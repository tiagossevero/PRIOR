[
{
  "model": "desktop.document2",
  "pk": 160029,
  "fields": {
    "owner": [
      "tsevero"
    ],
    "name": "PRIOR. COBRANÃ‡A",
    "description": "",
    "uuid": "13addfc5-7ea3-4f33-bd07-f3b8ce8c58f9",
    "type": "directory",
    "connector": null,
    "data": "{}",
    "extra": "",
    "search": null,
    "last_modified": "2025-10-07T15:20:02.353",
    "version": 1,
    "is_history": false,
    "is_managed": false,
    "is_trashed": false,
    "parent_directory": [
      "a8280168-7cf2-40b1-bc5d-733014ae6ba9",
      1,
      false
    ],
    "dependencies": []
  }
},
{
  "model": "desktop.document2",
  "pk": 160134,
  "fields": {
    "owner": [
      "tsevero"
    ],
    "name": "PRIOR. COBR: Gerar Tabelas",
    "description": "",
    "uuid": "e93ece4e-2607-28ac-a9ea-c1ab1bbd0119",
    "type": "query-impala",
    "connector": null,
    "data": "{\"id\": 160134, \"uuid\": \"c12d1cff-e83d-41b8-b01c-f5fd4f1046fe\", \"name\": \"PRIOR. COBR: Gerar Tabelas\", \"description\": \"\", \"type\": \"query-impala\", \"initialType\": \"impala\", \"coordinatorUuid\": null, \"isHistory\": false, \"isManaged\": false, \"parentSavedQueryUuid\": \"e93ece4e-2607-28ac-a9ea-c1ab1bbd0119\", \"isSaved\": true, \"onSuccessUrl\": null, \"pubSubUrl\": null, \"isPresentationModeDefault\": false, \"isPresentationMode\": false, \"isPresentationModeInitialized\": true, \"presentationSnippets\": {}, \"isHidingCode\": false, \"snippets\": [{\"id\": \"03f501e3-5b7e-4289-368c-b989c1498a4d\", \"name\": \"\", \"type\": \"impala\", \"connector\": {\"name\": \"Impala\", \"type\": \"impala\", \"id\": \"impala\", \"displayName\": \"Impala\", \"buttonName\": \"Consulta\", \"tooltip\": \"Impala Query\", \"optimizer\": \"off\", \"page\": \"/editor/?type=impala\", \"is_sql\": true, \"is_batchable\": true, \"dialect\": \"impala\", \"dialect_properties\": {}}, \"isSqlDialect\": true, \"dialect\": \"impala\", \"isBatchable\": true, \"autocompleteSettings\": {\"temporaryOnly\": false}, \"aceCursorPosition\": {\"row\": 1587, \"column\": 54}, \"errors\": [], \"aceErrorsHolder\": [], \"aceWarningsHolder\": [], \"aceErrors\": [], \"aceWarnings\": [], \"editorMode\": true, \"dbSelectionVisible\": false, \"showExecutionAnalysis\": true, \"namespace\": {\"id\": \"8271bb54-0cd9-47e1-89f2-a8a5de91d943\", \"name\": \"8271bb54-0cd9-47e1-89f2-a8a5de91d943\", \"status\": \"CREATED\", \"computes\": [{\"id\": \"8271bb54-0cd9-47e1-89f2-a8a5de91d943\", \"name\": \"8271bb54-0cd9-47e1-89f2-a8a5de91d943\", \"type\": \"direct\", \"credentials\": {}}]}, \"compute\": {\"id\": \"8271bb54-0cd9-47e1-89f2-a8a5de91d943\", \"name\": \"8271bb54-0cd9-47e1-89f2-a8a5de91d943\", \"namespace\": \"8271bb54-0cd9-47e1-89f2-a8a5de91d943\", \"interface\": \"impala\", \"type\": \"direct\", \"options\": {}}, \"database\": \"usr_sat_cadastro\", \"currentQueryTab\": \"queryResults\", \"pinnedContextTabs\": [], \"loadingQueries\": false, \"queriesHasErrors\": false, \"queriesCurrentPage\": 1, \"queriesTotalPages\": 3, \"queriesFilter\": \"\", \"queriesFilterVisible\": false, \"statementType\": \"text\", \"statementTypes\": [\"text\", \"file\"], \"statementPath\": \"\", \"externalStatementLoaded\": false, \"associatedDocumentLoading\": true, \"associatedDocumentUuid\": null, \"statement_raw\": \"-- ============================================================================\\r\\n-- SISTEMA DE PRIORIZA\\u00c7\\u00c3O DE COBRAN\\u00c7A - GECOB V1.4 (OTIMIZADO)\\r\\n-- Receita Estadual de Santa Catarina\\r\\n-- ============================================================================\\r\\n-- MELHORIAS V1.4:\\r\\n-- - Parte 4 (Features ML) dividida em 7 etapas para evitar timeout\\r\\n-- - Cada etapa processa um grupo espec\\u00edfico de features\\r\\n-- - Consolida\\u00e7\\u00e3o final com JOINs otimizados\\r\\n-- - Tempo total estimado: 10-12 minutos (vs 20+ minutos anterior)\\r\\n-- ============================================================================\\r\\n\\r\\n-- ============================================================================\\r\\n-- PARTE 1: TABELAS CORE - EXTRA\\u00c7\\u00c3O E CONSOLIDA\\u00c7\\u00c3O\\r\\n-- ============================================================================\\r\\n\\r\\n-- ----------------------------------------------------------------------------\\r\\n-- 1.1. BASE DE D\\u00c9BITOS CONSOLIDADA\\r\\n-- D\\u00e9bitos ativos com informa\\u00e7\\u00f5es essenciais\\r\\n-- ----------------------------------------------------------------------------\\r\\nDROP TABLE IF EXISTS gecob.prior_debitos_base;\\r\\nCREATE TABLE gecob.prior_debitos_base STORED AS PARQUET AS\\r\\nSELECT\\r\\n    -- Identifica\\u00e7\\u00e3o\\r\\n    cd.CDB_TCC_NUM_IDENT AS num_ident_conta,\\r\\n    TRIM(cd.CDB_RGE_RUC) AS inscricao_estadual,\\r\\n    cd.CDB_TIP_DEBITO AS tipo_debito,\\r\\n    \\r\\n    -- Status e Classifica\\u00e7\\u00e3o\\r\\n    cd.CDB_IND_STATUS AS status_debito,\\r\\n    cd.CDB_SN_COM_GARANTIA AS flag_com_garantia,\\r\\n    cd.CDB_SN_DEV_CONTUMAZ AS flag_devedor_contumaz,\\r\\n    cd.CDB_SN_RECUP_JUDICIAL AS flag_recuperacao_judicial,\\r\\n    cd.CDB_SN_COM_FALENCIA AS flag_falencia,\\r\\n    cd.CDB_SN_COM_PROTESTO AS flag_protesto,\\r\\n    \\r\\n    -- Valores Financeiros\\r\\n    cd.CDB_VLR_TOT_DEV AS valor_total_devido,\\r\\n    cd.CDB_TIM_GRUPO_IMPOSTO AS grupo_imposto,\\r\\n    cd.CDB_SEQ_ULT_CONT AS seq_ultimo_contato,\\r\\n    cd.CDB_GRUPO_SETORIAL AS grupo_setorial,\\r\\n    cd.CDB_COD_GEREG AS codigo_gereg,\\r\\n    cd.CDB_COD_USEFI AS codigo_usefi,\\r\\n    cd.CDB_RGE_TSC_SIT_CAD AS situacao_cadastral_rge,\\r\\n    cd.CDB_RGE_TGE_VTIP_REG AS tipo_regime_rge,\\r\\n    cd.CDB_RGE_CODG_MUN AS codigo_municipio_rge,\\r\\n    \\r\\n    -- Datas\\r\\n    cd.CDB_DAT_INCLUSAO AS data_inclusao_cobranca,\\r\\n    cd.CDB_FEC_LIM_PAGO AS data_limite_pagamento,\\r\\n    cd.CDB_DAT_EXC_MOROSO AS data_exclusao_moroso,\\r\\n    cd.CDB_TCC_FEC_ULT_TRANS AS data_ultima_transacao,\\r\\n    \\r\\n    -- Metadados\\r\\n    CURRENT_TIMESTAMP() AS dt_carga\\r\\n\\r\\nFROM usr_sat_ctacte.cob_debitos cd\\r\\nWHERE cd.CDB_IND_STATUS = 1\\r\\n  AND cd.CDB_VLR_TOT_DEV > 0\\r\\n  AND cd.CDB_DAT_INCLUSAO >= DATE_SUB(CURRENT_DATE(), 730);\\r\\n\\r\\n-- ----------------------------------------------------------------------------\\r\\n-- 1.2. CONTA CORRENTE PR\\u00c9-AGREGADA POR INSCRI\\u00c7\\u00c3O ESTADUAL\\r\\n-- Agrega\\u00e7\\u00e3o pr\\u00e9via para evitar multiplica\\u00e7\\u00e3o de linhas no JOIN com master\\r\\n-- MELHORIA: Reduz drasticamente o tempo de cria\\u00e7\\u00e3o da prior_master_consolidado\\r\\n-- ----------------------------------------------------------------------------\\r\\nDROP TABLE IF EXISTS gecob.prior_conta_corrente;\\r\\nCREATE TABLE gecob.prior_conta_corrente STORED AS PARQUET AS\\r\\nSELECT\\r\\n    -- Identifica\\u00e7\\u00e3o\\r\\n    TRIM(tcc.TCC_RGE_RUC) AS inscricao_estadual,\\r\\n    \\r\\n    -- Agrega\\u00e7\\u00f5es de Per\\u00edodos e Documentos\\r\\n    MAX(tcc.TCC_PER_CTACTE) AS periodo_conta,\\r\\n    MAX(tcc.TCC_NUM_DOC) AS numero_documento,\\r\\n    MAX(tcc.TCC_NUM_CTA_IMP) AS numero_conta_imposto,\\r\\n    \\r\\n    -- Situa\\u00e7\\u00e3o da Conta (\\u00faltima)\\r\\n    MAX(tcc.TCC_SIT_CTACTE) AS situacao_conta,\\r\\n    MAX(tcc.TCC_EDO_CTACTE) AS estado_conta,\\r\\n    \\r\\n    -- Saldos Agregados (SOMA)\\r\\n    SUM(COALESCE(tcc.TCC_SALDO_IMPOSTO, 0)) AS saldo_imposto,\\r\\n    SUM(COALESCE(tcc.TCC_SALDO_MULTA, 0)) AS saldo_multa,\\r\\n    SUM(COALESCE(tcc.TCC_SALDO_JUROS, 0)) AS saldo_juros,\\r\\n    SUM(COALESCE(tcc.TCC_SALDO_CREDITO, 0)) AS saldo_credito,\\r\\n    SUM(COALESCE(tcc.TCC_SALDO_REAJUSTE, 0)) AS saldo_reajuste,\\r\\n    \\r\\n    -- Valores Informados Agregados (SOMA)\\r\\n    SUM(COALESCE(tcc.TCC_VAL_IMP_INF, 0)) AS valor_imposto_informado,\\r\\n    SUM(COALESCE(tcc.TCC_VAL_MUL_INF, 0)) AS valor_multa_informado,\\r\\n    SUM(COALESCE(tcc.TCC_VAL_INT_INF, 0)) AS valor_juros_informado,\\r\\n    SUM(COALESCE(tcc.TCC_VAL_CRED_INF, 0)) AS valor_credito_informado,\\r\\n    SUM(COALESCE(tcc.TCC_VAL_REAJUSTE_INF, 0)) AS valor_reajuste_informado,\\r\\n    \\r\\n    -- Tipos de Tributo (mais recente)\\r\\n    MAX(tcc.TCC_TIR_IDE_IMPTO) AS tipo_identificacao_imposto,\\r\\n    MAX(tcc.TCC_TIM_COD_IMPTO) AS codigo_tipo_imposto,\\r\\n    \\r\\n    -- Datas (mais recentes)\\r\\n    MAX(tcc.TCC_FEC_LIM_PAGO) AS data_limite_pagamento,\\r\\n    MAX(tcc.TCC_FEC_RECP) AS data_recepcionamento,\\r\\n    MAX(tcc.TCC_FEC_INCLUSAO) AS data_inclusao,\\r\\n    MAX(tcc.TCC_FEC_QUITACAO) AS data_quitacao,\\r\\n    MAX(tcc.TCC_FEC_ULT_TRANS) AS data_ultima_transacao,\\r\\n    MAX(tcc.TCC_FEC_TRANS) AS data_transacao,\\r\\n    \\r\\n    -- Metadados\\r\\n    COUNT(*) AS qtd_registros_conta_corrente,\\r\\n    CURRENT_TIMESTAMP() AS dt_carga\\r\\n\\r\\nFROM usr_sat_ctacte.tab_cta_cte tcc\\r\\nGROUP BY TRIM(tcc.TCC_RGE_RUC);\\r\\n\\r\\n-- ----------------------------------------------------------------------------\\r\\n-- 1.3. DADOS CADASTRAIS DOS CONTRIBUINTES (CORRIGIDO)\\r\\n-- Informa\\u00e7\\u00f5es cadastrais completas com nomes corretos das colunas\\r\\n-- ----------------------------------------------------------------------------\\r\\nDROP TABLE IF EXISTS gecob.prior_contribuintes_cadastro;\\r\\nCREATE TABLE gecob.prior_contribuintes_cadastro STORED AS PARQUET AS\\r\\nSELECT\\r\\n    -- Identifica\\u00e7\\u00e3o (CORRIGIDO)\\r\\n    TRIM(oc.nu_ie) AS inscricao_estadual,\\r\\n    TRIM(oc.nu_ie_rge_ruc) AS inscricao_estadual_rge_ruc,\\r\\n    oc.nu_cnpj AS cnpj,\\r\\n    oc.nu_cnpj_grupo AS cnpj_grupo,\\r\\n    oc.nm_razao_social AS razao_social,\\r\\n    oc.nm_fantasia AS nome_fantasia,\\r\\n    \\r\\n    -- Situa\\u00e7\\u00e3o Cadastral (CORRIGIDO)\\r\\n    oc.cd_sit_cadastral AS situacao_cadastral_cod,\\r\\n    oc.nm_sit_cadastral AS situacao_cadastral_desc,\\r\\n    oc.dt_sit_cadastral AS data_situacao_cadastral,\\r\\n    \\r\\n    -- Classifica\\u00e7\\u00e3o Econ\\u00f4mica (CORRIGIDO)\\r\\n    SUBSTR(CAST(oc.cd_cnae AS STRING), 1, 5) AS cnae_classe,\\r\\n    SUBSTR(CAST(oc.cd_cnae AS STRING), 1, 2) AS cnae_divisao,\\r\\n    oc.de_classe AS descricao_cnae,\\r\\n    oc.cd_secao AS secao_cnae,\\r\\n    oc.de_secao AS descricao_secao,\\r\\n    oc.cd_divisao AS divisao_cnae,\\r\\n    oc.de_divisao AS descricao_divisao,\\r\\n    \\r\\n    -- Regime Tribut\\u00e1rio (CORRIGIDO)\\r\\n    oc.cd_reg_apuracao AS regime_apuracao_cod,\\r\\n    oc.nm_reg_apuracao AS regime_apuracao_desc,\\r\\n    oc.cd_tipo_contribuinte AS tipo_contribuinte_cod,\\r\\n    oc.nm_tipo_contribuinte AS tipo_contribuinte_desc,\\r\\n    oc.cd_enq_empresa AS enquadramento_empresa_cod,\\r\\n    oc.nm_enq_empresa AS enquadramento_empresa_desc,\\r\\n    \\r\\n    -- Caracter\\u00edsticas da Empresa\\r\\n    oc.cd_natureza_juridica AS natureza_juridica_cod,\\r\\n    oc.nm_natureza_juridica AS natureza_juridica_desc,\\r\\n    oc.dt_constituicao_empresa AS data_constituicao,\\r\\n    oc.dt_inicio_icms AS data_inicio_icms,\\r\\n    oc.sn_simples_nacional_rfb AS flag_simples_nacional,\\r\\n    oc.sn_dtec AS flag_dtec,\\r\\n    oc.dt_credenciamento_dtec AS data_credenciamento_dtec,\\r\\n    oc.sn_suspensao_dfe AS flag_suspensao_dfe,\\r\\n    oc.dt_suspensao_dfe AS data_suspensao_dfe,\\r\\n    \\r\\n    -- Localiza\\u00e7\\u00e3o (CORRIGIDO)\\r\\n    oc.cd_usefi AS codigo_usefi,\\r\\n    oc.nm_usefi AS nome_usefi,\\r\\n    oc.cd_gerfe AS codigo_gerfei,\\r\\n    oc.nm_gerfe AS nome_gerfe,\\r\\n    oc.cd_ges AS codigo_ges,\\r\\n    oc.nm_ges AS nome_ges,\\r\\n    oc.cd_munic AS codigo_municipio,\\r\\n    oc.nm_munic AS nome_municipio,\\r\\n    oc.cd_uf AS codigo_uf,\\r\\n    oc.cd_cep AS cep,\\r\\n    oc.nm_logradouro AS logradouro,\\r\\n    oc.nu_logradouro AS numero_logradouro,\\r\\n    oc.nm_bairro AS bairro,\\r\\n    \\r\\n    -- Contato\\r\\n    oc.nu_telefone AS telefone,\\r\\n    oc.nm_email AS email,\\r\\n    \\r\\n    -- Contador\\r\\n    oc.nu_cpf_cnpj_contador AS cnpj_cpf_contador,\\r\\n    oc.nm_contador AS nome_contador,\\r\\n    oc.nu_crc_contador AS crc_contador,\\r\\n    oc.dt_ini_relac_contador AS data_inicio_relacao_contador,\\r\\n    \\r\\n    -- V\\u00ednculos\\r\\n    oc.qt_vinculos AS qtd_vinculos,\\r\\n    oc.qt_vinculos_ativos AS qtd_vinculos_ativos,\\r\\n    oc.qt_socios AS qtd_socios,\\r\\n    oc.qt_socios_ativos AS qtd_socios_ativos,\\r\\n    \\r\\n    -- Consolida\\u00e7\\u00e3o\\r\\n    oc.sn_apur_consolidada AS flag_apuracao_consolidada,\\r\\n    oc.sn_estab_consolidado AS flag_estabelecimento_consolidado,\\r\\n    oc.sn_estab_consolidador AS flag_estabelecimento_consolidador,\\r\\n    oc.sn_matriz AS flag_matriz,\\r\\n    oc.nu_ie_consolidador AS ie_consolidador,\\r\\n    \\r\\n    -- Metadados\\r\\n    oc.dt_inclusao_cad AS data_inclusao_cadastro,\\r\\n    oc.dt_ult_atualiz AS data_ultima_atualizacao,\\r\\n    oc.dt_inclusao_ods AS data_inclusao_ods,\\r\\n    oc.dt_ult_atualiz_ods AS data_ultima_atualizacao_ods,\\r\\n    oc.id_seq_ult_alt AS seq_ultima_alteracao,\\r\\n    oc.dt_alteracao AS data_alteracao,\\r\\n    \\r\\n    CURRENT_TIMESTAMP() AS dt_carga\\r\\n\\r\\nFROM usr_sat_ods.vw_ods_contrib oc;\\r\\n\\r\\n-- ----------------------------------------------------------------------------\\r\\n-- 1.4. HIST\\u00d3RICO DE CONTATOS\\r\\n-- Agrega\\u00e7\\u00e3o de tentativas de contato por contribuinte\\r\\n-- MELHORIA: Filtro din\\u00e2mico para capturar \\u00faltimos 12 meses de contatos\\r\\n-- ----------------------------------------------------------------------------\\r\\nDROP TABLE IF EXISTS gecob.prior_historico_contatos;\\r\\nCREATE TABLE gecob.prior_historico_contatos STORED AS PARQUET AS\\r\\nWITH contatos_raw AS (\\r\\n    SELECT \\r\\n        cdb_tcc_num_ident AS num_ident_conta,\\r\\n        TRIM(cdb_rge_ruc) AS inscricao_estadual,\\r\\n        cdb_seq_contato AS seq_contato,\\r\\n        cdb_dat_inclusao AS data_inclusao,\\r\\n        cdb_dat_contato AS data_contato,\\r\\n        cdb_tus_cod_usr AS codigo_usuario,\\r\\n        cdb_tge_ctip_resp AS tipo_resposta,\\r\\n        cdb_des_obs AS observacao,\\r\\n        cdb_ctip_contato AS tipo_contato,\\r\\n        cdb_tp_origem_contato AS origem_contato,\\r\\n        cdb_dt_promessa AS data_promessa,\\r\\n        cdb_debito_contato AS debito_contato\\r\\n    FROM usr_sat_ctacte.raw_cob_debitos_contato\\r\\n    WHERE \\r\\n        -- MELHORIA: Filtro din\\u00e2mico para \\u00faltimos 12 meses\\r\\n        cdb_dat_contato >= DATE_SUB(CURRENT_DATE(), 365)\\r\\n        -- Filtro alternativo por parti\\u00e7\\u00f5es (se a tabela for particionada)\\r\\n        AND ano >= YEAR(DATE_SUB(CURRENT_DATE(), 365))\\r\\n        -- Para melhor performance, voc\\u00ea pode ajustar para:\\r\\n        -- ano = YEAR(CURRENT_DATE()) OR ano = YEAR(DATE_SUB(CURRENT_DATE(), 365))\\r\\n)\\r\\nSELECT\\r\\n    num_ident_conta,\\r\\n    inscricao_estadual,\\r\\n    \\r\\n    -- Contagens\\r\\n    COUNT(seq_contato) AS qtd_total_contatos,\\r\\n    COUNT(DISTINCT tipo_contato) AS qtd_tipos_contato_distintos,\\r\\n    COUNT(DISTINCT origem_contato) AS qtd_origens_distintas,\\r\\n    COUNT(DISTINCT codigo_usuario) AS qtd_usuarios_distintos,\\r\\n    \\r\\n    -- \\u00daltimo Contato\\r\\n    MAX(seq_contato) AS seq_ultimo_contato,\\r\\n    MAX(data_contato) AS data_ultimo_contato,\\r\\n    \\r\\n    -- Tipos de Resposta\\r\\n    SUM(CASE WHEN tipo_resposta = 1 THEN 1 ELSE 0 END) AS qtd_respostas_positivas,\\r\\n    SUM(CASE WHEN tipo_resposta = 2 THEN 1 ELSE 0 END) AS qtd_respostas_negativas,\\r\\n    SUM(CASE WHEN tipo_resposta IS NULL OR tipo_resposta = 0 THEN 1 ELSE 0 END) AS qtd_sem_resposta,\\r\\n    \\r\\n    -- Promessas\\r\\n    COUNT(CASE WHEN data_promessa IS NOT NULL THEN 1 END) AS qtd_com_promessa_pagamento,\\r\\n    MAX(data_promessa) AS data_ultima_promessa,\\r\\n    \\r\\n    -- Taxa de Resposta\\r\\n    CASE \\r\\n        WHEN COUNT(seq_contato) > 0 \\r\\n        THEN CAST(SUM(CASE WHEN tipo_resposta IS NOT NULL AND tipo_resposta > 0 THEN 1 ELSE 0 END) AS DOUBLE) / COUNT(seq_contato)\\r\\n        ELSE 0 \\r\\n    END AS taxa_resposta,\\r\\n    \\r\\n    -- Dias desde \\u00faltimo contato\\r\\n    DATEDIFF(CURRENT_DATE(), MAX(data_contato)) AS dias_desde_ultimo_contato,\\r\\n    \\r\\n    -- NOVA M\\u00c9TRICA: Contatos nos \\u00faltimos 30 dias\\r\\n    SUM(CASE WHEN data_contato >= DATE_SUB(CURRENT_DATE(), 30) THEN 1 ELSE 0 END) AS qtd_contatos_ultimos_30_dias,\\r\\n    \\r\\n    -- NOVA M\\u00c9TRICA: Contatos nos \\u00faltimos 90 dias\\r\\n    SUM(CASE WHEN data_contato >= DATE_SUB(CURRENT_DATE(), 90) THEN 1 ELSE 0 END) AS qtd_contatos_ultimos_90_dias,\\r\\n    \\r\\n    -- Metadados\\r\\n    CURRENT_TIMESTAMP() AS dt_carga\\r\\n\\r\\nFROM contatos_raw\\r\\nGROUP BY num_ident_conta, inscricao_estadual;\\r\\n\\r\\n-- ----------------------------------------------------------------------------\\r\\n-- 1.5. PARCELAMENTOS ATIVOS\\r\\n-- Informa\\u00e7\\u00f5es sobre parcelamentos de d\\u00edvidas\\r\\n-- ----------------------------------------------------------------------------\\r\\nDROP TABLE IF EXISTS gecob.prior_parcelamentos;\\r\\nCREATE TABLE gecob.prior_parcelamentos STORED AS PARQUET AS\\r\\nSELECT\\r\\n    -- Identifica\\u00e7\\u00e3o\\r\\n    tpa.TPA_NUM_PARCELAMENTO AS numero_parcelamento,\\r\\n    tpa.TPA_TCC_NUM_IDENT AS num_ident_conta,\\r\\n    TRIM(tpa.TPA_RGE_RUC) AS inscricao_estadual,\\r\\n    tpa.TPA_REGRA AS regra_parcelamento,\\r\\n    \\r\\n    -- Status do Parcelamento\\r\\n    tpa.TPA_STATUS AS status_parcelamento,\\r\\n    CASE \\r\\n        WHEN tpa.TPA_STATUS = 1 THEN 'ATIVO'\\r\\n        WHEN tpa.TPA_STATUS = 2 THEN 'CANCELADO'\\r\\n        WHEN tpa.TPA_STATUS = 3 THEN 'SUSPENSO'\\r\\n        WHEN tpa.TPA_STATUS = 4 THEN 'INADIMPLENTE'\\r\\n        WHEN tpa.TPA_STATUS = 5 THEN 'QUITADO'\\r\\n        ELSE 'OUTROS'\\r\\n    END AS status_parcelamento_desc,\\r\\n    \\r\\n    tpa.TPA_TIPO_CANCELAMENTO AS tipo_cancelamento,\\r\\n    tpa.TPA_STATUS_AUTORIZACAO AS status_autorizacao,\\r\\n    tpa.TPA_IND_DIVIDA_ATIVA AS flag_divida_ativa,\\r\\n    \\r\\n    -- Valores do Parcelamento\\r\\n    COALESCE(tpa.TPA_SALDO_DIVIDA, 0) AS saldo_divida,\\r\\n    COALESCE(tpa.TPA_SALDO_PARCELADO, 0) AS saldo_parcelado,\\r\\n    COALESCE(tpa.TPA_SALDO_IMPOSTO, 0) AS saldo_imposto_parcelado,\\r\\n    COALESCE(tpa.TPA_SALDO_MULTA, 0) AS saldo_multa_parcelada,\\r\\n    COALESCE(tpa.TPA_SALDO_JUROS, 0) AS saldo_juros_parcelado,\\r\\n    COALESCE(tpa.TPA_SALDO_REAJUSTE, 0) AS saldo_reajuste_parcelado,\\r\\n    COALESCE(tpa.TPA_SALDO_CREDITO, 0) AS saldo_credito_parcelado,\\r\\n    \\r\\n    -- Parcelas\\r\\n    tpa.TPA_NUM_PARCELAS AS numero_parcelas,\\r\\n    \\r\\n    -- Origem\\r\\n    tpa.TPA_ORIGEM_SISTEMA AS origem_sistema,\\r\\n    tpa.TPA_TIPO_DIVIDA AS tipo_divida,\\r\\n    tpa.TPA_NUM_PROC_ADM AS numero_processo_administrativo,\\r\\n    tpa.TPA_MCR_COD_RCTA AS codigo_receita,\\r\\n    \\r\\n    -- Localiza\\u00e7\\u00e3o\\r\\n    tpa.TPA_USEFI AS codigo_usefi,\\r\\n    tpa.TPA_GEREG AS codigo_gereg,\\r\\n    tpa.TPA_MUNICIPIO AS codigo_municipio,\\r\\n    \\r\\n    -- Datas\\r\\n    tpa.TPA_DT_PEDIDO AS data_pedido,\\r\\n    tpa.TPA_DT_CANCELAMENTO AS data_cancelamento,\\r\\n    tpa.TPA_DT_AUTORIZACAO AS data_autorizacao,\\r\\n    tpa.TPA_DT_PRAZO_PAGAMENTO AS data_prazo_pagamento,\\r\\n    tpa.TPA_DT_ULT_CALCULO AS data_ultimo_calculo,\\r\\n    tpa.TPA_DT_INCLUSAO AS data_inclusao,\\r\\n    tpa.TPA_DT_ATUALIZACAO AS data_atualizacao,\\r\\n    \\r\\n    -- Usu\\u00e1rios\\r\\n    tpa.TPA_TUS_COD_USR AS codigo_usuario,\\r\\n    tpa.TPA_TUS_COD_USR_CANCEL AS codigo_usuario_cancelamento,\\r\\n    tpa.TPA_TUS_COD_USR_AUT AS codigo_usuario_autorizacao,\\r\\n    \\r\\n    -- Metadados\\r\\n    CURRENT_TIMESTAMP() AS dt_carga\\r\\n\\r\\nFROM usr_sat_ctacte.tab_parcelamento_pedido tpa;\\r\\n\\r\\n-- ============================================================================\\r\\n-- PARTE 2: ENRIQUECIMENTO - SCORES E INDICADORES\\r\\n-- ============================================================================\\r\\n\\r\\n-- ----------------------------------------------------------------------------\\r\\n-- 2.1. SCORE DE EMPRESAS NOTEIRAS (NEAF)\\r\\n-- Agrega\\u00e7\\u00e3o de scores de ind\\u00edcios de irregularidades\\r\\n-- ----------------------------------------------------------------------------\\r\\nDROP TABLE IF EXISTS gecob.prior_score_noteiras;\\r\\nCREATE TABLE gecob.prior_score_noteiras STORED AS PARQUET AS\\r\\nWITH indicios_expandidos AS (\\r\\n    SELECT \\r\\n        nei.nu_cpf_cnpj AS cnpj_cpf,\\r\\n        nei.nu_score AS score_indicio,\\r\\n        nei.tx_descricao_indicio AS descricao_indicio,\\r\\n        comp.tx_descricao_complemento AS descricao_complemento\\r\\n    FROM neaf.empresa_indicio nei\\r\\n    JOIN nei.indicio_complemento comp\\r\\n    WHERE nei.cd_atual = 1\\r\\n)\\r\\nSELECT \\r\\n    cnpj_cpf,\\r\\n    \\r\\n    -- Score Agregado\\r\\n    SUM(COALESCE(score_indicio, 0)) AS score_total_noteiras,\\r\\n    COUNT(score_indicio) AS qtd_indicios,\\r\\n    AVG(COALESCE(score_indicio, 0)) AS score_medio_noteiras,\\r\\n    MAX(COALESCE(score_indicio, 0)) AS score_maximo_indicio,\\r\\n    \\r\\n    -- Tipos de Ind\\u00edcios\\r\\n    COUNT(DISTINCT descricao_indicio) AS qtd_tipos_indicios_distintos,\\r\\n    \\r\\n    -- Classifica\\u00e7\\u00e3o de Risco\\r\\n    CASE \\r\\n        WHEN SUM(COALESCE(score_indicio, 0)) = 0 THEN 'SEM_INDICIO'\\r\\n        WHEN SUM(COALESCE(score_indicio, 0)) < 20 THEN 'BAIXO'\\r\\n        WHEN SUM(COALESCE(score_indicio, 0)) < 50 THEN 'MEDIO'\\r\\n        WHEN SUM(COALESCE(score_indicio, 0)) < 100 THEN 'ALTO'\\r\\n        ELSE 'CRITICO'\\r\\n    END AS classificacao_risco_noteiras,\\r\\n    \\r\\n    CURRENT_TIMESTAMP() AS dt_carga\\r\\n\\r\\nFROM indicios_expandidos\\r\\nGROUP BY cnpj_cpf;\\r\\n\\r\\n-- ----------------------------------------------------------------------------\\r\\n-- 2.2. PAGAMENTOS POR PER\\u00cdODO\\r\\n-- Hist\\u00f3rico de pagamentos de ICMS\\r\\n-- ----------------------------------------------------------------------------\\r\\nDROP TABLE IF EXISTS gecob.prior_pagamentos_historico;\\r\\nCREATE TABLE gecob.prior_pagamentos_historico STORED AS PARQUET AS\\r\\nWITH pagamentos_6m AS (\\r\\n    SELECT \\r\\n        p.nu_cnpj AS cnpj,\\r\\n        p.nu_per_pagamento AS periodo_pagamento,\\r\\n        COUNT(p.nu_id_pagamento) AS qtd_pagamentos,\\r\\n        SUM(COALESCE(p.vl_total, 0)) AS valor_total_pago\\r\\n    FROM usr_sat_ods.vw_ods_pagamento p\\r\\n    WHERE p.nu_per_pagamento BETWEEN 202410 AND 202503\\r\\n      AND p.cd_receita IN (\\r\\n          1449, 1465, 1473, 1554, 1570, 1589, 1597, 1600, 1643, \\r\\n          1651, 1716, 1724, 1732, 1740, 1759, 1767, 1783, 1791, \\r\\n          2140, 2496, 2526, 2534, 3000, 3050, 3662, 4383, 7110, \\r\\n          7137, 9687, 9784\\r\\n      )\\r\\n    GROUP BY p.nu_cnpj, p.nu_per_pagamento\\r\\n)\\r\\nSELECT\\r\\n    cnpj,\\r\\n    \\r\\n    -- Agrega\\u00e7\\u00f5es de 6 meses\\r\\n    COUNT(DISTINCT periodo_pagamento) AS qtd_periodos_com_pagamento,\\r\\n    SUM(qtd_pagamentos) AS qtd_total_pagamentos_6m,\\r\\n    SUM(valor_total_pago) AS valor_total_pago_6m,\\r\\n    AVG(valor_total_pago) AS valor_medio_pago_periodo,\\r\\n    STDDEV(valor_total_pago) AS desvio_valor_pago,\\r\\n    \\r\\n    -- \\u00daltima Atividade\\r\\n    MAX(periodo_pagamento) AS ultimo_periodo_pagamento,\\r\\n    \\r\\n    -- Regularidade de Pagamento\\r\\n    CASE \\r\\n        WHEN COUNT(DISTINCT periodo_pagamento) >= 6 THEN 'REGULAR'\\r\\n        WHEN COUNT(DISTINCT periodo_pagamento) >= 4 THEN 'PARCIAL'\\r\\n        WHEN COUNT(DISTINCT periodo_pagamento) >= 1 THEN 'IRREGULAR'\\r\\n        ELSE 'SEM_PAGAMENTO'\\r\\n    END AS classificacao_regularidade,\\r\\n    \\r\\n    -- Coeficiente de Varia\\u00e7\\u00e3o dos Pagamentos\\r\\n    CASE \\r\\n        WHEN AVG(valor_total_pago) > 0 \\r\\n        THEN STDDEV(valor_total_pago) / NULLIF(AVG(valor_total_pago), 0)\\r\\n        ELSE NULL \\r\\n    END AS coef_variacao_pagamentos,\\r\\n    \\r\\n    CURRENT_TIMESTAMP() AS dt_carga\\r\\n\\r\\nFROM pagamentos_6m\\r\\nGROUP BY cnpj;\\r\\n\\r\\n-- ----------------------------------------------------------------------------\\r\\n-- 2.3. DECLARA\\u00c7\\u00d5ES DIME - \\u00daLTIMOS 6 MESES\\r\\n-- Agrega\\u00e7\\u00e3o de declara\\u00e7\\u00f5es mensais\\r\\n-- ----------------------------------------------------------------------------\\r\\nDROP TABLE IF EXISTS gecob.prior_declaracoes_dime;\\r\\nCREATE TABLE gecob.prior_declaracoes_dime STORED AS PARQUET AS\\r\\nWITH dime_6m AS (\\r\\n    SELECT \\r\\n        d.nu_cnpj AS cnpj,\\r\\n        d.nu_ie AS inscricao_estadual,\\r\\n        d.nu_per_ref AS periodo_referencia,\\r\\n        d.sn_omisso AS flag_omisso,\\r\\n        d.sn_entregue_prazo AS flag_entregue_prazo,\\r\\n        d.sn_com_movimento AS flag_com_movimento,\\r\\n        COALESCE(d.vl_faturamento, 0) AS faturamento,\\r\\n        COALESCE(d.vl_receita_bruta, 0) AS receita_bruta,\\r\\n        COALESCE(d.vl_tot_deb, 0) AS icms_devido,\\r\\n        COALESCE(d.vl_deb_recolher, 0) AS icms_recolher\\r\\n    FROM usr_sat_ods.vw_ods_decl_dime d\\r\\n    WHERE d.nu_per_ref BETWEEN 202410 AND 202503\\r\\n      AND d.sn_cancelada = 0\\r\\n)\\r\\nSELECT\\r\\n    cnpj,\\r\\n    MAX(inscricao_estadual) AS inscricao_estadual,\\r\\n    \\r\\n    -- Contagens\\r\\n    COUNT(DISTINCT periodo_referencia) AS qtd_periodos_declarados,\\r\\n    SUM(CASE WHEN flag_omisso = 1 THEN 1 ELSE 0 END) AS qtd_periodos_omissos,\\r\\n    SUM(CASE WHEN flag_com_movimento = 1 THEN 1 ELSE 0 END) AS qtd_periodos_com_movimento,\\r\\n    SUM(CASE WHEN flag_entregue_prazo = 1 THEN 1 ELSE 0 END) AS qtd_entregue_prazo,\\r\\n    \\r\\n    -- Agregados Financeiros\\r\\n    SUM(faturamento) AS faturamento_total_6m,\\r\\n    SUM(receita_bruta) AS receita_bruta_total_6m,\\r\\n    SUM(icms_devido) AS icms_devido_total_6m,\\r\\n    SUM(icms_recolher) AS icms_recolher_total_6m,\\r\\n    \\r\\n    AVG(faturamento) AS faturamento_medio_6m,\\r\\n    STDDEV(faturamento) AS faturamento_desvio_6m,\\r\\n    \\r\\n    -- Al\\u00edquota Efetiva M\\u00e9dia\\r\\n    CASE \\r\\n        WHEN SUM(faturamento) > 0 \\r\\n        THEN SUM(icms_devido) / NULLIF(SUM(faturamento), 0)\\r\\n        ELSE NULL \\r\\n    END AS aliquota_efetiva_media_6m,\\r\\n    \\r\\n    -- Classifica\\u00e7\\u00f5es\\r\\n    CASE \\r\\n        WHEN COUNT(DISTINCT periodo_referencia) >= 6 THEN 'REGULAR'\\r\\n        WHEN COUNT(DISTINCT periodo_referencia) >= 4 THEN 'PARCIAL'\\r\\n        WHEN COUNT(DISTINCT periodo_referencia) >= 1 THEN 'IRREGULAR'\\r\\n        ELSE 'SEM_DECLARACAO'\\r\\n    END AS classificacao_regularidade_declaracao,\\r\\n    \\r\\n    CASE \\r\\n        WHEN SUM(CASE WHEN flag_omisso = 1 THEN 1 ELSE 0 END) >= 3 THEN 'OMISSO_RECORRENTE'\\r\\n        WHEN SUM(CASE WHEN flag_omisso = 1 THEN 1 ELSE 0 END) >= 1 THEN 'OMISSO_EVENTUAL'\\r\\n        ELSE 'NAO_OMISSO'\\r\\n    END AS classificacao_omissao,\\r\\n    \\r\\n    -- Porte Baseado em Faturamento\\r\\n    CASE\\r\\n        WHEN SUM(faturamento) / NULLIF(COUNT(DISTINCT periodo_referencia), 0) <= 30000 THEN 'MICRO'\\r\\n        WHEN SUM(faturamento) / NULLIF(COUNT(DISTINCT periodo_referencia), 0) <= 400000 THEN 'PEQUENO'\\r\\n        WHEN SUM(faturamento) / NULLIF(COUNT(DISTINCT periodo_referencia), 0) <= 5000000 THEN 'MEDIO'\\r\\n        WHEN SUM(faturamento) / NULLIF(COUNT(DISTINCT periodo_referencia), 0) > 5000000 THEN 'GRANDE'\\r\\n        ELSE 'SEM_FATURAMENTO'\\r\\n    END AS porte_por_faturamento,\\r\\n    \\r\\n    CURRENT_TIMESTAMP() AS dt_carga\\r\\n\\r\\nFROM dime_6m\\r\\nGROUP BY cnpj;\\r\\n\\r\\n-- ============================================================================\\r\\n-- PARTE 3: TABELA MASTER CONSOLIDADA (CORRIGIDA - JOIN POR INSCRI\\u00c7\\u00c3O ESTADUAL)\\r\\n-- ============================================================================\\r\\n\\r\\n-- ----------------------------------------------------------------------------\\r\\n-- 3.1. TABELA MESTRE - CONSOLIDA\\u00c7\\u00c3O DE TODOS OS DADOS (SEM DUPLICATAS)\\r\\n-- Agrega\\u00e7\\u00e3o por inscri\\u00e7\\u00e3o estadual eliminando duplicatas\\r\\n-- ----------------------------------------------------------------------------\\r\\nDROP TABLE IF EXISTS gecob.prior_master_consolidado;\\r\\nCREATE TABLE gecob.prior_master_consolidado STORED AS PARQUET AS\\r\\nSELECT\\r\\n    -- ========================================================================\\r\\n    -- IDENTIFICA\\u00c7\\u00c3O PRINCIPAL\\r\\n    -- ========================================================================\\r\\n    db.inscricao_estadual,\\r\\n    db.tipo_debito,\\r\\n    \\r\\n    -- ========================================================================\\r\\n    -- INFORMA\\u00c7\\u00d5ES DO D\\u00c9BITO (AGREGADAS)\\r\\n    -- ========================================================================\\r\\n    MAX(db.status_debito) AS status_debito,\\r\\n    SUM(db.valor_total_devido) AS valor_total_devido,\\r\\n    MIN(db.data_inclusao_cobranca) AS data_inclusao_cobranca,\\r\\n    MAX(db.data_limite_pagamento) AS data_limite_pagamento,\\r\\n    MAX(db.data_exclusao_moroso) AS data_exclusao_moroso,\\r\\n    MAX(db.data_ultima_transacao) AS data_ultima_transacao,\\r\\n    MAX(db.flag_com_garantia) AS flag_com_garantia,\\r\\n    MAX(db.flag_devedor_contumaz) AS flag_devedor_contumaz,\\r\\n    MAX(db.flag_recuperacao_judicial) AS flag_recuperacao_judicial,\\r\\n    MAX(db.flag_falencia) AS flag_falencia,\\r\\n    MAX(db.flag_protesto) AS flag_protesto,\\r\\n    MAX(db.grupo_imposto) AS grupo_imposto,\\r\\n    MAX(db.seq_ultimo_contato) AS seq_ultimo_contato,\\r\\n    MAX(db.grupo_setorial) AS grupo_setorial,\\r\\n    MAX(db.codigo_gereg) AS codigo_gereg,\\r\\n    MAX(db.codigo_usefi) AS codigo_usefi,\\r\\n    MAX(db.situacao_cadastral_rge) AS situacao_cadastral_rge,\\r\\n    MAX(db.tipo_regime_rge) AS tipo_regime_rge,\\r\\n    MAX(db.codigo_municipio_rge) AS codigo_municipio_rge,\\r\\n    \\r\\n    -- ========================================================================\\r\\n    -- DADOS DA CONTA CORRENTE (J\\u00c1 PR\\u00c9-AGREGADOS)\\r\\n    -- MELHORIA: N\\u00e3o precisa mais de SUM() pois a tabela j\\u00e1 vem agregada por IE\\r\\n    -- ========================================================================\\r\\n    MAX(cc.periodo_conta) AS periodo_conta,\\r\\n    MAX(cc.numero_documento) AS numero_documento,\\r\\n    MAX(cc.numero_conta_imposto) AS numero_conta_imposto,\\r\\n    MAX(cc.situacao_conta) AS situacao_conta,\\r\\n    MAX(cc.estado_conta) AS estado_conta,\\r\\n    MAX(cc.qtd_registros_conta_corrente) AS qtd_registros_conta_corrente,\\r\\n    \\r\\n    -- Saldos (J\\u00c1 AGREGADOS na prior_conta_corrente, apenas pegar com MAX)\\r\\n    MAX(COALESCE(cc.saldo_imposto, 0)) AS saldo_imposto,\\r\\n    MAX(COALESCE(cc.saldo_multa, 0)) AS saldo_multa,\\r\\n    MAX(COALESCE(cc.saldo_juros, 0)) AS saldo_juros,\\r\\n    MAX(COALESCE(cc.saldo_credito, 0)) AS saldo_credito,\\r\\n    MAX(COALESCE(cc.saldo_reajuste, 0)) AS saldo_reajuste,\\r\\n    MAX(COALESCE(cc.valor_imposto_informado, 0)) AS valor_imposto_informado,\\r\\n    MAX(COALESCE(cc.valor_multa_informado, 0)) AS valor_multa_informado,\\r\\n    MAX(COALESCE(cc.valor_juros_informado, 0)) AS valor_juros_informado,\\r\\n    MAX(COALESCE(cc.valor_credito_informado, 0)) AS valor_credito_informado,\\r\\n    MAX(COALESCE(cc.valor_reajuste_informado, 0)) AS valor_reajuste_informado,\\r\\n    MAX(cc.codigo_tipo_imposto) AS codigo_tipo_imposto,\\r\\n    MAX(cc.tipo_identificacao_imposto) AS tipo_identificacao_imposto,\\r\\n    \\r\\n    -- ========================================================================\\r\\n    -- DADOS CADASTRAIS (CORRIGIDO - JOIN POR IE)\\r\\n    -- ========================================================================\\r\\n    MAX(cad.cnpj) AS cnpj,\\r\\n    MAX(cad.cnpj_grupo) AS cnpj_grupo,\\r\\n    MAX(cad.razao_social) AS razao_social,\\r\\n    MAX(cad.nome_fantasia) AS nome_fantasia,\\r\\n    MAX(cad.situacao_cadastral_cod) AS situacao_cadastral_cod,\\r\\n    MAX(cad.situacao_cadastral_desc) AS situacao_cadastral_desc,\\r\\n    MAX(cad.data_situacao_cadastral) AS data_situacao_cadastral,\\r\\n    \\r\\n    -- Classifica\\u00e7\\u00e3o Econ\\u00f4mica\\r\\n    MAX(cad.cnae_classe) AS cnae_classe,\\r\\n    MAX(cad.cnae_divisao) AS cnae_divisao,\\r\\n    MAX(cad.descricao_cnae) AS descricao_cnae,\\r\\n    MAX(cad.secao_cnae) AS secao_cnae,\\r\\n    MAX(cad.descricao_secao) AS descricao_secao,\\r\\n    MAX(cad.divisao_cnae) AS divisao_cnae,\\r\\n    MAX(cad.descricao_divisao) AS descricao_divisao,\\r\\n    \\r\\n    -- Regime Tribut\\u00e1rio\\r\\n    MAX(cad.regime_apuracao_cod) AS regime_apuracao_cod,\\r\\n    MAX(cad.regime_apuracao_desc) AS regime_apuracao_desc,\\r\\n    MAX(cad.tipo_contribuinte_cod) AS tipo_contribuinte_cod,\\r\\n    MAX(cad.tipo_contribuinte_desc) AS tipo_contribuinte_desc,\\r\\n    MAX(cad.enquadramento_empresa_cod) AS enquadramento_empresa_cod,\\r\\n    MAX(cad.enquadramento_empresa_desc) AS enquadramento_empresa_desc,\\r\\n    \\r\\n    -- Caracter\\u00edsticas\\r\\n    MAX(cad.natureza_juridica_cod) AS natureza_juridica_cod,\\r\\n    MAX(cad.natureza_juridica_desc) AS natureza_juridica_desc,\\r\\n    MAX(cad.data_constituicao) AS data_constituicao,\\r\\n    MAX(cad.data_inicio_icms) AS data_inicio_icms,\\r\\n    MAX(cad.flag_simples_nacional) AS flag_simples_nacional,\\r\\n    MAX(cad.flag_dtec) AS flag_dtec,\\r\\n    MAX(cad.flag_suspensao_dfe) AS flag_suspensao_dfe,\\r\\n    MAX(cad.flag_matriz) AS flag_matriz,\\r\\n    MAX(cad.flag_apuracao_consolidada) AS flag_apuracao_consolidada,\\r\\n    MAX(cad.flag_estabelecimento_consolidado) AS flag_estabelecimento_consolidado,\\r\\n    MAX(cad.flag_estabelecimento_consolidador) AS flag_estabelecimento_consolidador,\\r\\n    \\r\\n    -- Localiza\\u00e7\\u00e3o\\r\\n    MAX(cad.codigo_municipio) AS codigo_municipio,\\r\\n    MAX(cad.nome_municipio) AS nome_municipio,\\r\\n    MAX(cad.codigo_uf) AS codigo_uf,\\r\\n    MAX(cad.nome_usefi) AS nome_usefi,\\r\\n    MAX(cad.nome_ges) AS nome_ges,\\r\\n    \\r\\n    -- V\\u00ednculos\\r\\n    MAX(cad.qtd_vinculos) AS qtd_vinculos,\\r\\n    MAX(cad.qtd_vinculos_ativos) AS qtd_vinculos_ativos,\\r\\n    MAX(cad.qtd_socios) AS qtd_socios,\\r\\n    MAX(cad.qtd_socios_ativos) AS qtd_socios_ativos,\\r\\n    \\r\\n    -- Contador\\r\\n    MAX(cad.cnpj_cpf_contador) AS cnpj_cpf_contador,\\r\\n    MAX(cad.nome_contador) AS nome_contador,\\r\\n    \\r\\n    -- ========================================================================\\r\\n    -- HIST\\u00d3RICO DE CONTATOS (COM M\\u00c9TRICAS TEMPORAIS)\\r\\n    -- ========================================================================\\r\\n    MAX(COALESCE(hc.qtd_total_contatos, 0)) AS qtd_total_contatos,\\r\\n    MAX(COALESCE(hc.qtd_tipos_contato_distintos, 0)) AS qtd_tipos_contato_distintos,\\r\\n    MAX(COALESCE(hc.qtd_origens_distintas, 0)) AS qtd_origens_contato,\\r\\n    MAX(COALESCE(hc.qtd_usuarios_distintos, 0)) AS qtd_usuarios_contato,\\r\\n    MAX(COALESCE(hc.qtd_respostas_positivas, 0)) AS qtd_respostas_positivas,\\r\\n    MAX(COALESCE(hc.qtd_respostas_negativas, 0)) AS qtd_respostas_negativas,\\r\\n    MAX(COALESCE(hc.qtd_sem_resposta, 0)) AS qtd_sem_resposta,\\r\\n    MAX(COALESCE(hc.qtd_com_promessa_pagamento, 0)) AS qtd_promessas_pagamento,\\r\\n    MAX(COALESCE(hc.taxa_resposta, 0)) AS taxa_resposta_contatos,\\r\\n    MAX(hc.data_ultimo_contato) AS data_ultimo_contato,\\r\\n    MAX(hc.data_ultima_promessa) AS data_ultima_promessa,\\r\\n    MIN(COALESCE(hc.dias_desde_ultimo_contato, 999999)) AS dias_desde_ultimo_contato,\\r\\n    \\r\\n    -- NOVAS M\\u00c9TRICAS: Atividade recente de contatos\\r\\n    MAX(COALESCE(hc.qtd_contatos_ultimos_30_dias, 0)) AS qtd_contatos_ultimos_30_dias,\\r\\n    MAX(COALESCE(hc.qtd_contatos_ultimos_90_dias, 0)) AS qtd_contatos_ultimos_90_dias,\\r\\n    \\r\\n    -- ========================================================================\\r\\n    -- PARCELAMENTOS (MAIS RECENTE)\\r\\n    -- ========================================================================\\r\\n    MAX(CASE WHEN parc.numero_parcelamento IS NOT NULL THEN 1 ELSE 0 END) AS flag_tem_parcelamento,\\r\\n    MAX(parc.numero_parcelamento) AS numero_parcelamento,\\r\\n    MAX(parc.status_parcelamento) AS status_parcelamento,\\r\\n    MAX(parc.status_parcelamento_desc) AS status_parcelamento_desc,\\r\\n    MAX(parc.tipo_cancelamento) AS tipo_cancelamento_parcelamento,\\r\\n    MAX(parc.flag_divida_ativa) AS flag_parcelamento_divida_ativa,\\r\\n    SUM(COALESCE(parc.saldo_divida, 0)) AS saldo_divida_parcelamento,\\r\\n    SUM(COALESCE(parc.saldo_parcelado, 0)) AS saldo_parcelado,\\r\\n    SUM(COALESCE(parc.saldo_imposto_parcelado, 0)) AS saldo_imposto_parcelado,\\r\\n    SUM(COALESCE(parc.saldo_multa_parcelada, 0)) AS saldo_multa_parcelada,\\r\\n    SUM(COALESCE(parc.saldo_juros_parcelado, 0)) AS saldo_juros_parcelado,\\r\\n    MAX(parc.numero_parcelas) AS numero_parcelas,\\r\\n    MAX(parc.data_pedido) AS data_pedido_parcelamento,\\r\\n    MAX(parc.data_cancelamento) AS data_cancelamento_parcelamento,\\r\\n    \\r\\n    -- ========================================================================\\r\\n    -- SCORE DE NOTEIRAS (JOIN POR CNPJ)\\r\\n    -- ========================================================================\\r\\n    MAX(COALESCE(sn.score_total_noteiras, 0)) AS score_noteiras,\\r\\n    MAX(COALESCE(sn.qtd_indicios, 0)) AS qtd_indicios_noteiras,\\r\\n    MAX(COALESCE(sn.qtd_tipos_indicios_distintos, 0)) AS qtd_tipos_indicios_noteiras,\\r\\n    MAX(COALESCE(sn.score_medio_noteiras, 0)) AS score_medio_noteiras,\\r\\n    MAX(COALESCE(sn.score_maximo_indicio, 0)) AS score_maximo_indicio_noteiras,\\r\\n    MAX(COALESCE(sn.classificacao_risco_noteiras, 'SEM_INDICIO')) AS classificacao_risco_noteiras,\\r\\n    \\r\\n    -- ========================================================================\\r\\n    -- HIST\\u00d3RICO DE PAGAMENTOS (6 MESES) - JOIN POR CNPJ\\r\\n    -- ========================================================================\\r\\n    MAX(COALESCE(pg.qtd_periodos_com_pagamento, 0)) AS qtd_periodos_pagamento_6m,\\r\\n    MAX(COALESCE(pg.qtd_total_pagamentos_6m, 0)) AS qtd_pagamentos_6m,\\r\\n    MAX(COALESCE(pg.valor_total_pago_6m, 0)) AS valor_total_pago_6m,\\r\\n    MAX(COALESCE(pg.valor_medio_pago_periodo, 0)) AS valor_medio_pago_periodo,\\r\\n    MAX(COALESCE(pg.desvio_valor_pago, 0)) AS desvio_valor_pago,\\r\\n    MAX(pg.ultimo_periodo_pagamento) AS ultimo_periodo_pagamento,\\r\\n    MAX(COALESCE(pg.classificacao_regularidade, 'SEM_PAGAMENTO')) AS regularidade_pagamentos,\\r\\n    MAX(COALESCE(pg.coef_variacao_pagamentos, 0)) AS coef_variacao_pagamentos,\\r\\n    \\r\\n    -- ========================================================================\\r\\n    -- DECLARA\\u00c7\\u00d5ES DIME (6 MESES) - JOIN POR CNPJ\\r\\n    -- ========================================================================\\r\\n    MAX(COALESCE(dd.qtd_periodos_declarados, 0)) AS qtd_periodos_declarados_6m,\\r\\n    MAX(COALESCE(dd.qtd_periodos_omissos, 0)) AS qtd_periodos_omissos_6m,\\r\\n    MAX(COALESCE(dd.qtd_periodos_com_movimento, 0)) AS qtd_periodos_movimento_6m,\\r\\n    MAX(COALESCE(dd.qtd_entregue_prazo, 0)) AS qtd_entregue_prazo_6m,\\r\\n    MAX(COALESCE(dd.faturamento_total_6m, 0)) AS faturamento_total_6m,\\r\\n    MAX(COALESCE(dd.faturamento_medio_6m, 0)) AS faturamento_medio_6m,\\r\\n    MAX(COALESCE(dd.faturamento_desvio_6m, 0)) AS faturamento_desvio_6m,\\r\\n    MAX(COALESCE(dd.icms_devido_total_6m, 0)) AS icms_devido_total_6m,\\r\\n    MAX(COALESCE(dd.icms_recolher_total_6m, 0)) AS icms_recolher_total_6m,\\r\\n    MAX(COALESCE(dd.aliquota_efetiva_media_6m, 0)) AS aliquota_efetiva_media_6m,\\r\\n    MAX(COALESCE(dd.classificacao_regularidade_declaracao, 'SEM_DECLARACAO')) AS regularidade_declaracoes,\\r\\n    MAX(COALESCE(dd.classificacao_omissao, 'NAO_OMISSO')) AS classificacao_omissao,\\r\\n    MAX(COALESCE(dd.porte_por_faturamento, 'SEM_FATURAMENTO')) AS porte_por_faturamento,\\r\\n    \\r\\n    -- ========================================================================\\r\\n    -- METADADOS\\r\\n    -- ========================================================================\\r\\n    CURRENT_TIMESTAMP() AS dt_carga\\r\\n\\r\\nFROM gecob.prior_debitos_base db\\r\\n\\r\\n-- JOIN por Inscri\\u00e7\\u00e3o Estadual com Conta Corrente (PR\\u00c9-AGREGADA)\\r\\nLEFT JOIN gecob.prior_conta_corrente cc \\r\\n    ON db.inscricao_estadual = cc.inscricao_estadual\\r\\n\\r\\n-- JOIN por Inscri\\u00e7\\u00e3o Estadual com Cadastro\\r\\nLEFT JOIN gecob.prior_contribuintes_cadastro cad \\r\\n    ON db.inscricao_estadual = cad.inscricao_estadual\\r\\n\\r\\n-- JOIN por Inscri\\u00e7\\u00e3o Estadual com Hist\\u00f3rico de Contatos\\r\\nLEFT JOIN gecob.prior_historico_contatos hc \\r\\n    ON db.inscricao_estadual = hc.inscricao_estadual\\r\\n\\r\\n-- JOIN por Inscri\\u00e7\\u00e3o Estadual com Parcelamentos (pega o mais recente)\\r\\nLEFT JOIN (\\r\\n    SELECT \\r\\n        inscricao_estadual,\\r\\n        numero_parcelamento,\\r\\n        status_parcelamento,\\r\\n        status_parcelamento_desc,\\r\\n        tipo_cancelamento,\\r\\n        flag_divida_ativa,\\r\\n        saldo_divida,\\r\\n        saldo_parcelado,\\r\\n        saldo_imposto_parcelado,\\r\\n        saldo_multa_parcelada,\\r\\n        saldo_juros_parcelado,\\r\\n        numero_parcelas,\\r\\n        data_pedido,\\r\\n        data_cancelamento\\r\\n    FROM (\\r\\n        SELECT \\r\\n            inscricao_estadual,\\r\\n            numero_parcelamento,\\r\\n            status_parcelamento,\\r\\n            status_parcelamento_desc,\\r\\n            tipo_cancelamento,\\r\\n            flag_divida_ativa,\\r\\n            saldo_divida,\\r\\n            saldo_parcelado,\\r\\n            saldo_imposto_parcelado,\\r\\n            saldo_multa_parcelada,\\r\\n            saldo_juros_parcelado,\\r\\n            numero_parcelas,\\r\\n            data_pedido,\\r\\n            data_cancelamento,\\r\\n            ROW_NUMBER() OVER (PARTITION BY inscricao_estadual ORDER BY data_pedido DESC NULLS LAST) AS rn\\r\\n        FROM gecob.prior_parcelamentos\\r\\n    ) ranked\\r\\n    WHERE rn = 1\\r\\n) parc ON db.inscricao_estadual = parc.inscricao_estadual\\r\\n\\r\\n-- JOIN por CNPJ com Score Noteiras\\r\\nLEFT JOIN gecob.prior_score_noteiras sn \\r\\n    ON cad.cnpj = sn.cnpj_cpf\\r\\n\\r\\n-- JOIN por CNPJ com Pagamentos\\r\\nLEFT JOIN gecob.prior_pagamentos_historico pg \\r\\n    ON cad.cnpj = pg.cnpj\\r\\n\\r\\n-- JOIN por CNPJ com Declara\\u00e7\\u00f5es\\r\\nLEFT JOIN gecob.prior_declaracoes_dime dd \\r\\n    ON cad.cnpj = dd.cnpj\\r\\n\\r\\n-- Agrupa por IE e tipo_debito para eliminar duplicatas\\r\\nGROUP BY db.inscricao_estadual, db.tipo_debito;\\r\\n\\r\\n-- ============================================================================\\r\\n-- PARTE 4: FEATURES ENGINEERED - VERS\\u00c3O FINAL OTIMIZADA (PASSAGEM \\u00daNICA)\\r\\n-- Este \\u00fanico script substitui todas as 7 etapas da vers\\u00e3o V1.4\\r\\n-- Tempo estimado: ~3-5 minutos\\r\\n-- ============================================================================\\r\\n\\r\\nDROP TABLE IF EXISTS gecob.prior_features_ml;\\r\\nCREATE TABLE gecob.prior_features_ml STORED AS PARQUET AS\\r\\nSELECT\\r\\n    -- ========================================================================\\r\\n    -- IDENTIFICA\\u00c7\\u00c3O E TARGET\\r\\n    -- ========================================================================\\r\\n    mc.inscricao_estadual,\\r\\n    mc.cnpj,\\r\\n    mc.tipo_debito,\\r\\n    mc.status_debito AS target_status_debito,\\r\\n\\r\\n    -- ========================================================================\\r\\n    -- GRUPO 1: FEATURES FINANCEIRAS\\r\\n    -- ========================================================================\\r\\n    mc.valor_total_devido,\\r\\n    LN(CAST(1 + mc.valor_total_devido AS DOUBLE)) AS valor_devido_log,\\r\\n    mc.saldo_imposto, \\r\\n    mc.saldo_multa, \\r\\n    mc.saldo_juros, \\r\\n    mc.saldo_credito, \\r\\n    mc.saldo_reajuste,\\r\\n    \\r\\n    CASE \\r\\n        WHEN mc.valor_total_devido > 0 \\r\\n        THEN CAST(mc.saldo_imposto AS DOUBLE) / NULLIF(mc.valor_total_devido, 0) \\r\\n        ELSE 0 \\r\\n    END AS proporcao_imposto,\\r\\n    \\r\\n    CASE \\r\\n        WHEN mc.valor_total_devido > 0 \\r\\n        THEN CAST(mc.saldo_multa AS DOUBLE) / NULLIF(mc.valor_total_devido, 0) \\r\\n        ELSE 0 \\r\\n    END AS proporcao_multa,\\r\\n    \\r\\n    CASE \\r\\n        WHEN mc.valor_total_devido > 0 \\r\\n        THEN CAST(mc.saldo_juros AS DOUBLE) / NULLIF(mc.valor_total_devido, 0) \\r\\n        ELSE 0 \\r\\n    END AS proporcao_juros,\\r\\n    \\r\\n    CASE \\r\\n        WHEN mc.faturamento_medio_6m > 0 \\r\\n        THEN CAST(mc.valor_total_devido AS DOUBLE) / NULLIF(mc.faturamento_medio_6m, 0) \\r\\n        ELSE 0 \\r\\n    END AS razao_debito_faturamento,\\r\\n    \\r\\n    CASE \\r\\n        WHEN mc.valor_total_devido > 0 AND mc.faturamento_medio_6m > 0\\r\\n        THEN CAST(mc.faturamento_medio_6m AS DOUBLE) / NULLIF(mc.valor_total_devido, 0) \\r\\n        ELSE 0 \\r\\n    END AS capacidade_pagamento_estimada,\\r\\n\\r\\n    -- ========================================================================\\r\\n    -- GRUPO 2: FEATURES COMPORTAMENTAIS\\r\\n    -- ========================================================================\\r\\n    mc.qtd_periodos_pagamento_6m, \\r\\n    mc.qtd_pagamentos_6m, \\r\\n    mc.valor_total_pago_6m, \\r\\n    mc.valor_medio_pago_periodo, \\r\\n    mc.desvio_valor_pago,\\r\\n    mc.regularidade_pagamentos, \\r\\n    mc.coef_variacao_pagamentos,\\r\\n    \\r\\n    CASE \\r\\n        WHEN mc.icms_devido_total_6m > 0 \\r\\n        THEN CAST(mc.valor_total_pago_6m AS DOUBLE) / NULLIF(mc.icms_devido_total_6m, 0) \\r\\n        ELSE 0 \\r\\n    END AS taxa_pagamento_vs_devido_6m,\\r\\n    \\r\\n    mc.qtd_periodos_declarados_6m, \\r\\n    mc.qtd_periodos_omissos_6m, \\r\\n    mc.qtd_periodos_movimento_6m, \\r\\n    mc.qtd_entregue_prazo_6m,\\r\\n    mc.regularidade_declaracoes, \\r\\n    mc.classificacao_omissao,\\r\\n    \\r\\n    CASE \\r\\n        WHEN mc.qtd_periodos_declarados_6m > 0 \\r\\n        THEN CAST(mc.qtd_periodos_omissos_6m AS DOUBLE) / NULLIF(mc.qtd_periodos_declarados_6m, 0) \\r\\n        ELSE 0 \\r\\n    END AS taxa_omissao,\\r\\n    \\r\\n    CASE \\r\\n        WHEN mc.qtd_periodos_declarados_6m > 0 \\r\\n        THEN CAST(mc.qtd_entregue_prazo_6m AS DOUBLE) / NULLIF(mc.qtd_periodos_declarados_6m, 0) \\r\\n        ELSE 0 \\r\\n    END AS taxa_entrega_prazo,\\r\\n    \\r\\n    -- ========================================================================\\r\\n    -- GRUPO 3: FEATURES DE CONTATO\\r\\n    -- ========================================================================\\r\\n    mc.qtd_total_contatos, \\r\\n    mc.qtd_tipos_contato_distintos, \\r\\n    mc.qtd_origens_contato, \\r\\n    mc.qtd_usuarios_contato, \\r\\n    mc.qtd_respostas_positivas, \\r\\n    mc.qtd_respostas_negativas,\\r\\n    mc.qtd_sem_resposta, \\r\\n    mc.qtd_promessas_pagamento, \\r\\n    mc.taxa_resposta_contatos, \\r\\n    mc.dias_desde_ultimo_contato,\\r\\n    \\r\\n    CASE \\r\\n        WHEN mc.qtd_total_contatos > 0 \\r\\n        THEN CAST(mc.qtd_respostas_positivas AS DOUBLE) / NULLIF(mc.qtd_total_contatos, 0) \\r\\n        ELSE 0 \\r\\n    END AS taxa_efetividade_contatos,\\r\\n    \\r\\n    CASE \\r\\n        WHEN mc.qtd_total_contatos > 0 \\r\\n        THEN CAST(mc.qtd_promessas_pagamento AS DOUBLE) / NULLIF(mc.qtd_total_contatos, 0) \\r\\n        ELSE 0 \\r\\n    END AS taxa_promessas_contatos,\\r\\n    \\r\\n    DATEDIFF(CURRENT_DATE(), mc.data_inclusao_cobranca) AS dias_desde_inclusao_cobranca,\\r\\n    \\r\\n    CASE \\r\\n        WHEN DATEDIFF(CURRENT_DATE(), mc.data_inclusao_cobranca) > 0 \\r\\n        THEN CAST(mc.qtd_total_contatos AS DOUBLE) * 30 / NULLIF(DATEDIFF(CURRENT_DATE(), mc.data_inclusao_cobranca), 0) \\r\\n        ELSE 0 \\r\\n    END AS intensidade_contato_mensal,\\r\\n\\r\\n    -- ========================================================================\\r\\n    -- GRUPO 4: FEATURES DE RISCO E PERFIL\\r\\n    -- ========================================================================\\r\\n    mc.flag_com_garantia, \\r\\n    mc.flag_devedor_contumaz, \\r\\n    mc.flag_recuperacao_judicial, \\r\\n    mc.flag_falencia, \\r\\n    mc.flag_protesto, \\r\\n    mc.flag_tem_parcelamento, \\r\\n    mc.flag_suspensao_dfe,\\r\\n    \\r\\n    (\\r\\n        CASE WHEN mc.flag_devedor_contumaz = 1 THEN 30 ELSE 0 END + \\r\\n        CASE WHEN mc.flag_recuperacao_judicial = 1 THEN 25 ELSE 0 END + \\r\\n        CASE WHEN mc.flag_falencia = 1 THEN 50 ELSE 0 END + \\r\\n        CASE WHEN mc.flag_protesto = 1 THEN 15 ELSE 0 END + \\r\\n        CASE WHEN mc.classificacao_omissao = 'OMISSO_RECORRENTE' THEN 20 ELSE 0 END + \\r\\n        CASE WHEN mc.classificacao_omissao = 'OMISSO_EVENTUAL' THEN 10 ELSE 0 END + \\r\\n        CASE WHEN mc.flag_suspensao_dfe = 1 THEN 20 ELSE 0 END\\r\\n    ) AS score_risco_situacao,\\r\\n    \\r\\n    mc.score_noteiras, \\r\\n    mc.qtd_indicios_noteiras, \\r\\n    mc.qtd_tipos_indicios_noteiras, \\r\\n    mc.classificacao_risco_noteiras,\\r\\n    mc.situacao_cadastral_desc, \\r\\n    \\r\\n    CASE \\r\\n        WHEN mc.situacao_cadastral_desc = 'ATIVO' THEN 1.0 \\r\\n        WHEN mc.situacao_cadastral_desc = 'SUSPENSO' THEN 0.5 \\r\\n        WHEN mc.situacao_cadastral_desc = 'INAPTO' THEN 0.3 \\r\\n        ELSE 0 \\r\\n    END AS score_situacao_cadastral,\\r\\n    \\r\\n    mc.cnae_classe, \\r\\n    mc.cnae_divisao, \\r\\n    mc.secao_cnae, \\r\\n    mc.divisao_cnae, \\r\\n    mc.natureza_juridica_cod, \\r\\n    mc.porte_por_faturamento, \\r\\n    mc.codigo_municipio, \\r\\n    mc.codigo_uf, \\r\\n    mc.regime_apuracao_cod, \\r\\n    mc.tipo_contribuinte_cod, \\r\\n    mc.enquadramento_empresa_cod,\\r\\n    mc.flag_simples_nacional, \\r\\n    mc.flag_dtec, \\r\\n    mc.flag_matriz, \\r\\n    mc.flag_apuracao_consolidada, \\r\\n    mc.flag_estabelecimento_consolidado,\\r\\n    mc.qtd_vinculos, \\r\\n    mc.qtd_vinculos_ativos, \\r\\n    mc.qtd_socios, \\r\\n    mc.qtd_socios_ativos,\\r\\n    \\r\\n    CASE \\r\\n        WHEN mc.qtd_socios_ativos >= 10 THEN 'ALTA' \\r\\n        WHEN mc.qtd_socios_ativos >= 5 THEN 'MEDIA' \\r\\n        WHEN mc.qtd_socios_ativos >= 2 THEN 'BAIXA' \\r\\n        WHEN mc.qtd_socios_ativos = 1 THEN 'INDIVIDUAL' \\r\\n        ELSE 'SEM_DADOS' \\r\\n    END AS complexidade_societaria,\\r\\n\\r\\n    -- ========================================================================\\r\\n    -- GRUPO 5: FEATURES TEMPORAIS E PARCELAMENTO\\r\\n    -- ========================================================================\\r\\n    MONTH(mc.data_inclusao_cobranca) AS mes_inclusao_cobranca, \\r\\n    QUARTER(mc.data_inclusao_cobranca) AS trimestre_inclusao_cobranca, \\r\\n    DAYOFWEEK(mc.data_inclusao_cobranca) AS dia_semana_inclusao, \\r\\n    YEAR(mc.data_inclusao_cobranca) AS ano_inclusao_cobranca,\\r\\n    \\r\\n    CASE \\r\\n        WHEN DATEDIFF(CURRENT_DATE(), mc.data_inclusao_cobranca) <= 30 THEN '0-1_MES' \\r\\n        WHEN DATEDIFF(CURRENT_DATE(), mc.data_inclusao_cobranca) <= 90 THEN '1-3_MESES' \\r\\n        WHEN DATEDIFF(CURRENT_DATE(), mc.data_inclusao_cobranca) <= 180 THEN '3-6_MESES' \\r\\n        WHEN DATEDIFF(CURRENT_DATE(), mc.data_inclusao_cobranca) <= 365 THEN '6-12_MESES' \\r\\n        WHEN DATEDIFF(CURRENT_DATE(), mc.data_inclusao_cobranca) <= 730 THEN '1-2_ANOS' \\r\\n        ELSE 'MAIS_2_ANOS' \\r\\n    END AS faixa_idade_debito,\\r\\n    \\r\\n    mc.status_parcelamento_desc, \\r\\n    mc.tipo_cancelamento_parcelamento, \\r\\n    mc.flag_parcelamento_divida_ativa, \\r\\n    mc.saldo_divida_parcelamento, \\r\\n    mc.saldo_parcelado, \\r\\n    mc.saldo_imposto_parcelado, \\r\\n    mc.saldo_multa_parcelada, \\r\\n    mc.saldo_juros_parcelado, \\r\\n    mc.numero_parcelas,\\r\\n    \\r\\n    CASE \\r\\n        WHEN mc.data_pedido_parcelamento IS NOT NULL \\r\\n        THEN DATEDIFF(CURRENT_DATE(), mc.data_pedido_parcelamento) \\r\\n        ELSE NULL \\r\\n    END AS dias_desde_parcelamento,\\r\\n    \\r\\n    CASE \\r\\n        WHEN mc.valor_total_devido > 0 \\r\\n        THEN CAST((mc.saldo_imposto_parcelado + mc.saldo_multa_parcelada + mc.saldo_juros_parcelado) AS DOUBLE) / NULLIF(mc.valor_total_devido, 0) \\r\\n        ELSE 0 \\r\\n    END AS proporcao_debito_parcelado,\\r\\n    \\r\\n    CASE \\r\\n        WHEN mc.flag_tem_parcelamento = 0 THEN 'SEM_PARCELAMENTO' \\r\\n        WHEN mc.status_parcelamento_desc IN ('ATIVO', 'QUITADO') THEN 'PARCELAMENTO_ATIVO' \\r\\n        WHEN mc.status_parcelamento_desc = 'INADIMPLENTE' THEN 'PARCELAMENTO_INADIMPLENTE' \\r\\n        ELSE 'PARCELAMENTO_INATIVO' \\r\\n    END AS situacao_parcelamento,\\r\\n\\r\\n    -- ========================================================================\\r\\n    -- GRUPO 6: FEATURES DE AL\\u00cdQUOTA E CONFORMIDADE\\r\\n    -- ========================================================================\\r\\n    mc.aliquota_efetiva_media_6m, \\r\\n    mc.codigo_tipo_imposto,\\r\\n    \\r\\n    CASE \\r\\n        WHEN mc.icms_devido_total_6m > 0 \\r\\n        THEN CAST((mc.icms_devido_total_6m - mc.icms_recolher_total_6m) AS DOUBLE) / NULLIF(mc.icms_devido_total_6m, 0) \\r\\n        ELSE 0 \\r\\n    END AS taxa_divergencia_devido_recolher,\\r\\n    \\r\\n    CASE \\r\\n        WHEN mc.faturamento_medio_6m > 0 \\r\\n        THEN CAST(mc.faturamento_desvio_6m AS DOUBLE) / NULLIF(mc.faturamento_medio_6m, 0) \\r\\n        ELSE 0 \\r\\n    END AS coef_variacao_faturamento,\\r\\n    \\r\\n    mc.faturamento_total_6m, \\r\\n    mc.faturamento_medio_6m, \\r\\n    mc.faturamento_desvio_6m, \\r\\n    mc.icms_devido_total_6m, \\r\\n    mc.icms_recolher_total_6m,\\r\\n\\r\\n    -- ========================================================================\\r\\n    -- GRUPO 7: FEATURES COMPOSTAS\\r\\n    -- ========================================================================\\r\\n    CAST((\\r\\n        CASE \\r\\n            WHEN mc.qtd_periodos_movimento_6m >= 6 THEN 100 \\r\\n            WHEN mc.qtd_periodos_movimento_6m >= 4 THEN 70 \\r\\n            WHEN mc.qtd_periodos_movimento_6m >= 2 THEN 40 \\r\\n            WHEN mc.qtd_periodos_movimento_6m >= 1 THEN 20 \\r\\n            ELSE 0 \\r\\n        END + \\r\\n        CASE \\r\\n            WHEN mc.qtd_pagamentos_6m >= 6 THEN 50 \\r\\n            WHEN mc.qtd_pagamentos_6m >= 3 THEN 30 \\r\\n            WHEN mc.qtd_pagamentos_6m >= 1 THEN 10 \\r\\n            ELSE 0 \\r\\n        END\\r\\n    ) AS DOUBLE) / 150.0 AS score_atividade_recente,\\r\\n    \\r\\n    CAST((\\r\\n        CASE \\r\\n            WHEN mc.regularidade_declaracoes = 'REGULAR' THEN 40 \\r\\n            WHEN mc.regularidade_declaracoes = 'PARCIAL' THEN 20 \\r\\n            ELSE 0 \\r\\n        END + \\r\\n        CASE \\r\\n            WHEN mc.regularidade_pagamentos = 'REGULAR' THEN 40 \\r\\n            WHEN mc.regularidade_pagamentos = 'PARCIAL' THEN 20 \\r\\n            ELSE 0 \\r\\n        END + \\r\\n        CASE \\r\\n            WHEN mc.classificacao_omissao = 'NAO_OMISSO' THEN 20 \\r\\n            WHEN mc.classificacao_omissao = 'OMISSO_EVENTUAL' THEN 10 \\r\\n            ELSE 0 \\r\\n        END\\r\\n    ) AS DOUBLE) / 100.0 AS score_compliance,\\r\\n    \\r\\n    CASE \\r\\n        WHEN mc.qtd_total_contatos = 0 THEN 'NUNCA_CONTATADO' \\r\\n        WHEN mc.taxa_resposta_contatos >= 0.7 THEN 'ALTA_RESPOSTA' \\r\\n        WHEN mc.taxa_resposta_contatos >= 0.3 THEN 'MEDIA_RESPOSTA' \\r\\n        WHEN mc.qtd_total_contatos >= 5 THEN 'BAIXA_RESPOSTA_MULTIPLOS_CONTATOS' \\r\\n        ELSE 'BAIXA_RESPOSTA' \\r\\n    END AS perfil_engajamento,\\r\\n    \\r\\n    -- Metadados\\r\\n    CURRENT_TIMESTAMP() AS dt_carga\\r\\n    \\r\\nFROM gecob.prior_master_consolidado mc;\\r\\n\\r\\n-- ============================================================================\\r\\n-- PARTE 5: BENCHMARK SETORIAL E SCORE DE PRIORIZA\\u00c7\\u00c3O\\r\\n-- ============================================================================\\r\\n\\r\\n-- ----------------------------------------------------------------------------\\r\\n-- 5.1. BENCHMARK SETORIAL POR TIPO DE D\\u00c9BITO\\r\\n-- ----------------------------------------------------------------------------\\r\\nDROP TABLE IF EXISTS gecob.prior_benchmark_setorial;\\r\\nCREATE TABLE gecob.prior_benchmark_setorial STORED AS PARQUET AS\\r\\nWITH percentis_calculados AS (\\r\\n    SELECT\\r\\n        tipo_debito,\\r\\n        cnae_divisao,\\r\\n        secao_cnae,\\r\\n        porte_por_faturamento,\\r\\n        valor_total_devido,\\r\\n        status_debito,\\r\\n        qtd_total_contatos,\\r\\n        taxa_resposta_contatos,\\r\\n        qtd_periodos_pagamento_6m,\\r\\n        score_noteiras,\\r\\n        data_inclusao_cobranca,\\r\\n        NTILE(4) OVER (PARTITION BY tipo_debito, cnae_divisao, secao_cnae, porte_por_faturamento \\r\\n                       ORDER BY valor_total_devido) AS quartil\\r\\n    FROM gecob.prior_master_consolidado\\r\\n)\\r\\nSELECT\\r\\n    tipo_debito,\\r\\n    cnae_divisao,\\r\\n    secao_cnae,\\r\\n    porte_por_faturamento,\\r\\n    \\r\\n    -- Estat\\u00edsticas de Valor\\r\\n    COUNT(*) AS qtd_debitos,\\r\\n    COUNT(DISTINCT CASE WHEN valor_total_devido > 0 THEN 1 END) AS qtd_empresas,\\r\\n    AVG(valor_total_devido) AS valor_medio_debito,\\r\\n    STDDEV(valor_total_devido) AS desvio_valor_debito,\\r\\n    MIN(valor_total_devido) AS valor_min_debito,\\r\\n    MAX(valor_total_devido) AS valor_max_debito,\\r\\n    \\r\\n    -- Percentis usando NTILE\\r\\n    MIN(CASE WHEN quartil = 1 THEN valor_total_devido END) AS valor_p25_debito,\\r\\n    AVG(CASE WHEN quartil IN (2, 3) THEN valor_total_devido END) AS valor_mediana_debito,\\r\\n    MAX(CASE WHEN quartil = 4 THEN valor_total_devido END) AS valor_p75_debito,\\r\\n    \\r\\n    -- Taxa de Recupera\\u00e7\\u00e3o Hist\\u00f3rica\\r\\n    AVG(CASE WHEN status_debito = 2 THEN 1.0 ELSE 0.0 END) AS taxa_recuperacao_historica,\\r\\n    \\r\\n    -- M\\u00e9dias de Comportamento\\r\\n    AVG(qtd_total_contatos) AS media_contatos_setor,\\r\\n    AVG(taxa_resposta_contatos) AS media_taxa_resposta_setor,\\r\\n    AVG(qtd_periodos_pagamento_6m) AS media_periodos_pagamento_setor,\\r\\n    AVG(score_noteiras) AS media_score_noteiras_setor,\\r\\n    \\r\\n    -- Tempo M\\u00e9dio em Cobran\\u00e7a\\r\\n    AVG(DATEDIFF(CURRENT_DATE(), data_inclusao_cobranca)) AS media_dias_cobranca,\\r\\n    \\r\\n    CURRENT_TIMESTAMP() AS dt_carga\\r\\n\\r\\nFROM percentis_calculados\\r\\nGROUP BY \\r\\n    tipo_debito,\\r\\n    cnae_divisao,\\r\\n    secao_cnae,\\r\\n    porte_por_faturamento\\r\\nHAVING COUNT(*) >= 10;\\r\\n\\r\\n-- ----------------------------------------------------------------------------\\r\\n-- 5.2. SCORE DE PRIORIDADE - COMPONENTES INDIVIDUAIS\\r\\n-- ----------------------------------------------------------------------------\\r\\nDROP TABLE IF EXISTS gecob.prior_score_componentes;\\r\\nCREATE TABLE gecob.prior_score_componentes STORED AS PARQUET AS\\r\\nSELECT\\r\\n    fm.inscricao_estadual,\\r\\n    fm.cnpj,\\r\\n    fm.tipo_debito,\\r\\n    fm.valor_total_devido,\\r\\n    \\r\\n    -- COMPONENTE 1: SCORE VALOR DO D\\u00c9BITO (0-100 pontos)\\r\\n    CASE \\r\\n        WHEN fm.valor_total_devido >= 1000000 THEN 100\\r\\n        WHEN fm.valor_total_devido >= 500000 THEN 85\\r\\n        WHEN fm.valor_total_devido >= 100000 THEN 70\\r\\n        WHEN fm.valor_total_devido >= 50000 THEN 55\\r\\n        WHEN fm.valor_total_devido >= 10000 THEN 40\\r\\n        WHEN fm.valor_total_devido >= 5000 THEN 25\\r\\n        ELSE 10\\r\\n    END AS score_valor_debito,\\r\\n    \\r\\n    -- COMPONENTE 2: SCORE CAPACIDADE DE PAGAMENTO (0-100 pontos)\\r\\n    (\\r\\n        CASE \\r\\n            WHEN fm.porte_por_faturamento = 'GRANDE' THEN 85\\r\\n            WHEN fm.porte_por_faturamento = 'MEDIO' THEN 70\\r\\n            WHEN fm.porte_por_faturamento = 'PEQUENO' THEN 50\\r\\n            WHEN fm.porte_por_faturamento = 'MICRO' THEN 30\\r\\n            ELSE 10\\r\\n        END +\\r\\n        CASE \\r\\n            WHEN fm.capacidade_pagamento_estimada >= 5 THEN 15\\r\\n            WHEN fm.capacidade_pagamento_estimada >= 2 THEN 12\\r\\n            WHEN fm.capacidade_pagamento_estimada >= 1 THEN 8\\r\\n            WHEN fm.capacidade_pagamento_estimada >= 0.5 THEN 5\\r\\n            ELSE 0\\r\\n        END\\r\\n    ) AS score_capacidade_pagamento,\\r\\n    \\r\\n    -- COMPONENTE 3: SCORE HIST\\u00d3RICO DE PAGAMENTOS (0-100 pontos)\\r\\n    (\\r\\n        CASE \\r\\n            WHEN fm.regularidade_pagamentos = 'REGULAR' THEN 80\\r\\n            WHEN fm.regularidade_pagamentos = 'PARCIAL' THEN 50\\r\\n            WHEN fm.regularidade_pagamentos = 'IRREGULAR' THEN 20\\r\\n            ELSE 0\\r\\n        END +\\r\\n        CASE \\r\\n            WHEN fm.taxa_pagamento_vs_devido_6m >= 0.9 THEN 20\\r\\n            WHEN fm.taxa_pagamento_vs_devido_6m >= 0.7 THEN 15\\r\\n            WHEN fm.taxa_pagamento_vs_devido_6m >= 0.5 THEN 10\\r\\n            WHEN fm.taxa_pagamento_vs_devido_6m >= 0.3 THEN 5\\r\\n            ELSE 0\\r\\n        END\\r\\n    ) AS score_historico_pagamento,\\r\\n    \\r\\n    -- COMPONENTE 4: SCORE RESPONSIVIDADE (0-100 pontos)\\r\\n    CASE \\r\\n        WHEN fm.taxa_efetividade_contatos >= 0.7 THEN 100\\r\\n        WHEN fm.taxa_efetividade_contatos >= 0.5 THEN 80\\r\\n        WHEN fm.taxa_efetividade_contatos >= 0.3 THEN 60\\r\\n        WHEN fm.taxa_efetividade_contatos >= 0.1 THEN 40\\r\\n        WHEN fm.qtd_total_contatos > 0 THEN 20\\r\\n        ELSE 10\\r\\n    END AS score_responsividade,\\r\\n    \\r\\n    -- COMPONENTE 5: SCORE VIABILIDADE DE COBRAN\\u00c7A (0-100 pontos)\\r\\n    CAST(100 - LEAST(100, (\\r\\n        CASE WHEN fm.flag_falencia = 1 THEN 50 ELSE 0 END +\\r\\n        CASE WHEN fm.flag_recuperacao_judicial = 1 THEN 30 ELSE 0 END +\\r\\n        CASE WHEN fm.flag_devedor_contumaz = 1 THEN 20 ELSE 0 END +\\r\\n        CASE WHEN fm.situacao_cadastral_desc IN ('CANCELADO', 'BAIXADO', 'INAPTO') THEN 40 ELSE 0 END +\\r\\n        CASE WHEN fm.classificacao_omissao = 'OMISSO_RECORRENTE' THEN 15 ELSE 0 END +\\r\\n        CASE WHEN fm.score_noteiras >= 100 THEN 25 \\r\\n             WHEN fm.score_noteiras >= 50 THEN 15\\r\\n             WHEN fm.score_noteiras >= 20 THEN 5\\r\\n             ELSE 0 END\\r\\n    )) AS INT) AS score_viabilidade_cobranca,\\r\\n    \\r\\n    -- COMPONENTE 6: SCORE URG\\u00caNCIA TEMPORAL (0-100 pontos)\\r\\n    (\\r\\n        CASE \\r\\n            WHEN fm.dias_desde_inclusao_cobranca >= 365 THEN 100\\r\\n            WHEN fm.dias_desde_inclusao_cobranca >= 180 THEN 80\\r\\n            WHEN fm.dias_desde_inclusao_cobranca >= 90 THEN 60\\r\\n            WHEN fm.dias_desde_inclusao_cobranca >= 30 THEN 40\\r\\n            ELSE 20\\r\\n        END +\\r\\n        CASE \\r\\n            WHEN fm.flag_tem_parcelamento = 1 AND fm.status_parcelamento_desc = 'INADIMPLENTE' THEN -30\\r\\n            WHEN fm.flag_tem_parcelamento = 1 AND fm.status_parcelamento_desc = 'ATIVO' THEN -10\\r\\n            ELSE 0\\r\\n        END\\r\\n    ) AS score_urgencia,\\r\\n    \\r\\n    -- COMPONENTE 7: SCORE CONFORMIDADE FISCAL (0-100 pontos)\\r\\n    (\\r\\n        CASE \\r\\n            WHEN fm.regularidade_declaracoes = 'REGULAR' THEN 80\\r\\n            WHEN fm.regularidade_declaracoes = 'PARCIAL' THEN 50\\r\\n            WHEN fm.regularidade_declaracoes = 'IRREGULAR' THEN 20\\r\\n            ELSE 0\\r\\n        END +\\r\\n        CASE \\r\\n            WHEN fm.classificacao_omissao = 'NAO_OMISSO' THEN 20\\r\\n            WHEN fm.classificacao_omissao = 'OMISSO_EVENTUAL' THEN 10\\r\\n            ELSE 0\\r\\n        END\\r\\n    ) AS score_conformidade,\\r\\n    \\r\\n    CURRENT_TIMESTAMP() AS dt_carga\\r\\n\\r\\nFROM gecob.prior_features_ml fm;\\r\\n\\r\\n-- ----------------------------------------------------------------------------\\r\\n-- 5.3. SCORE DE PRIORIZA\\u00c7\\u00c3O FINAL\\r\\n-- ----------------------------------------------------------------------------\\r\\nDROP TABLE IF EXISTS gecob.prior_score_priorizacao;\\r\\nCREATE TABLE gecob.prior_score_priorizacao STORED AS PARQUET AS\\r\\nSELECT\\r\\n    sp.inscricao_estadual,\\r\\n    sp.cnpj,\\r\\n    sp.tipo_debito,\\r\\n    sp.valor_total_devido,\\r\\n    \\r\\n    -- Scores Parciais\\r\\n    sp.score_valor_debito,\\r\\n    sp.score_capacidade_pagamento,\\r\\n    sp.score_historico_pagamento,\\r\\n    sp.score_responsividade,\\r\\n    sp.score_viabilidade_cobranca,\\r\\n    sp.score_urgencia,\\r\\n    sp.score_conformidade,\\r\\n    \\r\\n    -- SCORE FINAL PONDERADO (0-100)\\r\\n    -- Pesos: Valor 25%, Capacidade 20%, Hist\\u00f3rico 15%, Responsividade 15%,\\r\\n    --        Viabilidade 10%, Urg\\u00eancia 10%, Conformidade 5%\\r\\n    ROUND(\\r\\n        (sp.score_valor_debito * 0.25) +\\r\\n        (sp.score_capacidade_pagamento * 0.20) +\\r\\n        (sp.score_historico_pagamento * 0.15) +\\r\\n        (sp.score_responsividade * 0.15) +\\r\\n        (sp.score_viabilidade_cobranca * 0.10) +\\r\\n        (sp.score_urgencia * 0.10) +\\r\\n        (sp.score_conformidade * 0.05),\\r\\n        2\\r\\n    ) AS score_final_priorizacao,\\r\\n    \\r\\n    -- Classifica\\u00e7\\u00e3o de Prioridade\\r\\n    CASE \\r\\n        WHEN ROUND(\\r\\n            (sp.score_valor_debito * 0.25) +\\r\\n            (sp.score_capacidade_pagamento * 0.20) +\\r\\n            (sp.score_historico_pagamento * 0.15) +\\r\\n            (sp.score_responsividade * 0.15) +\\r\\n            (sp.score_viabilidade_cobranca * 0.10) +\\r\\n            (sp.score_urgencia * 0.10) +\\r\\n            (sp.score_conformidade * 0.05),\\r\\n            2\\r\\n        ) >= 80 THEN 'PRIORIDADE_MAXIMA'\\r\\n        WHEN ROUND(\\r\\n            (sp.score_valor_debito * 0.25) +\\r\\n            (sp.score_capacidade_pagamento * 0.20) +\\r\\n            (sp.score_historico_pagamento * 0.15) +\\r\\n            (sp.score_responsividade * 0.15) +\\r\\n            (sp.score_viabilidade_cobranca * 0.10) +\\r\\n            (sp.score_urgencia * 0.10) +\\r\\n            (sp.score_conformidade * 0.05),\\r\\n            2\\r\\n        ) >= 60 THEN 'PRIORIDADE_ALTA'\\r\\n        WHEN ROUND(\\r\\n            (sp.score_valor_debito * 0.25) +\\r\\n            (sp.score_capacidade_pagamento * 0.20) +\\r\\n            (sp.score_historico_pagamento * 0.15) +\\r\\n            (sp.score_responsividade * 0.15) +\\r\\n            (sp.score_viabilidade_cobranca * 0.10) +\\r\\n            (sp.score_urgencia * 0.10) +\\r\\n            (sp.score_conformidade * 0.05),\\r\\n            2\\r\\n        ) >= 40 THEN 'PRIORIDADE_MEDIA'\\r\\n        ELSE 'PRIORIDADE_BAIXA'\\r\\n    END AS classificacao_prioridade,\\r\\n    \\r\\n    CURRENT_TIMESTAMP() AS dt_carga\\r\\n\\r\\nFROM gecob.prior_score_componentes sp;\\r\\n\\r\\n-- ============================================================================\\r\\n-- PARTE 6: VIEWS EXECUTIVAS E DASHBOARDS\\r\\n-- ============================================================================\\r\\n\\r\\n-- ----------------------------------------------------------------------------\\r\\n-- 6.1. VIEW DASHBOARD - TOP PRIORIDADES\\r\\n-- ----------------------------------------------------------------------------\\r\\nDROP VIEW IF EXISTS gecob.vw_dashboard_priorizacao;\\r\\nCREATE VIEW gecob.vw_dashboard_priorizacao AS\\r\\nSELECT\\r\\n    -- Identifica\\u00e7\\u00e3o\\r\\n    sp.inscricao_estadual,\\r\\n    mc.razao_social,\\r\\n    mc.nome_fantasia,\\r\\n    sp.tipo_debito,\\r\\n    \\r\\n    -- Valor e Prioridade\\r\\n    sp.valor_total_devido,\\r\\n    sp.score_final_priorizacao,\\r\\n    sp.classificacao_prioridade,\\r\\n    \\r\\n    -- Situa\\u00e7\\u00e3o\\r\\n    mc.situacao_cadastral_desc,\\r\\n    mc.porte_por_faturamento,\\r\\n    mc.secao_cnae,\\r\\n    mc.descricao_secao,\\r\\n    \\r\\n    -- Hist\\u00f3rico\\r\\n    mc.regularidade_pagamentos,\\r\\n    mc.regularidade_declaracoes,\\r\\n    mc.qtd_total_contatos,\\r\\n    mc.taxa_resposta_contatos,\\r\\n    \\r\\n    -- Flags de Risco\\r\\n    mc.flag_falencia,\\r\\n    mc.flag_recuperacao_judicial,\\r\\n    mc.flag_devedor_contumaz,\\r\\n    mc.classificacao_risco_noteiras,\\r\\n    \\r\\n    -- Contato\\r\\n    mc.codigo_municipio,\\r\\n    mc.nome_municipio,\\r\\n    mc.codigo_uf,\\r\\n    \\r\\n    -- Scores Detalhados\\r\\n    sp.score_valor_debito,\\r\\n    sp.score_capacidade_pagamento,\\r\\n    sp.score_historico_pagamento,\\r\\n    sp.score_responsividade,\\r\\n    sp.score_viabilidade_cobranca,\\r\\n    sp.score_urgencia,\\r\\n    sp.score_conformidade\\r\\n\\r\\nFROM gecob.prior_score_priorizacao sp\\r\\nINNER JOIN gecob.prior_master_consolidado mc \\r\\n    ON sp.inscricao_estadual = mc.inscricao_estadual\\r\\n    AND sp.tipo_debito = mc.tipo_debito\\r\\nORDER BY sp.score_final_priorizacao DESC, sp.valor_total_devido DESC;\\r\\n\\r\\n-- ----------------------------------------------------------------------------\\r\\n-- 6.2. VIEW TOP 1000 PRIORIDADES COM A\\u00c7\\u00c3O RECOMENDADA\\r\\n-- ----------------------------------------------------------------------------\\r\\nDROP VIEW IF EXISTS gecob.vw_top_1000_prioridades;\\r\\nCREATE VIEW gecob.vw_top_1000_prioridades AS\\r\\nSELECT\\r\\n    ROW_NUMBER() OVER (ORDER BY sp.score_final_priorizacao DESC, sp.valor_total_devido DESC) AS ranking,\\r\\n    \\r\\n    sp.inscricao_estadual,\\r\\n    mc.cnpj,\\r\\n    mc.razao_social,\\r\\n    mc.nome_fantasia,\\r\\n    \\r\\n    -- Valor e Score\\r\\n    sp.valor_total_devido,\\r\\n    sp.score_final_priorizacao,\\r\\n    sp.classificacao_prioridade,\\r\\n    \\r\\n    -- Detalhes do D\\u00e9bito\\r\\n    mc.tipo_debito,\\r\\n    fm.dias_desde_inclusao_cobranca,\\r\\n    mc.saldo_imposto,\\r\\n    mc.saldo_multa,\\r\\n    mc.saldo_juros,\\r\\n    \\r\\n    -- Perfil\\r\\n    mc.porte_por_faturamento,\\r\\n    mc.secao_cnae,\\r\\n    mc.descricao_secao,\\r\\n    mc.situacao_cadastral_desc,\\r\\n    \\r\\n    -- Capacidade\\r\\n    fm.capacidade_pagamento_estimada,\\r\\n    mc.faturamento_medio_6m,\\r\\n    \\r\\n    -- Hist\\u00f3rico\\r\\n    mc.regularidade_pagamentos,\\r\\n    fm.taxa_pagamento_vs_devido_6m,\\r\\n    mc.qtd_total_contatos,\\r\\n    mc.taxa_resposta_contatos,\\r\\n    \\r\\n    -- Riscos\\r\\n    mc.flag_falencia,\\r\\n    mc.flag_recuperacao_judicial,\\r\\n    mc.flag_devedor_contumaz,\\r\\n    mc.classificacao_risco_noteiras,\\r\\n    mc.score_noteiras,\\r\\n    \\r\\n    -- Localiza\\u00e7\\u00e3o\\r\\n    mc.codigo_municipio,\\r\\n    mc.nome_municipio,\\r\\n    mc.codigo_uf,\\r\\n    \\r\\n    -- Scores Componentes\\r\\n    sp.score_valor_debito,\\r\\n    sp.score_capacidade_pagamento,\\r\\n    sp.score_historico_pagamento,\\r\\n    sp.score_responsividade,\\r\\n    sp.score_viabilidade_cobranca,\\r\\n    sp.score_urgencia,\\r\\n    sp.score_conformidade,\\r\\n    \\r\\n    -- A\\u00e7\\u00e3o Recomendada\\r\\n    CASE \\r\\n        WHEN sp.score_final_priorizacao >= 80 AND fm.taxa_efetividade_contatos >= 0.5 THEN 'CONTATO_IMEDIATO_NEGOCIACAO'\\r\\n        WHEN sp.score_final_priorizacao >= 80 AND mc.qtd_total_contatos < 3 THEN 'INTENSIFICAR_CONTATOS'\\r\\n        WHEN sp.score_final_priorizacao >= 60 AND mc.flag_tem_parcelamento = 0 THEN 'OFERECER_PARCELAMENTO'\\r\\n        WHEN sp.score_final_priorizacao >= 60 AND fm.capacidade_pagamento_estimada >= 2 THEN 'NEGOCIACAO_DESCONTO'\\r\\n        WHEN sp.score_viabilidade_cobranca < 40 THEN 'AVALIAR_INSCRICAO_DIVIDA_ATIVA'\\r\\n        ELSE 'CONTATO_PADRAO'\\r\\n    END AS acao_recomendada\\r\\n\\r\\nFROM gecob.prior_score_priorizacao sp\\r\\nINNER JOIN gecob.prior_master_consolidado mc \\r\\n    ON sp.inscricao_estadual = mc.inscricao_estadual\\r\\n    AND sp.tipo_debito = mc.tipo_debito\\r\\nINNER JOIN gecob.prior_features_ml fm \\r\\n    ON sp.inscricao_estadual = fm.inscricao_estadual\\r\\n    AND sp.tipo_debito = fm.tipo_debito\\r\\nORDER BY sp.score_final_priorizacao DESC, sp.valor_total_devido DESC\\r\\nLIMIT 1000;\\r\\n\\r\\n-- ----------------------------------------------------------------------------\\r\\n-- 6.3. VIEW AN\\u00c1LISE POR MUNIC\\u00cdPIO\\r\\n-- ----------------------------------------------------------------------------\\r\\nDROP VIEW IF EXISTS gecob.vw_analise_por_municipio;\\r\\nCREATE VIEW gecob.vw_analise_por_municipio AS\\r\\nSELECT\\r\\n    mc.codigo_municipio,\\r\\n    mc.nome_municipio,\\r\\n    mc.codigo_uf,\\r\\n    \\r\\n    -- Contagens\\r\\n    COUNT(DISTINCT mc.inscricao_estadual) AS qtd_contribuintes,\\r\\n    COUNT(*) AS qtd_debitos,\\r\\n    \\r\\n    -- Valores Totais\\r\\n    SUM(mc.valor_total_devido) AS valor_total_devido,\\r\\n    AVG(mc.valor_total_devido) AS valor_medio_devido,\\r\\n    \\r\\n    -- Distribui\\u00e7\\u00e3o por Prioridade\\r\\n    SUM(CASE WHEN sp.classificacao_prioridade = 'PRIORIDADE_MAXIMA' THEN 1 ELSE 0 END) AS qtd_prioridade_maxima,\\r\\n    SUM(CASE WHEN sp.classificacao_prioridade = 'PRIORIDADE_ALTA' THEN 1 ELSE 0 END) AS qtd_prioridade_alta,\\r\\n    SUM(CASE WHEN sp.classificacao_prioridade = 'PRIORIDADE_MEDIA' THEN 1 ELSE 0 END) AS qtd_prioridade_media,\\r\\n    SUM(CASE WHEN sp.classificacao_prioridade = 'PRIORIDADE_BAIXA' THEN 1 ELSE 0 END) AS qtd_prioridade_baixa,\\r\\n    \\r\\n    -- Valores por Prioridade\\r\\n    SUM(CASE WHEN sp.classificacao_prioridade = 'PRIORIDADE_MAXIMA' THEN mc.valor_total_devido ELSE 0 END) AS valor_prioridade_maxima,\\r\\n    SUM(CASE WHEN sp.classificacao_prioridade = 'PRIORIDADE_ALTA' THEN mc.valor_total_devido ELSE 0 END) AS valor_prioridade_alta,\\r\\n    \\r\\n    -- M\\u00e9dias de Performance\\r\\n    AVG(mc.taxa_resposta_contatos) AS media_taxa_resposta,\\r\\n    AVG(sp.score_final_priorizacao) AS media_score_priorizacao,\\r\\n    \\r\\n    -- Flags de Risco\\r\\n    SUM(CASE WHEN mc.flag_falencia = 1 THEN 1 ELSE 0 END) AS qtd_com_falencia,\\r\\n    SUM(CASE WHEN mc.flag_recuperacao_judicial = 1 THEN 1 ELSE 0 END) AS qtd_recuperacao_judicial,\\r\\n    SUM(CASE WHEN mc.flag_devedor_contumaz = 1 THEN 1 ELSE 0 END) AS qtd_devedor_contumaz\\r\\n\\r\\nFROM gecob.prior_master_consolidado mc\\r\\nINNER JOIN gecob.prior_score_priorizacao sp \\r\\n    ON mc.inscricao_estadual = sp.inscricao_estadual\\r\\n    AND mc.tipo_debito = sp.tipo_debito\\r\\nGROUP BY mc.codigo_municipio, mc.nome_municipio, mc.codigo_uf\\r\\nORDER BY SUM(mc.valor_total_devido) DESC;\\r\\n\\r\\n-- ============================================================================\\r\\n-- VALIDA\\u00c7\\u00d5ES FINAIS\\r\\n-- ============================================================================\\r\\n\\r\\n-- Valida\\u00e7\\u00e3o 1: Distribui\\u00e7\\u00e3o de Prioridades\\r\\nSELECT \\r\\n    'DISTRIBUICAO DE PRIORIDADES' AS validacao,\\r\\n    classificacao_prioridade,\\r\\n    COUNT(*) AS quantidade,\\r\\n    ROUND(COUNT(*) * 100.0 / SUM(COUNT(*)) OVER (), 1) AS percentual,\\r\\n    SUM(valor_total_devido) AS valor_total,\\r\\n    AVG(valor_total_devido) AS valor_medio,\\r\\n    ROUND(AVG(score_final_priorizacao), 1) AS score_medio\\r\\nFROM gecob.prior_score_priorizacao\\r\\nGROUP BY classificacao_prioridade\\r\\nORDER BY \\r\\n    CASE classificacao_prioridade\\r\\n        WHEN 'PRIORIDADE_MAXIMA' THEN 1\\r\\n        WHEN 'PRIORIDADE_ALTA' THEN 2\\r\\n        WHEN 'PRIORIDADE_MEDIA' THEN 3\\r\\n        WHEN 'PRIORIDADE_BAIXA' THEN 4\\r\\n    END;\\r\\n\\r\\n-- Valida\\u00e7\\u00e3o 2: Verifica\\u00e7\\u00e3o de Cadastros NULL\\r\\nSELECT\\r\\n    'VERIFICACAO DE NULLS NO CADASTRO' AS validacao,\\r\\n    COUNT(*) AS total_registros,\\r\\n    SUM(CASE WHEN razao_social IS NULL THEN 1 ELSE 0 END) AS razao_social_null,\\r\\n    SUM(CASE WHEN nome_fantasia IS NULL THEN 1 ELSE 0 END) AS nome_fantasia_null,\\r\\n    SUM(CASE WHEN situacao_cadastral_desc IS NULL THEN 1 ELSE 0 END) AS situacao_cadastral_null,\\r\\n    SUM(CASE WHEN descricao_cnae IS NULL THEN 1 ELSE 0 END) AS cnae_null,\\r\\n    SUM(CASE WHEN regime_apuracao_desc IS NULL THEN 1 ELSE 0 END) AS regime_null,\\r\\n    SUM(CASE WHEN nome_municipio IS NULL THEN 1 ELSE 0 END) AS municipio_null\\r\\nFROM gecob.prior_master_consolidado;\\r\\n\\r\\n-- Valida\\u00e7\\u00e3o 3: Top 10 Setores\\r\\nSELECT \\r\\n    'TOP 10 SETORES' AS validacao,\\r\\n    mc.secao_cnae,\\r\\n    mc.descricao_secao,\\r\\n    COUNT(DISTINCT mc.inscricao_estadual) AS qtd_contribuintes,\\r\\n    SUM(mc.valor_total_devido) AS valor_total,\\r\\n    ROUND(AVG(sp.score_final_priorizacao), 1) AS score_medio\\r\\nFROM gecob.prior_master_consolidado mc\\r\\nINNER JOIN gecob.prior_score_priorizacao sp \\r\\n    ON mc.inscricao_estadual = sp.inscricao_estadual\\r\\n    AND mc.tipo_debito = sp.tipo_debito\\r\\nGROUP BY mc.secao_cnae, mc.descricao_secao\\r\\nORDER BY SUM(mc.valor_total_devido) DESC\\r\\nLIMIT 10;\", \"statementsList\": [\"\\r\\nCREATE TABLE gecob.prior_declaracoes_dime STORED AS PARQUET AS\\r\\nWITH dime_6m AS (\\r\\n    SELECT \\r\\n        d.nu_cnpj AS cnpj,\\r\\n        d.nu_ie AS inscricao_estadual,\\r\\n        d.nu_per_ref AS periodo_referencia,\\r\\n        d.sn_omisso AS flag_omisso,\\r\\n        d.sn_entregue_prazo AS flag_entregue_prazo,\\r\\n        d.sn_com_movimento AS flag_com_movimento,\\r\\n        COALESCE(d.vl_faturamento, 0) AS faturamento,\\r\\n        COALESCE(d.vl_receita_bruta, 0) AS receita_bruta,\\r\\n        COALESCE(d.vl_tot_deb, 0) AS icms_devido,\\r\\n        COALESCE(d.vl_deb_recolher, 0) AS icms_recolher\\r\\n    FROM usr_sat_ods.vw_ods_decl_dime d\\r\\n    WHERE d.nu_per_ref BETWEEN 202410 AND 202503\\r\\n      AND d.sn_cancelada = 0\\r\\n)\\r\\nSELECT\\r\\n    cnpj,\\r\\n    MAX(inscricao_estadual) AS inscricao_estadual,\\r\\n    \\r\\n    -- Contagens\\r\\n    COUNT(DISTINCT periodo_referencia) AS qtd_periodos_declarados,\\r\\n    SUM(CASE WHEN flag_omisso = 1 THEN 1 ELSE 0 END) AS qtd_periodos_omissos,\\r\\n    SUM(CASE WHEN flag_com_movimento = 1 THEN 1 ELSE 0 END) AS qtd_periodos_com_movimento,\\r\\n    SUM(CASE WHEN flag_entregue_prazo = 1 THEN 1 ELSE 0 END) AS qtd_entregue_prazo,\\r\\n    \\r\\n    -- Agregados Financeiros\\r\\n    SUM(faturamento) AS faturamento_total_6m,\\r\\n    SUM(receita_bruta) AS receita_bruta_total_6m,\\r\\n    SUM(icms_devido) AS icms_devido_total_6m,\\r\\n    SUM(icms_recolher) AS icms_recolher_total_6m,\\r\\n    \\r\\n    AVG(faturamento) AS faturamento_medio_6m,\\r\\n    STDDEV(faturamento) AS faturamento_desvio_6m,\\r\\n    \\r\\n    -- Al\\u00edquota Efetiva M\\u00e9dia\\r\\n    CASE \\r\\n        WHEN SUM(faturamento) > 0 \\r\\n        THEN SUM(icms_devido) / NULLIF(SUM(faturamento), 0)\\r\\n        ELSE NULL \\r\\n    END AS aliquota_efetiva_media_6m,\\r\\n    \\r\\n    -- Classifica\\u00e7\\u00f5es\\r\\n    CASE \\r\\n        WHEN COUNT(DISTINCT periodo_referencia) >= 6 THEN 'REGULAR'\\r\\n        WHEN COUNT(DISTINCT periodo_referencia) >= 4 THEN 'PARCIAL'\\r\\n        WHEN COUNT(DISTINCT periodo_referencia) >= 1 THEN 'IRREGULAR'\\r\\n        ELSE 'SEM_DECLARACAO'\\r\\n    END AS classificacao_regularidade_declaracao,\\r\\n    \\r\\n    CASE \\r\\n        WHEN SUM(CASE WHEN flag_omisso = 1 THEN 1 ELSE 0 END) >= 3 THEN 'OMISSO_RECORRENTE'\\r\\n        WHEN SUM(CASE WHEN flag_omisso = 1 THEN 1 ELSE 0 END) >= 1 THEN 'OMISSO_EVENTUAL'\\r\\n        ELSE 'NAO_OMISSO'\\r\\n    END AS classificacao_omissao,\\r\\n    \\r\\n    -- Porte Baseado em Faturamento\\r\\n    CASE\\r\\n        WHEN SUM(faturamento) / NULLIF(COUNT(DISTINCT periodo_referencia), 0) <= 30000 THEN 'MICRO'\\r\\n        WHEN SUM(faturamento) / NULLIF(COUNT(DISTINCT periodo_referencia), 0) <= 400000 THEN 'PEQUENO'\\r\\n        WHEN SUM(faturamento) / NULLIF(COUNT(DISTINCT periodo_referencia), 0) <= 5000000 THEN 'MEDIO'\\r\\n        WHEN SUM(faturamento) / NULLIF(COUNT(DISTINCT periodo_referencia), 0) > 5000000 THEN 'GRANDE'\\r\\n        ELSE 'SEM_FATURAMENTO'\\r\\n    END AS porte_por_faturamento,\\r\\n    \\r\\n    CURRENT_TIMESTAMP() AS dt_carga\\r\\n\\r\\nFROM dime_6m\\r\\nGROUP BY cnpj;\", \"\\r\\n\\r\\n-- ============================================================================\\r\\n-- PARTE 3: TABELA MASTER CONSOLIDADA (CORRIGIDA - JOIN POR INSCRI\\u00c7\\u00c3O ESTADUAL)\\r\\n-- ============================================================================\\r\\n\\r\\n-- ----------------------------------------------------------------------------\\r\\n-- 3.1. TABELA MESTRE - CONSOLIDA\\u00c7\\u00c3O DE TODOS OS DADOS (SEM DUPLICATAS)\\r\\n-- Agrega\\u00e7\\u00e3o por inscri\\u00e7\\u00e3o estadual eliminando duplicatas\\r\\n-- ----------------------------------------------------------------------------\\r\\nDROP TABLE IF EXISTS gecob.prior_master_consolidado;\", \"\\r\\nCREATE TABLE gecob.prior_master_consolidado STORED AS PARQUET AS\\r\\nSELECT\\r\\n    -- ========================================================================\\r\\n    -- IDENTIFICA\\u00c7\\u00c3O PRINCIPAL\\r\\n    -- ========================================================================\\r\\n    db.inscricao_estadual,\\r\\n    db.tipo_debito,\\r\\n    \\r\\n    -- ========================================================================\\r\\n    -- INFORMA\\u00c7\\u00d5ES DO D\\u00c9BITO (AGREGADAS)\\r\\n    -- ========================================================================\\r\\n    MAX(db.status_debito) AS status_debito,\\r\\n    SUM(db.valor_total_devido) AS valor_total_devido,\\r\\n    MIN(db.data_inclusao_cobranca) AS data_inclusao_cobranca,\\r\\n    MAX(db.data_limite_pagamento) AS data_limite_pagamento,\\r\\n    MAX(db.data_exclusao_moroso) AS data_exclusao_moroso,\\r\\n    MAX(db.data_ultima_transacao) AS data_ultima_transacao,\\r\\n    MAX(db.flag_com_garantia) AS flag_com_garantia,\\r\\n    MAX(db.flag_devedor_contumaz) AS flag_devedor_contumaz,\\r\\n    MAX(db.flag_recuperacao_judicial) AS flag_recuperacao_judicial,\\r\\n    MAX(db.flag_falencia) AS flag_falencia,\\r\\n    MAX(db.flag_protesto) AS flag_protesto,\\r\\n    MAX(db.grupo_imposto) AS grupo_imposto,\\r\\n    MAX(db.seq_ultimo_contato) AS seq_ultimo_contato,\\r\\n    MAX(db.grupo_setorial) AS grupo_setorial,\\r\\n    MAX(db.codigo_gereg) AS codigo_gereg,\\r\\n    MAX(db.codigo_usefi) AS codigo_usefi,\\r\\n    MAX(db.situacao_cadastral_rge) AS situacao_cadastral_rge,\\r\\n    MAX(db.tipo_regime_rge) AS tipo_regime_rge,\\r\\n    MAX(db.codigo_municipio_rge) AS codigo_municipio_rge,\\r\\n    \\r\\n    -- ========================================================================\\r\\n    -- DADOS DA CONTA CORRENTE (J\\u00c1 PR\\u00c9-AGREGADOS)\\r\\n    -- MELHORIA: N\\u00e3o precisa mais de SUM() pois a tabela j\\u00e1 vem agregada por IE\\r\\n    -- ========================================================================\\r\\n    MAX(cc.periodo_conta) AS periodo_conta,\\r\\n    MAX(cc.numero_documento) AS numero_documento,\\r\\n    MAX(cc.numero_conta_imposto) AS numero_conta_imposto,\\r\\n    MAX(cc.situacao_conta) AS situacao_conta,\\r\\n    MAX(cc.estado_conta) AS estado_conta,\\r\\n    MAX(cc.qtd_registros_conta_corrente) AS qtd_registros_conta_corrente,\\r\\n    \\r\\n    -- Saldos (J\\u00c1 AGREGADOS na prior_conta_corrente, apenas pegar com MAX)\\r\\n    MAX(COALESCE(cc.saldo_imposto, 0)) AS saldo_imposto,\\r\\n    MAX(COALESCE(cc.saldo_multa, 0)) AS saldo_multa,\\r\\n    MAX(COALESCE(cc.saldo_juros, 0)) AS saldo_juros,\\r\\n    MAX(COALESCE(cc.saldo_credito, 0)) AS saldo_credito,\\r\\n    MAX(COALESCE(cc.saldo_reajuste, 0)) AS saldo_reajuste,\\r\\n    MAX(COALESCE(cc.valor_imposto_informado, 0)) AS valor_imposto_informado,\\r\\n    MAX(COALESCE(cc.valor_multa_informado, 0)) AS valor_multa_informado,\\r\\n    MAX(COALESCE(cc.valor_juros_informado, 0)) AS valor_juros_informado,\\r\\n    MAX(COALESCE(cc.valor_credito_informado, 0)) AS valor_credito_informado,\\r\\n    MAX(COALESCE(cc.valor_reajuste_informado, 0)) AS valor_reajuste_informado,\\r\\n    MAX(cc.codigo_tipo_imposto) AS codigo_tipo_imposto,\\r\\n    MAX(cc.tipo_identificacao_imposto) AS tipo_identificacao_imposto,\\r\\n    \\r\\n    -- ========================================================================\\r\\n    -- DADOS CADASTRAIS (CORRIGIDO - JOIN POR IE)\\r\\n    -- ========================================================================\\r\\n    MAX(cad.cnpj) AS cnpj,\\r\\n    MAX(cad.cnpj_grupo) AS cnpj_grupo,\\r\\n    MAX(cad.razao_social) AS razao_social,\\r\\n    MAX(cad.nome_fantasia) AS nome_fantasia,\\r\\n    MAX(cad.situacao_cadastral_cod) AS situacao_cadastral_cod,\\r\\n    MAX(cad.situacao_cadastral_desc) AS situacao_cadastral_desc,\\r\\n    MAX(cad.data_situacao_cadastral) AS data_situacao_cadastral,\\r\\n    \\r\\n    -- Classifica\\u00e7\\u00e3o Econ\\u00f4mica\\r\\n    MAX(cad.cnae_classe) AS cnae_classe,\\r\\n    MAX(cad.cnae_divisao) AS cnae_divisao,\\r\\n    MAX(cad.descricao_cnae) AS descricao_cnae,\\r\\n    MAX(cad.secao_cnae) AS secao_cnae,\\r\\n    MAX(cad.descricao_secao) AS descricao_secao,\\r\\n    MAX(cad.divisao_cnae) AS divisao_cnae,\\r\\n    MAX(cad.descricao_divisao) AS descricao_divisao,\\r\\n    \\r\\n    -- Regime Tribut\\u00e1rio\\r\\n    MAX(cad.regime_apuracao_cod) AS regime_apuracao_cod,\\r\\n    MAX(cad.regime_apuracao_desc) AS regime_apuracao_desc,\\r\\n    MAX(cad.tipo_contribuinte_cod) AS tipo_contribuinte_cod,\\r\\n    MAX(cad.tipo_contribuinte_desc) AS tipo_contribuinte_desc,\\r\\n    MAX(cad.enquadramento_empresa_cod) AS enquadramento_empresa_cod,\\r\\n    MAX(cad.enquadramento_empresa_desc) AS enquadramento_empresa_desc,\\r\\n    \\r\\n    -- Caracter\\u00edsticas\\r\\n    MAX(cad.natureza_juridica_cod) AS natureza_juridica_cod,\\r\\n    MAX(cad.natureza_juridica_desc) AS natureza_juridica_desc,\\r\\n    MAX(cad.data_constituicao) AS data_constituicao,\\r\\n    MAX(cad.data_inicio_icms) AS data_inicio_icms,\\r\\n    MAX(cad.flag_simples_nacional) AS flag_simples_nacional,\\r\\n    MAX(cad.flag_dtec) AS flag_dtec,\\r\\n    MAX(cad.flag_suspensao_dfe) AS flag_suspensao_dfe,\\r\\n    MAX(cad.flag_matriz) AS flag_matriz,\\r\\n    MAX(cad.flag_apuracao_consolidada) AS flag_apuracao_consolidada,\\r\\n    MAX(cad.flag_estabelecimento_consolidado) AS flag_estabelecimento_consolidado,\\r\\n    MAX(cad.flag_estabelecimento_consolidador) AS flag_estabelecimento_consolidador,\\r\\n    \\r\\n    -- Localiza\\u00e7\\u00e3o\\r\\n    MAX(cad.codigo_municipio) AS codigo_municipio,\\r\\n    MAX(cad.nome_municipio) AS nome_municipio,\\r\\n    MAX(cad.codigo_uf) AS codigo_uf,\\r\\n    MAX(cad.nome_usefi) AS nome_usefi,\\r\\n    MAX(cad.nome_ges) AS nome_ges,\\r\\n    \\r\\n    -- V\\u00ednculos\\r\\n    MAX(cad.qtd_vinculos) AS qtd_vinculos,\\r\\n    MAX(cad.qtd_vinculos_ativos) AS qtd_vinculos_ativos,\\r\\n    MAX(cad.qtd_socios) AS qtd_socios,\\r\\n    MAX(cad.qtd_socios_ativos) AS qtd_socios_ativos,\\r\\n    \\r\\n    -- Contador\\r\\n    MAX(cad.cnpj_cpf_contador) AS cnpj_cpf_contador,\\r\\n    MAX(cad.nome_contador) AS nome_contador,\\r\\n    \\r\\n    -- ========================================================================\\r\\n    -- HIST\\u00d3RICO DE CONTATOS (COM M\\u00c9TRICAS TEMPORAIS)\\r\\n    -- ========================================================================\\r\\n    MAX(COALESCE(hc.qtd_total_contatos, 0)) AS qtd_total_contatos,\\r\\n    MAX(COALESCE(hc.qtd_tipos_contato_distintos, 0)) AS qtd_tipos_contato_distintos,\\r\\n    MAX(COALESCE(hc.qtd_origens_distintas, 0)) AS qtd_origens_contato,\\r\\n    MAX(COALESCE(hc.qtd_usuarios_distintos, 0)) AS qtd_usuarios_contato,\\r\\n    MAX(COALESCE(hc.qtd_respostas_positivas, 0)) AS qtd_respostas_positivas,\\r\\n    MAX(COALESCE(hc.qtd_respostas_negativas, 0)) AS qtd_respostas_negativas,\\r\\n    MAX(COALESCE(hc.qtd_sem_resposta, 0)) AS qtd_sem_resposta,\\r\\n    MAX(COALESCE(hc.qtd_com_promessa_pagamento, 0)) AS qtd_promessas_pagamento,\\r\\n    MAX(COALESCE(hc.taxa_resposta, 0)) AS taxa_resposta_contatos,\\r\\n    MAX(hc.data_ultimo_contato) AS data_ultimo_contato,\\r\\n    MAX(hc.data_ultima_promessa) AS data_ultima_promessa,\\r\\n    MIN(COALESCE(hc.dias_desde_ultimo_contato, 999999)) AS dias_desde_ultimo_contato,\\r\\n    \\r\\n    -- NOVAS M\\u00c9TRICAS: Atividade recente de contatos\\r\\n    MAX(COALESCE(hc.qtd_contatos_ultimos_30_dias, 0)) AS qtd_contatos_ultimos_30_dias,\\r\\n    MAX(COALESCE(hc.qtd_contatos_ultimos_90_dias, 0)) AS qtd_contatos_ultimos_90_dias,\\r\\n    \\r\\n    -- ========================================================================\\r\\n    -- PARCELAMENTOS (MAIS RECENTE)\\r\\n    -- ========================================================================\\r\\n    MAX(CASE WHEN parc.numero_parcelamento IS NOT NULL THEN 1 ELSE 0 END) AS flag_tem_parcelamento,\\r\\n    MAX(parc.numero_parcelamento) AS numero_parcelamento,\\r\\n    MAX(parc.status_parcelamento) AS status_parcelamento,\\r\\n    MAX(parc.status_parcelamento_desc) AS status_parcelamento_desc,\\r\\n    MAX(parc.tipo_cancelamento) AS tipo_cancelamento_parcelamento,\\r\\n    MAX(parc.flag_divida_ativa) AS flag_parcelamento_divida_ativa,\\r\\n    SUM(COALESCE(parc.saldo_divida, 0)) AS saldo_divida_parcelamento,\\r\\n    SUM(COALESCE(parc.saldo_parcelado, 0)) AS saldo_parcelado,\\r\\n    SUM(COALESCE(parc.saldo_imposto_parcelado, 0)) AS saldo_imposto_parcelado,\\r\\n    SUM(COALESCE(parc.saldo_multa_parcelada, 0)) AS saldo_multa_parcelada,\\r\\n    SUM(COALESCE(parc.saldo_juros_parcelado, 0)) AS saldo_juros_parcelado,\\r\\n    MAX(parc.numero_parcelas) AS numero_parcelas,\\r\\n    MAX(parc.data_pedido) AS data_pedido_parcelamento,\\r\\n    MAX(parc.data_cancelamento) AS data_cancelamento_parcelamento,\\r\\n    \\r\\n    -- ========================================================================\\r\\n    -- SCORE DE NOTEIRAS (JOIN POR CNPJ)\\r\\n    -- ========================================================================\\r\\n    MAX(COALESCE(sn.score_total_noteiras, 0)) AS score_noteiras,\\r\\n    MAX(COALESCE(sn.qtd_indicios, 0)) AS qtd_indicios_noteiras,\\r\\n    MAX(COALESCE(sn.qtd_tipos_indicios_distintos, 0)) AS qtd_tipos_indicios_noteiras,\\r\\n    MAX(COALESCE(sn.score_medio_noteiras, 0)) AS score_medio_noteiras,\\r\\n    MAX(COALESCE(sn.score_maximo_indicio, 0)) AS score_maximo_indicio_noteiras,\\r\\n    MAX(COALESCE(sn.classificacao_risco_noteiras, 'SEM_INDICIO')) AS classificacao_risco_noteiras,\\r\\n    \\r\\n    -- ========================================================================\\r\\n    -- HIST\\u00d3RICO DE PAGAMENTOS (6 MESES) - JOIN POR CNPJ\\r\\n    -- ========================================================================\\r\\n    MAX(COALESCE(pg.qtd_periodos_com_pagamento, 0)) AS qtd_periodos_pagamento_6m,\\r\\n    MAX(COALESCE(pg.qtd_total_pagamentos_6m, 0)) AS qtd_pagamentos_6m,\\r\\n    MAX(COALESCE(pg.valor_total_pago_6m, 0)) AS valor_total_pago_6m,\\r\\n    MAX(COALESCE(pg.valor_medio_pago_periodo, 0)) AS valor_medio_pago_periodo,\\r\\n    MAX(COALESCE(pg.desvio_valor_pago, 0)) AS desvio_valor_pago,\\r\\n    MAX(pg.ultimo_periodo_pagamento) AS ultimo_periodo_pagamento,\\r\\n    MAX(COALESCE(pg.classificacao_regularidade, 'SEM_PAGAMENTO')) AS regularidade_pagamentos,\\r\\n    MAX(COALESCE(pg.coef_variacao_pagamentos, 0)) AS coef_variacao_pagamentos,\\r\\n    \\r\\n    -- ========================================================================\\r\\n    -- DECLARA\\u00c7\\u00d5ES DIME (6 MESES) - JOIN POR CNPJ\\r\\n    -- ========================================================================\\r\\n    MAX(COALESCE(dd.qtd_periodos_declarados, 0)) AS qtd_periodos_declarados_6m,\\r\\n    MAX(COALESCE(dd.qtd_periodos_omissos, 0)) AS qtd_periodos_omissos_6m,\\r\\n    MAX(COALESCE(dd.qtd_periodos_com_movimento, 0)) AS qtd_periodos_movimento_6m,\\r\\n    MAX(COALESCE(dd.qtd_entregue_prazo, 0)) AS qtd_entregue_prazo_6m,\\r\\n    MAX(COALESCE(dd.faturamento_total_6m, 0)) AS faturamento_total_6m,\\r\\n    MAX(COALESCE(dd.faturamento_medio_6m, 0)) AS faturamento_medio_6m,\\r\\n    MAX(COALESCE(dd.faturamento_desvio_6m, 0)) AS faturamento_desvio_6m,\\r\\n    MAX(COALESCE(dd.icms_devido_total_6m, 0)) AS icms_devido_total_6m,\\r\\n    MAX(COALESCE(dd.icms_recolher_total_6m, 0)) AS icms_recolher_total_6m,\\r\\n    MAX(COALESCE(dd.aliquota_efetiva_media_6m, 0)) AS aliquota_efetiva_media_6m,\\r\\n    MAX(COALESCE(dd.classificacao_regularidade_declaracao, 'SEM_DECLARACAO')) AS regularidade_declaracoes,\\r\\n    MAX(COALESCE(dd.classificacao_omissao, 'NAO_OMISSO')) AS classificacao_omissao,\\r\\n    MAX(COALESCE(dd.porte_por_faturamento, 'SEM_FATURAMENTO')) AS porte_por_faturamento,\\r\\n    \\r\\n    -- ========================================================================\\r\\n    -- METADADOS\\r\\n    -- ========================================================================\\r\\n    CURRENT_TIMESTAMP() AS dt_carga\\r\\n\\r\\nFROM gecob.prior_debitos_base db\\r\\n\\r\\n-- JOIN por Inscri\\u00e7\\u00e3o Estadual com Conta Corrente (PR\\u00c9-AGREGADA)\\r\\nLEFT JOIN gecob.prior_conta_corrente cc \\r\\n    ON db.inscricao_estadual = cc.inscricao_estadual\\r\\n\\r\\n-- JOIN por Inscri\\u00e7\\u00e3o Estadual com Cadastro\\r\\nLEFT JOIN gecob.prior_contribuintes_cadastro cad \\r\\n    ON db.inscricao_estadual = cad.inscricao_estadual\\r\\n\\r\\n-- JOIN por Inscri\\u00e7\\u00e3o Estadual com Hist\\u00f3rico de Contatos\\r\\nLEFT JOIN gecob.prior_historico_contatos hc \\r\\n    ON db.inscricao_estadual = hc.inscricao_estadual\\r\\n\\r\\n-- JOIN por Inscri\\u00e7\\u00e3o Estadual com Parcelamentos (pega o mais recente)\\r\\nLEFT JOIN (\\r\\n    SELECT \\r\\n        inscricao_estadual,\\r\\n        numero_parcelamento,\\r\\n        status_parcelamento,\\r\\n        status_parcelamento_desc,\\r\\n        tipo_cancelamento,\\r\\n        flag_divida_ativa,\\r\\n        saldo_divida,\\r\\n        saldo_parcelado,\\r\\n        saldo_imposto_parcelado,\\r\\n        saldo_multa_parcelada,\\r\\n        saldo_juros_parcelado,\\r\\n        numero_parcelas,\\r\\n        data_pedido,\\r\\n        data_cancelamento\\r\\n    FROM (\\r\\n        SELECT \\r\\n            inscricao_estadual,\\r\\n            numero_parcelamento,\\r\\n            status_parcelamento,\\r\\n            status_parcelamento_desc,\\r\\n            tipo_cancelamento,\\r\\n            flag_divida_ativa,\\r\\n            saldo_divida,\\r\\n            saldo_parcelado,\\r\\n            saldo_imposto_parcelado,\\r\\n            saldo_multa_parcelada,\\r\\n            saldo_juros_parcelado,\\r\\n            numero_parcelas,\\r\\n            data_pedido,\\r\\n            data_cancelamento,\\r\\n            ROW_NUMBER() OVER (PARTITION BY inscricao_estadual ORDER BY data_pedido DESC NULLS LAST) AS rn\\r\\n        FROM gecob.prior_parcelamentos\\r\\n    ) ranked\\r\\n    WHERE rn = 1\\r\\n) parc ON db.inscricao_estadual = parc.inscricao_estadual\\r\\n\\r\\n-- JOIN por CNPJ com Score Noteiras\\r\\nLEFT JOIN gecob.prior_score_noteiras sn \\r\\n    ON cad.cnpj = sn.cnpj_cpf\\r\\n\\r\\n-- JOIN por CNPJ com Pagamentos\\r\\nLEFT JOIN gecob.prior_pagamentos_historico pg \\r\\n    ON cad.cnpj = pg.cnpj\\r\\n\\r\\n-- JOIN por CNPJ com Declara\\u00e7\\u00f5es\\r\\nLEFT JOIN gecob.prior_declaracoes_dime dd \\r\\n    ON cad.cnpj = dd.cnpj\\r\\n\\r\\n-- Agrupa por IE e tipo_debito para eliminar duplicatas\\r\\nGROUP BY db.inscricao_estadual, db.tipo_debito;\", \"\\r\\n\\r\\n-- ============================================================================\\r\\n-- PARTE 4: FEATURES ENGINEERED - VERS\\u00c3O FINAL OTIMIZADA (PASSAGEM \\u00daNICA)\\r\\n-- Este \\u00fanico script substitui todas as 7 etapas da vers\\u00e3o V1.4\\r\\n-- Tempo estimado: ~3-5 minutos\\r\\n-- ============================================================================\\r\\n\\r\\nDROP TABLE IF EXISTS gecob.prior_features_ml;\", \"\\r\\nCREATE TABLE gecob.prior_features_ml STORED AS PARQUET AS\\r\\nSELECT\\r\\n    -- ========================================================================\\r\\n    -- IDENTIFICA\\u00c7\\u00c3O E TARGET\\r\\n    -- ========================================================================\\r\\n    mc.inscricao_estadual,\\r\\n    mc.cnpj,\\r\\n    mc.tipo_debito,\\r\\n    mc.status_debito AS target_status_debito,\\r\\n\\r\\n    -- ========================================================================\\r\\n    -- GRUPO 1: FEATURES FINANCEIRAS\\r\\n    -- ========================================================================\\r\\n    mc.valor_total_devido,\\r\\n    LN(CAST(1 + mc.valor_total_devido AS DOUBLE)) AS valor_devido_log,\\r\\n    mc.saldo_imposto, \\r\\n    mc.saldo_multa, \\r\\n    mc.saldo_juros, \\r\\n    mc.saldo_credito, \\r\\n    mc.saldo_reajuste,\\r\\n    \\r\\n    CASE \\r\\n        WHEN mc.valor_total_devido > 0 \\r\\n        THEN CAST(mc.saldo_imposto AS DOUBLE) / NULLIF(mc.valor_total_devido, 0) \\r\\n        ELSE 0 \\r\\n    END AS proporcao_imposto,\\r\\n    \\r\\n    CASE \\r\\n        WHEN mc.valor_total_devido > 0 \\r\\n        THEN CAST(mc.saldo_multa AS DOUBLE) / NULLIF(mc.valor_total_devido, 0) \\r\\n        ELSE 0 \\r\\n    END AS proporcao_multa,\\r\\n    \\r\\n    CASE \\r\\n        WHEN mc.valor_total_devido > 0 \\r\\n        THEN CAST(mc.saldo_juros AS DOUBLE) / NULLIF(mc.valor_total_devido, 0) \\r\\n        ELSE 0 \\r\\n    END AS proporcao_juros,\\r\\n    \\r\\n    CASE \\r\\n        WHEN mc.faturamento_medio_6m > 0 \\r\\n        THEN CAST(mc.valor_total_devido AS DOUBLE) / NULLIF(mc.faturamento_medio_6m, 0) \\r\\n        ELSE 0 \\r\\n    END AS razao_debito_faturamento,\\r\\n    \\r\\n    CASE \\r\\n        WHEN mc.valor_total_devido > 0 AND mc.faturamento_medio_6m > 0\\r\\n        THEN CAST(mc.faturamento_medio_6m AS DOUBLE) / NULLIF(mc.valor_total_devido, 0) \\r\\n        ELSE 0 \\r\\n    END AS capacidade_pagamento_estimada,\\r\\n\\r\\n    -- ========================================================================\\r\\n    -- GRUPO 2: FEATURES COMPORTAMENTAIS\\r\\n    -- ========================================================================\\r\\n    mc.qtd_periodos_pagamento_6m, \\r\\n    mc.qtd_pagamentos_6m, \\r\\n    mc.valor_total_pago_6m, \\r\\n    mc.valor_medio_pago_periodo, \\r\\n    mc.desvio_valor_pago,\\r\\n    mc.regularidade_pagamentos, \\r\\n    mc.coef_variacao_pagamentos,\\r\\n    \\r\\n    CASE \\r\\n        WHEN mc.icms_devido_total_6m > 0 \\r\\n        THEN CAST(mc.valor_total_pago_6m AS DOUBLE) / NULLIF(mc.icms_devido_total_6m, 0) \\r\\n        ELSE 0 \\r\\n    END AS taxa_pagamento_vs_devido_6m,\\r\\n    \\r\\n    mc.qtd_periodos_declarados_6m, \\r\\n    mc.qtd_periodos_omissos_6m, \\r\\n    mc.qtd_periodos_movimento_6m, \\r\\n    mc.qtd_entregue_prazo_6m,\\r\\n    mc.regularidade_declaracoes, \\r\\n    mc.classificacao_omissao,\\r\\n    \\r\\n    CASE \\r\\n        WHEN mc.qtd_periodos_declarados_6m > 0 \\r\\n        THEN CAST(mc.qtd_periodos_omissos_6m AS DOUBLE) / NULLIF(mc.qtd_periodos_declarados_6m, 0) \\r\\n        ELSE 0 \\r\\n    END AS taxa_omissao,\\r\\n    \\r\\n    CASE \\r\\n        WHEN mc.qtd_periodos_declarados_6m > 0 \\r\\n        THEN CAST(mc.qtd_entregue_prazo_6m AS DOUBLE) / NULLIF(mc.qtd_periodos_declarados_6m, 0) \\r\\n        ELSE 0 \\r\\n    END AS taxa_entrega_prazo,\\r\\n    \\r\\n    -- ========================================================================\\r\\n    -- GRUPO 3: FEATURES DE CONTATO\\r\\n    -- ========================================================================\\r\\n    mc.qtd_total_contatos, \\r\\n    mc.qtd_tipos_contato_distintos, \\r\\n    mc.qtd_origens_contato, \\r\\n    mc.qtd_usuarios_contato, \\r\\n    mc.qtd_respostas_positivas, \\r\\n    mc.qtd_respostas_negativas,\\r\\n    mc.qtd_sem_resposta, \\r\\n    mc.qtd_promessas_pagamento, \\r\\n    mc.taxa_resposta_contatos, \\r\\n    mc.dias_desde_ultimo_contato,\\r\\n    \\r\\n    CASE \\r\\n        WHEN mc.qtd_total_contatos > 0 \\r\\n        THEN CAST(mc.qtd_respostas_positivas AS DOUBLE) / NULLIF(mc.qtd_total_contatos, 0) \\r\\n        ELSE 0 \\r\\n    END AS taxa_efetividade_contatos,\\r\\n    \\r\\n    CASE \\r\\n        WHEN mc.qtd_total_contatos > 0 \\r\\n        THEN CAST(mc.qtd_promessas_pagamento AS DOUBLE) / NULLIF(mc.qtd_total_contatos, 0) \\r\\n        ELSE 0 \\r\\n    END AS taxa_promessas_contatos,\\r\\n    \\r\\n    DATEDIFF(CURRENT_DATE(), mc.data_inclusao_cobranca) AS dias_desde_inclusao_cobranca,\\r\\n    \\r\\n    CASE \\r\\n        WHEN DATEDIFF(CURRENT_DATE(), mc.data_inclusao_cobranca) > 0 \\r\\n        THEN CAST(mc.qtd_total_contatos AS DOUBLE) * 30 / NULLIF(DATEDIFF(CURRENT_DATE(), mc.data_inclusao_cobranca), 0) \\r\\n        ELSE 0 \\r\\n    END AS intensidade_contato_mensal,\\r\\n\\r\\n    -- ========================================================================\\r\\n    -- GRUPO 4: FEATURES DE RISCO E PERFIL\\r\\n    -- ========================================================================\\r\\n    mc.flag_com_garantia, \\r\\n    mc.flag_devedor_contumaz, \\r\\n    mc.flag_recuperacao_judicial, \\r\\n    mc.flag_falencia, \\r\\n    mc.flag_protesto, \\r\\n    mc.flag_tem_parcelamento, \\r\\n    mc.flag_suspensao_dfe,\\r\\n    \\r\\n    (\\r\\n        CASE WHEN mc.flag_devedor_contumaz = 1 THEN 30 ELSE 0 END + \\r\\n        CASE WHEN mc.flag_recuperacao_judicial = 1 THEN 25 ELSE 0 END + \\r\\n        CASE WHEN mc.flag_falencia = 1 THEN 50 ELSE 0 END + \\r\\n        CASE WHEN mc.flag_protesto = 1 THEN 15 ELSE 0 END + \\r\\n        CASE WHEN mc.classificacao_omissao = 'OMISSO_RECORRENTE' THEN 20 ELSE 0 END + \\r\\n        CASE WHEN mc.classificacao_omissao = 'OMISSO_EVENTUAL' THEN 10 ELSE 0 END + \\r\\n        CASE WHEN mc.flag_suspensao_dfe = 1 THEN 20 ELSE 0 END\\r\\n    ) AS score_risco_situacao,\\r\\n    \\r\\n    mc.score_noteiras, \\r\\n    mc.qtd_indicios_noteiras, \\r\\n    mc.qtd_tipos_indicios_noteiras, \\r\\n    mc.classificacao_risco_noteiras,\\r\\n    mc.situacao_cadastral_desc, \\r\\n    \\r\\n    CASE \\r\\n        WHEN mc.situacao_cadastral_desc = 'ATIVO' THEN 1.0 \\r\\n        WHEN mc.situacao_cadastral_desc = 'SUSPENSO' THEN 0.5 \\r\\n        WHEN mc.situacao_cadastral_desc = 'INAPTO' THEN 0.3 \\r\\n        ELSE 0 \\r\\n    END AS score_situacao_cadastral,\\r\\n    \\r\\n    mc.cnae_classe, \\r\\n    mc.cnae_divisao, \\r\\n    mc.secao_cnae, \\r\\n    mc.divisao_cnae, \\r\\n    mc.natureza_juridica_cod, \\r\\n    mc.porte_por_faturamento, \\r\\n    mc.codigo_municipio, \\r\\n    mc.codigo_uf, \\r\\n    mc.regime_apuracao_cod, \\r\\n    mc.tipo_contribuinte_cod, \\r\\n    mc.enquadramento_empresa_cod,\\r\\n    mc.flag_simples_nacional, \\r\\n    mc.flag_dtec, \\r\\n    mc.flag_matriz, \\r\\n    mc.flag_apuracao_consolidada, \\r\\n    mc.flag_estabelecimento_consolidado,\\r\\n    mc.qtd_vinculos, \\r\\n    mc.qtd_vinculos_ativos, \\r\\n    mc.qtd_socios, \\r\\n    mc.qtd_socios_ativos,\\r\\n    \\r\\n    CASE \\r\\n        WHEN mc.qtd_socios_ativos >= 10 THEN 'ALTA' \\r\\n        WHEN mc.qtd_socios_ativos >= 5 THEN 'MEDIA' \\r\\n        WHEN mc.qtd_socios_ativos >= 2 THEN 'BAIXA' \\r\\n        WHEN mc.qtd_socios_ativos = 1 THEN 'INDIVIDUAL' \\r\\n        ELSE 'SEM_DADOS' \\r\\n    END AS complexidade_societaria,\\r\\n\\r\\n    -- ========================================================================\\r\\n    -- GRUPO 5: FEATURES TEMPORAIS E PARCELAMENTO\\r\\n    -- ========================================================================\\r\\n    MONTH(mc.data_inclusao_cobranca) AS mes_inclusao_cobranca, \\r\\n    QUARTER(mc.data_inclusao_cobranca) AS trimestre_inclusao_cobranca, \\r\\n    DAYOFWEEK(mc.data_inclusao_cobranca) AS dia_semana_inclusao, \\r\\n    YEAR(mc.data_inclusao_cobranca) AS ano_inclusao_cobranca,\\r\\n    \\r\\n    CASE \\r\\n        WHEN DATEDIFF(CURRENT_DATE(), mc.data_inclusao_cobranca) <= 30 THEN '0-1_MES' \\r\\n        WHEN DATEDIFF(CURRENT_DATE(), mc.data_inclusao_cobranca) <= 90 THEN '1-3_MESES' \\r\\n        WHEN DATEDIFF(CURRENT_DATE(), mc.data_inclusao_cobranca) <= 180 THEN '3-6_MESES' \\r\\n        WHEN DATEDIFF(CURRENT_DATE(), mc.data_inclusao_cobranca) <= 365 THEN '6-12_MESES' \\r\\n        WHEN DATEDIFF(CURRENT_DATE(), mc.data_inclusao_cobranca) <= 730 THEN '1-2_ANOS' \\r\\n        ELSE 'MAIS_2_ANOS' \\r\\n    END AS faixa_idade_debito,\\r\\n    \\r\\n    mc.status_parcelamento_desc, \\r\\n    mc.tipo_cancelamento_parcelamento, \\r\\n    mc.flag_parcelamento_divida_ativa, \\r\\n    mc.saldo_divida_parcelamento, \\r\\n    mc.saldo_parcelado, \\r\\n    mc.saldo_imposto_parcelado, \\r\\n    mc.saldo_multa_parcelada, \\r\\n    mc.saldo_juros_parcelado, \\r\\n    mc.numero_parcelas,\\r\\n    \\r\\n    CASE \\r\\n        WHEN mc.data_pedido_parcelamento IS NOT NULL \\r\\n        THEN DATEDIFF(CURRENT_DATE(), mc.data_pedido_parcelamento) \\r\\n        ELSE NULL \\r\\n    END AS dias_desde_parcelamento,\\r\\n    \\r\\n    CASE \\r\\n        WHEN mc.valor_total_devido > 0 \\r\\n        THEN CAST((mc.saldo_imposto_parcelado + mc.saldo_multa_parcelada + mc.saldo_juros_parcelado) AS DOUBLE) / NULLIF(mc.valor_total_devido, 0) \\r\\n        ELSE 0 \\r\\n    END AS proporcao_debito_parcelado,\\r\\n    \\r\\n    CASE \\r\\n        WHEN mc.flag_tem_parcelamento = 0 THEN 'SEM_PARCELAMENTO' \\r\\n        WHEN mc.status_parcelamento_desc IN ('ATIVO', 'QUITADO') THEN 'PARCELAMENTO_ATIVO' \\r\\n        WHEN mc.status_parcelamento_desc = 'INADIMPLENTE' THEN 'PARCELAMENTO_INADIMPLENTE' \\r\\n        ELSE 'PARCELAMENTO_INATIVO' \\r\\n    END AS situacao_parcelamento,\\r\\n\\r\\n    -- ========================================================================\\r\\n    -- GRUPO 6: FEATURES DE AL\\u00cdQUOTA E CONFORMIDADE\\r\\n    -- ========================================================================\\r\\n    mc.aliquota_efetiva_media_6m, \\r\\n    mc.codigo_tipo_imposto,\\r\\n    \\r\\n    CASE \\r\\n        WHEN mc.icms_devido_total_6m > 0 \\r\\n        THEN CAST((mc.icms_devido_total_6m - mc.icms_recolher_total_6m) AS DOUBLE) / NULLIF(mc.icms_devido_total_6m, 0) \\r\\n        ELSE 0 \\r\\n    END AS taxa_divergencia_devido_recolher,\\r\\n    \\r\\n    CASE \\r\\n        WHEN mc.faturamento_medio_6m > 0 \\r\\n        THEN CAST(mc.faturamento_desvio_6m AS DOUBLE) / NULLIF(mc.faturamento_medio_6m, 0) \\r\\n        ELSE 0 \\r\\n    END AS coef_variacao_faturamento,\\r\\n    \\r\\n    mc.faturamento_total_6m, \\r\\n    mc.faturamento_medio_6m, \\r\\n    mc.faturamento_desvio_6m, \\r\\n    mc.icms_devido_total_6m, \\r\\n    mc.icms_recolher_total_6m,\\r\\n\\r\\n    -- ========================================================================\\r\\n    -- GRUPO 7: FEATURES COMPOSTAS\\r\\n    -- ========================================================================\\r\\n    CAST((\\r\\n        CASE \\r\\n            WHEN mc.qtd_periodos_movimento_6m >= 6 THEN 100 \\r\\n            WHEN mc.qtd_periodos_movimento_6m >= 4 THEN 70 \\r\\n            WHEN mc.qtd_periodos_movimento_6m >= 2 THEN 40 \\r\\n            WHEN mc.qtd_periodos_movimento_6m >= 1 THEN 20 \\r\\n            ELSE 0 \\r\\n        END + \\r\\n        CASE \\r\\n            WHEN mc.qtd_pagamentos_6m >= 6 THEN 50 \\r\\n            WHEN mc.qtd_pagamentos_6m >= 3 THEN 30 \\r\\n            WHEN mc.qtd_pagamentos_6m >= 1 THEN 10 \\r\\n            ELSE 0 \\r\\n        END\\r\\n    ) AS DOUBLE) / 150.0 AS score_atividade_recente,\\r\\n    \\r\\n    CAST((\\r\\n        CASE \\r\\n            WHEN mc.regularidade_declaracoes = 'REGULAR' THEN 40 \\r\\n            WHEN mc.regularidade_declaracoes = 'PARCIAL' THEN 20 \\r\\n            ELSE 0 \\r\\n        END + \\r\\n        CASE \\r\\n            WHEN mc.regularidade_pagamentos = 'REGULAR' THEN 40 \\r\\n            WHEN mc.regularidade_pagamentos = 'PARCIAL' THEN 20 \\r\\n            ELSE 0 \\r\\n        END + \\r\\n        CASE \\r\\n            WHEN mc.classificacao_omissao = 'NAO_OMISSO' THEN 20 \\r\\n            WHEN mc.classificacao_omissao = 'OMISSO_EVENTUAL' THEN 10 \\r\\n            ELSE 0 \\r\\n        END\\r\\n    ) AS DOUBLE) / 100.0 AS score_compliance,\\r\\n    \\r\\n    CASE \\r\\n        WHEN mc.qtd_total_contatos = 0 THEN 'NUNCA_CONTATADO' \\r\\n        WHEN mc.taxa_resposta_contatos >= 0.7 THEN 'ALTA_RESPOSTA' \\r\\n        WHEN mc.taxa_resposta_contatos >= 0.3 THEN 'MEDIA_RESPOSTA' \\r\\n        WHEN mc.qtd_total_contatos >= 5 THEN 'BAIXA_RESPOSTA_MULTIPLOS_CONTATOS' \\r\\n        ELSE 'BAIXA_RESPOSTA' \\r\\n    END AS perfil_engajamento,\\r\\n    \\r\\n    -- Metadados\\r\\n    CURRENT_TIMESTAMP() AS dt_carga\\r\\n    \\r\\nFROM gecob.prior_master_consolidado mc;\", \"\\r\\n\\r\\n-- ============================================================================\\r\\n-- PARTE 5: BENCHMARK SETORIAL E SCORE DE PRIORIZA\\u00c7\\u00c3O\\r\\n-- ============================================================================\\r\\n\\r\\n-- ----------------------------------------------------------------------------\\r\\n-- 5.1. BENCHMARK SETORIAL POR TIPO DE D\\u00c9BITO\\r\\n-- ----------------------------------------------------------------------------\\r\\nDROP TABLE IF EXISTS gecob.prior_benchmark_setorial;\", \"\\r\\nCREATE TABLE gecob.prior_benchmark_setorial STORED AS PARQUET AS\\r\\nWITH percentis_calculados AS (\\r\\n    SELECT\\r\\n        tipo_debito,\\r\\n        cnae_divisao,\\r\\n        secao_cnae,\\r\\n        porte_por_faturamento,\\r\\n        valor_total_devido,\\r\\n        status_debito,\\r\\n        qtd_total_contatos,\\r\\n        taxa_resposta_contatos,\\r\\n        qtd_periodos_pagamento_6m,\\r\\n        score_noteiras,\\r\\n        data_inclusao_cobranca,\\r\\n        NTILE(4) OVER (PARTITION BY tipo_debito, cnae_divisao, secao_cnae, porte_por_faturamento \\r\\n                       ORDER BY valor_total_devido) AS quartil\\r\\n    FROM gecob.prior_master_consolidado\\r\\n)\\r\\nSELECT\\r\\n    tipo_debito,\\r\\n    cnae_divisao,\\r\\n    secao_cnae,\\r\\n    porte_por_faturamento,\\r\\n    \\r\\n    -- Estat\\u00edsticas de Valor\\r\\n    COUNT(*) AS qtd_debitos,\\r\\n    COUNT(DISTINCT CASE WHEN valor_total_devido > 0 THEN 1 END) AS qtd_empresas,\\r\\n    AVG(valor_total_devido) AS valor_medio_debito,\\r\\n    STDDEV(valor_total_devido) AS desvio_valor_debito,\\r\\n    MIN(valor_total_devido) AS valor_min_debito,\\r\\n    MAX(valor_total_devido) AS valor_max_debito,\\r\\n    \\r\\n    -- Percentis usando NTILE\\r\\n    MIN(CASE WHEN quartil = 1 THEN valor_total_devido END) AS valor_p25_debito,\\r\\n    AVG(CASE WHEN quartil IN (2, 3) THEN valor_total_devido END) AS valor_mediana_debito,\\r\\n    MAX(CASE WHEN quartil = 4 THEN valor_total_devido END) AS valor_p75_debito,\\r\\n    \\r\\n    -- Taxa de Recupera\\u00e7\\u00e3o Hist\\u00f3rica\\r\\n    AVG(CASE WHEN status_debito = 2 THEN 1.0 ELSE 0.0 END) AS taxa_recuperacao_historica,\\r\\n    \\r\\n    -- M\\u00e9dias de Comportamento\\r\\n    AVG(qtd_total_contatos) AS media_contatos_setor,\\r\\n    AVG(taxa_resposta_contatos) AS media_taxa_resposta_setor,\\r\\n    AVG(qtd_periodos_pagamento_6m) AS media_periodos_pagamento_setor,\\r\\n    AVG(score_noteiras) AS media_score_noteiras_setor,\\r\\n    \\r\\n    -- Tempo M\\u00e9dio em Cobran\\u00e7a\\r\\n    AVG(DATEDIFF(CURRENT_DATE(), data_inclusao_cobranca)) AS media_dias_cobranca,\\r\\n    \\r\\n    CURRENT_TIMESTAMP() AS dt_carga\\r\\n\\r\\nFROM percentis_calculados\\r\\nGROUP BY \\r\\n    tipo_debito,\\r\\n    cnae_divisao,\\r\\n    secao_cnae,\\r\\n    porte_por_faturamento\\r\\nHAVING COUNT(*) >= 10;\", \"\\r\\n\\r\\n-- ----------------------------------------------------------------------------\\r\\n-- 5.2. SCORE DE PRIORIDADE - COMPONENTES INDIVIDUAIS\\r\\n-- ----------------------------------------------------------------------------\\r\\nDROP TABLE IF EXISTS gecob.prior_score_componentes;\", \"\\r\\nCREATE TABLE gecob.prior_score_componentes STORED AS PARQUET AS\\r\\nSELECT\\r\\n    fm.inscricao_estadual,\\r\\n    fm.cnpj,\\r\\n    fm.tipo_debito,\\r\\n    fm.valor_total_devido,\\r\\n    \\r\\n    -- COMPONENTE 1: SCORE VALOR DO D\\u00c9BITO (0-100 pontos)\\r\\n    CASE \\r\\n        WHEN fm.valor_total_devido >= 1000000 THEN 100\\r\\n        WHEN fm.valor_total_devido >= 500000 THEN 85\\r\\n        WHEN fm.valor_total_devido >= 100000 THEN 70\\r\\n        WHEN fm.valor_total_devido >= 50000 THEN 55\\r\\n        WHEN fm.valor_total_devido >= 10000 THEN 40\\r\\n        WHEN fm.valor_total_devido >= 5000 THEN 25\\r\\n        ELSE 10\\r\\n    END AS score_valor_debito,\\r\\n    \\r\\n    -- COMPONENTE 2: SCORE CAPACIDADE DE PAGAMENTO (0-100 pontos)\\r\\n    (\\r\\n        CASE \\r\\n            WHEN fm.porte_por_faturamento = 'GRANDE' THEN 85\\r\\n            WHEN fm.porte_por_faturamento = 'MEDIO' THEN 70\\r\\n            WHEN fm.porte_por_faturamento = 'PEQUENO' THEN 50\\r\\n            WHEN fm.porte_por_faturamento = 'MICRO' THEN 30\\r\\n            ELSE 10\\r\\n        END +\\r\\n        CASE \\r\\n            WHEN fm.capacidade_pagamento_estimada >= 5 THEN 15\\r\\n            WHEN fm.capacidade_pagamento_estimada >= 2 THEN 12\\r\\n            WHEN fm.capacidade_pagamento_estimada >= 1 THEN 8\\r\\n            WHEN fm.capacidade_pagamento_estimada >= 0.5 THEN 5\\r\\n            ELSE 0\\r\\n        END\\r\\n    ) AS score_capacidade_pagamento,\\r\\n    \\r\\n    -- COMPONENTE 3: SCORE HIST\\u00d3RICO DE PAGAMENTOS (0-100 pontos)\\r\\n    (\\r\\n        CASE \\r\\n            WHEN fm.regularidade_pagamentos = 'REGULAR' THEN 80\\r\\n            WHEN fm.regularidade_pagamentos = 'PARCIAL' THEN 50\\r\\n            WHEN fm.regularidade_pagamentos = 'IRREGULAR' THEN 20\\r\\n            ELSE 0\\r\\n        END +\\r\\n        CASE \\r\\n            WHEN fm.taxa_pagamento_vs_devido_6m >= 0.9 THEN 20\\r\\n            WHEN fm.taxa_pagamento_vs_devido_6m >= 0.7 THEN 15\\r\\n            WHEN fm.taxa_pagamento_vs_devido_6m >= 0.5 THEN 10\\r\\n            WHEN fm.taxa_pagamento_vs_devido_6m >= 0.3 THEN 5\\r\\n            ELSE 0\\r\\n        END\\r\\n    ) AS score_historico_pagamento,\\r\\n    \\r\\n    -- COMPONENTE 4: SCORE RESPONSIVIDADE (0-100 pontos)\\r\\n    CASE \\r\\n        WHEN fm.taxa_efetividade_contatos >= 0.7 THEN 100\\r\\n        WHEN fm.taxa_efetividade_contatos >= 0.5 THEN 80\\r\\n        WHEN fm.taxa_efetividade_contatos >= 0.3 THEN 60\\r\\n        WHEN fm.taxa_efetividade_contatos >= 0.1 THEN 40\\r\\n        WHEN fm.qtd_total_contatos > 0 THEN 20\\r\\n        ELSE 10\\r\\n    END AS score_responsividade,\\r\\n    \\r\\n    -- COMPONENTE 5: SCORE VIABILIDADE DE COBRAN\\u00c7A (0-100 pontos)\\r\\n    CAST(100 - LEAST(100, (\\r\\n        CASE WHEN fm.flag_falencia = 1 THEN 50 ELSE 0 END +\\r\\n        CASE WHEN fm.flag_recuperacao_judicial = 1 THEN 30 ELSE 0 END +\\r\\n        CASE WHEN fm.flag_devedor_contumaz = 1 THEN 20 ELSE 0 END +\\r\\n        CASE WHEN fm.situacao_cadastral_desc IN ('CANCELADO', 'BAIXADO', 'INAPTO') THEN 40 ELSE 0 END +\\r\\n        CASE WHEN fm.classificacao_omissao = 'OMISSO_RECORRENTE' THEN 15 ELSE 0 END +\\r\\n        CASE WHEN fm.score_noteiras >= 100 THEN 25 \\r\\n             WHEN fm.score_noteiras >= 50 THEN 15\\r\\n             WHEN fm.score_noteiras >= 20 THEN 5\\r\\n             ELSE 0 END\\r\\n    )) AS INT) AS score_viabilidade_cobranca,\\r\\n    \\r\\n    -- COMPONENTE 6: SCORE URG\\u00caNCIA TEMPORAL (0-100 pontos)\\r\\n    (\\r\\n        CASE \\r\\n            WHEN fm.dias_desde_inclusao_cobranca >= 365 THEN 100\\r\\n            WHEN fm.dias_desde_inclusao_cobranca >= 180 THEN 80\\r\\n            WHEN fm.dias_desde_inclusao_cobranca >= 90 THEN 60\\r\\n            WHEN fm.dias_desde_inclusao_cobranca >= 30 THEN 40\\r\\n            ELSE 20\\r\\n        END +\\r\\n        CASE \\r\\n            WHEN fm.flag_tem_parcelamento = 1 AND fm.status_parcelamento_desc = 'INADIMPLENTE' THEN -30\\r\\n            WHEN fm.flag_tem_parcelamento = 1 AND fm.status_parcelamento_desc = 'ATIVO' THEN -10\\r\\n            ELSE 0\\r\\n        END\\r\\n    ) AS score_urgencia,\\r\\n    \\r\\n    -- COMPONENTE 7: SCORE CONFORMIDADE FISCAL (0-100 pontos)\\r\\n    (\\r\\n        CASE \\r\\n            WHEN fm.regularidade_declaracoes = 'REGULAR' THEN 80\\r\\n            WHEN fm.regularidade_declaracoes = 'PARCIAL' THEN 50\\r\\n            WHEN fm.regularidade_declaracoes = 'IRREGULAR' THEN 20\\r\\n            ELSE 0\\r\\n        END +\\r\\n        CASE \\r\\n            WHEN fm.classificacao_omissao = 'NAO_OMISSO' THEN 20\\r\\n            WHEN fm.classificacao_omissao = 'OMISSO_EVENTUAL' THEN 10\\r\\n            ELSE 0\\r\\n        END\\r\\n    ) AS score_conformidade,\\r\\n    \\r\\n    CURRENT_TIMESTAMP() AS dt_carga\\r\\n\\r\\nFROM gecob.prior_features_ml fm;\", \"\\r\\n\\r\\n-- ----------------------------------------------------------------------------\\r\\n-- 5.3. SCORE DE PRIORIZA\\u00c7\\u00c3O FINAL\\r\\n-- ----------------------------------------------------------------------------\\r\\nDROP TABLE IF EXISTS gecob.prior_score_priorizacao;\", \"\\r\\nCREATE TABLE gecob.prior_score_priorizacao STORED AS PARQUET AS\\r\\nSELECT\\r\\n    sp.inscricao_estadual,\\r\\n    sp.cnpj,\\r\\n    sp.tipo_debito,\\r\\n    sp.valor_total_devido,\\r\\n    \\r\\n    -- Scores Parciais\\r\\n    sp.score_valor_debito,\\r\\n    sp.score_capacidade_pagamento,\\r\\n    sp.score_historico_pagamento,\\r\\n    sp.score_responsividade,\\r\\n    sp.score_viabilidade_cobranca,\\r\\n    sp.score_urgencia,\\r\\n    sp.score_conformidade,\\r\\n    \\r\\n    -- SCORE FINAL PONDERADO (0-100)\\r\\n    -- Pesos: Valor 25%, Capacidade 20%, Hist\\u00f3rico 15%, Responsividade 15%,\\r\\n    --        Viabilidade 10%, Urg\\u00eancia 10%, Conformidade 5%\\r\\n    ROUND(\\r\\n        (sp.score_valor_debito * 0.25) +\\r\\n        (sp.score_capacidade_pagamento * 0.20) +\\r\\n        (sp.score_historico_pagamento * 0.15) +\\r\\n        (sp.score_responsividade * 0.15) +\\r\\n        (sp.score_viabilidade_cobranca * 0.10) +\\r\\n        (sp.score_urgencia * 0.10) +\\r\\n        (sp.score_conformidade * 0.05),\\r\\n        2\\r\\n    ) AS score_final_priorizacao,\\r\\n    \\r\\n    -- Classifica\\u00e7\\u00e3o de Prioridade\\r\\n    CASE \\r\\n        WHEN ROUND(\\r\\n            (sp.score_valor_debito * 0.25) +\\r\\n            (sp.score_capacidade_pagamento * 0.20) +\\r\\n            (sp.score_historico_pagamento * 0.15) +\\r\\n            (sp.score_responsividade * 0.15) +\\r\\n            (sp.score_viabilidade_cobranca * 0.10) +\\r\\n            (sp.score_urgencia * 0.10) +\\r\\n            (sp.score_conformidade * 0.05),\\r\\n            2\\r\\n        ) >= 80 THEN 'PRIORIDADE_MAXIMA'\\r\\n        WHEN ROUND(\\r\\n            (sp.score_valor_debito * 0.25) +\\r\\n            (sp.score_capacidade_pagamento * 0.20) +\\r\\n            (sp.score_historico_pagamento * 0.15) +\\r\\n            (sp.score_responsividade * 0.15) +\\r\\n            (sp.score_viabilidade_cobranca * 0.10) +\\r\\n            (sp.score_urgencia * 0.10) +\\r\\n            (sp.score_conformidade * 0.05),\\r\\n            2\\r\\n        ) >= 60 THEN 'PRIORIDADE_ALTA'\\r\\n        WHEN ROUND(\\r\\n            (sp.score_valor_debito * 0.25) +\\r\\n            (sp.score_capacidade_pagamento * 0.20) +\\r\\n            (sp.score_historico_pagamento * 0.15) +\\r\\n            (sp.score_responsividade * 0.15) +\\r\\n            (sp.score_viabilidade_cobranca * 0.10) +\\r\\n            (sp.score_urgencia * 0.10) +\\r\\n            (sp.score_conformidade * 0.05),\\r\\n            2\\r\\n        ) >= 40 THEN 'PRIORIDADE_MEDIA'\\r\\n        ELSE 'PRIORIDADE_BAIXA'\\r\\n    END AS classificacao_prioridade,\\r\\n    \\r\\n    CURRENT_TIMESTAMP() AS dt_carga\\r\\n\\r\\nFROM gecob.prior_score_componentes sp;\", \"\\r\\n\\r\\n-- ============================================================================\\r\\n-- PARTE 6: VIEWS EXECUTIVAS E DASHBOARDS\\r\\n-- ============================================================================\\r\\n\\r\\n-- ----------------------------------------------------------------------------\\r\\n-- 6.1. VIEW DASHBOARD - TOP PRIORIDADES\\r\\n-- ----------------------------------------------------------------------------\\r\\nDROP VIEW IF EXISTS gecob.vw_dashboard_priorizacao;\", \"\\r\\nCREATE VIEW gecob.vw_dashboard_priorizacao AS\\r\\nSELECT\\r\\n    -- Identifica\\u00e7\\u00e3o\\r\\n    sp.inscricao_estadual,\\r\\n    mc.razao_social,\\r\\n    mc.nome_fantasia,\\r\\n    sp.tipo_debito,\\r\\n    \\r\\n    -- Valor e Prioridade\\r\\n    sp.valor_total_devido,\\r\\n    sp.score_final_priorizacao,\\r\\n    sp.classificacao_prioridade,\\r\\n    \\r\\n    -- Situa\\u00e7\\u00e3o\\r\\n    mc.situacao_cadastral_desc,\\r\\n    mc.porte_por_faturamento,\\r\\n    mc.secao_cnae,\\r\\n    mc.descricao_secao,\\r\\n    \\r\\n    -- Hist\\u00f3rico\\r\\n    mc.regularidade_pagamentos,\\r\\n    mc.regularidade_declaracoes,\\r\\n    mc.qtd_total_contatos,\\r\\n    mc.taxa_resposta_contatos,\\r\\n    \\r\\n    -- Flags de Risco\\r\\n    mc.flag_falencia,\\r\\n    mc.flag_recuperacao_judicial,\\r\\n    mc.flag_devedor_contumaz,\\r\\n    mc.classificacao_risco_noteiras,\\r\\n    \\r\\n    -- Contato\\r\\n    mc.codigo_municipio,\\r\\n    mc.nome_municipio,\\r\\n    mc.codigo_uf,\\r\\n    \\r\\n    -- Scores Detalhados\\r\\n    sp.score_valor_debito,\\r\\n    sp.score_capacidade_pagamento,\\r\\n    sp.score_historico_pagamento,\\r\\n    sp.score_responsividade,\\r\\n    sp.score_viabilidade_cobranca,\\r\\n    sp.score_urgencia,\\r\\n    sp.score_conformidade\\r\\n\\r\\nFROM gecob.prior_score_priorizacao sp\\r\\nINNER JOIN gecob.prior_master_consolidado mc \\r\\n    ON sp.inscricao_estadual = mc.inscricao_estadual\\r\\n    AND sp.tipo_debito = mc.tipo_debito\\r\\nORDER BY sp.score_final_priorizacao DESC, sp.valor_total_devido DESC;\", \"\\r\\n\\r\\n-- ----------------------------------------------------------------------------\\r\\n-- 6.2. VIEW TOP 1000 PRIORIDADES COM A\\u00c7\\u00c3O RECOMENDADA\\r\\n-- ----------------------------------------------------------------------------\\r\\nDROP VIEW IF EXISTS gecob.vw_top_1000_prioridades;\", \"\\r\\nCREATE VIEW gecob.vw_top_1000_prioridades AS\\r\\nSELECT\\r\\n    ROW_NUMBER() OVER (ORDER BY sp.score_final_priorizacao DESC, sp.valor_total_devido DESC) AS ranking,\\r\\n    \\r\\n    sp.inscricao_estadual,\\r\\n    mc.cnpj,\\r\\n    mc.razao_social,\\r\\n    mc.nome_fantasia,\\r\\n    \\r\\n    -- Valor e Score\\r\\n    sp.valor_total_devido,\\r\\n    sp.score_final_priorizacao,\\r\\n    sp.classificacao_prioridade,\\r\\n    \\r\\n    -- Detalhes do D\\u00e9bito\\r\\n    mc.tipo_debito,\\r\\n    fm.dias_desde_inclusao_cobranca,\\r\\n    mc.saldo_imposto,\\r\\n    mc.saldo_multa,\\r\\n    mc.saldo_juros,\\r\\n    \\r\\n    -- Perfil\\r\\n    mc.porte_por_faturamento,\\r\\n    mc.secao_cnae,\\r\\n    mc.descricao_secao,\\r\\n    mc.situacao_cadastral_desc,\\r\\n    \\r\\n    -- Capacidade\\r\\n    fm.capacidade_pagamento_estimada,\\r\\n    mc.faturamento_medio_6m,\\r\\n    \\r\\n    -- Hist\\u00f3rico\\r\\n    mc.regularidade_pagamentos,\\r\\n    fm.taxa_pagamento_vs_devido_6m,\\r\\n    mc.qtd_total_contatos,\\r\\n    mc.taxa_resposta_contatos,\\r\\n    \\r\\n    -- Riscos\\r\\n    mc.flag_falencia,\\r\\n    mc.flag_recuperacao_judicial,\\r\\n    mc.flag_devedor_contumaz,\\r\\n    mc.classificacao_risco_noteiras,\\r\\n    mc.score_noteiras,\\r\\n    \\r\\n    -- Localiza\\u00e7\\u00e3o\\r\\n    mc.codigo_municipio,\\r\\n    mc.nome_municipio,\\r\\n    mc.codigo_uf,\\r\\n    \\r\\n    -- Scores Componentes\\r\\n    sp.score_valor_debito,\\r\\n    sp.score_capacidade_pagamento,\\r\\n    sp.score_historico_pagamento,\\r\\n    sp.score_responsividade,\\r\\n    sp.score_viabilidade_cobranca,\\r\\n    sp.score_urgencia,\\r\\n    sp.score_conformidade,\\r\\n    \\r\\n    -- A\\u00e7\\u00e3o Recomendada\\r\\n    CASE \\r\\n        WHEN sp.score_final_priorizacao >= 80 AND fm.taxa_efetividade_contatos >= 0.5 THEN 'CONTATO_IMEDIATO_NEGOCIACAO'\\r\\n        WHEN sp.score_final_priorizacao >= 80 AND mc.qtd_total_contatos < 3 THEN 'INTENSIFICAR_CONTATOS'\\r\\n        WHEN sp.score_final_priorizacao >= 60 AND mc.flag_tem_parcelamento = 0 THEN 'OFERECER_PARCELAMENTO'\\r\\n        WHEN sp.score_final_priorizacao >= 60 AND fm.capacidade_pagamento_estimada >= 2 THEN 'NEGOCIACAO_DESCONTO'\\r\\n        WHEN sp.score_viabilidade_cobranca < 40 THEN 'AVALIAR_INSCRICAO_DIVIDA_ATIVA'\\r\\n        ELSE 'CONTATO_PADRAO'\\r\\n    END AS acao_recomendada\\r\\n\\r\\nFROM gecob.prior_score_priorizacao sp\\r\\nINNER JOIN gecob.prior_master_consolidado mc \\r\\n    ON sp.inscricao_estadual = mc.inscricao_estadual\\r\\n    AND sp.tipo_debito = mc.tipo_debito\\r\\nINNER JOIN gecob.prior_features_ml fm \\r\\n    ON sp.inscricao_estadual = fm.inscricao_estadual\\r\\n    AND sp.tipo_debito = fm.tipo_debito\\r\\nORDER BY sp.score_final_priorizacao DESC, sp.valor_total_devido DESC\\r\\nLIMIT 1000;\", \"\\r\\n\\r\\n-- ----------------------------------------------------------------------------\\r\\n-- 6.3. VIEW AN\\u00c1LISE POR MUNIC\\u00cdPIO\\r\\n-- ----------------------------------------------------------------------------\\r\\nDROP VIEW IF EXISTS gecob.vw_analise_por_municipio;\", \"\\r\\nCREATE VIEW gecob.vw_analise_por_municipio AS\\r\\nSELECT\\r\\n    mc.codigo_municipio,\\r\\n    mc.nome_municipio,\\r\\n    mc.codigo_uf,\\r\\n    \\r\\n    -- Contagens\\r\\n    COUNT(DISTINCT mc.inscricao_estadual) AS qtd_contribuintes,\\r\\n    COUNT(*) AS qtd_debitos,\\r\\n    \\r\\n    -- Valores Totais\\r\\n    SUM(mc.valor_total_devido) AS valor_total_devido,\\r\\n    AVG(mc.valor_total_devido) AS valor_medio_devido,\\r\\n    \\r\\n    -- Distribui\\u00e7\\u00e3o por Prioridade\\r\\n    SUM(CASE WHEN sp.classificacao_prioridade = 'PRIORIDADE_MAXIMA' THEN 1 ELSE 0 END) AS qtd_prioridade_maxima,\\r\\n    SUM(CASE WHEN sp.classificacao_prioridade = 'PRIORIDADE_ALTA' THEN 1 ELSE 0 END) AS qtd_prioridade_alta,\\r\\n    SUM(CASE WHEN sp.classificacao_prioridade = 'PRIORIDADE_MEDIA' THEN 1 ELSE 0 END) AS qtd_prioridade_media,\\r\\n    SUM(CASE WHEN sp.classificacao_prioridade = 'PRIORIDADE_BAIXA' THEN 1 ELSE 0 END) AS qtd_prioridade_baixa,\\r\\n    \\r\\n    -- Valores por Prioridade\\r\\n    SUM(CASE WHEN sp.classificacao_prioridade = 'PRIORIDADE_MAXIMA' THEN mc.valor_total_devido ELSE 0 END) AS valor_prioridade_maxima,\\r\\n    SUM(CASE WHEN sp.classificacao_prioridade = 'PRIORIDADE_ALTA' THEN mc.valor_total_devido ELSE 0 END) AS valor_prioridade_alta,\\r\\n    \\r\\n    -- M\\u00e9dias de Performance\\r\\n    AVG(mc.taxa_resposta_contatos) AS media_taxa_resposta,\\r\\n    AVG(sp.score_final_priorizacao) AS media_score_priorizacao,\\r\\n    \\r\\n    -- Flags de Risco\\r\\n    SUM(CASE WHEN mc.flag_falencia = 1 THEN 1 ELSE 0 END) AS qtd_com_falencia,\\r\\n    SUM(CASE WHEN mc.flag_recuperacao_judicial = 1 THEN 1 ELSE 0 END) AS qtd_recuperacao_judicial,\\r\\n    SUM(CASE WHEN mc.flag_devedor_contumaz = 1 THEN 1 ELSE 0 END) AS qtd_devedor_contumaz\\r\\n\\r\\nFROM gecob.prior_master_consolidado mc\\r\\nINNER JOIN gecob.prior_score_priorizacao sp \\r\\n    ON mc.inscricao_estadual = sp.inscricao_estadual\\r\\n    AND mc.tipo_debito = sp.tipo_debito\\r\\nGROUP BY mc.codigo_municipio, mc.nome_municipio, mc.codigo_uf\\r\\nORDER BY SUM(mc.valor_total_devido) DESC;\", \"\\r\\n\\r\\n-- ============================================================================\\r\\n-- VALIDA\\u00c7\\u00d5ES FINAIS\\r\\n-- ============================================================================\\r\\n\\r\\n-- Valida\\u00e7\\u00e3o 1: Distribui\\u00e7\\u00e3o de Prioridades\\r\\nSELECT \\r\\n    'DISTRIBUICAO DE PRIORIDADES' AS validacao,\\r\\n    classificacao_prioridade,\\r\\n    COUNT(*) AS quantidade,\\r\\n    ROUND(COUNT(*) * 100.0 / SUM(COUNT(*)) OVER (), 1) AS percentual,\\r\\n    SUM(valor_total_devido) AS valor_total,\\r\\n    AVG(valor_total_devido) AS valor_medio,\\r\\n    ROUND(AVG(score_final_priorizacao), 1) AS score_medio\\r\\nFROM gecob.prior_score_priorizacao\\r\\nGROUP BY classificacao_prioridade\\r\\nORDER BY \\r\\n    CASE classificacao_prioridade\\r\\n        WHEN 'PRIORIDADE_MAXIMA' THEN 1\\r\\n        WHEN 'PRIORIDADE_ALTA' THEN 2\\r\\n        WHEN 'PRIORIDADE_MEDIA' THEN 3\\r\\n        WHEN 'PRIORIDADE_BAIXA' THEN 4\\r\\n    END;\", \"\\r\\n\\r\\n-- Valida\\u00e7\\u00e3o 2: Verifica\\u00e7\\u00e3o de Cadastros NULL\\r\\nSELECT\\r\\n    'VERIFICACAO DE NULLS NO CADASTRO' AS validacao,\\r\\n    COUNT(*) AS total_registros,\\r\\n    SUM(CASE WHEN razao_social IS NULL THEN 1 ELSE 0 END) AS razao_social_null,\\r\\n    SUM(CASE WHEN nome_fantasia IS NULL THEN 1 ELSE 0 END) AS nome_fantasia_null,\\r\\n    SUM(CASE WHEN situacao_cadastral_desc IS NULL THEN 1 ELSE 0 END) AS situacao_cadastral_null,\\r\\n    SUM(CASE WHEN descricao_cnae IS NULL THEN 1 ELSE 0 END) AS cnae_null,\\r\\n    SUM(CASE WHEN regime_apuracao_desc IS NULL THEN 1 ELSE 0 END) AS regime_null,\\r\\n    SUM(CASE WHEN nome_municipio IS NULL THEN 1 ELSE 0 END) AS municipio_null\\r\\nFROM gecob.prior_master_consolidado;\", \"\\r\\n\\r\\n-- Valida\\u00e7\\u00e3o 3: Top 10 Setores\\r\\nSELECT \\r\\n    'TOP 10 SETORES' AS validacao,\\r\\n    mc.secao_cnae,\\r\\n    mc.descricao_secao,\\r\\n    COUNT(DISTINCT mc.inscricao_estadual) AS qtd_contribuintes,\\r\\n    SUM(mc.valor_total_devido) AS valor_total,\\r\\n    ROUND(AVG(sp.score_final_priorizacao), 1) AS score_medio\\r\\nFROM gecob.prior_master_consolidado mc\\r\\nINNER JOIN gecob.prior_score_priorizacao sp \\r\\n    ON mc.inscricao_estadual = sp.inscricao_estadual\\r\\n    AND mc.tipo_debito = sp.tipo_debito\\r\\nGROUP BY mc.secao_cnae, mc.descricao_secao\\r\\nORDER BY SUM(mc.valor_total_devido) DESC\\r\\nLIMIT 10;\"], \"aceSize\": 100, \"status\": \"available\", \"statusForButtons\": \"executed\", \"properties\": {\"settings\": []}, \"viewSettings\": {\"placeHolder\": \"Exemplo: SELECT * FROM tablename ou pressione CTRL + espa\\u00e7o\", \"sqlDialect\": true}, \"variables\": [], \"hasCurlyBracketParameters\": true, \"variableNames\": [], \"variableValues\": {}, \"statement\": \"\\r\\nCREATE TABLE gecob.prior_score_priorizacao STORED AS PARQUET AS\\r\\nSELECT\\r\\n    sp.inscricao_estadual,\\r\\n    sp.cnpj,\\r\\n    sp.tipo_debito,\\r\\n    sp.valor_total_devido,\\r\\n    \\r\\n    -- Scores Parciais\\r\\n    sp.score_valor_debito,\\r\\n    sp.score_capacidade_pagamento,\\r\\n    sp.score_historico_pagamento,\\r\\n    sp.score_responsividade,\\r\\n    sp.score_viabilidade_cobranca,\\r\\n    sp.score_urgencia,\\r\\n    sp.score_conformidade,\\r\\n    \\r\\n    -- SCORE FINAL PONDERADO (0-100)\\r\\n    -- Pesos: Valor 25%, Capacidade 20%, Hist\\u00f3rico 15%, Responsividade 15%,\\r\\n    --        Viabilidade 10%, Urg\\u00eancia 10%, Conformidade 5%\\r\\n    ROUND(\\r\\n        (sp.score_valor_debito * 0.25) +\\r\\n        (sp.score_capacidade_pagamento * 0.20) +\\r\\n        (sp.score_historico_pagamento * 0.15) +\\r\\n        (sp.score_responsividade * 0.15) +\\r\\n        (sp.score_viabilidade_cobranca * 0.10) +\\r\\n        (sp.score_urgencia * 0.10) +\\r\\n        (sp.score_conformidade * 0.05),\\r\\n        2\\r\\n    ) AS score_final_priorizacao,\\r\\n    \\r\\n    -- Classifica\\u00e7\\u00e3o de Prioridade\\r\\n    CASE \\r\\n        WHEN ROUND(\\r\\n            (sp.score_valor_debito * 0.25) +\\r\\n            (sp.score_capacidade_pagamento * 0.20) +\\r\\n            (sp.score_historico_pagamento * 0.15) +\\r\\n            (sp.score_responsividade * 0.15) +\\r\\n            (sp.score_viabilidade_cobranca * 0.10) +\\r\\n            (sp.score_urgencia * 0.10) +\\r\\n            (sp.score_conformidade * 0.05),\\r\\n            2\\r\\n        ) >= 80 THEN 'PRIORIDADE_MAXIMA'\\r\\n        WHEN ROUND(\\r\\n            (sp.score_valor_debito * 0.25) +\\r\\n            (sp.score_capacidade_pagamento * 0.20) +\\r\\n            (sp.score_historico_pagamento * 0.15) +\\r\\n            (sp.score_responsividade * 0.15) +\\r\\n            (sp.score_viabilidade_cobranca * 0.10) +\\r\\n            (sp.score_urgencia * 0.10) +\\r\\n            (sp.score_conformidade * 0.05),\\r\\n            2\\r\\n        ) >= 60 THEN 'PRIORIDADE_ALTA'\\r\\n        WHEN ROUND(\\r\\n            (sp.score_valor_debito * 0.25) +\\r\\n            (sp.score_capacidade_pagamento * 0.20) +\\r\\n            (sp.score_historico_pagamento * 0.15) +\\r\\n            (sp.score_responsividade * 0.15) +\\r\\n            (sp.score_viabilidade_cobranca * 0.10) +\\r\\n            (sp.score_urgencia * 0.10) +\\r\\n            (sp.score_conformidade * 0.05),\\r\\n            2\\r\\n        ) >= 40 THEN 'PRIORIDADE_MEDIA'\\r\\n        ELSE 'PRIORIDADE_BAIXA'\\r\\n    END AS classificacao_prioridade,\\r\\n    \\r\\n    CURRENT_TIMESTAMP() AS dt_carga\\r\\n\\r\\nFROM gecob.prior_score_componentes sp;\", \"result\": {\"id\": \"585982c9-d2ad-01be-19cc-9d45b89f9975\", \"type\": \"table\", \"hasResultset\": true, \"handle\": {\"secret\": \"zUdyIDwuR6+bZK6rHlH/GA==\", \"guid\": \"5lSx2J96TKcAAAAAmw/BIg==\", \"operation_type\": 0, \"has_result_set\": true, \"modified_row_count\": null, \"log_context\": null, \"session_guid\": \"654e68afcb83bc8a:13f4b3be321fc89c\", \"session_id\": 21350, \"session_type\": \"impala\", \"statement_id\": 0, \"has_more_statements\": false, \"statements_count\": 1, \"previous_statement_hash\": \"b030bc2881d0065020aa06cef224c8caa2f145a5ae9bc9756bf5a9ad\", \"start\": {\"row\": 0, \"column\": 0}, \"end\": {\"row\": 0, \"column\": 464}, \"statement\": \"-- ============================================================================\\r\\n-- PARTE 6: VIEWS EXECUTIVAS E DASHBOARDS\\r\\n-- ============================================================================\\r\\n\\r\\n-- ----------------------------------------------------------------------------\\r\\n-- 6.1. VIEW DASHBOARD - TOP PRIORIDADES\\r\\n-- ----------------------------------------------------------------------------\\r\\nDROP VIEW IF EXISTS gecob.vw_dashboard_priorizacao\"}, \"meta\": [], \"rows\": \"1\", \"hasMore\": false, \"statement_id\": 0, \"statement_range\": {\"start\": {\"row\": 0, \"column\": 0}, \"end\": {\"row\": 0, \"column\": 0}}, \"statements_count\": 1, \"metaFilter\": {\"query\": \"\", \"facets\": {}, \"text\": []}, \"isMetaFilterVisible\": false, \"filteredMetaChecked\": true, \"filteredColumnCount\": 1, \"filteredMeta\": [{\"type\": \"int\", \"name\": \"\", \"comment\": null, \"cssClass\": \"sort-numeric\", \"checked\": true, \"originalIndex\": 0}, {\"name\": \"summary\", \"type\": \"string\", \"comment\": null, \"cssClass\": \"sort-string\", \"checked\": true, \"originalIndex\": 1}], \"fetchedOnce\": false, \"startTime\": \"2025-10-09T12:54:07.054Z\", \"endTime\": \"2025-10-09T12:54:07.292Z\", \"executionTime\": 238, \"data\": [], \"explanation\": \"\", \"logs\": \"\", \"logLines\": 0, \"hasSomeResults\": true}, \"showGrid\": true, \"showChart\": false, \"showLogs\": true, \"progress\": 0, \"jobs\": [], \"executeNextTimeout\": 709954, \"isLoading\": false, \"resultsKlass\": \"results impala\", \"errorsKlass\": \"results impala alert alert-error\", \"is_redacted\": false, \"chartType\": \"bars\", \"chartSorting\": \"none\", \"chartScatterGroup\": null, \"chartScatterSize\": null, \"chartScope\": \"world\", \"chartTimelineType\": \"bar\", \"chartLimits\": [5, 10, 25, 50, 100], \"chartLimit\": null, \"chartX\": \"summary\", \"chartXPivot\": null, \"chartYSingle\": null, \"chartYMulti\": [], \"chartData\": [], \"chartMapType\": \"marker\", \"chartMapLabel\": null, \"chartMapHeat\": null, \"hideStacked\": true, \"hasDataForChart\": false, \"previousChartOptions\": {\"chartLimit\": null, \"chartX\": null, \"chartXPivot\": null, \"chartYSingle\": null, \"chartMapType\": \"marker\", \"chartMapLabel\": null, \"chartMapHeat\": null, \"chartYMulti\": [], \"chartScope\": \"world\", \"chartTimelineType\": \"bar\", \"chartSorting\": \"none\", \"chartScatterGroup\": null, \"chartScatterSize\": null}, \"isResultSettingsVisible\": false, \"settingsVisible\": false, \"checkStatusTimeout\": null, \"getLogsTimeout\": 784432, \"topRisk\": null, \"suggestion\": \"\", \"hasSuggestion\": null, \"compatibilityCheckRunning\": false, \"compatibilitySourcePlatforms\": [{\"name\": \"Teradata\", \"value\": \"teradata\"}, {\"name\": \"Oracle\", \"value\": \"oracle\"}, {\"name\": \"Netezza\", \"value\": \"netezza\"}, {\"name\": \"Impala\", \"value\": \"impala\"}, {\"name\": \"Hive\", \"value\": \"hive\"}, {\"name\": \"DB2\", \"value\": \"db2\"}, {\"name\": \"Greenplum\", \"value\": \"greenplum\"}, {\"name\": \"MySQL\", \"value\": \"mysql\"}, {\"name\": \"PostgreSQL\", \"value\": \"postgresql\"}, {\"name\": \"Informix\", \"value\": \"informix\"}, {\"name\": \"SQL Server\", \"value\": \"sqlserver\"}, {\"name\": \"Sybase\", \"value\": \"sybase\"}, {\"name\": \"Access\", \"value\": \"access\"}, {\"name\": \"Firebird\", \"value\": \"firebird\"}, {\"name\": \"ANSISQL\", \"value\": \"ansisql\"}, {\"name\": \"Generic\", \"value\": \"generic\"}], \"compatibilitySourcePlatform\": {\"name\": \"Impala\", \"value\": \"impala\"}, \"compatibilityTargetPlatforms\": [{\"name\": \"Impala\", \"value\": \"impala\"}, {\"name\": \"Hive\", \"value\": \"hive\"}], \"compatibilityTargetPlatform\": {\"name\": \"Impala\", \"value\": \"impala\"}, \"showSqlAnalyzer\": false, \"wasBatchExecuted\": false, \"isReady\": true, \"lastExecuted\": 1760014446716, \"lastAceSelectionRowOffset\": 1606, \"executingBlockingOperation\": null, \"showLongOperationWarning\": false, \"lastExecutedStatements\": \"\\r\\n\\r\\n-- ============================================================================\\r\\n-- PARTE 6: VIEWS EXECUTIVAS E DASHBOARDS\\r\\n-- ============================================================================\\r\\n\\r\\n-- ----------------------------------------------------------------------------\\r\\n-- 6.1. VIEW DASHBOARD - TOP PRIORIDADES\\r\\n-- ----------------------------------------------------------------------------\\r\\nDROP VIEW IF EXISTS gecob.vw_dashboard_priorizacao;\", \"lastExecutedSelectionRange\": {\"start\": {\"row\": 1606, \"column\": 9}, \"end\": {\"row\": 1606, \"column\": 9}}, \"formatEnabled\": true, \"isFetchingData\": false, \"isCanceling\": false, \"aceAutoExpand\": false, \"lastCheckStatusRequest\": {\"readyState\": 4, \"responseText\": \"{\\\"status\\\": 0, \\\"query_status\\\": {\\\"status\\\": \\\"available\\\"}}\", \"responseJSON\": {\"status\": 0, \"query_status\": {\"status\": \"available\"}}, \"status\": 200, \"statusText\": \"OK\"}, \"lastGetLogsRequest\": {\"readyState\": 4, \"responseText\": \"{\\\"status\\\": 0, \\\"logs\\\": \\\"\\\", \\\"progress\\\": 100, \\\"jobs\\\": [{\\\"name\\\": \\\"a74c7a9fd8b154e6:22c10f9b00000000\\\", \\\"url\\\": \\\"/hue/jobbrowser#!id=a74c7a9fd8b154e6:22c10f9b00000000\\\", \\\"started\\\": true, \\\"finished\\\": false, \\\"percentJob\\\": 100}], \\\"isFullLogs\\\": false}\", \"responseJSON\": {\"status\": 0, \"logs\": \"\", \"progress\": 100, \"jobs\": [{\"name\": \"a74c7a9fd8b154e6:22c10f9b00000000\", \"url\": \"/hue/jobbrowser#!id=a74c7a9fd8b154e6:22c10f9b00000000\", \"started\": true, \"finished\": false, \"percentJob\": 100}], \"isFullLogs\": false}, \"status\": 200, \"statusText\": \"OK\"}}], \"selectedSnippet\": \"impala\", \"creatingSessionLocks\": [], \"sessions\": [], \"directoryUuid\": \"\", \"dependentsCoordinator\": [], \"historyFilter\": \"\", \"historyFilterVisible\": false, \"loadingHistory\": false, \"historyInitialHeight\": 26576, \"forceHistoryInitialHeight\": false, \"historyCurrentPage\": 1, \"historyTotalPages\": 109, \"schedulerViewModel\": null, \"schedulerViewModelIsLoaded\": false, \"isBatchable\": true, \"isExecutingAll\": false, \"executingAllIndex\": 0, \"retryModalConfirm\": null, \"retryModalCancel\": null, \"canSave\": true, \"unloaded\": false, \"updateHistoryFailed\": false, \"viewSchedulerId\": \"\", \"loadingScheduler\": false, \"is_history\": false}",
    "extra": "",
    "search": "-- ============================================================================\r\n-- SISTEMA DE PRIORIZAÃ‡ÃƒO DE COBRANÃ‡A - GECOB V1.4 (OTIMIZADO)\r\n-- Receita Estadual de Santa Catarina\r\n-- ============================================================================\r\n-- MELHORIAS V1.4:\r\n-- - Parte 4 (Features ML) dividida em 7 etapas para evitar timeout\r\n-- - Cada etapa processa um grupo especÃ­fico de features\r\n-- - ConsolidaÃ§Ã£o final com JOINs otimizados\r\n-- - Tempo total estimado: 10-12 minutos (vs 20+ minutos anterior)\r\n-- ============================================================================\r\n\r\n-- ============================================================================\r\n-- PARTE 1: TABELAS CORE - EXTRAÃ‡ÃƒO E CONSOLIDAÃ‡ÃƒO\r\n-- ============================================================================\r\n\r\n-- ----------------------------------------------------------------------------\r\n-- 1.1. BASE DE DÃ‰BITOS CONSOLIDADA\r\n-- DÃ©bitos ativos com informaÃ§Ãµes essenciais\r\n-- ----------------------------------------------------------------------------\r\nDROP TABLE IF EXISTS gecob.prior_debitos_base;\r\nCREATE TABLE gecob.prior_debitos_base STORED AS PARQUET AS\r\nSELECT\r\n    -- IdentificaÃ§Ã£o\r\n    cd.CDB_TCC_NUM_IDENT AS num_ident_conta,\r\n    TRIM(cd.CDB_RGE_RUC) AS inscricao_estadual,\r\n    cd.CDB_TIP_DEBITO AS tipo_debito,\r\n    \r\n    -- Status e ClassificaÃ§Ã£o\r\n    cd.CDB_IND_STATUS AS status_debito,\r\n    cd.CDB_SN_COM_GARANTIA AS flag_com_garantia,\r\n    cd.CDB_SN_DEV_CONTUMAZ AS flag_devedor_contumaz,\r\n    cd.CDB_SN_RECUP_JUDICIAL AS flag_recuperacao_judicial,\r\n    cd.CDB_SN_COM_FALENCIA AS flag_falencia,\r\n    cd.CDB_SN_COM_PROTESTO AS flag_protesto,\r\n    \r\n    -- Valores Financeiros\r\n    cd.CDB_VLR_TOT_DEV AS valor_total_devido,\r\n    cd.CDB_TIM_GRUPO_IMPOSTO AS grupo_imposto,\r\n    cd.CDB_SEQ_ULT_CONT AS seq_ultimo_contato,\r\n    cd.CDB_GRUPO_SETORIAL AS grupo_setorial,\r\n    cd.CDB_COD_GEREG AS codigo_gereg,\r\n    cd.CDB_COD_USEFI AS codigo_usefi,\r\n    cd.CDB_RGE_TSC_SIT_",
    "last_modified": "2025-10-09T09:58:04.725",
    "version": 1,
    "is_history": false,
    "is_managed": false,
    "is_trashed": false,
    "parent_directory": [
      "13addfc5-7ea3-4f33-bd07-f3b8ce8c58f9",
      1,
      false
    ],
    "dependencies": []
  }
},
{
  "model": "desktop.document2",
  "pk": 160944,
  "fields": {
    "owner": [
      "tsevero"
    ],
    "name": "PRIOR. COBR: Analises",
    "description": "",
    "uuid": "7e8ea018-0cb3-236e-28fb-b3ee05bf9516",
    "type": "query-impala",
    "connector": null,
    "data": "{\"id\": 160944, \"uuid\": \"2317cf88-c89c-46ae-ac1f-4647ca967e1b\", \"name\": \"PRIOR. COBR: Analises\", \"description\": \"\", \"type\": \"query-impala\", \"initialType\": \"impala\", \"coordinatorUuid\": null, \"isHistory\": false, \"isManaged\": false, \"parentSavedQueryUuid\": \"7e8ea018-0cb3-236e-28fb-b3ee05bf9516\", \"isSaved\": true, \"onSuccessUrl\": null, \"pubSubUrl\": null, \"isPresentationModeDefault\": false, \"isPresentationMode\": false, \"isPresentationModeInitialized\": true, \"presentationSnippets\": {}, \"isHidingCode\": false, \"snippets\": [{\"id\": \"df136fff-277e-7d3c-c078-7391b62941f0\", \"name\": \"\", \"type\": \"impala\", \"connector\": {\"name\": \"Impala\", \"type\": \"impala\", \"id\": \"impala\", \"displayName\": \"Impala\", \"buttonName\": \"Consulta\", \"tooltip\": \"Impala Query\", \"optimizer\": \"off\", \"page\": \"/editor/?type=impala\", \"is_sql\": true, \"is_batchable\": true, \"dialect\": \"impala\", \"dialect_properties\": {}}, \"isSqlDialect\": true, \"dialect\": \"impala\", \"isBatchable\": true, \"autocompleteSettings\": {\"temporaryOnly\": false}, \"aceCursorPosition\": {\"row\": 1005, \"column\": 101}, \"errors\": [], \"aceErrorsHolder\": [], \"aceWarningsHolder\": [], \"aceErrors\": [], \"aceWarnings\": [], \"editorMode\": true, \"dbSelectionVisible\": false, \"showExecutionAnalysis\": true, \"namespace\": {\"id\": \"8271bb54-0cd9-47e1-89f2-a8a5de91d943\", \"name\": \"8271bb54-0cd9-47e1-89f2-a8a5de91d943\", \"status\": \"CREATED\", \"computes\": [{\"id\": \"8271bb54-0cd9-47e1-89f2-a8a5de91d943\", \"name\": \"8271bb54-0cd9-47e1-89f2-a8a5de91d943\", \"type\": \"direct\", \"credentials\": {}}]}, \"compute\": {\"id\": \"8271bb54-0cd9-47e1-89f2-a8a5de91d943\", \"name\": \"8271bb54-0cd9-47e1-89f2-a8a5de91d943\", \"namespace\": \"8271bb54-0cd9-47e1-89f2-a8a5de91d943\", \"interface\": \"impala\", \"type\": \"direct\", \"options\": {}}, \"database\": \"default\", \"currentQueryTab\": \"queryResults\", \"pinnedContextTabs\": [], \"loadingQueries\": false, \"queriesHasErrors\": false, \"queriesCurrentPage\": 1, \"queriesTotalPages\": 3, \"queriesFilter\": \"\", \"queriesFilterVisible\": false, \"statementType\": \"text\", \"statementTypes\": [\"text\", \"file\"], \"statementPath\": \"\", \"externalStatementLoaded\": false, \"associatedDocumentLoading\": true, \"associatedDocumentUuid\": null, \"statement_raw\": \"/***************************************************************************************************\\r\\n * =================================================================================================\\r\\n * SISTEMA DE PRIORIZA\\u00c7\\u00c3O DE COBRAN\\u00c7A - CONSULTAS ANAL\\u00cdTICAS COMPLETAS V4\\r\\n * Receita Estadual de Santa Catarina - GECOB\\r\\n * =================================================================================================\\r\\n *\\r\\n * DESCRI\\u00c7\\u00c3O:\\r\\n * Este script cont\\u00e9m um conjunto completo de consultas prontas para an\\u00e1lise do sistema de\\r\\n * prioriza\\u00e7\\u00e3o de cobran\\u00e7a, incluindo estat\\u00edsticas gerais, rankings, an\\u00e1lises setoriais e\\r\\n * dossi\\u00eas detalhados de contribuintes.\\r\\n *\\r\\n * COMPATIBILIDADE: V1.5 do Sistema GECOB\\r\\n * - Compat\\u00edvel com pr\\u00e9-agrega\\u00e7\\u00e3o de conta corrente\\r\\n * - Inclui novas m\\u00e9tricas de contatos (30/90 dias)\\r\\n * - JOINs otimizados incluindo tipo_debito\\r\\n *\\r\\n * COMO USAR:\\r\\n * 1. Para dossi\\u00eas de contribuintes espec\\u00edficos, modifique a inscri\\u00e7\\u00e3o estadual na cl\\u00e1usula WHERE\\r\\n * 2. Execute o script completo ou consultas individuais conforme necessidade\\r\\n * 3. Ajuste os limites (LIMIT) conforme sua an\\u00e1lise\\r\\n *\\r\\n * DATA DE ATUALIZA\\u00c7\\u00c3O: 09 de Outubro de 2025\\r\\n ***************************************************************************************************/\\r\\n\\r\\n-- =================================================================================================\\r\\n-- CONFIGURA\\u00c7\\u00c3O DE AMBIENTE\\r\\n-- =================================================================================================\\r\\nSET REQUEST_POOL = 'medium';\\r\\nSET MEM_LIMIT = 8G;\\r\\n\\r\\n-- =================================================================================================\\r\\n-- SE\\u00c7\\u00c3O 1: ESTAT\\u00cdSTICAS GERAIS DO SISTEMA (VIS\\u00c3O MACRO)\\r\\n-- =================================================================================================\\r\\n\\r\\n-- 1.1. PANORAMA GERAL DO SISTEMA DE COBRAN\\u00c7A\\r\\n-- Objetivo: Vis\\u00e3o executiva consolidada do sistema de prioriza\\u00e7\\u00e3o\\r\\nSELECT \\r\\n    '1.1. PANORAMA GERAL DO SISTEMA' AS consulta,\\r\\n    \\r\\n    -- M\\u00e9tricas de Volume\\r\\n    COUNT(DISTINCT mc.inscricao_estadual) AS total_contribuintes_em_cobranca,\\r\\n    COUNT(DISTINCT mc.cnpj) AS total_cnpjs_distintos,\\r\\n    COUNT(DISTINCT mc.tipo_debito) AS tipos_debito_distintos,\\r\\n    \\r\\n    -- M\\u00e9tricas Financeiras\\r\\n    SUM(mc.valor_total_devido) AS valor_total_divida_ativa,\\r\\n    ROUND(AVG(mc.valor_total_devido), 2) AS valor_medio_devido_por_ie,\\r\\n    ROUND(STDDEV(mc.valor_total_devido), 2) AS desvio_padrao_divida,\\r\\n    \\r\\n    -- Distribui\\u00e7\\u00e3o de Valores\\r\\n    MIN(mc.valor_total_devido) AS menor_divida,\\r\\n    MAX(mc.valor_total_devido) AS maior_divida,\\r\\n    \\r\\n    -- M\\u00e9tricas de Prioriza\\u00e7\\u00e3o\\r\\n    COUNT(DISTINCT CASE WHEN sp.classificacao_prioridade = 'PRIORIDADE_MAXIMA' THEN mc.inscricao_estadual END) AS ies_prioridade_maxima,\\r\\n    COUNT(DISTINCT CASE WHEN sp.classificacao_prioridade = 'PRIORIDADE_ALTA' THEN mc.inscricao_estadual END) AS ies_prioridade_alta,\\r\\n    COUNT(DISTINCT CASE WHEN sp.classificacao_prioridade = 'PRIORIDADE_MEDIA' THEN mc.inscricao_estadual END) AS ies_prioridade_media,\\r\\n    COUNT(DISTINCT CASE WHEN sp.classificacao_prioridade = 'PRIORIDADE_BAIXA' THEN mc.inscricao_estadual END) AS ies_prioridade_baixa,\\r\\n    \\r\\n    -- Percentuais de Prioridade\\r\\n    ROUND(COUNT(DISTINCT CASE WHEN sp.classificacao_prioridade IN ('PRIORIDADE_MAXIMA', 'PRIORIDADE_ALTA') \\r\\n                         THEN mc.inscricao_estadual END) * 100.0 / \\r\\n          COUNT(DISTINCT mc.inscricao_estadual), 2) AS perc_prioridade_critica,\\r\\n    \\r\\n    -- M\\u00e9tricas de Situa\\u00e7\\u00e3o Cadastral\\r\\n    COUNT(CASE WHEN mc.situacao_cadastral_desc = 'ATIVO' THEN 1 END) AS contribuintes_ativos,\\r\\n    COUNT(CASE WHEN mc.flag_falencia = 1 THEN 1 END) AS casos_falencia,\\r\\n    COUNT(CASE WHEN mc.flag_recuperacao_judicial = 1 THEN 1 END) AS casos_recuperacao_judicial,\\r\\n    \\r\\n    -- M\\u00e9tricas de Contato\\r\\n    ROUND(AVG(mc.qtd_total_contatos), 2) AS media_contatos_por_contribuinte,\\r\\n    ROUND(AVG(mc.taxa_resposta_contatos) * 100, 2) AS taxa_media_resposta_pct,\\r\\n    \\r\\n    -- NOVAS M\\u00c9TRICAS V1.5\\r\\n    ROUND(AVG(mc.qtd_contatos_ultimos_30_dias), 2) AS media_contatos_ultimos_30d,\\r\\n    ROUND(AVG(mc.qtd_contatos_ultimos_90_dias), 2) AS media_contatos_ultimos_90d,\\r\\n    \\r\\n    -- Timestamp\\r\\n    FROM_UNIXTIME(UNIX_TIMESTAMP()) AS data_atualizacao\\r\\n    \\r\\nFROM gecob.prior_master_consolidado mc\\r\\nLEFT JOIN gecob.prior_score_priorizacao sp \\r\\n    ON mc.inscricao_estadual = sp.inscricao_estadual \\r\\n    AND mc.tipo_debito = sp.tipo_debito;\\r\\n\\r\\n-- 1.2. DISTRIBUI\\u00c7\\u00c3O POR FAIXAS DE VALOR DE D\\u00c9BITO\\r\\n-- Objetivo: Entender a concentra\\u00e7\\u00e3o da d\\u00edvida por faixas de valor\\r\\nSELECT \\r\\n    '1.2. DISTRIBUI\\u00c7\\u00c3O POR FAIXAS DE VALOR' AS consulta,\\r\\n    \\r\\n    CASE \\r\\n        WHEN mc.valor_total_devido >= 10000000 THEN '10M+ (Mega Devedores)'\\r\\n        WHEN mc.valor_total_devido >= 1000000 THEN '1M-10M (Grandes)'\\r\\n        WHEN mc.valor_total_devido >= 500000 THEN '500K-1M (M\\u00e9dio-Alto)'\\r\\n        WHEN mc.valor_total_devido >= 100000 THEN '100K-500K (M\\u00e9dio)'\\r\\n        WHEN mc.valor_total_devido >= 50000 THEN '50K-100K (M\\u00e9dio-Baixo)'\\r\\n        WHEN mc.valor_total_devido >= 10000 THEN '10K-50K (Pequeno)'\\r\\n        ELSE 'At\\u00e9 10K (Micro)'\\r\\n    END AS faixa_valor,\\r\\n    \\r\\n    COUNT(DISTINCT mc.inscricao_estadual) AS qtd_contribuintes,\\r\\n    ROUND(COUNT(DISTINCT mc.inscricao_estadual) * 100.0 / \\r\\n          SUM(COUNT(DISTINCT mc.inscricao_estadual)) OVER(), 2) AS percentual_contribuintes,\\r\\n    \\r\\n    SUM(mc.valor_total_devido) AS valor_total_faixa,\\r\\n    ROUND(SUM(mc.valor_total_devido) * 100.0 / \\r\\n          SUM(SUM(mc.valor_total_devido)) OVER(), 2) AS percentual_valor_total,\\r\\n    \\r\\n    ROUND(AVG(mc.valor_total_devido), 2) AS valor_medio_faixa,\\r\\n    \\r\\n    -- Prioriza\\u00e7\\u00e3o na faixa\\r\\n    COUNT(CASE WHEN sp.classificacao_prioridade = 'PRIORIDADE_MAXIMA' THEN 1 END) AS prioridade_maxima,\\r\\n    COUNT(CASE WHEN sp.classificacao_prioridade = 'PRIORIDADE_ALTA' THEN 1 END) AS prioridade_alta,\\r\\n    \\r\\n    -- Indicadores de risco\\r\\n    ROUND(AVG(sp.score_final_priorizacao), 2) AS score_medio_faixa,\\r\\n    COUNT(CASE WHEN mc.flag_falencia = 1 THEN 1 END) AS casos_falencia_faixa\\r\\n    \\r\\nFROM gecob.prior_master_consolidado mc\\r\\nLEFT JOIN gecob.prior_score_priorizacao sp \\r\\n    ON mc.inscricao_estadual = sp.inscricao_estadual \\r\\n    AND mc.tipo_debito = sp.tipo_debito\\r\\nGROUP BY \\r\\n    CASE \\r\\n        WHEN mc.valor_total_devido >= 10000000 THEN '10M+ (Mega Devedores)'\\r\\n        WHEN mc.valor_total_devido >= 1000000 THEN '1M-10M (Grandes)'\\r\\n        WHEN mc.valor_total_devido >= 500000 THEN '500K-1M (M\\u00e9dio-Alto)'\\r\\n        WHEN mc.valor_total_devido >= 100000 THEN '100K-500K (M\\u00e9dio)'\\r\\n        WHEN mc.valor_total_devido >= 50000 THEN '50K-100K (M\\u00e9dio-Baixo)'\\r\\n        WHEN mc.valor_total_devido >= 10000 THEN '10K-50K (Pequeno)'\\r\\n        ELSE 'At\\u00e9 10K (Micro)'\\r\\n    END\\r\\nORDER BY MIN(mc.valor_total_devido) DESC;\\r\\n\\r\\n-- 1.3. DISTRIBUI\\u00c7\\u00c3O POR CLASSIFICA\\u00c7\\u00c3O DE PRIORIDADE\\r\\n-- Objetivo: An\\u00e1lise detalhada da distribui\\u00e7\\u00e3o dos scores de prioriza\\u00e7\\u00e3o\\r\\nSELECT \\r\\n    '1.3. DISTRIBUI\\u00c7\\u00c3O POR PRIORIDADE' AS consulta,\\r\\n    \\r\\n    sp.classificacao_prioridade,\\r\\n    COUNT(DISTINCT mc.inscricao_estadual) AS quantidade_contribuintes,\\r\\n    ROUND(COUNT(DISTINCT mc.inscricao_estadual) * 100.0 / \\r\\n          SUM(COUNT(DISTINCT mc.inscricao_estadual)) OVER(), 2) AS percentual,\\r\\n    \\r\\n    SUM(mc.valor_total_devido) AS valor_total_prioridade,\\r\\n    ROUND(SUM(mc.valor_total_devido) * 100.0 / \\r\\n          SUM(SUM(mc.valor_total_devido)) OVER(), 2) AS percentual_valor,\\r\\n    \\r\\n    ROUND(AVG(sp.score_final_priorizacao), 2) AS score_medio,\\r\\n    ROUND(MIN(sp.score_final_priorizacao), 2) AS score_minimo,\\r\\n    ROUND(MAX(sp.score_final_priorizacao), 2) AS score_maximo,\\r\\n    \\r\\n    -- M\\u00e9tricas de capacidade\\r\\n    ROUND(AVG(mc.faturamento_medio_6m), 2) AS faturamento_medio_grupo,\\r\\n    ROUND(AVG(fm.capacidade_pagamento_estimada), 2) AS capacidade_media_grupo,\\r\\n    \\r\\n    -- M\\u00e9tricas de compliance\\r\\n    ROUND(AVG(fm.taxa_pagamento_vs_devido_6m) * 100, 2) AS taxa_media_compliance_pct,\\r\\n    ROUND(AVG(mc.taxa_resposta_contatos) * 100, 2) AS taxa_media_resposta_pct\\r\\n    \\r\\nFROM gecob.prior_master_consolidado mc\\r\\nJOIN gecob.prior_score_priorizacao sp \\r\\n    ON mc.inscricao_estadual = sp.inscricao_estadual \\r\\n    AND mc.tipo_debito = sp.tipo_debito\\r\\nJOIN gecob.prior_features_ml fm \\r\\n    ON mc.inscricao_estadual = fm.inscricao_estadual \\r\\n    AND mc.tipo_debito = fm.tipo_debito\\r\\nGROUP BY sp.classificacao_prioridade\\r\\nORDER BY \\r\\n    CASE sp.classificacao_prioridade\\r\\n        WHEN 'PRIORIDADE_MAXIMA' THEN 1\\r\\n        WHEN 'PRIORIDADE_ALTA' THEN 2\\r\\n        WHEN 'PRIORIDADE_MEDIA' THEN 3\\r\\n        WHEN 'PRIORIDADE_BAIXA' THEN 4\\r\\n    END;\\r\\n\\r\\n-- =================================================================================================\\r\\n-- SE\\u00c7\\u00c3O 2: CONSULTAS ANAL\\u00cdTICAS (RANKINGS E PADR\\u00d5ES)\\r\\n-- =================================================================================================\\r\\n\\r\\n-- 2.1. TOP 50 CONTRIBUINTES POR SCORE DE PRIORIZA\\u00c7\\u00c3O\\r\\n-- Objetivo: Identificar os casos mais priorit\\u00e1rios para a\\u00e7\\u00e3o imediata\\r\\nSELECT \\r\\n    '2.1. TOP 50 CONTRIBUINTES POR SCORE' AS consulta,\\r\\n    \\r\\n    sp.inscricao_estadual,\\r\\n    mc.razao_social,\\r\\n    mc.nome_fantasia,\\r\\n    mc.cnpj,\\r\\n    \\r\\n    -- Score e Prioridade\\r\\n    sp.score_final_priorizacao,\\r\\n    sp.classificacao_prioridade,\\r\\n    \\r\\n    -- Valor do D\\u00e9bito\\r\\n    mc.valor_total_devido,\\r\\n    mc.saldo_imposto,\\r\\n    mc.saldo_multa,\\r\\n    mc.saldo_juros,\\r\\n    \\r\\n    -- Scores Componentes\\r\\n    sp.score_valor_debito,\\r\\n    sp.score_capacidade_pagamento,\\r\\n    sp.score_historico_pagamento,\\r\\n    sp.score_responsividade,\\r\\n    sp.score_viabilidade_cobranca,\\r\\n    \\r\\n    -- Situa\\u00e7\\u00e3o\\r\\n    mc.situacao_cadastral_desc,\\r\\n    mc.porte_por_faturamento,\\r\\n    fm.dias_desde_inclusao_cobranca,\\r\\n    \\r\\n    -- Flags de Risco\\r\\n    mc.flag_falencia,\\r\\n    mc.flag_recuperacao_judicial,\\r\\n    mc.flag_devedor_contumaz,\\r\\n    \\r\\n    -- Hist\\u00f3rico de Contato\\r\\n    mc.qtd_total_contatos,\\r\\n    mc.taxa_resposta_contatos,\\r\\n    fm.perfil_engajamento,\\r\\n    \\r\\n    -- NOVAS M\\u00c9TRICAS V1.5\\r\\n    mc.qtd_contatos_ultimos_30_dias,\\r\\n    mc.qtd_contatos_ultimos_90_dias,\\r\\n    \\r\\n    -- Localiza\\u00e7\\u00e3o\\r\\n    mc.codigo_municipio,\\r\\n    mc.nome_municipio\\r\\n    \\r\\nFROM gecob.prior_score_priorizacao sp\\r\\nJOIN gecob.prior_master_consolidado mc \\r\\n    ON sp.inscricao_estadual = mc.inscricao_estadual \\r\\n    AND sp.tipo_debito = mc.tipo_debito\\r\\nJOIN gecob.prior_features_ml fm \\r\\n    ON sp.inscricao_estadual = fm.inscricao_estadual \\r\\n    AND sp.tipo_debito = fm.tipo_debito\\r\\nORDER BY sp.score_final_priorizacao DESC\\r\\nLIMIT 50;\\r\\n\\r\\n-- 2.2. TOP 30 SETORES ECON\\u00d4MICOS POR VALOR EM COBRAN\\u00c7A\\r\\n-- Objetivo: Identificar os setores com maior concentra\\u00e7\\u00e3o de d\\u00edvida\\r\\nSELECT \\r\\n    '2.2. TOP 30 SETORES ECON\\u00d4MICOS' AS consulta,\\r\\n    \\r\\n    mc.secao_cnae,\\r\\n    mc.descricao_secao,\\r\\n    \\r\\n    COUNT(DISTINCT mc.inscricao_estadual) AS qtd_contribuintes,\\r\\n    SUM(mc.valor_total_devido) AS valor_total_setor,\\r\\n    ROUND(AVG(mc.valor_total_devido), 2) AS valor_medio_por_ie,\\r\\n    \\r\\n    -- Distribui\\u00e7\\u00e3o de Prioridade\\r\\n    COUNT(CASE WHEN sp.classificacao_prioridade = 'PRIORIDADE_MAXIMA' THEN 1 END) AS prioridade_maxima,\\r\\n    COUNT(CASE WHEN sp.classificacao_prioridade = 'PRIORIDADE_ALTA' THEN 1 END) AS prioridade_alta,\\r\\n    ROUND(COUNT(CASE WHEN sp.classificacao_prioridade IN ('PRIORIDADE_MAXIMA', 'PRIORIDADE_ALTA') THEN 1 END) * 100.0 / \\r\\n          COUNT(*), 2) AS perc_prioridade_critica,\\r\\n    \\r\\n    -- M\\u00e9tricas de Score\\r\\n    ROUND(AVG(sp.score_final_priorizacao), 2) AS score_medio_setor,\\r\\n    \\r\\n    -- M\\u00e9tricas de Capacidade\\r\\n    ROUND(AVG(mc.faturamento_medio_6m), 2) AS faturamento_medio_setor,\\r\\n    ROUND(AVG(fm.capacidade_pagamento_estimada), 2) AS capacidade_media_setor,\\r\\n    \\r\\n    -- Compliance\\r\\n    ROUND(AVG(fm.taxa_pagamento_vs_devido_6m) * 100, 2) AS taxa_compliance_setor_pct,\\r\\n    \\r\\n    -- Flags de Risco\\r\\n    COUNT(CASE WHEN mc.flag_falencia = 1 THEN 1 END) AS casos_falencia,\\r\\n    COUNT(CASE WHEN mc.flag_recuperacao_judicial = 1 THEN 1 END) AS casos_recuperacao_judicial\\r\\n    \\r\\nFROM gecob.prior_master_consolidado mc\\r\\nJOIN gecob.prior_score_priorizacao sp \\r\\n    ON mc.inscricao_estadual = sp.inscricao_estadual \\r\\n    AND mc.tipo_debito = sp.tipo_debito\\r\\nJOIN gecob.prior_features_ml fm \\r\\n    ON mc.inscricao_estadual = fm.inscricao_estadual \\r\\n    AND mc.tipo_debito = fm.tipo_debito\\r\\nWHERE mc.secao_cnae IS NOT NULL\\r\\nGROUP BY mc.secao_cnae, mc.descricao_secao\\r\\nHAVING COUNT(DISTINCT mc.inscricao_estadual) >= 5\\r\\nORDER BY SUM(mc.valor_total_devido) DESC\\r\\nLIMIT 30;\\r\\n\\r\\n-- 2.3. AN\\u00c1LISE DE MUNIC\\u00cdPIOS COM MAIOR CONCENTRA\\u00c7\\u00c3O DE D\\u00cdVIDA\\r\\n-- Objetivo: Identificar concentra\\u00e7\\u00f5es geogr\\u00e1ficas para planejamento de a\\u00e7\\u00f5es\\r\\nSELECT \\r\\n    '2.3. TOP 20 MUNIC\\u00cdPIOS POR CONCENTRA\\u00c7\\u00c3O DE D\\u00cdVIDA' AS consulta,\\r\\n    \\r\\n    mc.codigo_municipio,\\r\\n    mc.nome_municipio,\\r\\n    mc.codigo_uf,\\r\\n    \\r\\n    COUNT(DISTINCT mc.inscricao_estadual) AS qtd_contribuintes,\\r\\n    SUM(mc.valor_total_devido) AS valor_total_municipio,\\r\\n    ROUND(AVG(mc.valor_total_devido), 2) AS valor_medio_por_ie,\\r\\n    \\r\\n    -- Concentra\\u00e7\\u00e3o\\r\\n    ROUND(SUM(mc.valor_total_devido) * 100.0 / \\r\\n          (SELECT SUM(valor_total_devido) FROM gecob.prior_master_consolidado), 2) AS perc_divida_total,\\r\\n    \\r\\n    -- Prioriza\\u00e7\\u00e3o\\r\\n    COUNT(CASE WHEN sp.classificacao_prioridade = 'PRIORIDADE_MAXIMA' THEN 1 END) AS prioridade_maxima,\\r\\n    COUNT(CASE WHEN sp.classificacao_prioridade = 'PRIORIDADE_ALTA' THEN 1 END) AS prioridade_alta,\\r\\n    ROUND(AVG(sp.score_final_priorizacao), 2) AS score_medio_municipio,\\r\\n    \\r\\n    -- Perfil de Porte\\r\\n    COUNT(CASE WHEN mc.porte_por_faturamento = 'GRANDE' THEN 1 END) AS empresas_grande_porte,\\r\\n    COUNT(CASE WHEN mc.porte_por_faturamento = 'MEDIO' THEN 1 END) AS empresas_medio_porte,\\r\\n    \\r\\n    -- Situa\\u00e7\\u00e3o\\r\\n    COUNT(CASE WHEN mc.flag_falencia = 1 THEN 1 END) AS casos_falencia,\\r\\n    COUNT(CASE WHEN mc.flag_recuperacao_judicial = 1 THEN 1 END) AS casos_recuperacao_judicial,\\r\\n    \\r\\n    -- Performance de Contato\\r\\n    ROUND(AVG(mc.taxa_resposta_contatos) * 100, 2) AS taxa_resposta_media_pct\\r\\n    \\r\\nFROM gecob.prior_master_consolidado mc\\r\\nJOIN gecob.prior_score_priorizacao sp \\r\\n    ON mc.inscricao_estadual = sp.inscricao_estadual \\r\\n    AND mc.tipo_debito = sp.tipo_debito\\r\\nWHERE mc.codigo_municipio IS NOT NULL\\r\\nGROUP BY mc.codigo_municipio, mc.nome_municipio, mc.codigo_uf\\r\\nORDER BY SUM(mc.valor_total_devido) DESC\\r\\nLIMIT 20;\\r\\n\\r\\n-- 2.4. RANKING DE RESPONSIVIDADE E ENGAJAMENTO\\r\\n-- Objetivo: Identificar contribuintes com melhor/pior hist\\u00f3rico de resposta\\r\\nSELECT \\r\\n    '2.4. TOP 30 - MELHOR RESPONSIVIDADE (ALTA PRIORIDADE)' AS consulta,\\r\\n    \\r\\n    mc.inscricao_estadual,\\r\\n    mc.razao_social,\\r\\n    mc.valor_total_devido,\\r\\n    sp.classificacao_prioridade,\\r\\n    \\r\\n    -- M\\u00e9tricas de Contato\\r\\n    mc.qtd_total_contatos,\\r\\n    mc.qtd_respostas_positivas,\\r\\n    mc.qtd_promessas_pagamento,\\r\\n    ROUND(mc.taxa_resposta_contatos * 100, 2) AS taxa_resposta_pct,\\r\\n    fm.perfil_engajamento,\\r\\n    \\r\\n    -- NOVAS M\\u00c9TRICAS V1.5\\r\\n    mc.qtd_contatos_ultimos_30_dias,\\r\\n    mc.qtd_contatos_ultimos_90_dias,\\r\\n    \\r\\n    -- Scores\\r\\n    sp.score_final_priorizacao,\\r\\n    sp.score_responsividade,\\r\\n    \\r\\n    -- Capacidade\\r\\n    fm.capacidade_pagamento_estimada,\\r\\n    mc.faturamento_medio_6m,\\r\\n    \\r\\n    -- \\u00daltimo contato\\r\\n    mc.data_ultimo_contato,\\r\\n    mc.dias_desde_ultimo_contato\\r\\n    \\r\\nFROM gecob.prior_master_consolidado mc\\r\\nJOIN gecob.prior_score_priorizacao sp \\r\\n    ON mc.inscricao_estadual = sp.inscricao_estadual \\r\\n    AND mc.tipo_debito = sp.tipo_debito\\r\\nJOIN gecob.prior_features_ml fm \\r\\n    ON mc.inscricao_estadual = fm.inscricao_estadual \\r\\n    AND mc.tipo_debito = fm.tipo_debito\\r\\nWHERE sp.classificacao_prioridade IN ('PRIORIDADE_MAXIMA', 'PRIORIDADE_ALTA')\\r\\n  AND mc.qtd_total_contatos >= 3\\r\\nORDER BY mc.taxa_resposta_contatos DESC, sp.score_final_priorizacao DESC\\r\\nLIMIT 30;\\r\\n\\r\\n-- 2.5. AN\\u00c1LISE DE EMPRESAS NOTEIRAS (ALTO RISCO FISCAL)\\r\\n-- Objetivo: Identificar contribuintes com ind\\u00edcios de irregularidades fiscais\\r\\nSELECT \\r\\n    '2.5. TOP 30 EMPRESAS COM ALTO RISCO FISCAL (NOTEIRAS)' AS consulta,\\r\\n    \\r\\n    mc.inscricao_estadual,\\r\\n    mc.razao_social,\\r\\n    mc.cnpj,\\r\\n    mc.valor_total_devido,\\r\\n    \\r\\n    -- Score Noteiras\\r\\n    mc.score_noteiras,\\r\\n    mc.qtd_indicios_noteiras,\\r\\n    mc.qtd_tipos_indicios_noteiras,\\r\\n    mc.classificacao_risco_noteiras,\\r\\n    \\r\\n    -- Score de Prioriza\\u00e7\\u00e3o\\r\\n    sp.score_final_priorizacao,\\r\\n    sp.classificacao_prioridade,\\r\\n    \\r\\n    -- Situa\\u00e7\\u00e3o\\r\\n    mc.situacao_cadastral_desc,\\r\\n    mc.flag_falencia,\\r\\n    mc.flag_recuperacao_judicial,\\r\\n    mc.flag_devedor_contumaz,\\r\\n    \\r\\n    -- Capacidade\\r\\n    mc.porte_por_faturamento,\\r\\n    mc.faturamento_medio_6m,\\r\\n    \\r\\n    -- Setor\\r\\n    mc.secao_cnae,\\r\\n    mc.descricao_secao\\r\\n    \\r\\nFROM gecob.prior_master_consolidado mc\\r\\nJOIN gecob.prior_score_priorizacao sp \\r\\n    ON mc.inscricao_estadual = sp.inscricao_estadual \\r\\n    AND mc.tipo_debito = sp.tipo_debito\\r\\nWHERE mc.score_noteiras > 0\\r\\nORDER BY mc.score_noteiras DESC, sp.score_final_priorizacao DESC\\r\\nLIMIT 30;\\r\\n\\r\\n-- =================================================================================================\\r\\n-- SE\\u00c7\\u00c3O 3: AN\\u00c1LISES COMPLETAS (DOSSI\\u00ca DE CONTRIBUINTE ESPEC\\u00cdFICO)\\r\\n-- Instru\\u00e7\\u00e3o: Substitua '0000000000000' pela inscri\\u00e7\\u00e3o estadual desejada\\r\\n-- =================================================================================================\\r\\n\\r\\n-- 3.1. DOSSI\\u00ca COMPLETO - VIS\\u00c3O GERAL DO CONTRIBUINTE\\r\\nSELECT \\r\\n    '3.1. DOSSI\\u00ca - VIS\\u00c3O GERAL' AS consulta,\\r\\n    \\r\\n    -- Identifica\\u00e7\\u00e3o\\r\\n    mc.inscricao_estadual,\\r\\n    mc.cnpj,\\r\\n    mc.razao_social,\\r\\n    mc.nome_fantasia,\\r\\n    \\r\\n    -- Score e Prioridade\\r\\n    sp.score_final_priorizacao,\\r\\n    sp.classificacao_prioridade,\\r\\n    \\r\\n    -- Decomposi\\u00e7\\u00e3o do Score\\r\\n    sp.score_valor_debito,\\r\\n    sp.score_capacidade_pagamento,\\r\\n    sp.score_historico_pagamento,\\r\\n    sp.score_responsividade,\\r\\n    sp.score_viabilidade_cobranca,\\r\\n    sp.score_urgencia,\\r\\n    sp.score_conformidade,\\r\\n    \\r\\n    -- D\\u00e9bito Detalhado\\r\\n    mc.valor_total_devido,\\r\\n    mc.saldo_imposto,\\r\\n    mc.saldo_multa,\\r\\n    mc.saldo_juros,\\r\\n    mc.saldo_credito,\\r\\n    mc.tipo_debito,\\r\\n    \\r\\n    -- Situa\\u00e7\\u00e3o Cadastral\\r\\n    mc.situacao_cadastral_desc,\\r\\n    mc.data_situacao_cadastral,\\r\\n    mc.regime_apuracao_desc,\\r\\n    mc.tipo_contribuinte_desc,\\r\\n    mc.enquadramento_empresa_desc,\\r\\n    \\r\\n    -- Classifica\\u00e7\\u00e3o Econ\\u00f4mica\\r\\n    mc.cnae_classe,\\r\\n    mc.descricao_cnae,\\r\\n    mc.secao_cnae,\\r\\n    mc.descricao_secao,\\r\\n    mc.natureza_juridica_desc,\\r\\n    \\r\\n    -- Caracter\\u00edsticas\\r\\n    mc.porte_por_faturamento,\\r\\n    mc.flag_simples_nacional,\\r\\n    mc.flag_matriz,\\r\\n    mc.data_constituicao,\\r\\n    mc.data_inicio_icms,\\r\\n    \\r\\n    -- Localiza\\u00e7\\u00e3o\\r\\n    mc.codigo_municipio,\\r\\n    mc.nome_municipio,\\r\\n    mc.codigo_uf,\\r\\n    mc.nome_usefi,\\r\\n    mc.nome_ges,\\r\\n    \\r\\n    -- V\\u00ednculos Societ\\u00e1rios\\r\\n    mc.qtd_vinculos,\\r\\n    mc.qtd_vinculos_ativos,\\r\\n    mc.qtd_socios,\\r\\n    mc.qtd_socios_ativos,\\r\\n    \\r\\n    -- Contador\\r\\n    mc.cnpj_cpf_contador,\\r\\n    mc.nome_contador\\r\\n    \\r\\nFROM gecob.prior_master_consolidado mc\\r\\nJOIN gecob.prior_score_priorizacao sp \\r\\n    ON mc.inscricao_estadual = sp.inscricao_estadual \\r\\n    AND mc.tipo_debito = sp.tipo_debito\\r\\nWHERE mc.inscricao_estadual = '0000000000000'; -- << MODIFIQUE AQUI\\r\\n\\r\\n-- 3.2. DOSSI\\u00ca - HIST\\u00d3RICO DE COBRAN\\u00c7A E CONTATOS\\r\\nSELECT \\r\\n    '3.2. DOSSI\\u00ca - HIST\\u00d3RICO DE COBRAN\\u00c7A' AS consulta,\\r\\n    \\r\\n    mc.inscricao_estadual,\\r\\n    mc.razao_social,\\r\\n    \\r\\n    -- Datas Importantes\\r\\n    mc.data_inclusao_cobranca,\\r\\n    mc.data_limite_pagamento,\\r\\n    mc.data_ultima_transacao,\\r\\n    fm.dias_desde_inclusao_cobranca,\\r\\n    fm.faixa_idade_debito,\\r\\n    \\r\\n    -- Hist\\u00f3rico de Contatos\\r\\n    mc.qtd_total_contatos,\\r\\n    mc.qtd_tipos_contato_distintos,\\r\\n    mc.qtd_origens_contato,\\r\\n    mc.qtd_usuarios_contato,\\r\\n    \\r\\n    -- Respostas aos Contatos\\r\\n    mc.qtd_respostas_positivas,\\r\\n    mc.qtd_respostas_negativas,\\r\\n    mc.qtd_sem_resposta,\\r\\n    ROUND(mc.taxa_resposta_contatos * 100, 2) AS taxa_resposta_pct,\\r\\n    ROUND(fm.taxa_efetividade_contatos * 100, 2) AS taxa_efetividade_pct,\\r\\n    \\r\\n    -- Promessas de Pagamento\\r\\n    mc.qtd_promessas_pagamento,\\r\\n    mc.data_ultima_promessa,\\r\\n    ROUND(fm.taxa_promessas_contatos * 100, 2) AS taxa_promessas_pct,\\r\\n    \\r\\n    -- \\u00daltimo Contato\\r\\n    mc.data_ultimo_contato,\\r\\n    mc.dias_desde_ultimo_contato,\\r\\n    \\r\\n    -- NOVAS M\\u00c9TRICAS V1.5\\r\\n    mc.qtd_contatos_ultimos_30_dias,\\r\\n    mc.qtd_contatos_ultimos_90_dias,\\r\\n    \\r\\n    -- Perfil de Engajamento\\r\\n    fm.perfil_engajamento,\\r\\n    \\r\\n    -- Intensidade de Contato\\r\\n    ROUND(fm.intensidade_contato_mensal, 2) AS contatos_por_mes\\r\\n    \\r\\nFROM gecob.prior_master_consolidado mc\\r\\nJOIN gecob.prior_features_ml fm \\r\\n    ON mc.inscricao_estadual = fm.inscricao_estadual \\r\\n    AND mc.tipo_debito = fm.tipo_debito\\r\\nWHERE mc.inscricao_estadual = '0000000000000'; -- << MODIFIQUE AQUI\\r\\n\\r\\n-- 3.3. DOSSI\\u00ca - AN\\u00c1LISE FINANCEIRA E CAPACIDADE\\r\\nSELECT \\r\\n    '3.3. DOSSI\\u00ca - AN\\u00c1LISE FINANCEIRA' AS consulta,\\r\\n    \\r\\n    mc.inscricao_estadual,\\r\\n    mc.razao_social,\\r\\n    \\r\\n    -- Faturamento e Atividade (\\u00faltimos 6 meses)\\r\\n    mc.faturamento_total_6m,\\r\\n    mc.faturamento_medio_6m,\\r\\n    mc.faturamento_desvio_6m,\\r\\n    mc.icms_devido_total_6m,\\r\\n    mc.icms_recolher_total_6m,\\r\\n    ROUND(mc.aliquota_efetiva_media_6m * 100, 2) AS aliquota_efetiva_pct,\\r\\n    \\r\\n    -- Declara\\u00e7\\u00f5es\\r\\n    mc.qtd_periodos_declarados_6m,\\r\\n    mc.qtd_periodos_omissos_6m,\\r\\n    mc.qtd_periodos_movimento_6m,\\r\\n    mc.regularidade_declaracoes,\\r\\n    mc.classificacao_omissao,\\r\\n    \\r\\n    -- Pagamentos\\r\\n    mc.qtd_periodos_pagamento_6m,\\r\\n    mc.qtd_pagamentos_6m,\\r\\n    mc.valor_total_pago_6m,\\r\\n    mc.valor_medio_pago_periodo,\\r\\n    mc.regularidade_pagamentos,\\r\\n    ROUND(mc.coef_variacao_pagamentos, 2) AS coef_variacao_pagamentos,\\r\\n    \\r\\n    -- Capacidade de Pagamento\\r\\n    ROUND(fm.capacidade_pagamento_estimada, 2) AS capacidade_pagamento_meses,\\r\\n    ROUND(fm.razao_debito_faturamento, 2) AS razao_debito_faturamento,\\r\\n    ROUND(fm.taxa_pagamento_vs_devido_6m * 100, 2) AS taxa_pagamento_vs_devido_pct,\\r\\n    \\r\\n    -- Al\\u00edquota e Conformidade\\r\\n    ROUND(fm.taxa_divergencia_devido_recolher * 100, 2) AS taxa_divergencia_pct,\\r\\n    ROUND(fm.coef_variacao_faturamento, 2) AS coef_variacao_faturamento,\\r\\n    ROUND(fm.score_compliance * 100, 2) AS score_compliance,\\r\\n    ROUND(fm.score_atividade_recente * 100, 2) AS score_atividade_recente\\r\\n    \\r\\nFROM gecob.prior_master_consolidado mc\\r\\nJOIN gecob.prior_features_ml fm \\r\\n    ON mc.inscricao_estadual = fm.inscricao_estadual \\r\\n    AND mc.tipo_debito = fm.tipo_debito\\r\\nWHERE mc.inscricao_estadual = '0000000000000'; -- << MODIFIQUE AQUI\\r\\n\\r\\n-- 3.4. DOSSI\\u00ca - SITUA\\u00c7\\u00c3O DE RISCO E FLAGS\\r\\nSELECT \\r\\n    '3.4. DOSSI\\u00ca - SITUA\\u00c7\\u00c3O DE RISCO' AS consulta,\\r\\n    \\r\\n    mc.inscricao_estadual,\\r\\n    mc.razao_social,\\r\\n    mc.valor_total_devido,\\r\\n    \\r\\n    -- Flags de Risco Cr\\u00edtico\\r\\n    mc.flag_falencia,\\r\\n    mc.flag_recuperacao_judicial,\\r\\n    mc.flag_devedor_contumaz,\\r\\n    mc.flag_protesto,\\r\\n    mc.flag_com_garantia,\\r\\n    mc.flag_suspensao_dfe,\\r\\n    \\r\\n    -- Score de Risco Composto\\r\\n    fm.score_risco_situacao,\\r\\n    fm.score_situacao_cadastral,\\r\\n    \\r\\n    -- Score Noteiras\\r\\n    mc.score_noteiras,\\r\\n    mc.qtd_indicios_noteiras,\\r\\n    mc.qtd_tipos_indicios_noteiras,\\r\\n    mc.classificacao_risco_noteiras,\\r\\n    \\r\\n    -- Parcelamento\\r\\n    mc.flag_tem_parcelamento,\\r\\n    mc.numero_parcelamento,\\r\\n    mc.status_parcelamento_desc,\\r\\n    mc.saldo_parcelado,\\r\\n    mc.numero_parcelas,\\r\\n    mc.data_pedido_parcelamento,\\r\\n    fm.situacao_parcelamento,\\r\\n    ROUND(fm.proporcao_debito_parcelado * 100, 2) AS perc_debito_parcelado,\\r\\n    \\r\\n    -- Viabilidade\\r\\n    sp.score_viabilidade_cobranca,\\r\\n    \\r\\n    -- Complexidade Societ\\u00e1ria\\r\\n    fm.complexidade_societaria\\r\\n    \\r\\nFROM gecob.prior_master_consolidado mc\\r\\nJOIN gecob.prior_features_ml fm \\r\\n    ON mc.inscricao_estadual = fm.inscricao_estadual \\r\\n    AND mc.tipo_debito = fm.tipo_debito\\r\\nJOIN gecob.prior_score_priorizacao sp \\r\\n    ON mc.inscricao_estadual = sp.inscricao_estadual \\r\\n    AND mc.tipo_debito = sp.tipo_debito\\r\\nWHERE mc.inscricao_estadual = '0000000000000'; -- << MODIFIQUE AQUI\\r\\n\\r\\n-- =================================================================================================\\r\\n-- SE\\u00c7\\u00c3O 4: AN\\u00c1LISES ESPECIALIZADAS E CEN\\u00c1RIOS ESPEC\\u00cdFICOS\\r\\n-- =================================================================================================\\r\\n\\r\\n-- 4.1. CASOS DE ALTA PRIORIDADE COM BOA CAPACIDADE DE PAGAMENTO\\r\\n-- Objetivo: Identificar os casos mais promissores para cobran\\u00e7a imediata\\r\\nSELECT \\r\\n    '4.1. ALTA PRIORIDADE + BOA CAPACIDADE' AS consulta,\\r\\n    \\r\\n    mc.inscricao_estadual,\\r\\n    mc.razao_social,\\r\\n    mc.valor_total_devido,\\r\\n    \\r\\n    -- Scores\\r\\n    sp.score_final_priorizacao,\\r\\n    sp.classificacao_prioridade,\\r\\n    sp.score_capacidade_pagamento,\\r\\n    \\r\\n    -- Capacidade Financeira\\r\\n    fm.capacidade_pagamento_estimada,\\r\\n    mc.faturamento_medio_6m,\\r\\n    mc.porte_por_faturamento,\\r\\n    ROUND(fm.razao_debito_faturamento, 2) AS razao_debito_faturamento,\\r\\n    \\r\\n    -- Hist\\u00f3rico de Compliance\\r\\n    mc.regularidade_pagamentos,\\r\\n    ROUND(fm.taxa_pagamento_vs_devido_6m * 100, 2) AS taxa_compliance_pct,\\r\\n    ROUND(fm.score_compliance * 100, 2) AS score_compliance,\\r\\n    \\r\\n    -- Situa\\u00e7\\u00e3o\\r\\n    mc.situacao_cadastral_desc,\\r\\n    mc.flag_falencia,\\r\\n    mc.flag_recuperacao_judicial,\\r\\n    \\r\\n    -- Contato\\r\\n    mc.qtd_total_contatos,\\r\\n    ROUND(mc.taxa_resposta_contatos * 100, 2) AS taxa_resposta_pct,\\r\\n    fm.perfil_engajamento,\\r\\n    \\r\\n    -- NOVAS M\\u00c9TRICAS V1.5\\r\\n    mc.qtd_contatos_ultimos_30_dias,\\r\\n    mc.qtd_contatos_ultimos_90_dias,\\r\\n    \\r\\n    -- A\\u00e7\\u00e3o Recomendada\\r\\n    CASE \\r\\n        WHEN fm.taxa_efetividade_contatos >= 0.5 THEN 'CONTATO_IMEDIATO_NEGOCIACAO'\\r\\n        WHEN mc.qtd_total_contatos < 3 THEN 'INTENSIFICAR_CONTATOS'\\r\\n        WHEN mc.flag_tem_parcelamento = 0 THEN 'OFERECER_PARCELAMENTO'\\r\\n        ELSE 'NEGOCIACAO_DESCONTO'\\r\\n    END AS acao_recomendada\\r\\n    \\r\\nFROM gecob.prior_master_consolidado mc\\r\\nJOIN gecob.prior_score_priorizacao sp \\r\\n    ON mc.inscricao_estadual = sp.inscricao_estadual \\r\\n    AND mc.tipo_debito = sp.tipo_debito\\r\\nJOIN gecob.prior_features_ml fm \\r\\n    ON mc.inscricao_estadual = fm.inscricao_estadual \\r\\n    AND mc.tipo_debito = fm.tipo_debito\\r\\nWHERE sp.classificacao_prioridade IN ('PRIORIDADE_MAXIMA', 'PRIORIDADE_ALTA')\\r\\n  AND fm.capacidade_pagamento_estimada >= 1.5  -- Pode pagar em at\\u00e9 2 meses\\r\\n  AND mc.situacao_cadastral_desc = 'ATIVO'\\r\\n  AND mc.flag_falencia = 0\\r\\n  AND mc.flag_recuperacao_judicial = 0\\r\\nORDER BY sp.score_final_priorizacao DESC, fm.capacidade_pagamento_estimada DESC\\r\\nLIMIT 100;\\r\\n\\r\\n-- 4.2. CASOS DE RECUPERA\\u00c7\\u00c3O P\\u00d3S-CONTATO\\r\\n-- Objetivo: Empresas que melhoraram comportamento ap\\u00f3s contatos\\r\\nSELECT \\r\\n    '4.2. CASOS DE RECUPERA\\u00c7\\u00c3O P\\u00d3S-CONTATO' AS consulta,\\r\\n    \\r\\n    mc.inscricao_estadual,\\r\\n    mc.razao_social,\\r\\n    mc.valor_total_devido,\\r\\n    sp.score_final_priorizacao,\\r\\n    \\r\\n    -- Hist\\u00f3rico de Contato Positivo\\r\\n    mc.qtd_total_contatos,\\r\\n    mc.qtd_respostas_positivas,\\r\\n    mc.qtd_promessas_pagamento,\\r\\n    ROUND(mc.taxa_resposta_contatos * 100, 2) AS taxa_resposta_pct,\\r\\n    ROUND(fm.taxa_efetividade_contatos * 100, 2) AS taxa_efetividade_pct,\\r\\n    \\r\\n    -- NOVAS M\\u00c9TRICAS V1.5\\r\\n    mc.qtd_contatos_ultimos_30_dias,\\r\\n    mc.qtd_contatos_ultimos_90_dias,\\r\\n    \\r\\n    -- Melhora no Comportamento\\r\\n    mc.qtd_periodos_pagamento_6m,\\r\\n    ROUND(fm.taxa_pagamento_vs_devido_6m * 100, 2) AS taxa_pagamento_recente_pct,\\r\\n    mc.regularidade_pagamentos,\\r\\n    \\r\\n    -- Declara\\u00e7\\u00f5es\\r\\n    mc.qtd_periodos_declarados_6m,\\r\\n    mc.regularidade_declaracoes,\\r\\n    \\r\\n    -- Perfil\\r\\n    fm.perfil_engajamento,\\r\\n    mc.porte_por_faturamento,\\r\\n    \\r\\n    -- \\u00daltima intera\\u00e7\\u00e3o\\r\\n    mc.data_ultimo_contato,\\r\\n    mc.data_ultima_promessa\\r\\n    \\r\\nFROM gecob.prior_master_consolidado mc\\r\\nJOIN gecob.prior_score_priorizacao sp \\r\\n    ON mc.inscricao_estadual = sp.inscricao_estadual \\r\\n    AND mc.tipo_debito = sp.tipo_debito\\r\\nJOIN gecob.prior_features_ml fm \\r\\n    ON mc.inscricao_estadual = fm.inscricao_estadual \\r\\n    AND mc.tipo_debito = fm.tipo_debito\\r\\nWHERE mc.qtd_respostas_positivas >= 2\\r\\n  AND mc.qtd_total_contatos >= 3\\r\\n  AND mc.taxa_resposta_contatos >= 0.4\\r\\n  AND mc.qtd_periodos_pagamento_6m >= 3\\r\\nORDER BY mc.taxa_resposta_contatos DESC, fm.taxa_pagamento_vs_devido_6m DESC\\r\\nLIMIT 50;\\r\\n\\r\\n-- 4.3. CASOS CR\\u00cdTICOS PARA DIVIDA ATIVA\\r\\n-- Objetivo: Identificar casos de baixa viabilidade para encaminhamento\\r\\nSELECT \\r\\n    '4.3. CASOS CR\\u00cdTICOS PARA D\\u00cdVIDA ATIVA' AS consulta,\\r\\n    \\r\\n    mc.inscricao_estadual,\\r\\n    mc.razao_social,\\r\\n    mc.valor_total_devido,\\r\\n    fm.dias_desde_inclusao_cobranca,\\r\\n    \\r\\n    -- Score baixo de viabilidade\\r\\n    sp.score_viabilidade_cobranca,\\r\\n    sp.score_final_priorizacao,\\r\\n    \\r\\n    -- Flags de Risco Grave\\r\\n    mc.flag_falencia,\\r\\n    mc.flag_recuperacao_judicial,\\r\\n    mc.flag_devedor_contumaz,\\r\\n    mc.situacao_cadastral_desc,\\r\\n    \\r\\n    -- Hist\\u00f3rico de N\\u00e3o-Resposta\\r\\n    mc.qtd_total_contatos,\\r\\n    mc.qtd_sem_resposta,\\r\\n    ROUND(mc.taxa_resposta_contatos * 100, 2) AS taxa_resposta_pct,\\r\\n    mc.dias_desde_ultimo_contato,\\r\\n    \\r\\n    -- Inatividade Fiscal\\r\\n    mc.qtd_periodos_declarados_6m,\\r\\n    mc.qtd_periodos_omissos_6m,\\r\\n    mc.classificacao_omissao,\\r\\n    \\r\\n    -- Score de Risco\\r\\n    fm.score_risco_situacao,\\r\\n    mc.classificacao_risco_noteiras,\\r\\n    \\r\\n    -- Motivo Principal\\r\\n    CASE \\r\\n        WHEN mc.flag_falencia = 1 THEN 'FAL\\u00caNCIA'\\r\\n        WHEN mc.flag_recuperacao_judicial = 1 THEN 'RECUPERA\\u00c7\\u00c3O JUDICIAL'\\r\\n        WHEN mc.situacao_cadastral_desc IN ('CANCELADO', 'BAIXADO', 'INAPTO') THEN 'INATIVO/INAPTO'\\r\\n        WHEN fm.dias_desde_inclusao_cobranca > 730 AND mc.qtd_total_contatos >= 10 AND mc.taxa_resposta_contatos < 0.2 THEN 'N\\u00c3O RESPONSIVO CR\\u00d4NICO'\\r\\n        WHEN mc.classificacao_omissao = 'OMISSO_RECORRENTE' THEN 'OMISS\\u00c3O RECORRENTE'\\r\\n        ELSE 'OUTROS'\\r\\n    END AS motivo_principal\\r\\n    \\r\\nFROM gecob.prior_master_consolidado mc\\r\\nJOIN gecob.prior_score_priorizacao sp \\r\\n    ON mc.inscricao_estadual = sp.inscricao_estadual \\r\\n    AND mc.tipo_debito = sp.tipo_debito\\r\\nJOIN gecob.prior_features_ml fm \\r\\n    ON mc.inscricao_estadual = fm.inscricao_estadual \\r\\n    AND mc.tipo_debito = fm.tipo_debito\\r\\nWHERE sp.score_viabilidade_cobranca < 40\\r\\n  OR mc.flag_falencia = 1\\r\\n  OR mc.flag_recuperacao_judicial = 1\\r\\n  OR (fm.dias_desde_inclusao_cobranca > 730 AND mc.qtd_total_contatos >= 10 AND mc.taxa_resposta_contatos < 0.2)\\r\\nORDER BY sp.score_viabilidade_cobranca ASC, mc.valor_total_devido DESC\\r\\nLIMIT 100;\\r\\n\\r\\n-- 4.4. AN\\u00c1LISE DE PARCELAMENTOS ATIVOS E INADIMPLENTES\\r\\n-- Objetivo: Monitorar a situa\\u00e7\\u00e3o dos parcelamentos\\r\\nSELECT \\r\\n    '4.4. AN\\u00c1LISE DE PARCELAMENTOS' AS consulta,\\r\\n    \\r\\n    mc.inscricao_estadual,\\r\\n    mc.razao_social,\\r\\n    mc.valor_total_devido,\\r\\n    \\r\\n    -- Parcelamento\\r\\n    mc.numero_parcelamento,\\r\\n    mc.status_parcelamento_desc,\\r\\n    mc.numero_parcelas,\\r\\n    mc.saldo_parcelado,\\r\\n    mc.saldo_imposto_parcelado,\\r\\n    mc.saldo_multa_parcelada,\\r\\n    mc.data_pedido_parcelamento,\\r\\n    \\r\\n    -- Situa\\u00e7\\u00e3o do Parcelamento\\r\\n    fm.situacao_parcelamento,\\r\\n    ROUND(fm.proporcao_debito_parcelado * 100, 2) AS perc_debito_parcelado,\\r\\n    fm.dias_desde_parcelamento,\\r\\n    \\r\\n    -- Score\\r\\n    sp.score_final_priorizacao,\\r\\n    sp.classificacao_prioridade,\\r\\n    \\r\\n    -- Capacidade\\r\\n    fm.capacidade_pagamento_estimada,\\r\\n    mc.faturamento_medio_6m,\\r\\n    \\r\\n    -- Compliance\\r\\n    mc.regularidade_pagamentos,\\r\\n    ROUND(fm.taxa_pagamento_vs_devido_6m * 100, 2) AS taxa_compliance_pct,\\r\\n    \\r\\n    -- Alertas\\r\\n    CASE \\r\\n        WHEN mc.status_parcelamento_desc = 'INADIMPLENTE' THEN 'ALERTA: Parcelamento Inadimplente'\\r\\n        WHEN fm.dias_desde_parcelamento > 180 AND mc.status_parcelamento_desc = 'ATIVO' THEN 'Parcelamento Longevo - Monitorar'\\r\\n        WHEN mc.status_parcelamento_desc = 'ATIVO' AND fm.capacidade_pagamento_estimada >= 3 THEN 'Oportunidade de Quita\\u00e7\\u00e3o Antecipada'\\r\\n        ELSE 'Normal'\\r\\n    END AS status_alerta\\r\\n    \\r\\nFROM gecob.prior_master_consolidado mc\\r\\nJOIN gecob.prior_score_priorizacao sp \\r\\n    ON mc.inscricao_estadual = sp.inscricao_estadual \\r\\n    AND mc.tipo_debito = sp.tipo_debito\\r\\nJOIN gecob.prior_features_ml fm \\r\\n    ON mc.inscricao_estadual = fm.inscricao_estadual \\r\\n    AND mc.tipo_debito = fm.tipo_debito\\r\\nWHERE mc.flag_tem_parcelamento = 1\\r\\nORDER BY \\r\\n    CASE mc.status_parcelamento_desc \\r\\n        WHEN 'INADIMPLENTE' THEN 1\\r\\n        WHEN 'ATIVO' THEN 2\\r\\n        ELSE 3 \\r\\n    END,\\r\\n    mc.saldo_parcelado DESC;\\r\\n\\r\\n-- 4.5. IMPACTO ARRECADAT\\u00d3RIO POTENCIAL POR SETOR\\r\\n-- Objetivo: Estimar o potencial de recupera\\u00e7\\u00e3o por setor econ\\u00f4mico\\r\\nSELECT \\r\\n    '4.5. IMPACTO ARRECADAT\\u00d3RIO POR SETOR' AS consulta,\\r\\n    \\r\\n    mc.secao_cnae,\\r\\n    mc.descricao_secao,\\r\\n    \\r\\n    -- Volume Total\\r\\n    COUNT(DISTINCT mc.inscricao_estadual) AS qtd_contribuintes,\\r\\n    SUM(mc.valor_total_devido) AS valor_total_setor,\\r\\n    \\r\\n    -- Alta Prioridade + Alta Capacidade (Potencial M\\u00e1ximo)\\r\\n    COUNT(CASE \\r\\n        WHEN sp.classificacao_prioridade IN ('PRIORIDADE_MAXIMA', 'PRIORIDADE_ALTA')\\r\\n        AND fm.capacidade_pagamento_estimada >= 1.5\\r\\n        AND mc.situacao_cadastral_desc = 'ATIVO'\\r\\n        AND mc.flag_falencia = 0\\r\\n        THEN 1 \\r\\n    END) AS casos_alta_recuperabilidade,\\r\\n    \\r\\n    SUM(CASE \\r\\n        WHEN sp.classificacao_prioridade IN ('PRIORIDADE_MAXIMA', 'PRIORIDADE_ALTA')\\r\\n        AND fm.capacidade_pagamento_estimada >= 1.5\\r\\n        AND mc.situacao_cadastral_desc = 'ATIVO'\\r\\n        AND mc.flag_falencia = 0\\r\\n        THEN mc.valor_total_devido\\r\\n        ELSE 0 \\r\\n    END) AS valor_alta_recuperabilidade,\\r\\n    \\r\\n    -- Taxa de Recuperabilidade Estimada\\r\\n    ROUND(SUM(CASE \\r\\n        WHEN sp.classificacao_prioridade IN ('PRIORIDADE_MAXIMA', 'PRIORIDADE_ALTA')\\r\\n        AND fm.capacidade_pagamento_estimada >= 1.5\\r\\n        AND mc.situacao_cadastral_desc = 'ATIVO'\\r\\n        AND mc.flag_falencia = 0\\r\\n        THEN mc.valor_total_devido\\r\\n        ELSE 0 \\r\\n    END) * 100.0 / NULLIF(SUM(mc.valor_total_devido), 0), 2) AS perc_recuperabilidade,\\r\\n    \\r\\n    -- Compliance M\\u00e9dio do Setor\\r\\n    ROUND(AVG(fm.taxa_pagamento_vs_devido_6m) * 100, 2) AS taxa_compliance_media_pct,\\r\\n    ROUND(AVG(sp.score_final_priorizacao), 2) AS score_medio_setor\\r\\n    \\r\\nFROM gecob.prior_master_consolidado mc\\r\\nJOIN gecob.prior_score_priorizacao sp \\r\\n    ON mc.inscricao_estadual = sp.inscricao_estadual \\r\\n    AND mc.tipo_debito = sp.tipo_debito\\r\\nJOIN gecob.prior_features_ml fm \\r\\n    ON mc.inscricao_estadual = fm.inscricao_estadual \\r\\n    AND mc.tipo_debito = fm.tipo_debito\\r\\nWHERE mc.secao_cnae IS NOT NULL\\r\\nGROUP BY mc.secao_cnae, mc.descricao_secao\\r\\nHAVING COUNT(DISTINCT mc.inscricao_estadual) >= 5\\r\\nORDER BY valor_alta_recuperabilidade DESC\\r\\nLIMIT 30;\\r\\n\\r\\n-- =================================================================================================\\r\\n-- SE\\u00c7\\u00c3O 5: DASHBOARD EXECUTIVO E KPIs\\r\\n-- =================================================================================================\\r\\n\\r\\n-- 5.1. DASHBOARD EXECUTIVO - INDICADORES PRINCIPAIS\\r\\nSELECT \\r\\n    'DASHBOARD EXECUTIVO - KPIS PRINCIPAIS' AS consulta,\\r\\n    \\r\\n    -- M\\u00e9tricas de Volume\\r\\n    COUNT(DISTINCT mc.inscricao_estadual) AS total_contribuintes,\\r\\n    SUM(mc.valor_total_devido) AS divida_total,\\r\\n    ROUND(AVG(mc.valor_total_devido), 2) AS divida_media,\\r\\n    \\r\\n    -- Distribui\\u00e7\\u00e3o de Prioridade\\r\\n    COUNT(CASE WHEN sp.classificacao_prioridade = 'PRIORIDADE_MAXIMA' THEN 1 END) AS qtd_prioridade_maxima,\\r\\n    COUNT(CASE WHEN sp.classificacao_prioridade = 'PRIORIDADE_ALTA' THEN 1 END) AS qtd_prioridade_alta,\\r\\n    COUNT(CASE WHEN sp.classificacao_prioridade = 'PRIORIDADE_MEDIA' THEN 1 END) AS qtd_prioridade_media,\\r\\n    \\r\\n    SUM(CASE WHEN sp.classificacao_prioridade = 'PRIORIDADE_MAXIMA' THEN mc.valor_total_devido ELSE 0 END) AS valor_prioridade_maxima,\\r\\n    SUM(CASE WHEN sp.classificacao_prioridade = 'PRIORIDADE_ALTA' THEN mc.valor_total_devido ELSE 0 END) AS valor_prioridade_alta,\\r\\n    \\r\\n    -- Potencial de Recupera\\u00e7\\u00e3o\\r\\n    COUNT(CASE \\r\\n        WHEN sp.classificacao_prioridade IN ('PRIORIDADE_MAXIMA', 'PRIORIDADE_ALTA')\\r\\n        AND fm.capacidade_pagamento_estimada >= 1.5\\r\\n        AND mc.situacao_cadastral_desc = 'ATIVO'\\r\\n        AND mc.flag_falencia = 0\\r\\n        THEN 1 \\r\\n    END) AS casos_alta_recuperabilidade,\\r\\n    \\r\\n    SUM(CASE \\r\\n        WHEN sp.classificacao_prioridade IN ('PRIORIDADE_MAXIMA', 'PRIORIDADE_ALTA')\\r\\n        AND fm.capacidade_pagamento_estimada >= 1.5\\r\\n        AND mc.situacao_cadastral_desc = 'ATIVO'\\r\\n        AND mc.flag_falencia = 0\\r\\n        THEN mc.valor_total_devido\\r\\n        ELSE 0 \\r\\n    END) AS valor_alta_recuperabilidade,\\r\\n    \\r\\n    -- Taxa de Contato e Resposta\\r\\n    ROUND(AVG(mc.taxa_resposta_contatos) * 100, 2) AS taxa_resposta_media_pct,\\r\\n    ROUND(AVG(mc.qtd_total_contatos), 2) AS media_contatos_por_ie,\\r\\n    \\r\\n    -- NOVAS M\\u00c9TRICAS V1.5\\r\\n    ROUND(AVG(mc.qtd_contatos_ultimos_30_dias), 2) AS media_contatos_30d,\\r\\n    ROUND(AVG(mc.qtd_contatos_ultimos_90_dias), 2) AS media_contatos_90d,\\r\\n    \\r\\n    -- Compliance\\r\\n    ROUND(AVG(fm.taxa_pagamento_vs_devido_6m) * 100, 2) AS taxa_compliance_media_pct,\\r\\n    \\r\\n    -- Casos Cr\\u00edticos\\r\\n    COUNT(CASE WHEN mc.flag_falencia = 1 THEN 1 END) AS casos_falencia,\\r\\n    COUNT(CASE WHEN mc.flag_recuperacao_judicial = 1 THEN 1 END) AS casos_recuperacao_judicial,\\r\\n    COUNT(CASE WHEN sp.score_viabilidade_cobranca < 40 THEN 1 END) AS casos_baixa_viabilidade,\\r\\n    \\r\\n    -- Timestamp\\r\\n    FROM_UNIXTIME(UNIX_TIMESTAMP()) AS data_atualizacao\\r\\n    \\r\\nFROM gecob.prior_master_consolidado mc\\r\\nJOIN gecob.prior_score_priorizacao sp \\r\\n    ON mc.inscricao_estadual = sp.inscricao_estadual \\r\\n    AND mc.tipo_debito = sp.tipo_debito\\r\\nJOIN gecob.prior_features_ml fm \\r\\n    ON mc.inscricao_estadual = fm.inscricao_estadual \\r\\n    AND mc.tipo_debito = fm.tipo_debito;\\r\\n\", \"statementsList\": [\"\\r\\n\\r\\n-- 2.3. AN\\u00c1LISE DE MUNIC\\u00cdPIOS COM MAIOR CONCENTRA\\u00c7\\u00c3O DE D\\u00cdVIDA\\r\\n-- Objetivo: Identificar concentra\\u00e7\\u00f5es geogr\\u00e1ficas para planejamento de a\\u00e7\\u00f5es\\r\\nSELECT \\r\\n    '2.3. TOP 20 MUNIC\\u00cdPIOS POR CONCENTRA\\u00c7\\u00c3O DE D\\u00cdVIDA' AS consulta,\\r\\n    \\r\\n    mc.codigo_municipio,\\r\\n    mc.nome_municipio,\\r\\n    mc.codigo_uf,\\r\\n    \\r\\n    COUNT(DISTINCT mc.inscricao_estadual) AS qtd_contribuintes,\\r\\n    SUM(mc.valor_total_devido) AS valor_total_municipio,\\r\\n    ROUND(AVG(mc.valor_total_devido), 2) AS valor_medio_por_ie,\\r\\n    \\r\\n    -- Concentra\\u00e7\\u00e3o\\r\\n    ROUND(SUM(mc.valor_total_devido) * 100.0 / \\r\\n          (SELECT SUM(valor_total_devido) FROM gecob.prior_master_consolidado), 2) AS perc_divida_total,\\r\\n    \\r\\n    -- Prioriza\\u00e7\\u00e3o\\r\\n    COUNT(CASE WHEN sp.classificacao_prioridade = 'PRIORIDADE_MAXIMA' THEN 1 END) AS prioridade_maxima,\\r\\n    COUNT(CASE WHEN sp.classificacao_prioridade = 'PRIORIDADE_ALTA' THEN 1 END) AS prioridade_alta,\\r\\n    ROUND(AVG(sp.score_final_priorizacao), 2) AS score_medio_municipio,\\r\\n    \\r\\n    -- Perfil de Porte\\r\\n    COUNT(CASE WHEN mc.porte_por_faturamento = 'GRANDE' THEN 1 END) AS empresas_grande_porte,\\r\\n    COUNT(CASE WHEN mc.porte_por_faturamento = 'MEDIO' THEN 1 END) AS empresas_medio_porte,\\r\\n    \\r\\n    -- Situa\\u00e7\\u00e3o\\r\\n    COUNT(CASE WHEN mc.flag_falencia = 1 THEN 1 END) AS casos_falencia,\\r\\n    COUNT(CASE WHEN mc.flag_recuperacao_judicial = 1 THEN 1 END) AS casos_recuperacao_judicial,\\r\\n    \\r\\n    -- Performance de Contato\\r\\n    ROUND(AVG(mc.taxa_resposta_contatos) * 100, 2) AS taxa_resposta_media_pct\\r\\n    \\r\\nFROM gecob.prior_master_consolidado mc\\r\\nJOIN gecob.prior_score_priorizacao sp \\r\\n    ON mc.inscricao_estadual = sp.inscricao_estadual \\r\\n    AND mc.tipo_debito = sp.tipo_debito\\r\\nWHERE mc.codigo_municipio IS NOT NULL\\r\\nGROUP BY mc.codigo_municipio, mc.nome_municipio, mc.codigo_uf\\r\\nORDER BY SUM(mc.valor_total_devido) DESC\\r\\nLIMIT 20;\", \"\\r\\n\\r\\n-- 2.4. RANKING DE RESPONSIVIDADE E ENGAJAMENTO\\r\\n-- Objetivo: Identificar contribuintes com melhor/pior hist\\u00f3rico de resposta\\r\\nSELECT \\r\\n    '2.4. TOP 30 - MELHOR RESPONSIVIDADE (ALTA PRIORIDADE)' AS consulta,\\r\\n    \\r\\n    mc.inscricao_estadual,\\r\\n    mc.razao_social,\\r\\n    mc.valor_total_devido,\\r\\n    sp.classificacao_prioridade,\\r\\n    \\r\\n    -- M\\u00e9tricas de Contato\\r\\n    mc.qtd_total_contatos,\\r\\n    mc.qtd_respostas_positivas,\\r\\n    mc.qtd_promessas_pagamento,\\r\\n    ROUND(mc.taxa_resposta_contatos * 100, 2) AS taxa_resposta_pct,\\r\\n    fm.perfil_engajamento,\\r\\n    \\r\\n    -- NOVAS M\\u00c9TRICAS V1.5\\r\\n    mc.qtd_contatos_ultimos_30_dias,\\r\\n    mc.qtd_contatos_ultimos_90_dias,\\r\\n    \\r\\n    -- Scores\\r\\n    sp.score_final_priorizacao,\\r\\n    sp.score_responsividade,\\r\\n    \\r\\n    -- Capacidade\\r\\n    fm.capacidade_pagamento_estimada,\\r\\n    mc.faturamento_medio_6m,\\r\\n    \\r\\n    -- \\u00daltimo contato\\r\\n    mc.data_ultimo_contato,\\r\\n    mc.dias_desde_ultimo_contato\\r\\n    \\r\\nFROM gecob.prior_master_consolidado mc\\r\\nJOIN gecob.prior_score_priorizacao sp \\r\\n    ON mc.inscricao_estadual = sp.inscricao_estadual \\r\\n    AND mc.tipo_debito = sp.tipo_debito\\r\\nJOIN gecob.prior_features_ml fm \\r\\n    ON mc.inscricao_estadual = fm.inscricao_estadual \\r\\n    AND mc.tipo_debito = fm.tipo_debito\\r\\nWHERE sp.classificacao_prioridade IN ('PRIORIDADE_MAXIMA', 'PRIORIDADE_ALTA')\\r\\n  AND mc.qtd_total_contatos >= 3\\r\\nORDER BY mc.taxa_resposta_contatos DESC, sp.score_final_priorizacao DESC\\r\\nLIMIT 30;\", \"\\r\\n\\r\\n-- 2.5. AN\\u00c1LISE DE EMPRESAS NOTEIRAS (ALTO RISCO FISCAL)\\r\\n-- Objetivo: Identificar contribuintes com ind\\u00edcios de irregularidades fiscais\\r\\nSELECT \\r\\n    '2.5. TOP 30 EMPRESAS COM ALTO RISCO FISCAL (NOTEIRAS)' AS consulta,\\r\\n    \\r\\n    mc.inscricao_estadual,\\r\\n    mc.razao_social,\\r\\n    mc.cnpj,\\r\\n    mc.valor_total_devido,\\r\\n    \\r\\n    -- Score Noteiras\\r\\n    mc.score_noteiras,\\r\\n    mc.qtd_indicios_noteiras,\\r\\n    mc.qtd_tipos_indicios_noteiras,\\r\\n    mc.classificacao_risco_noteiras,\\r\\n    \\r\\n    -- Score de Prioriza\\u00e7\\u00e3o\\r\\n    sp.score_final_priorizacao,\\r\\n    sp.classificacao_prioridade,\\r\\n    \\r\\n    -- Situa\\u00e7\\u00e3o\\r\\n    mc.situacao_cadastral_desc,\\r\\n    mc.flag_falencia,\\r\\n    mc.flag_recuperacao_judicial,\\r\\n    mc.flag_devedor_contumaz,\\r\\n    \\r\\n    -- Capacidade\\r\\n    mc.porte_por_faturamento,\\r\\n    mc.faturamento_medio_6m,\\r\\n    \\r\\n    -- Setor\\r\\n    mc.secao_cnae,\\r\\n    mc.descricao_secao\\r\\n    \\r\\nFROM gecob.prior_master_consolidado mc\\r\\nJOIN gecob.prior_score_priorizacao sp \\r\\n    ON mc.inscricao_estadual = sp.inscricao_estadual \\r\\n    AND mc.tipo_debito = sp.tipo_debito\\r\\nWHERE mc.score_noteiras > 0\\r\\nORDER BY mc.score_noteiras DESC, sp.score_final_priorizacao DESC\\r\\nLIMIT 30;\", \"\\r\\n\\r\\n-- =================================================================================================\\r\\n-- SE\\u00c7\\u00c3O 3: AN\\u00c1LISES COMPLETAS (DOSSI\\u00ca DE CONTRIBUINTE ESPEC\\u00cdFICO)\\r\\n-- Instru\\u00e7\\u00e3o: Substitua '0000000000000' pela inscri\\u00e7\\u00e3o estadual desejada\\r\\n-- =================================================================================================\\r\\n\\r\\n-- 3.1. DOSSI\\u00ca COMPLETO - VIS\\u00c3O GERAL DO CONTRIBUINTE\\r\\nSELECT \\r\\n    '3.1. DOSSI\\u00ca - VIS\\u00c3O GERAL' AS consulta,\\r\\n    \\r\\n    -- Identifica\\u00e7\\u00e3o\\r\\n    mc.inscricao_estadual,\\r\\n    mc.cnpj,\\r\\n    mc.razao_social,\\r\\n    mc.nome_fantasia,\\r\\n    \\r\\n    -- Score e Prioridade\\r\\n    sp.score_final_priorizacao,\\r\\n    sp.classificacao_prioridade,\\r\\n    \\r\\n    -- Decomposi\\u00e7\\u00e3o do Score\\r\\n    sp.score_valor_debito,\\r\\n    sp.score_capacidade_pagamento,\\r\\n    sp.score_historico_pagamento,\\r\\n    sp.score_responsividade,\\r\\n    sp.score_viabilidade_cobranca,\\r\\n    sp.score_urgencia,\\r\\n    sp.score_conformidade,\\r\\n    \\r\\n    -- D\\u00e9bito Detalhado\\r\\n    mc.valor_total_devido,\\r\\n    mc.saldo_imposto,\\r\\n    mc.saldo_multa,\\r\\n    mc.saldo_juros,\\r\\n    mc.saldo_credito,\\r\\n    mc.tipo_debito,\\r\\n    \\r\\n    -- Situa\\u00e7\\u00e3o Cadastral\\r\\n    mc.situacao_cadastral_desc,\\r\\n    mc.data_situacao_cadastral,\\r\\n    mc.regime_apuracao_desc,\\r\\n    mc.tipo_contribuinte_desc,\\r\\n    mc.enquadramento_empresa_desc,\\r\\n    \\r\\n    -- Classifica\\u00e7\\u00e3o Econ\\u00f4mica\\r\\n    mc.cnae_classe,\\r\\n    mc.descricao_cnae,\\r\\n    mc.secao_cnae,\\r\\n    mc.descricao_secao,\\r\\n    mc.natureza_juridica_desc,\\r\\n    \\r\\n    -- Caracter\\u00edsticas\\r\\n    mc.porte_por_faturamento,\\r\\n    mc.flag_simples_nacional,\\r\\n    mc.flag_matriz,\\r\\n    mc.data_constituicao,\\r\\n    mc.data_inicio_icms,\\r\\n    \\r\\n    -- Localiza\\u00e7\\u00e3o\\r\\n    mc.codigo_municipio,\\r\\n    mc.nome_municipio,\\r\\n    mc.codigo_uf,\\r\\n    mc.nome_usefi,\\r\\n    mc.nome_ges,\\r\\n    \\r\\n    -- V\\u00ednculos Societ\\u00e1rios\\r\\n    mc.qtd_vinculos,\\r\\n    mc.qtd_vinculos_ativos,\\r\\n    mc.qtd_socios,\\r\\n    mc.qtd_socios_ativos,\\r\\n    \\r\\n    -- Contador\\r\\n    mc.cnpj_cpf_contador,\\r\\n    mc.nome_contador\\r\\n    \\r\\nFROM gecob.prior_master_consolidado mc\\r\\nJOIN gecob.prior_score_priorizacao sp \\r\\n    ON mc.inscricao_estadual = sp.inscricao_estadual \\r\\n    AND mc.tipo_debito = sp.tipo_debito\\r\\nWHERE mc.inscricao_estadual = '0000000000000';\", \" -- << MODIFIQUE AQUI\\r\\n\\r\\n-- 3.2. DOSSI\\u00ca - HIST\\u00d3RICO DE COBRAN\\u00c7A E CONTATOS\\r\\nSELECT \\r\\n    '3.2. DOSSI\\u00ca - HIST\\u00d3RICO DE COBRAN\\u00c7A' AS consulta,\\r\\n    \\r\\n    mc.inscricao_estadual,\\r\\n    mc.razao_social,\\r\\n    \\r\\n    -- Datas Importantes\\r\\n    mc.data_inclusao_cobranca,\\r\\n    mc.data_limite_pagamento,\\r\\n    mc.data_ultima_transacao,\\r\\n    fm.dias_desde_inclusao_cobranca,\\r\\n    fm.faixa_idade_debito,\\r\\n    \\r\\n    -- Hist\\u00f3rico de Contatos\\r\\n    mc.qtd_total_contatos,\\r\\n    mc.qtd_tipos_contato_distintos,\\r\\n    mc.qtd_origens_contato,\\r\\n    mc.qtd_usuarios_contato,\\r\\n    \\r\\n    -- Respostas aos Contatos\\r\\n    mc.qtd_respostas_positivas,\\r\\n    mc.qtd_respostas_negativas,\\r\\n    mc.qtd_sem_resposta,\\r\\n    ROUND(mc.taxa_resposta_contatos * 100, 2) AS taxa_resposta_pct,\\r\\n    ROUND(fm.taxa_efetividade_contatos * 100, 2) AS taxa_efetividade_pct,\\r\\n    \\r\\n    -- Promessas de Pagamento\\r\\n    mc.qtd_promessas_pagamento,\\r\\n    mc.data_ultima_promessa,\\r\\n    ROUND(fm.taxa_promessas_contatos * 100, 2) AS taxa_promessas_pct,\\r\\n    \\r\\n    -- \\u00daltimo Contato\\r\\n    mc.data_ultimo_contato,\\r\\n    mc.dias_desde_ultimo_contato,\\r\\n    \\r\\n    -- NOVAS M\\u00c9TRICAS V1.5\\r\\n    mc.qtd_contatos_ultimos_30_dias,\\r\\n    mc.qtd_contatos_ultimos_90_dias,\\r\\n    \\r\\n    -- Perfil de Engajamento\\r\\n    fm.perfil_engajamento,\\r\\n    \\r\\n    -- Intensidade de Contato\\r\\n    ROUND(fm.intensidade_contato_mensal, 2) AS contatos_por_mes\\r\\n    \\r\\nFROM gecob.prior_master_consolidado mc\\r\\nJOIN gecob.prior_features_ml fm \\r\\n    ON mc.inscricao_estadual = fm.inscricao_estadual \\r\\n    AND mc.tipo_debito = fm.tipo_debito\\r\\nWHERE mc.inscricao_estadual = '0000000000000';\", \" -- << MODIFIQUE AQUI\\r\\n\\r\\n-- 3.3. DOSSI\\u00ca - AN\\u00c1LISE FINANCEIRA E CAPACIDADE\\r\\nSELECT \\r\\n    '3.3. DOSSI\\u00ca - AN\\u00c1LISE FINANCEIRA' AS consulta,\\r\\n    \\r\\n    mc.inscricao_estadual,\\r\\n    mc.razao_social,\\r\\n    \\r\\n    -- Faturamento e Atividade (\\u00faltimos 6 meses)\\r\\n    mc.faturamento_total_6m,\\r\\n    mc.faturamento_medio_6m,\\r\\n    mc.faturamento_desvio_6m,\\r\\n    mc.icms_devido_total_6m,\\r\\n    mc.icms_recolher_total_6m,\\r\\n    ROUND(mc.aliquota_efetiva_media_6m * 100, 2) AS aliquota_efetiva_pct,\\r\\n    \\r\\n    -- Declara\\u00e7\\u00f5es\\r\\n    mc.qtd_periodos_declarados_6m,\\r\\n    mc.qtd_periodos_omissos_6m,\\r\\n    mc.qtd_periodos_movimento_6m,\\r\\n    mc.regularidade_declaracoes,\\r\\n    mc.classificacao_omissao,\\r\\n    \\r\\n    -- Pagamentos\\r\\n    mc.qtd_periodos_pagamento_6m,\\r\\n    mc.qtd_pagamentos_6m,\\r\\n    mc.valor_total_pago_6m,\\r\\n    mc.valor_medio_pago_periodo,\\r\\n    mc.regularidade_pagamentos,\\r\\n    ROUND(mc.coef_variacao_pagamentos, 2) AS coef_variacao_pagamentos,\\r\\n    \\r\\n    -- Capacidade de Pagamento\\r\\n    ROUND(fm.capacidade_pagamento_estimada, 2) AS capacidade_pagamento_meses,\\r\\n    ROUND(fm.razao_debito_faturamento, 2) AS razao_debito_faturamento,\\r\\n    ROUND(fm.taxa_pagamento_vs_devido_6m * 100, 2) AS taxa_pagamento_vs_devido_pct,\\r\\n    \\r\\n    -- Al\\u00edquota e Conformidade\\r\\n    ROUND(fm.taxa_divergencia_devido_recolher * 100, 2) AS taxa_divergencia_pct,\\r\\n    ROUND(fm.coef_variacao_faturamento, 2) AS coef_variacao_faturamento,\\r\\n    ROUND(fm.score_compliance * 100, 2) AS score_compliance,\\r\\n    ROUND(fm.score_atividade_recente * 100, 2) AS score_atividade_recente\\r\\n    \\r\\nFROM gecob.prior_master_consolidado mc\\r\\nJOIN gecob.prior_features_ml fm \\r\\n    ON mc.inscricao_estadual = fm.inscricao_estadual \\r\\n    AND mc.tipo_debito = fm.tipo_debito\\r\\nWHERE mc.inscricao_estadual = '0000000000000';\", \" -- << MODIFIQUE AQUI\\r\\n\\r\\n-- 3.4. DOSSI\\u00ca - SITUA\\u00c7\\u00c3O DE RISCO E FLAGS\\r\\nSELECT \\r\\n    '3.4. DOSSI\\u00ca - SITUA\\u00c7\\u00c3O DE RISCO' AS consulta,\\r\\n    \\r\\n    mc.inscricao_estadual,\\r\\n    mc.razao_social,\\r\\n    mc.valor_total_devido,\\r\\n    \\r\\n    -- Flags de Risco Cr\\u00edtico\\r\\n    mc.flag_falencia,\\r\\n    mc.flag_recuperacao_judicial,\\r\\n    mc.flag_devedor_contumaz,\\r\\n    mc.flag_protesto,\\r\\n    mc.flag_com_garantia,\\r\\n    mc.flag_suspensao_dfe,\\r\\n    \\r\\n    -- Score de Risco Composto\\r\\n    fm.score_risco_situacao,\\r\\n    fm.score_situacao_cadastral,\\r\\n    \\r\\n    -- Score Noteiras\\r\\n    mc.score_noteiras,\\r\\n    mc.qtd_indicios_noteiras,\\r\\n    mc.qtd_tipos_indicios_noteiras,\\r\\n    mc.classificacao_risco_noteiras,\\r\\n    \\r\\n    -- Parcelamento\\r\\n    mc.flag_tem_parcelamento,\\r\\n    mc.numero_parcelamento,\\r\\n    mc.status_parcelamento_desc,\\r\\n    mc.saldo_parcelado,\\r\\n    mc.numero_parcelas,\\r\\n    mc.data_pedido_parcelamento,\\r\\n    fm.situacao_parcelamento,\\r\\n    ROUND(fm.proporcao_debito_parcelado * 100, 2) AS perc_debito_parcelado,\\r\\n    \\r\\n    -- Viabilidade\\r\\n    sp.score_viabilidade_cobranca,\\r\\n    \\r\\n    -- Complexidade Societ\\u00e1ria\\r\\n    fm.complexidade_societaria\\r\\n    \\r\\nFROM gecob.prior_master_consolidado mc\\r\\nJOIN gecob.prior_features_ml fm \\r\\n    ON mc.inscricao_estadual = fm.inscricao_estadual \\r\\n    AND mc.tipo_debito = fm.tipo_debito\\r\\nJOIN gecob.prior_score_priorizacao sp \\r\\n    ON mc.inscricao_estadual = sp.inscricao_estadual \\r\\n    AND mc.tipo_debito = sp.tipo_debito\\r\\nWHERE mc.inscricao_estadual = '0000000000000';\", \" -- << MODIFIQUE AQUI\\r\\n\\r\\n-- =================================================================================================\\r\\n-- SE\\u00c7\\u00c3O 4: AN\\u00c1LISES ESPECIALIZADAS E CEN\\u00c1RIOS ESPEC\\u00cdFICOS\\r\\n-- =================================================================================================\\r\\n\\r\\n-- 4.1. CASOS DE ALTA PRIORIDADE COM BOA CAPACIDADE DE PAGAMENTO\\r\\n-- Objetivo: Identificar os casos mais promissores para cobran\\u00e7a imediata\\r\\nSELECT \\r\\n    '4.1. ALTA PRIORIDADE + BOA CAPACIDADE' AS consulta,\\r\\n    \\r\\n    mc.inscricao_estadual,\\r\\n    mc.razao_social,\\r\\n    mc.valor_total_devido,\\r\\n    \\r\\n    -- Scores\\r\\n    sp.score_final_priorizacao,\\r\\n    sp.classificacao_prioridade,\\r\\n    sp.score_capacidade_pagamento,\\r\\n    \\r\\n    -- Capacidade Financeira\\r\\n    fm.capacidade_pagamento_estimada,\\r\\n    mc.faturamento_medio_6m,\\r\\n    mc.porte_por_faturamento,\\r\\n    ROUND(fm.razao_debito_faturamento, 2) AS razao_debito_faturamento,\\r\\n    \\r\\n    -- Hist\\u00f3rico de Compliance\\r\\n    mc.regularidade_pagamentos,\\r\\n    ROUND(fm.taxa_pagamento_vs_devido_6m * 100, 2) AS taxa_compliance_pct,\\r\\n    ROUND(fm.score_compliance * 100, 2) AS score_compliance,\\r\\n    \\r\\n    -- Situa\\u00e7\\u00e3o\\r\\n    mc.situacao_cadastral_desc,\\r\\n    mc.flag_falencia,\\r\\n    mc.flag_recuperacao_judicial,\\r\\n    \\r\\n    -- Contato\\r\\n    mc.qtd_total_contatos,\\r\\n    ROUND(mc.taxa_resposta_contatos * 100, 2) AS taxa_resposta_pct,\\r\\n    fm.perfil_engajamento,\\r\\n    \\r\\n    -- NOVAS M\\u00c9TRICAS V1.5\\r\\n    mc.qtd_contatos_ultimos_30_dias,\\r\\n    mc.qtd_contatos_ultimos_90_dias,\\r\\n    \\r\\n    -- A\\u00e7\\u00e3o Recomendada\\r\\n    CASE \\r\\n        WHEN fm.taxa_efetividade_contatos >= 0.5 THEN 'CONTATO_IMEDIATO_NEGOCIACAO'\\r\\n        WHEN mc.qtd_total_contatos < 3 THEN 'INTENSIFICAR_CONTATOS'\\r\\n        WHEN mc.flag_tem_parcelamento = 0 THEN 'OFERECER_PARCELAMENTO'\\r\\n        ELSE 'NEGOCIACAO_DESCONTO'\\r\\n    END AS acao_recomendada\\r\\n    \\r\\nFROM gecob.prior_master_consolidado mc\\r\\nJOIN gecob.prior_score_priorizacao sp \\r\\n    ON mc.inscricao_estadual = sp.inscricao_estadual \\r\\n    AND mc.tipo_debito = sp.tipo_debito\\r\\nJOIN gecob.prior_features_ml fm \\r\\n    ON mc.inscricao_estadual = fm.inscricao_estadual \\r\\n    AND mc.tipo_debito = fm.tipo_debito\\r\\nWHERE sp.classificacao_prioridade IN ('PRIORIDADE_MAXIMA', 'PRIORIDADE_ALTA')\\r\\n  AND fm.capacidade_pagamento_estimada >= 1.5  -- Pode pagar em at\\u00e9 2 meses\\r\\n  AND mc.situacao_cadastral_desc = 'ATIVO'\\r\\n  AND mc.flag_falencia = 0\\r\\n  AND mc.flag_recuperacao_judicial = 0\\r\\nORDER BY sp.score_final_priorizacao DESC, fm.capacidade_pagamento_estimada DESC\\r\\nLIMIT 100;\", \"\\r\\n\\r\\n-- 4.2. CASOS DE RECUPERA\\u00c7\\u00c3O P\\u00d3S-CONTATO\\r\\n-- Objetivo: Empresas que melhoraram comportamento ap\\u00f3s contatos\\r\\nSELECT \\r\\n    '4.2. CASOS DE RECUPERA\\u00c7\\u00c3O P\\u00d3S-CONTATO' AS consulta,\\r\\n    \\r\\n    mc.inscricao_estadual,\\r\\n    mc.razao_social,\\r\\n    mc.valor_total_devido,\\r\\n    sp.score_final_priorizacao,\\r\\n    \\r\\n    -- Hist\\u00f3rico de Contato Positivo\\r\\n    mc.qtd_total_contatos,\\r\\n    mc.qtd_respostas_positivas,\\r\\n    mc.qtd_promessas_pagamento,\\r\\n    ROUND(mc.taxa_resposta_contatos * 100, 2) AS taxa_resposta_pct,\\r\\n    ROUND(fm.taxa_efetividade_contatos * 100, 2) AS taxa_efetividade_pct,\\r\\n    \\r\\n    -- NOVAS M\\u00c9TRICAS V1.5\\r\\n    mc.qtd_contatos_ultimos_30_dias,\\r\\n    mc.qtd_contatos_ultimos_90_dias,\\r\\n    \\r\\n    -- Melhora no Comportamento\\r\\n    mc.qtd_periodos_pagamento_6m,\\r\\n    ROUND(fm.taxa_pagamento_vs_devido_6m * 100, 2) AS taxa_pagamento_recente_pct,\\r\\n    mc.regularidade_pagamentos,\\r\\n    \\r\\n    -- Declara\\u00e7\\u00f5es\\r\\n    mc.qtd_periodos_declarados_6m,\\r\\n    mc.regularidade_declaracoes,\\r\\n    \\r\\n    -- Perfil\\r\\n    fm.perfil_engajamento,\\r\\n    mc.porte_por_faturamento,\\r\\n    \\r\\n    -- \\u00daltima intera\\u00e7\\u00e3o\\r\\n    mc.data_ultimo_contato,\\r\\n    mc.data_ultima_promessa\\r\\n    \\r\\nFROM gecob.prior_master_consolidado mc\\r\\nJOIN gecob.prior_score_priorizacao sp \\r\\n    ON mc.inscricao_estadual = sp.inscricao_estadual \\r\\n    AND mc.tipo_debito = sp.tipo_debito\\r\\nJOIN gecob.prior_features_ml fm \\r\\n    ON mc.inscricao_estadual = fm.inscricao_estadual \\r\\n    AND mc.tipo_debito = fm.tipo_debito\\r\\nWHERE mc.qtd_respostas_positivas >= 2\\r\\n  AND mc.qtd_total_contatos >= 3\\r\\n  AND mc.taxa_resposta_contatos >= 0.4\\r\\n  AND mc.qtd_periodos_pagamento_6m >= 3\\r\\nORDER BY mc.taxa_resposta_contatos DESC, fm.taxa_pagamento_vs_devido_6m DESC\\r\\nLIMIT 50;\", \"\\r\\n\\r\\n-- 4.3. CASOS CR\\u00cdTICOS PARA DIVIDA ATIVA\\r\\n-- Objetivo: Identificar casos de baixa viabilidade para encaminhamento\\r\\nSELECT \\r\\n    '4.3. CASOS CR\\u00cdTICOS PARA D\\u00cdVIDA ATIVA' AS consulta,\\r\\n    \\r\\n    mc.inscricao_estadual,\\r\\n    mc.razao_social,\\r\\n    mc.valor_total_devido,\\r\\n    fm.dias_desde_inclusao_cobranca,\\r\\n    \\r\\n    -- Score baixo de viabilidade\\r\\n    sp.score_viabilidade_cobranca,\\r\\n    sp.score_final_priorizacao,\\r\\n    \\r\\n    -- Flags de Risco Grave\\r\\n    mc.flag_falencia,\\r\\n    mc.flag_recuperacao_judicial,\\r\\n    mc.flag_devedor_contumaz,\\r\\n    mc.situacao_cadastral_desc,\\r\\n    \\r\\n    -- Hist\\u00f3rico de N\\u00e3o-Resposta\\r\\n    mc.qtd_total_contatos,\\r\\n    mc.qtd_sem_resposta,\\r\\n    ROUND(mc.taxa_resposta_contatos * 100, 2) AS taxa_resposta_pct,\\r\\n    mc.dias_desde_ultimo_contato,\\r\\n    \\r\\n    -- Inatividade Fiscal\\r\\n    mc.qtd_periodos_declarados_6m,\\r\\n    mc.qtd_periodos_omissos_6m,\\r\\n    mc.classificacao_omissao,\\r\\n    \\r\\n    -- Score de Risco\\r\\n    fm.score_risco_situacao,\\r\\n    mc.classificacao_risco_noteiras,\\r\\n    \\r\\n    -- Motivo Principal\\r\\n    CASE \\r\\n        WHEN mc.flag_falencia = 1 THEN 'FAL\\u00caNCIA'\\r\\n        WHEN mc.flag_recuperacao_judicial = 1 THEN 'RECUPERA\\u00c7\\u00c3O JUDICIAL'\\r\\n        WHEN mc.situacao_cadastral_desc IN ('CANCELADO', 'BAIXADO', 'INAPTO') THEN 'INATIVO/INAPTO'\\r\\n        WHEN fm.dias_desde_inclusao_cobranca > 730 AND mc.qtd_total_contatos >= 10 AND mc.taxa_resposta_contatos < 0.2 THEN 'N\\u00c3O RESPONSIVO CR\\u00d4NICO'\\r\\n        WHEN mc.classificacao_omissao = 'OMISSO_RECORRENTE' THEN 'OMISS\\u00c3O RECORRENTE'\\r\\n        ELSE 'OUTROS'\\r\\n    END AS motivo_principal\\r\\n    \\r\\nFROM gecob.prior_master_consolidado mc\\r\\nJOIN gecob.prior_score_priorizacao sp \\r\\n    ON mc.inscricao_estadual = sp.inscricao_estadual \\r\\n    AND mc.tipo_debito = sp.tipo_debito\\r\\nJOIN gecob.prior_features_ml fm \\r\\n    ON mc.inscricao_estadual = fm.inscricao_estadual \\r\\n    AND mc.tipo_debito = fm.tipo_debito\\r\\nWHERE sp.score_viabilidade_cobranca < 40\\r\\n  OR mc.flag_falencia = 1\\r\\n  OR mc.flag_recuperacao_judicial = 1\\r\\n  OR (fm.dias_desde_inclusao_cobranca > 730 AND mc.qtd_total_contatos >= 10 AND mc.taxa_resposta_contatos < 0.2)\\r\\nORDER BY sp.score_viabilidade_cobranca ASC, mc.valor_total_devido DESC\\r\\nLIMIT 100;\", \"\\r\\n\\r\\n-- 4.4. AN\\u00c1LISE DE PARCELAMENTOS ATIVOS E INADIMPLENTES\\r\\n-- Objetivo: Monitorar a situa\\u00e7\\u00e3o dos parcelamentos\\r\\nSELECT \\r\\n    '4.4. AN\\u00c1LISE DE PARCELAMENTOS' AS consulta,\\r\\n    \\r\\n    mc.inscricao_estadual,\\r\\n    mc.razao_social,\\r\\n    mc.valor_total_devido,\\r\\n    \\r\\n    -- Parcelamento\\r\\n    mc.numero_parcelamento,\\r\\n    mc.status_parcelamento_desc,\\r\\n    mc.numero_parcelas,\\r\\n    mc.saldo_parcelado,\\r\\n    mc.saldo_imposto_parcelado,\\r\\n    mc.saldo_multa_parcelada,\\r\\n    mc.data_pedido_parcelamento,\\r\\n    \\r\\n    -- Situa\\u00e7\\u00e3o do Parcelamento\\r\\n    fm.situacao_parcelamento,\\r\\n    ROUND(fm.proporcao_debito_parcelado * 100, 2) AS perc_debito_parcelado,\\r\\n    fm.dias_desde_parcelamento,\\r\\n    \\r\\n    -- Score\\r\\n    sp.score_final_priorizacao,\\r\\n    sp.classificacao_prioridade,\\r\\n    \\r\\n    -- Capacidade\\r\\n    fm.capacidade_pagamento_estimada,\\r\\n    mc.faturamento_medio_6m,\\r\\n    \\r\\n    -- Compliance\\r\\n    mc.regularidade_pagamentos,\\r\\n    ROUND(fm.taxa_pagamento_vs_devido_6m * 100, 2) AS taxa_compliance_pct,\\r\\n    \\r\\n    -- Alertas\\r\\n    CASE \\r\\n        WHEN mc.status_parcelamento_desc = 'INADIMPLENTE' THEN 'ALERTA: Parcelamento Inadimplente'\\r\\n        WHEN fm.dias_desde_parcelamento > 180 AND mc.status_parcelamento_desc = 'ATIVO' THEN 'Parcelamento Longevo - Monitorar'\\r\\n        WHEN mc.status_parcelamento_desc = 'ATIVO' AND fm.capacidade_pagamento_estimada >= 3 THEN 'Oportunidade de Quita\\u00e7\\u00e3o Antecipada'\\r\\n        ELSE 'Normal'\\r\\n    END AS status_alerta\\r\\n    \\r\\nFROM gecob.prior_master_consolidado mc\\r\\nJOIN gecob.prior_score_priorizacao sp \\r\\n    ON mc.inscricao_estadual = sp.inscricao_estadual \\r\\n    AND mc.tipo_debito = sp.tipo_debito\\r\\nJOIN gecob.prior_features_ml fm \\r\\n    ON mc.inscricao_estadual = fm.inscricao_estadual \\r\\n    AND mc.tipo_debito = fm.tipo_debito\\r\\nWHERE mc.flag_tem_parcelamento = 1\\r\\nORDER BY \\r\\n    CASE mc.status_parcelamento_desc \\r\\n        WHEN 'INADIMPLENTE' THEN 1\\r\\n        WHEN 'ATIVO' THEN 2\\r\\n        ELSE 3 \\r\\n    END,\\r\\n    mc.saldo_parcelado DESC;\", \"\\r\\n\\r\\n-- 4.5. IMPACTO ARRECADAT\\u00d3RIO POTENCIAL POR SETOR\\r\\n-- Objetivo: Estimar o potencial de recupera\\u00e7\\u00e3o por setor econ\\u00f4mico\\r\\nSELECT \\r\\n    '4.5. IMPACTO ARRECADAT\\u00d3RIO POR SETOR' AS consulta,\\r\\n    \\r\\n    mc.secao_cnae,\\r\\n    mc.descricao_secao,\\r\\n    \\r\\n    -- Volume Total\\r\\n    COUNT(DISTINCT mc.inscricao_estadual) AS qtd_contribuintes,\\r\\n    SUM(mc.valor_total_devido) AS valor_total_setor,\\r\\n    \\r\\n    -- Alta Prioridade + Alta Capacidade (Potencial M\\u00e1ximo)\\r\\n    COUNT(CASE \\r\\n        WHEN sp.classificacao_prioridade IN ('PRIORIDADE_MAXIMA', 'PRIORIDADE_ALTA')\\r\\n        AND fm.capacidade_pagamento_estimada >= 1.5\\r\\n        AND mc.situacao_cadastral_desc = 'ATIVO'\\r\\n        AND mc.flag_falencia = 0\\r\\n        THEN 1 \\r\\n    END) AS casos_alta_recuperabilidade,\\r\\n    \\r\\n    SUM(CASE \\r\\n        WHEN sp.classificacao_prioridade IN ('PRIORIDADE_MAXIMA', 'PRIORIDADE_ALTA')\\r\\n        AND fm.capacidade_pagamento_estimada >= 1.5\\r\\n        AND mc.situacao_cadastral_desc = 'ATIVO'\\r\\n        AND mc.flag_falencia = 0\\r\\n        THEN mc.valor_total_devido\\r\\n        ELSE 0 \\r\\n    END) AS valor_alta_recuperabilidade,\\r\\n    \\r\\n    -- Taxa de Recuperabilidade Estimada\\r\\n    ROUND(SUM(CASE \\r\\n        WHEN sp.classificacao_prioridade IN ('PRIORIDADE_MAXIMA', 'PRIORIDADE_ALTA')\\r\\n        AND fm.capacidade_pagamento_estimada >= 1.5\\r\\n        AND mc.situacao_cadastral_desc = 'ATIVO'\\r\\n        AND mc.flag_falencia = 0\\r\\n        THEN mc.valor_total_devido\\r\\n        ELSE 0 \\r\\n    END) * 100.0 / NULLIF(SUM(mc.valor_total_devido), 0), 2) AS perc_recuperabilidade,\\r\\n    \\r\\n    -- Compliance M\\u00e9dio do Setor\\r\\n    ROUND(AVG(fm.taxa_pagamento_vs_devido_6m) * 100, 2) AS taxa_compliance_media_pct,\\r\\n    ROUND(AVG(sp.score_final_priorizacao), 2) AS score_medio_setor\\r\\n    \\r\\nFROM gecob.prior_master_consolidado mc\\r\\nJOIN gecob.prior_score_priorizacao sp \\r\\n    ON mc.inscricao_estadual = sp.inscricao_estadual \\r\\n    AND mc.tipo_debito = sp.tipo_debito\\r\\nJOIN gecob.prior_features_ml fm \\r\\n    ON mc.inscricao_estadual = fm.inscricao_estadual \\r\\n    AND mc.tipo_debito = fm.tipo_debito\\r\\nWHERE mc.secao_cnae IS NOT NULL\\r\\nGROUP BY mc.secao_cnae, mc.descricao_secao\\r\\nHAVING COUNT(DISTINCT mc.inscricao_estadual) >= 5\\r\\nORDER BY valor_alta_recuperabilidade DESC\\r\\nLIMIT 30;\", \"\\r\\n\\r\\n-- =================================================================================================\\r\\n-- SE\\u00c7\\u00c3O 5: DASHBOARD EXECUTIVO E KPIs\\r\\n-- =================================================================================================\\r\\n\\r\\n-- 5.1. DASHBOARD EXECUTIVO - INDICADORES PRINCIPAIS\\r\\nSELECT \\r\\n    'DASHBOARD EXECUTIVO - KPIS PRINCIPAIS' AS consulta,\\r\\n    \\r\\n    -- M\\u00e9tricas de Volume\\r\\n    COUNT(DISTINCT mc.inscricao_estadual) AS total_contribuintes,\\r\\n    SUM(mc.valor_total_devido) AS divida_total,\\r\\n    ROUND(AVG(mc.valor_total_devido), 2) AS divida_media,\\r\\n    \\r\\n    -- Distribui\\u00e7\\u00e3o de Prioridade\\r\\n    COUNT(CASE WHEN sp.classificacao_prioridade = 'PRIORIDADE_MAXIMA' THEN 1 END) AS qtd_prioridade_maxima,\\r\\n    COUNT(CASE WHEN sp.classificacao_prioridade = 'PRIORIDADE_ALTA' THEN 1 END) AS qtd_prioridade_alta,\\r\\n    COUNT(CASE WHEN sp.classificacao_prioridade = 'PRIORIDADE_MEDIA' THEN 1 END) AS qtd_prioridade_media,\\r\\n    \\r\\n    SUM(CASE WHEN sp.classificacao_prioridade = 'PRIORIDADE_MAXIMA' THEN mc.valor_total_devido ELSE 0 END) AS valor_prioridade_maxima,\\r\\n    SUM(CASE WHEN sp.classificacao_prioridade = 'PRIORIDADE_ALTA' THEN mc.valor_total_devido ELSE 0 END) AS valor_prioridade_alta,\\r\\n    \\r\\n    -- Potencial de Recupera\\u00e7\\u00e3o\\r\\n    COUNT(CASE \\r\\n        WHEN sp.classificacao_prioridade IN ('PRIORIDADE_MAXIMA', 'PRIORIDADE_ALTA')\\r\\n        AND fm.capacidade_pagamento_estimada >= 1.5\\r\\n        AND mc.situacao_cadastral_desc = 'ATIVO'\\r\\n        AND mc.flag_falencia = 0\\r\\n        THEN 1 \\r\\n    END) AS casos_alta_recuperabilidade,\\r\\n    \\r\\n    SUM(CASE \\r\\n        WHEN sp.classificacao_prioridade IN ('PRIORIDADE_MAXIMA', 'PRIORIDADE_ALTA')\\r\\n        AND fm.capacidade_pagamento_estimada >= 1.5\\r\\n        AND mc.situacao_cadastral_desc = 'ATIVO'\\r\\n        AND mc.flag_falencia = 0\\r\\n        THEN mc.valor_total_devido\\r\\n        ELSE 0 \\r\\n    END) AS valor_alta_recuperabilidade,\\r\\n    \\r\\n    -- Taxa de Contato e Resposta\\r\\n    ROUND(AVG(mc.taxa_resposta_contatos) * 100, 2) AS taxa_resposta_media_pct,\\r\\n    ROUND(AVG(mc.qtd_total_contatos), 2) AS media_contatos_por_ie,\\r\\n    \\r\\n    -- NOVAS M\\u00c9TRICAS V1.5\\r\\n    ROUND(AVG(mc.qtd_contatos_ultimos_30_dias), 2) AS media_contatos_30d,\\r\\n    ROUND(AVG(mc.qtd_contatos_ultimos_90_dias), 2) AS media_contatos_90d,\\r\\n    \\r\\n    -- Compliance\\r\\n    ROUND(AVG(fm.taxa_pagamento_vs_devido_6m) * 100, 2) AS taxa_compliance_media_pct,\\r\\n    \\r\\n    -- Casos Cr\\u00edticos\\r\\n    COUNT(CASE WHEN mc.flag_falencia = 1 THEN 1 END) AS casos_falencia,\\r\\n    COUNT(CASE WHEN mc.flag_recuperacao_judicial = 1 THEN 1 END) AS casos_recuperacao_judicial,\\r\\n    COUNT(CASE WHEN sp.score_viabilidade_cobranca < 40 THEN 1 END) AS casos_baixa_viabilidade,\\r\\n    \\r\\n    -- Timestamp\\r\\n    FROM_UNIXTIME(UNIX_TIMESTAMP()) AS data_atualizacao\\r\\n    \\r\\nFROM gecob.prior_master_consolidado mc\\r\\nJOIN gecob.prior_score_priorizacao sp \\r\\n    ON mc.inscricao_estadual = sp.inscricao_estadual \\r\\n    AND mc.tipo_debito = sp.tipo_debito\\r\\nJOIN gecob.prior_features_ml fm \\r\\n    ON mc.inscricao_estadual = fm.inscricao_estadual \\r\\n    AND mc.tipo_debito = fm.tipo_debito;\"], \"aceSize\": 100, \"status\": \"available\", \"statusForButtons\": \"executed\", \"properties\": {\"settings\": []}, \"viewSettings\": {\"placeHolder\": \"Exemplo: SELECT * FROM tablename ou pressione CTRL + espa\\u00e7o\", \"sqlDialect\": true}, \"variables\": [], \"hasCurlyBracketParameters\": true, \"variableNames\": [], \"variableValues\": {}, \"statement\": \"\\r\\n\\r\\n-- 4.4. AN\\u00c1LISE DE PARCELAMENTOS ATIVOS E INADIMPLENTES\\r\\n-- Objetivo: Monitorar a situa\\u00e7\\u00e3o dos parcelamentos\\r\\nSELECT \\r\\n    '4.4. AN\\u00c1LISE DE PARCELAMENTOS' AS consulta,\\r\\n    \\r\\n    mc.inscricao_estadual,\\r\\n    mc.razao_social,\\r\\n    mc.valor_total_devido,\\r\\n    \\r\\n    -- Parcelamento\\r\\n    mc.numero_parcelamento,\\r\\n    mc.status_parcelamento_desc,\\r\\n    mc.numero_parcelas,\\r\\n    mc.saldo_parcelado,\\r\\n    mc.saldo_imposto_parcelado,\\r\\n    mc.saldo_multa_parcelada,\\r\\n    mc.data_pedido_parcelamento,\\r\\n    \\r\\n    -- Situa\\u00e7\\u00e3o do Parcelamento\\r\\n    fm.situacao_parcelamento,\\r\\n    ROUND(fm.proporcao_debito_parcelado * 100, 2) AS perc_debito_parcelado,\\r\\n    fm.dias_desde_parcelamento,\\r\\n    \\r\\n    -- Score\\r\\n    sp.score_final_priorizacao,\\r\\n    sp.classificacao_prioridade,\\r\\n    \\r\\n    -- Capacidade\\r\\n    fm.capacidade_pagamento_estimada,\\r\\n    mc.faturamento_medio_6m,\\r\\n    \\r\\n    -- Compliance\\r\\n    mc.regularidade_pagamentos,\\r\\n    ROUND(fm.taxa_pagamento_vs_devido_6m * 100, 2) AS taxa_compliance_pct,\\r\\n    \\r\\n    -- Alertas\\r\\n    CASE \\r\\n        WHEN mc.status_parcelamento_desc = 'INADIMPLENTE' THEN 'ALERTA: Parcelamento Inadimplente'\\r\\n        WHEN fm.dias_desde_parcelamento > 180 AND mc.status_parcelamento_desc = 'ATIVO' THEN 'Parcelamento Longevo - Monitorar'\\r\\n        WHEN mc.status_parcelamento_desc = 'ATIVO' AND fm.capacidade_pagamento_estimada >= 3 THEN 'Oportunidade de Quita\\u00e7\\u00e3o Antecipada'\\r\\n        ELSE 'Normal'\\r\\n    END AS status_alerta\\r\\n    \\r\\nFROM gecob.prior_master_consolidado mc\\r\\nJOIN gecob.prior_score_priorizacao sp \\r\\n    ON mc.inscricao_estadual = sp.inscricao_estadual \\r\\n    AND mc.tipo_debito = sp.tipo_debito\\r\\nJOIN gecob.prior_features_ml fm \\r\\n    ON mc.inscricao_estadual = fm.inscricao_estadual \\r\\n    AND mc.tipo_debito = fm.tipo_debito\\r\\nWHERE mc.flag_tem_parcelamento = 1\\r\\nORDER BY \\r\\n    CASE mc.status_parcelamento_desc \\r\\n        WHEN 'INADIMPLENTE' THEN 1\\r\\n        WHEN 'ATIVO' THEN 2\\r\\n        ELSE 3 \\r\\n    END,\\r\\n    mc.saldo_parcelado DESC;\", \"result\": {\"id\": \"9536b3cc-7066-429b-ca99-76cd4ef6e776\", \"type\": \"table\", \"hasResultset\": true, \"handle\": {\"secret\": \"Wwa74HBNQ6aRRPI+3Bi7Jw==\", \"guid\": \"d8pcalhdSxsAAAAAZpJ5CQ==\", \"operation_type\": 0, \"has_result_set\": true, \"modified_row_count\": null, \"log_context\": null, \"session_guid\": \"e7482dbeae065c4b:21b20ad37e7898a0\", \"session_id\": 21363, \"session_type\": \"impala\", \"statement_id\": 0, \"has_more_statements\": false, \"statements_count\": 1, \"previous_statement_hash\": \"3f9d5ae6b4e1358d1e3fdce5bf3953f09e1b6b62e64d5966e8eb60fd\", \"start\": {\"row\": 0, \"column\": 0}, \"end\": {\"row\": 0, \"column\": 1954}, \"statement\": \"-- 4.4. AN\\u00c1LISE DE PARCELAMENTOS ATIVOS E INADIMPLENTES\\r\\n-- Objetivo: Monitorar a situa\\u00e7\\u00e3o dos parcelamentos\\r\\nSELECT \\r\\n    '4.4. AN\\u00c1LISE DE PARCELAMENTOS' AS consulta,\\r\\n    \\r\\n    mc.inscricao_estadual,\\r\\n    mc.razao_social,\\r\\n    mc.valor_total_devido,\\r\\n    \\r\\n    -- Parcelamento\\r\\n    mc.numero_parcelamento,\\r\\n    mc.status_parcelamento_desc,\\r\\n    mc.numero_parcelas,\\r\\n    mc.saldo_parcelado,\\r\\n    mc.saldo_imposto_parcelado,\\r\\n    mc.saldo_multa_parcelada,\\r\\n    mc.data_pedido_parcelamento,\\r\\n    \\r\\n    -- Situa\\u00e7\\u00e3o do Parcelamento\\r\\n    fm.situacao_parcelamento,\\r\\n    ROUND(fm.proporcao_debito_parcelado * 100, 2) AS perc_debito_parcelado,\\r\\n    fm.dias_desde_parcelamento,\\r\\n    \\r\\n    -- Score\\r\\n    sp.score_final_priorizacao,\\r\\n    sp.classificacao_prioridade,\\r\\n    \\r\\n    -- Capacidade\\r\\n    fm.capacidade_pagamento_estimada,\\r\\n    mc.faturamento_medio_6m,\\r\\n    \\r\\n    -- Compliance\\r\\n    mc.regularidade_pagamentos,\\r\\n    ROUND(fm.taxa_pagamento_vs_devido_6m * 100, 2) AS taxa_compliance_pct,\\r\\n    \\r\\n    -- Alertas\\r\\n    CASE \\r\\n        WHEN mc.status_parcelamento_desc = 'INADIMPLENTE' THEN 'ALERTA: Parcelamento Inadimplente'\\r\\n        WHEN fm.dias_desde_parcelamento > 180 AND mc.status_parcelamento_desc = 'ATIVO' THEN 'Parcelamento Longevo - Monitorar'\\r\\n        WHEN mc.status_parcelamento_desc = 'ATIVO' AND fm.capacidade_pagamento_estimada >= 3 THEN 'Oportunidade de Quita\\u00e7\\u00e3o Antecipada'\\r\\n        ELSE 'Normal'\\r\\n    END AS status_alerta\\r\\n    \\r\\nFROM gecob.prior_master_consolidado mc\\r\\nJOIN gecob.prior_score_priorizacao sp \\r\\n    ON mc.inscricao_estadual = sp.inscricao_estadual \\r\\n    AND mc.tipo_debito = sp.tipo_debito\\r\\nJOIN gecob.prior_features_ml fm \\r\\n    ON mc.inscricao_estadual = fm.inscricao_estadual \\r\\n    AND mc.tipo_debito = fm.tipo_debito\\r\\nWHERE mc.flag_tem_parcelamento = 1\\r\\nORDER BY \\r\\n    CASE mc.status_parcelamento_desc \\r\\n        WHEN 'INADIMPLENTE' THEN 1\\r\\n        WHEN 'ATIVO' THEN 2\\r\\n        ELSE 3 \\r\\n    END,\\r\\n    mc.saldo_parcelado DESC\"}, \"meta\": [], \"rows\": 8360, \"hasMore\": true, \"statement_id\": 0, \"statement_range\": {\"start\": {\"row\": 0, \"column\": 0}, \"end\": {\"row\": 0, \"column\": 0}}, \"statements_count\": 1, \"metaFilter\": {\"query\": \"\", \"facets\": {}, \"text\": []}, \"isMetaFilterVisible\": false, \"filteredMetaChecked\": true, \"filteredColumnCount\": 21, \"filteredMeta\": [{\"type\": \"int\", \"name\": \"\", \"comment\": null, \"cssClass\": \"sort-numeric\", \"checked\": true, \"originalIndex\": 0}, {\"name\": \"consulta\", \"type\": \"string\", \"comment\": null, \"cssClass\": \"sort-string\", \"checked\": true, \"originalIndex\": 1}, {\"name\": \"inscricao_estadual\", \"type\": \"string\", \"comment\": null, \"cssClass\": \"sort-string\", \"checked\": true, \"originalIndex\": 2}, {\"name\": \"razao_social\", \"type\": \"string\", \"comment\": null, \"cssClass\": \"sort-string\", \"checked\": true, \"originalIndex\": 3}, {\"name\": \"valor_total_devido\", \"type\": \"decimal\", \"comment\": null, \"cssClass\": \"sort-numeric\", \"checked\": true, \"originalIndex\": 4}, {\"name\": \"numero_parcelamento\", \"type\": \"bigint\", \"comment\": null, \"cssClass\": \"sort-numeric\", \"checked\": true, \"originalIndex\": 5}, {\"name\": \"status_parcelamento_desc\", \"type\": \"string\", \"comment\": null, \"cssClass\": \"sort-string\", \"checked\": true, \"originalIndex\": 6}, {\"name\": \"numero_parcelas\", \"type\": \"smallint\", \"comment\": null, \"cssClass\": \"sort-numeric\", \"checked\": true, \"originalIndex\": 7}, {\"name\": \"saldo_parcelado\", \"type\": \"decimal\", \"comment\": null, \"cssClass\": \"sort-numeric\", \"checked\": true, \"originalIndex\": 8}, {\"name\": \"saldo_imposto_parcelado\", \"type\": \"decimal\", \"comment\": null, \"cssClass\": \"sort-numeric\", \"checked\": true, \"originalIndex\": 9}, {\"name\": \"saldo_multa_parcelada\", \"type\": \"decimal\", \"comment\": null, \"cssClass\": \"sort-numeric\", \"checked\": true, \"originalIndex\": 10}, {\"name\": \"data_pedido_parcelamento\", \"type\": \"timestamp\", \"comment\": null, \"cssClass\": \"sort-date\", \"checked\": true, \"originalIndex\": 11}, {\"name\": \"situacao_parcelamento\", \"type\": \"string\", \"comment\": null, \"cssClass\": \"sort-string\", \"checked\": true, \"originalIndex\": 12}, {\"name\": \"perc_debito_parcelado\", \"type\": \"decimal\", \"comment\": null, \"cssClass\": \"sort-numeric\", \"checked\": true, \"originalIndex\": 13}, {\"name\": \"dias_desde_parcelamento\", \"type\": \"int\", \"comment\": null, \"cssClass\": \"sort-numeric\", \"checked\": true, \"originalIndex\": 14}, {\"name\": \"score_final_priorizacao\", \"type\": \"decimal\", \"comment\": null, \"cssClass\": \"sort-numeric\", \"checked\": true, \"originalIndex\": 15}, {\"name\": \"classificacao_prioridade\", \"type\": \"string\", \"comment\": null, \"cssClass\": \"sort-string\", \"checked\": true, \"originalIndex\": 16}, {\"name\": \"capacidade_pagamento_estimada\", \"type\": \"decimal\", \"comment\": null, \"cssClass\": \"sort-numeric\", \"checked\": true, \"originalIndex\": 17}, {\"name\": \"faturamento_medio_6m\", \"type\": \"decimal\", \"comment\": null, \"cssClass\": \"sort-numeric\", \"checked\": true, \"originalIndex\": 18}, {\"name\": \"regularidade_pagamentos\", \"type\": \"string\", \"comment\": null, \"cssClass\": \"sort-string\", \"checked\": true, \"originalIndex\": 19}, {\"name\": \"taxa_compliance_pct\", \"type\": \"decimal\", \"comment\": null, \"cssClass\": \"sort-numeric\", \"checked\": true, \"originalIndex\": 20}, {\"name\": \"status_alerta\", \"type\": \"string\", \"comment\": null, \"cssClass\": \"sort-string\", \"checked\": true, \"originalIndex\": 21}], \"fetchedOnce\": false, \"startTime\": \"2025-10-09T17:48:06.256Z\", \"endTime\": \"2025-10-09T17:48:07.618Z\", \"executionTime\": 1362, \"data\": [], \"explanation\": \"\", \"logs\": \"\", \"logLines\": 3, \"hasSomeResults\": true}, \"showGrid\": true, \"showChart\": false, \"showLogs\": true, \"progress\": 0, \"jobs\": [], \"executeNextTimeout\": 12319, \"isLoading\": false, \"resultsKlass\": \"results impala\", \"errorsKlass\": \"results impala alert alert-error\", \"is_redacted\": false, \"chartType\": \"bars\", \"chartSorting\": \"none\", \"chartScatterGroup\": null, \"chartScatterSize\": null, \"chartScope\": \"world\", \"chartTimelineType\": \"bar\", \"chartLimits\": [5, 10, 25, 50, 100], \"chartLimit\": null, \"chartX\": \"consulta\", \"chartXPivot\": null, \"chartYSingle\": null, \"chartYMulti\": [\"numero_parcelamento\"], \"chartData\": [], \"chartMapType\": \"marker\", \"chartMapLabel\": null, \"chartMapHeat\": null, \"hideStacked\": true, \"hasDataForChart\": true, \"previousChartOptions\": {\"chartLimit\": null, \"chartX\": null, \"chartXPivot\": null, \"chartYSingle\": null, \"chartMapType\": \"marker\", \"chartMapLabel\": null, \"chartMapHeat\": null, \"chartYMulti\": [], \"chartScope\": \"world\", \"chartTimelineType\": \"bar\", \"chartSorting\": \"none\", \"chartScatterGroup\": null, \"chartScatterSize\": null}, \"isResultSettingsVisible\": false, \"settingsVisible\": false, \"checkStatusTimeout\": 17241, \"getLogsTimeout\": 17318, \"topRisk\": null, \"suggestion\": \"\", \"hasSuggestion\": null, \"compatibilityCheckRunning\": false, \"compatibilitySourcePlatforms\": [{\"name\": \"Teradata\", \"value\": \"teradata\"}, {\"name\": \"Oracle\", \"value\": \"oracle\"}, {\"name\": \"Netezza\", \"value\": \"netezza\"}, {\"name\": \"Impala\", \"value\": \"impala\"}, {\"name\": \"Hive\", \"value\": \"hive\"}, {\"name\": \"DB2\", \"value\": \"db2\"}, {\"name\": \"Greenplum\", \"value\": \"greenplum\"}, {\"name\": \"MySQL\", \"value\": \"mysql\"}, {\"name\": \"PostgreSQL\", \"value\": \"postgresql\"}, {\"name\": \"Informix\", \"value\": \"informix\"}, {\"name\": \"SQL Server\", \"value\": \"sqlserver\"}, {\"name\": \"Sybase\", \"value\": \"sybase\"}, {\"name\": \"Access\", \"value\": \"access\"}, {\"name\": \"Firebird\", \"value\": \"firebird\"}, {\"name\": \"ANSISQL\", \"value\": \"ansisql\"}, {\"name\": \"Generic\", \"value\": \"generic\"}], \"compatibilitySourcePlatform\": {\"name\": \"Impala\", \"value\": \"impala\"}, \"compatibilityTargetPlatforms\": [{\"name\": \"Impala\", \"value\": \"impala\"}, {\"name\": \"Hive\", \"value\": \"hive\"}], \"compatibilityTargetPlatform\": {\"name\": \"Impala\", \"value\": \"impala\"}, \"showSqlAnalyzer\": false, \"wasBatchExecuted\": false, \"isReady\": true, \"lastExecuted\": 1760032086022, \"lastAceSelectionRowOffset\": 1002, \"executingBlockingOperation\": null, \"showLongOperationWarning\": false, \"lastExecutedStatements\": \"\\r\\n\\r\\n-- 4.4. AN\\u00c1LISE DE PARCELAMENTOS ATIVOS E INADIMPLENTES\\r\\n-- Objetivo: Monitorar a situa\\u00e7\\u00e3o dos parcelamentos\\r\\nSELECT \\r\\n    '4.4. AN\\u00c1LISE DE PARCELAMENTOS' AS consulta,\\r\\n    \\r\\n    mc.inscricao_estadual,\\r\\n    mc.razao_social,\\r\\n    mc.valor_total_devido,\\r\\n    \\r\\n    -- Parcelamento\\r\\n    mc.numero_parcelamento,\\r\\n    mc.status_parcelamento_desc,\\r\\n    mc.numero_parcelas,\\r\\n    mc.saldo_parcelado,\\r\\n    mc.saldo_imposto_parcelado,\\r\\n    mc.saldo_multa_parcelada,\\r\\n    mc.data_pedido_parcelamento,\\r\\n    \\r\\n    -- Situa\\u00e7\\u00e3o do Parcelamento\\r\\n    fm.situacao_parcelamento,\\r\\n    ROUND(fm.proporcao_debito_parcelado * 100, 2) AS perc_debito_parcelado,\\r\\n    fm.dias_desde_parcelamento,\\r\\n    \\r\\n    -- Score\\r\\n    sp.score_final_priorizacao,\\r\\n    sp.classificacao_prioridade,\\r\\n    \\r\\n    -- Capacidade\\r\\n    fm.capacidade_pagamento_estimada,\\r\\n    mc.faturamento_medio_6m,\\r\\n    \\r\\n    -- Compliance\\r\\n    mc.regularidade_pagamentos,\\r\\n    ROUND(fm.taxa_pagamento_vs_devido_6m * 100, 2) AS taxa_compliance_pct,\\r\\n    \\r\\n    -- Alertas\\r\\n    CASE \\r\\n        WHEN mc.status_parcelamento_desc = 'INADIMPLENTE' THEN 'ALERTA: Parcelamento Inadimplente'\\r\\n        WHEN fm.dias_desde_parcelamento > 180 AND mc.status_parcelamento_desc = 'ATIVO' THEN 'Parcelamento Longevo - Monitorar'\\r\\n        WHEN mc.status_parcelamento_desc = 'ATIVO' AND fm.capacidade_pagamento_estimada >= 3 THEN 'Oportunidade de Quita\\u00e7\\u00e3o Antecipada'\\r\\n        ELSE 'Normal'\\r\\n    END AS status_alerta\\r\\n    \\r\\nFROM gecob.prior_master_consolidado mc\\r\\nJOIN gecob.prior_score_priorizacao sp \\r\\n    ON mc.inscricao_estadual = sp.inscricao_estadual \\r\\n    AND mc.tipo_debito = sp.tipo_debito\\r\\nJOIN gecob.prior_features_ml fm \\r\\n    ON mc.inscricao_estadual = fm.inscricao_estadual \\r\\n    AND mc.tipo_debito = fm.tipo_debito\\r\\nWHERE mc.flag_tem_parcelamento = 1\\r\\nORDER BY \\r\\n    CASE mc.status_parcelamento_desc \\r\\n        WHEN 'INADIMPLENTE' THEN 1\\r\\n        WHEN 'ATIVO' THEN 2\\r\\n        ELSE 3 \\r\\n    END,\\r\\n    mc.saldo_parcelado DESC;\", \"lastExecutedSelectionRange\": {\"start\": {\"row\": 1002, \"column\": 0}, \"end\": {\"row\": 1002, \"column\": 0}}, \"formatEnabled\": true, \"isFetchingData\": false, \"isCanceling\": false, \"aceAutoExpand\": false, \"lastCheckStatusRequest\": {\"readyState\": 4, \"responseText\": \"{\\\"status\\\": 0, \\\"query_status\\\": {\\\"status\\\": \\\"available\\\"}}\", \"responseJSON\": {\"status\": 0, \"query_status\": {\"status\": \"available\"}}, \"status\": 200, \"statusText\": \"OK\"}, \"lastGetLogsRequest\": {\"readyState\": 4, \"responseText\": \"{\\\"status\\\": 0, \\\"logs\\\": \\\"Query 1b4b5d586a5cca77:0979926600000000: 85% Complete (17 out of 20)\\\", \\\"progress\\\": 100, \\\"jobs\\\": [{\\\"name\\\": \\\"1b4b5d586a5cca77:0979926600000000\\\", \\\"url\\\": \\\"/hue/jobbrowser#!id=1b4b5d586a5cca77:0979926600000000\\\", \\\"started\\\": true, \\\"finished\\\": false, \\\"percentJob\\\": 100}], \\\"isFullLogs\\\": false}\", \"responseJSON\": {\"status\": 0, \"logs\": \"Query 1b4b5d586a5cca77:0979926600000000: 85% Complete (17 out of 20)\", \"progress\": 100, \"jobs\": [{\"name\": \"1b4b5d586a5cca77:0979926600000000\", \"url\": \"/hue/jobbrowser#!id=1b4b5d586a5cca77:0979926600000000\", \"started\": true, \"finished\": false, \"percentJob\": 100}], \"isFullLogs\": false}, \"status\": 200, \"statusText\": \"OK\"}}], \"selectedSnippet\": \"impala\", \"creatingSessionLocks\": [], \"sessions\": [], \"directoryUuid\": \"\", \"dependentsCoordinator\": [], \"historyFilter\": \"\", \"historyFilterVisible\": false, \"loadingHistory\": false, \"historyInitialHeight\": 13151, \"forceHistoryInitialHeight\": false, \"historyCurrentPage\": 1, \"historyTotalPages\": 112, \"schedulerViewModel\": null, \"schedulerViewModelIsLoaded\": false, \"isBatchable\": true, \"isExecutingAll\": false, \"executingAllIndex\": 0, \"retryModalConfirm\": null, \"retryModalCancel\": null, \"canSave\": true, \"unloaded\": false, \"updateHistoryFailed\": false, \"viewSchedulerId\": \"\", \"loadingScheduler\": false}",
    "extra": "",
    "search": "/***************************************************************************************************\r\n * =================================================================================================\r\n * SISTEMA DE PRIORIZAÃ‡ÃƒO DE COBRANÃ‡A - CONSULTAS ANALÃTICAS COMPLETAS V4\r\n * Receita Estadual de Santa Catarina - GECOB\r\n * =================================================================================================\r\n *\r\n * DESCRIÃ‡ÃƒO:\r\n * Este script contÃ©m um conjunto completo de consultas prontas para anÃ¡lise do sistema de\r\n * priorizaÃ§Ã£o de cobranÃ§a, incluindo estatÃ­sticas gerais, rankings, anÃ¡lises setoriais e\r\n * dossiÃªs detalhados de contribuintes.\r\n *\r\n * COMPATIBILIDADE: V1.5 do Sistema GECOB\r\n * - CompatÃ­vel com prÃ©-agregaÃ§Ã£o de conta corrente\r\n * - Inclui novas mÃ©tricas de contatos (30/90 dias)\r\n * - JOINs otimizados incluindo tipo_debito\r\n *\r\n * COMO USAR:\r\n * 1. Para dossiÃªs de contribuintes especÃ­ficos, modifique a inscriÃ§Ã£o estadual na clÃ¡usula WHERE\r\n * 2. Execute o script completo ou consultas individuais conforme necessidade\r\n * 3. Ajuste os limites (LIMIT) conforme sua anÃ¡lise\r\n *\r\n * DATA DE ATUALIZAÃ‡ÃƒO: 09 de Outubro de 2025\r\n ***************************************************************************************************/\r\n\r\n-- =================================================================================================\r\n-- CONFIGURAÃ‡ÃƒO DE AMBIENTE\r\n-- =================================================================================================\r\nSET REQUEST_POOL = 'medium';\r\nSET MEM_LIMIT = 8G;\r\n\r\n-- =================================================================================================\r\n-- SEÃ‡ÃƒO 1: ESTATÃSTICAS GERAIS DO SISTEMA (VISÃƒO MACRO)\r\n-- =================================================================================================\r\n\r\n-- 1.1. PANORAMA GERAL DO SISTEMA DE COBRANÃ‡A\r\n-- Objetivo: VisÃ£o executiva consolidada do sistema de priorizaÃ§Ã£o\r\nSELECT \r\n    '1.1. PANORAMA GERAL DO SISTEMA' AS consulta,\r",
    "last_modified": "2025-10-09T14:48:11.592",
    "version": 1,
    "is_history": false,
    "is_managed": false,
    "is_trashed": false,
    "parent_directory": [
      "13addfc5-7ea3-4f33-bd07-f3b8ce8c58f9",
      1,
      false
    ],
    "dependencies": []
  }
},
{
  "model": "desktop.document2",
  "pk": 160946,
  "fields": {
    "owner": [
      "tsevero"
    ],
    "name": "PRIOR. COBR: Analises 2",
    "description": "",
    "uuid": "3fa552b7-4a6c-921f-5c85-7862f09ef0ae",
    "type": "query-impala",
    "connector": null,
    "data": "{\"id\": 160946, \"uuid\": \"7a5b19a1-5459-46cb-b1b8-8d069a6abb40\", \"name\": \"PRIOR. COBR: Analises 2\", \"description\": \"\", \"type\": \"query-impala\", \"initialType\": \"impala\", \"coordinatorUuid\": null, \"isHistory\": false, \"isManaged\": false, \"parentSavedQueryUuid\": \"3fa552b7-4a6c-921f-5c85-7862f09ef0ae\", \"isSaved\": true, \"onSuccessUrl\": null, \"pubSubUrl\": null, \"isPresentationModeDefault\": false, \"isPresentationMode\": false, \"isPresentationModeInitialized\": true, \"presentationSnippets\": {}, \"isHidingCode\": false, \"snippets\": [{\"id\": \"747534c1-86aa-15d7-665c-6dc8b4491b93\", \"name\": \"\", \"type\": \"impala\", \"connector\": {\"name\": \"Impala\", \"type\": \"impala\", \"id\": \"impala\", \"displayName\": \"Impala\", \"buttonName\": \"Consulta\", \"tooltip\": \"Impala Query\", \"optimizer\": \"off\", \"page\": \"/editor/?type=impala\", \"is_sql\": true, \"is_batchable\": true, \"dialect\": \"impala\", \"dialect_properties\": {}}, \"isSqlDialect\": true, \"dialect\": \"impala\", \"isBatchable\": true, \"autocompleteSettings\": {\"temporaryOnly\": false}, \"aceCursorPosition\": {\"row\": 514, \"column\": 40}, \"errors\": [], \"aceErrorsHolder\": [], \"aceWarningsHolder\": [], \"aceErrors\": [], \"aceWarnings\": [], \"editorMode\": true, \"dbSelectionVisible\": false, \"showExecutionAnalysis\": true, \"namespace\": {\"id\": \"8271bb54-0cd9-47e1-89f2-a8a5de91d943\", \"name\": \"8271bb54-0cd9-47e1-89f2-a8a5de91d943\", \"status\": \"CREATED\", \"computes\": [{\"id\": \"8271bb54-0cd9-47e1-89f2-a8a5de91d943\", \"name\": \"8271bb54-0cd9-47e1-89f2-a8a5de91d943\", \"type\": \"direct\", \"credentials\": {}}]}, \"compute\": {\"id\": \"8271bb54-0cd9-47e1-89f2-a8a5de91d943\", \"name\": \"8271bb54-0cd9-47e1-89f2-a8a5de91d943\", \"namespace\": \"8271bb54-0cd9-47e1-89f2-a8a5de91d943\", \"interface\": \"impala\", \"type\": \"direct\", \"options\": {}}, \"database\": \"default\", \"currentQueryTab\": \"queryResults\", \"pinnedContextTabs\": [], \"loadingQueries\": false, \"queriesHasErrors\": false, \"queriesCurrentPage\": 1, \"queriesTotalPages\": 3, \"queriesFilter\": \"\", \"queriesFilterVisible\": false, \"statementType\": \"text\", \"statementTypes\": [\"text\", \"file\"], \"statementPath\": \"\", \"externalStatementLoaded\": false, \"associatedDocumentLoading\": true, \"associatedDocumentUuid\": null, \"statement_raw\": \"/***************************************************************************************************\\r\\n * SISTEMA DE PRIORIZA\\u00c7\\u00c3O DE COBRAN\\u00c7A - CONSULTAS ANAL\\u00cdTICAS V3 (COMPAT\\u00cdVEL COM V1.5)\\r\\n * Receita Estadual de Santa Catarina - GECOB\\r\\n * Data: 09 de Outubro de 2025\\r\\n * \\r\\n * CORRE\\u00c7\\u00d5ES V3:\\r\\n * - Compatibilizado com V1.5 do sistema (pr\\u00e9-agrega\\u00e7\\u00e3o de conta corrente)\\r\\n * - Adicionadas novas m\\u00e9tricas de contatos (30/90 dias)\\r\\n * - Otimizado para trabalhar com dados j\\u00e1 agregados\\r\\n * - Removidas duplica\\u00e7\\u00f5es usando agrega\\u00e7\\u00e3o por inscricao_estadual\\r\\n ***************************************************************************************************/\\r\\n\\r\\nSET REQUEST_POOL = 'medium';\\r\\nSET MEM_LIMIT = 8G;\\r\\n\\r\\n-- =================================================================================================\\r\\n-- SE\\u00c7\\u00c3O 1: ESTAT\\u00cdSTICAS GERAIS DO SISTEMA\\r\\n-- =================================================================================================\\r\\n\\r\\n-- 1.1. PANORAMA GERAL\\r\\nSELECT \\r\\n    '1.1. PANORAMA GERAL' AS consulta,\\r\\n    COUNT(DISTINCT mc.inscricao_estadual) AS total_contribuintes,\\r\\n    SUM(mc.valor_total_devido) AS divida_total,\\r\\n    ROUND(AVG(mc.valor_total_devido), 2) AS divida_media,\\r\\n    COUNT(DISTINCT CASE WHEN sp.classificacao_prioridade = 'PRIORIDADE_MAXIMA' THEN mc.inscricao_estadual END) AS prioridade_maxima,\\r\\n    COUNT(DISTINCT CASE WHEN sp.classificacao_prioridade = 'PRIORIDADE_ALTA' THEN mc.inscricao_estadual END) AS prioridade_alta,\\r\\n    ROUND(AVG(mc.taxa_resposta_contatos) * 100, 2) AS taxa_resposta_pct,\\r\\n    COUNT(DISTINCT CASE WHEN mc.flag_falencia = 1 THEN mc.inscricao_estadual END) AS casos_falencia,\\r\\n    FROM_UNIXTIME(UNIX_TIMESTAMP()) AS data_atualizacao\\r\\nFROM gecob.prior_master_consolidado mc\\r\\nLEFT JOIN gecob.prior_score_priorizacao sp \\r\\n    ON mc.inscricao_estadual = sp.inscricao_estadual \\r\\n    AND mc.tipo_debito = sp.tipo_debito;\\r\\n\\r\\n-- 1.2. DISTRIBUI\\u00c7\\u00c3O POR FAIXAS DE VALOR\\r\\nSELECT \\r\\n    '1.2. FAIXAS DE VALOR' AS consulta,\\r\\n    CASE \\r\\n        WHEN valor_total_devido >= 10000000 THEN '10M+'\\r\\n        WHEN valor_total_devido >= 1000000 THEN '1M-10M'\\r\\n        WHEN valor_total_devido >= 100000 THEN '100K-1M'\\r\\n        WHEN valor_total_devido >= 10000 THEN '10K-100K'\\r\\n        ELSE 'At\\u00e9 10K'\\r\\n    END AS faixa,\\r\\n    COUNT(DISTINCT inscricao_estadual) AS qtd,\\r\\n    SUM(valor_total_devido) AS valor_total,\\r\\n    ROUND(AVG(score_final_priorizacao), 2) AS score_medio\\r\\nFROM (\\r\\n    SELECT \\r\\n        mc.inscricao_estadual,\\r\\n        SUM(mc.valor_total_devido) AS valor_total_devido,\\r\\n        MAX(sp.score_final_priorizacao) AS score_final_priorizacao\\r\\n    FROM gecob.prior_master_consolidado mc\\r\\n    LEFT JOIN gecob.prior_score_priorizacao sp \\r\\n        ON mc.inscricao_estadual = sp.inscricao_estadual \\r\\n        AND mc.tipo_debito = sp.tipo_debito\\r\\n    GROUP BY mc.inscricao_estadual\\r\\n) dados\\r\\nGROUP BY \\r\\n    CASE \\r\\n        WHEN valor_total_devido >= 10000000 THEN '10M+'\\r\\n        WHEN valor_total_devido >= 1000000 THEN '1M-10M'\\r\\n        WHEN valor_total_devido >= 100000 THEN '100K-1M'\\r\\n        WHEN valor_total_devido >= 10000 THEN '10K-100K'\\r\\n        ELSE 'At\\u00e9 10K'\\r\\n    END\\r\\nORDER BY MIN(valor_total_devido) DESC;\\r\\n\\r\\n-- 1.3. DISTRIBUI\\u00c7\\u00c3O POR PRIORIDADE\\r\\nSELECT \\r\\n    '1.3. DISTRIBUI\\u00c7\\u00c3O PRIORIDADE' AS consulta,\\r\\n    sp.classificacao_prioridade,\\r\\n    COUNT(DISTINCT mc.inscricao_estadual) AS quantidade,\\r\\n    ROUND(COUNT(DISTINCT mc.inscricao_estadual) * 100.0 / \\r\\n          SUM(COUNT(DISTINCT mc.inscricao_estadual)) OVER(), 2) AS percentual,\\r\\n    SUM(mc.valor_total_devido) AS valor_total,\\r\\n    ROUND(AVG(sp.score_final_priorizacao), 2) AS score_medio\\r\\nFROM gecob.prior_master_consolidado mc\\r\\nJOIN gecob.prior_score_priorizacao sp \\r\\n    ON mc.inscricao_estadual = sp.inscricao_estadual \\r\\n    AND mc.tipo_debito = sp.tipo_debito\\r\\nGROUP BY sp.classificacao_prioridade\\r\\nORDER BY \\r\\n    CASE sp.classificacao_prioridade\\r\\n        WHEN 'PRIORIDADE_MAXIMA' THEN 1\\r\\n        WHEN 'PRIORIDADE_ALTA' THEN 2\\r\\n        WHEN 'PRIORIDADE_MEDIA' THEN 3\\r\\n        ELSE 4\\r\\n    END;\\r\\n\\r\\n-- =================================================================================================\\r\\n-- SE\\u00c7\\u00c3O 2: RANKINGS E AN\\u00c1LISES\\r\\n-- =================================================================================================\\r\\n\\r\\n-- 2.1. TOP 50 CONTRIBUINTES POR SCORE\\r\\nSELECT \\r\\n    '2.1. TOP 50 SCORES' AS consulta,\\r\\n    mc.inscricao_estadual,\\r\\n    mc.razao_social,\\r\\n    mc.nome_fantasia,\\r\\n    mc.cnpj,\\r\\n    sp.score_final_priorizacao,\\r\\n    sp.classificacao_prioridade,\\r\\n    mc.valor_total_devido,\\r\\n    mc.situacao_cadastral_desc,\\r\\n    mc.porte_por_faturamento,\\r\\n    mc.qtd_total_contatos,\\r\\n    mc.flag_falencia,\\r\\n    mc.nome_municipio\\r\\nFROM gecob.prior_master_consolidado mc\\r\\nJOIN gecob.prior_score_priorizacao sp \\r\\n    ON mc.inscricao_estadual = sp.inscricao_estadual \\r\\n    AND mc.tipo_debito = sp.tipo_debito\\r\\nORDER BY sp.score_final_priorizacao DESC\\r\\nLIMIT 50;\\r\\n\\r\\n-- 2.2. TOP 30 SETORES POR VALOR\\r\\nSELECT \\r\\n    '2.2. TOP SETORES' AS consulta,\\r\\n    mc.secao_cnae,\\r\\n    mc.descricao_secao,\\r\\n    COUNT(DISTINCT mc.inscricao_estadual) AS qtd_contribuintes,\\r\\n    SUM(mc.valor_total_devido) AS valor_total,\\r\\n    ROUND(AVG(sp.score_final_priorizacao), 2) AS score_medio,\\r\\n    SUM(CASE WHEN sp.classificacao_prioridade IN ('PRIORIDADE_MAXIMA', 'PRIORIDADE_ALTA') THEN 1 ELSE 0 END) AS alta_prioridade,\\r\\n    SUM(CASE WHEN mc.flag_falencia = 1 THEN 1 ELSE 0 END) AS casos_falencia\\r\\nFROM gecob.prior_master_consolidado mc\\r\\nJOIN gecob.prior_score_priorizacao sp \\r\\n    ON mc.inscricao_estadual = sp.inscricao_estadual \\r\\n    AND mc.tipo_debito = sp.tipo_debito\\r\\nWHERE mc.secao_cnae IS NOT NULL\\r\\nGROUP BY mc.secao_cnae, mc.descricao_secao\\r\\nHAVING COUNT(DISTINCT mc.inscricao_estadual) >= 5\\r\\nORDER BY SUM(mc.valor_total_devido) DESC\\r\\nLIMIT 30;\\r\\n\\r\\n-- 2.3. TOP 20 MUNIC\\u00cdPIOS\\r\\nSELECT \\r\\n    '2.3. TOP MUNIC\\u00cdPIOS' AS consulta,\\r\\n    mc.codigo_municipio,\\r\\n    mc.nome_municipio,\\r\\n    COUNT(DISTINCT mc.inscricao_estadual) AS qtd_contribuintes,\\r\\n    SUM(mc.valor_total_devido) AS valor_total,\\r\\n    ROUND(AVG(sp.score_final_priorizacao), 2) AS score_medio,\\r\\n    SUM(CASE WHEN sp.classificacao_prioridade = 'PRIORIDADE_MAXIMA' THEN 1 ELSE 0 END) AS prioridade_maxima,\\r\\n    ROUND(AVG(mc.taxa_resposta_contatos) * 100, 2) AS taxa_resposta_pct\\r\\nFROM gecob.prior_master_consolidado mc\\r\\nJOIN gecob.prior_score_priorizacao sp \\r\\n    ON mc.inscricao_estadual = sp.inscricao_estadual \\r\\n    AND mc.tipo_debito = sp.tipo_debito\\r\\nWHERE mc.nome_municipio IS NOT NULL\\r\\nGROUP BY mc.codigo_municipio, mc.nome_municipio\\r\\nORDER BY SUM(mc.valor_total_devido) DESC\\r\\nLIMIT 20;\\r\\n\\r\\n-- 2.4. MELHOR RESPONSIVIDADE (ALTA PRIORIDADE)\\r\\nSELECT \\r\\n    '2.4. MELHOR RESPONSIVIDADE' AS consulta,\\r\\n    mc.inscricao_estadual,\\r\\n    mc.razao_social,\\r\\n    mc.valor_total_devido,\\r\\n    sp.classificacao_prioridade,\\r\\n    mc.qtd_total_contatos,\\r\\n    ROUND(mc.taxa_resposta_contatos * 100, 2) AS taxa_resposta_pct,\\r\\n    mc.qtd_promessas_pagamento,\\r\\n    fm.capacidade_pagamento_estimada,\\r\\n    fm.perfil_engajamento,\\r\\n    -- NOVAS M\\u00c9TRICAS V1.5\\r\\n    mc.qtd_contatos_ultimos_30_dias,\\r\\n    mc.qtd_contatos_ultimos_90_dias\\r\\nFROM gecob.prior_master_consolidado mc\\r\\nJOIN gecob.prior_score_priorizacao sp \\r\\n    ON mc.inscricao_estadual = sp.inscricao_estadual \\r\\n    AND mc.tipo_debito = sp.tipo_debito\\r\\nJOIN gecob.prior_features_ml fm \\r\\n    ON mc.inscricao_estadual = fm.inscricao_estadual \\r\\n    AND mc.tipo_debito = fm.tipo_debito\\r\\nWHERE sp.classificacao_prioridade IN ('PRIORIDADE_MAXIMA', 'PRIORIDADE_ALTA')\\r\\n  AND mc.qtd_total_contatos >= 3\\r\\nORDER BY mc.taxa_resposta_contatos DESC\\r\\nLIMIT 30;\\r\\n\\r\\n-- 2.5. EMPRESAS NOTEIRAS (ALTO RISCO FISCAL)\\r\\nSELECT \\r\\n    '2.5. EMPRESAS NOTEIRAS' AS consulta,\\r\\n    mc.inscricao_estadual,\\r\\n    mc.razao_social,\\r\\n    mc.cnpj,\\r\\n    mc.valor_total_devido,\\r\\n    mc.score_noteiras,\\r\\n    mc.qtd_indicios_noteiras,\\r\\n    mc.classificacao_risco_noteiras,\\r\\n    sp.score_final_priorizacao,\\r\\n    sp.classificacao_prioridade,\\r\\n    mc.situacao_cadastral_desc,\\r\\n    mc.porte_por_faturamento\\r\\nFROM gecob.prior_master_consolidado mc\\r\\nJOIN gecob.prior_score_priorizacao sp \\r\\n    ON mc.inscricao_estadual = sp.inscricao_estadual \\r\\n    AND mc.tipo_debito = sp.tipo_debito\\r\\nWHERE mc.score_noteiras > 0\\r\\nORDER BY mc.score_noteiras DESC, sp.score_final_priorizacao DESC\\r\\nLIMIT 30;\\r\\n\\r\\n-- =================================================================================================\\r\\n-- SE\\u00c7\\u00c3O 3: DOSSI\\u00ca DE CONTRIBUINTE (MODIFICAR INSCRI\\u00c7\\u00c3O ESTADUAL)\\r\\n-- =================================================================================================\\r\\n\\r\\n-- 3.1. DOSSI\\u00ca - VIS\\u00c3O GERAL\\r\\n-- MODIFICAR: Trocar '0000000000000' pela inscri\\u00e7\\u00e3o estadual desejada\\r\\nSELECT \\r\\n    '3.1. DOSSI\\u00ca GERAL' AS consulta,\\r\\n    mc.inscricao_estadual,\\r\\n    mc.cnpj,\\r\\n    mc.razao_social,\\r\\n    mc.nome_fantasia,\\r\\n    sp.score_final_priorizacao,\\r\\n    sp.classificacao_prioridade,\\r\\n    sp.score_valor_debito,\\r\\n    sp.score_capacidade_pagamento,\\r\\n    sp.score_historico_pagamento,\\r\\n    sp.score_responsividade,\\r\\n    sp.score_viabilidade_cobranca,\\r\\n    mc.valor_total_devido,\\r\\n    mc.saldo_imposto,\\r\\n    mc.saldo_multa,\\r\\n    mc.saldo_juros,\\r\\n    mc.situacao_cadastral_desc,\\r\\n    mc.cnae_classe,\\r\\n    mc.descricao_cnae,\\r\\n    mc.porte_por_faturamento,\\r\\n    mc.nome_municipio,\\r\\n    mc.qtd_socios_ativos\\r\\nFROM gecob.prior_master_consolidado mc\\r\\nJOIN gecob.prior_score_priorizacao sp \\r\\n    ON mc.inscricao_estadual = sp.inscricao_estadual \\r\\n    AND mc.tipo_debito = sp.tipo_debito\\r\\nWHERE mc.inscricao_estadual = '0000000000000'; -- << MODIFIQUE AQUI\\r\\n\\r\\n-- 3.2. DOSSI\\u00ca - HIST\\u00d3RICO DE CONTATOS\\r\\nSELECT \\r\\n    '3.2. DOSSI\\u00ca CONTATOS' AS consulta,\\r\\n    mc.inscricao_estadual,\\r\\n    mc.razao_social,\\r\\n    mc.data_inclusao_cobranca,\\r\\n    fm.dias_desde_inclusao_cobranca,\\r\\n    fm.faixa_idade_debito,\\r\\n    mc.qtd_total_contatos,\\r\\n    mc.qtd_respostas_positivas,\\r\\n    mc.qtd_respostas_negativas,\\r\\n    ROUND(mc.taxa_resposta_contatos * 100, 2) AS taxa_resposta_pct,\\r\\n    mc.qtd_promessas_pagamento,\\r\\n    mc.data_ultimo_contato,\\r\\n    mc.dias_desde_ultimo_contato,\\r\\n    fm.perfil_engajamento,\\r\\n    -- NOVAS M\\u00c9TRICAS V1.5\\r\\n    mc.qtd_contatos_ultimos_30_dias,\\r\\n    mc.qtd_contatos_ultimos_90_dias\\r\\nFROM gecob.prior_master_consolidado mc\\r\\nJOIN gecob.prior_features_ml fm \\r\\n    ON mc.inscricao_estadual = fm.inscricao_estadual \\r\\n    AND mc.tipo_debito = fm.tipo_debito\\r\\nWHERE mc.inscricao_estadual = '0000000000000'; -- << MODIFIQUE AQUI\\r\\n\\r\\n-- 3.3. DOSSI\\u00ca - AN\\u00c1LISE FINANCEIRA\\r\\nSELECT \\r\\n    '3.3. DOSSI\\u00ca FINANCEIRO' AS consulta,\\r\\n    mc.inscricao_estadual,\\r\\n    mc.razao_social,\\r\\n    mc.faturamento_total_6m,\\r\\n    mc.faturamento_medio_6m,\\r\\n    mc.icms_devido_total_6m,\\r\\n    mc.icms_recolher_total_6m,\\r\\n    mc.qtd_periodos_declarados_6m,\\r\\n    mc.qtd_periodos_omissos_6m,\\r\\n    mc.regularidade_declaracoes,\\r\\n    mc.qtd_pagamentos_6m,\\r\\n    mc.valor_total_pago_6m,\\r\\n    mc.regularidade_pagamentos,\\r\\n    ROUND(fm.capacidade_pagamento_estimada, 2) AS capacidade_pagamento,\\r\\n    ROUND(fm.taxa_pagamento_vs_devido_6m * 100, 2) AS taxa_compliance_pct,\\r\\n    ROUND(fm.score_compliance * 100, 2) AS score_compliance\\r\\nFROM gecob.prior_master_consolidado mc\\r\\nJOIN gecob.prior_features_ml fm \\r\\n    ON mc.inscricao_estadual = fm.inscricao_estadual \\r\\n    AND mc.tipo_debito = fm.tipo_debito\\r\\nWHERE mc.inscricao_estadual = '0000000000000'; -- << MODIFIQUE AQUI\\r\\n\\r\\n-- 3.4. DOSSI\\u00ca - SITUA\\u00c7\\u00c3O DE RISCO\\r\\nSELECT \\r\\n    '3.4. DOSSI\\u00ca RISCO' AS consulta,\\r\\n    mc.inscricao_estadual,\\r\\n    mc.razao_social,\\r\\n    mc.flag_falencia,\\r\\n    mc.flag_recuperacao_judicial,\\r\\n    mc.flag_devedor_contumaz,\\r\\n    mc.flag_protesto,\\r\\n    fm.score_risco_situacao,\\r\\n    mc.score_noteiras,\\r\\n    mc.qtd_indicios_noteiras,\\r\\n    mc.classificacao_risco_noteiras,\\r\\n    mc.flag_tem_parcelamento,\\r\\n    mc.status_parcelamento_desc,\\r\\n    mc.saldo_parcelado,\\r\\n    mc.numero_parcelas,\\r\\n    sp.score_viabilidade_cobranca\\r\\nFROM gecob.prior_master_consolidado mc\\r\\nJOIN gecob.prior_features_ml fm \\r\\n    ON mc.inscricao_estadual = fm.inscricao_estadual \\r\\n    AND mc.tipo_debito = fm.tipo_debito\\r\\nJOIN gecob.prior_score_priorizacao sp \\r\\n    ON mc.inscricao_estadual = sp.inscricao_estadual \\r\\n    AND mc.tipo_debito = sp.tipo_debito\\r\\nWHERE mc.inscricao_estadual = '0000000000000'; -- << MODIFIQUE AQUI\\r\\n\\r\\n-- =================================================================================================\\r\\n-- SE\\u00c7\\u00c3O 4: AN\\u00c1LISES ESPECIALIZADAS\\r\\n-- =================================================================================================\\r\\n\\r\\n-- 4.1. ALTA PRIORIDADE + BOA CAPACIDADE\\r\\nSELECT \\r\\n    '4.1. ALTA PRIORIDADE + CAPACIDADE' AS consulta,\\r\\n    mc.inscricao_estadual,\\r\\n    mc.razao_social,\\r\\n    mc.valor_total_devido,\\r\\n    sp.score_final_priorizacao,\\r\\n    sp.classificacao_prioridade,\\r\\n    fm.capacidade_pagamento_estimada,\\r\\n    mc.faturamento_medio_6m,\\r\\n    mc.regularidade_pagamentos,\\r\\n    ROUND(fm.taxa_pagamento_vs_devido_6m * 100, 2) AS taxa_compliance_pct,\\r\\n    mc.situacao_cadastral_desc,\\r\\n    mc.qtd_total_contatos,\\r\\n    fm.perfil_engajamento,\\r\\n    CASE \\r\\n        WHEN fm.taxa_efetividade_contatos >= 0.5 THEN 'CONTATO_IMEDIATO_NEGOCIACAO'\\r\\n        WHEN mc.qtd_total_contatos < 3 THEN 'INTENSIFICAR_CONTATOS'\\r\\n        WHEN mc.flag_tem_parcelamento = 0 THEN 'OFERECER_PARCELAMENTO'\\r\\n        ELSE 'NEGOCIACAO_DESCONTO'\\r\\n    END AS acao_recomendada\\r\\nFROM gecob.prior_master_consolidado mc\\r\\nJOIN gecob.prior_score_priorizacao sp \\r\\n    ON mc.inscricao_estadual = sp.inscricao_estadual \\r\\n    AND mc.tipo_debito = sp.tipo_debito\\r\\nJOIN gecob.prior_features_ml fm \\r\\n    ON mc.inscricao_estadual = fm.inscricao_estadual \\r\\n    AND mc.tipo_debito = fm.tipo_debito\\r\\nWHERE sp.classificacao_prioridade IN ('PRIORIDADE_MAXIMA', 'PRIORIDADE_ALTA')\\r\\n  AND fm.capacidade_pagamento_estimada >= 1.5\\r\\n  AND mc.flag_falencia = 0\\r\\n  AND mc.flag_recuperacao_judicial = 0\\r\\n  AND mc.situacao_cadastral_desc = 'ATIVO'\\r\\nORDER BY sp.score_final_priorizacao DESC\\r\\nLIMIT 100;\\r\\n\\r\\n-- 4.2. CASOS DE RECUPERA\\u00c7\\u00c3O P\\u00d3S-CONTATO\\r\\nSELECT \\r\\n    '4.2. RECUPERA\\u00c7\\u00c3O P\\u00d3S-CONTATO' AS consulta,\\r\\n    mc.inscricao_estadual,\\r\\n    mc.razao_social,\\r\\n    mc.valor_total_devido,\\r\\n    sp.score_final_priorizacao,\\r\\n    mc.qtd_total_contatos,\\r\\n    mc.qtd_respostas_positivas,\\r\\n    ROUND(mc.taxa_resposta_contatos * 100, 2) AS taxa_resposta_pct,\\r\\n    mc.qtd_periodos_pagamento_6m,\\r\\n    ROUND(fm.taxa_pagamento_vs_devido_6m * 100, 2) AS taxa_pagamento_pct,\\r\\n    mc.regularidade_pagamentos,\\r\\n    fm.perfil_engajamento,\\r\\n    mc.data_ultimo_contato\\r\\nFROM gecob.prior_master_consolidado mc\\r\\nJOIN gecob.prior_score_priorizacao sp \\r\\n    ON mc.inscricao_estadual = sp.inscricao_estadual \\r\\n    AND mc.tipo_debito = sp.tipo_debito\\r\\nJOIN gecob.prior_features_ml fm \\r\\n    ON mc.inscricao_estadual = fm.inscricao_estadual \\r\\n    AND mc.tipo_debito = fm.tipo_debito\\r\\nWHERE mc.qtd_respostas_positivas >= 2\\r\\n  AND mc.qtd_total_contatos >= 3\\r\\n  AND mc.taxa_resposta_contatos >= 0.4\\r\\n  AND mc.qtd_periodos_pagamento_6m >= 3\\r\\nORDER BY mc.taxa_resposta_contatos DESC\\r\\nLIMIT 50;\\r\\n\\r\\n-- 4.3. CASOS CR\\u00cdTICOS PARA D\\u00cdVIDA ATIVA\\r\\nSELECT \\r\\n    '4.3. CASOS CR\\u00cdTICOS D\\u00cdVIDA ATIVA' AS consulta,\\r\\n    mc.inscricao_estadual,\\r\\n    mc.razao_social,\\r\\n    mc.valor_total_devido,\\r\\n    fm.dias_desde_inclusao_cobranca,\\r\\n    sp.score_viabilidade_cobranca,\\r\\n    mc.flag_falencia,\\r\\n    mc.flag_recuperacao_judicial,\\r\\n    mc.situacao_cadastral_desc,\\r\\n    mc.qtd_total_contatos,\\r\\n    ROUND(mc.taxa_resposta_contatos * 100, 2) AS taxa_resposta_pct,\\r\\n    mc.classificacao_omissao,\\r\\n    CASE \\r\\n        WHEN mc.flag_falencia = 1 THEN 'FAL\\u00caNCIA'\\r\\n        WHEN mc.flag_recuperacao_judicial = 1 THEN 'RECUPERA\\u00c7\\u00c3O JUDICIAL'\\r\\n        WHEN fm.dias_desde_inclusao_cobranca > 730 AND mc.qtd_total_contatos >= 10 AND mc.taxa_resposta_contatos < 0.2 THEN 'N\\u00c3O RESPONSIVO'\\r\\n        ELSE 'OUTROS'\\r\\n    END AS motivo_principal\\r\\nFROM gecob.prior_master_consolidado mc\\r\\nJOIN gecob.prior_score_priorizacao sp \\r\\n    ON mc.inscricao_estadual = sp.inscricao_estadual \\r\\n    AND mc.tipo_debito = sp.tipo_debito\\r\\nJOIN gecob.prior_features_ml fm \\r\\n    ON mc.inscricao_estadual = fm.inscricao_estadual \\r\\n    AND mc.tipo_debito = fm.tipo_debito\\r\\nWHERE sp.score_viabilidade_cobranca < 40\\r\\n  OR mc.flag_falencia = 1\\r\\n  OR mc.flag_recuperacao_judicial = 1\\r\\nORDER BY sp.score_viabilidade_cobranca ASC\\r\\nLIMIT 100;\\r\\n\\r\\n-- 4.4. AN\\u00c1LISE DE PARCELAMENTOS\\r\\nSELECT \\r\\n    '4.4. PARCELAMENTOS' AS consulta,\\r\\n    mc.inscricao_estadual,\\r\\n    mc.razao_social,\\r\\n    mc.valor_total_devido,\\r\\n    mc.numero_parcelamento,\\r\\n    mc.status_parcelamento_desc,\\r\\n    mc.saldo_parcelado,\\r\\n    mc.numero_parcelas,\\r\\n    fm.capacidade_pagamento_estimada,\\r\\n    mc.regularidade_pagamentos,\\r\\n    CASE \\r\\n        WHEN mc.status_parcelamento_desc = 'INADIMPLENTE' THEN 'ALERTA: Inadimplente'\\r\\n        WHEN fm.capacidade_pagamento_estimada >= 3 THEN 'Oportunidade Quita\\u00e7\\u00e3o'\\r\\n        ELSE 'Normal'\\r\\n    END AS status_alerta\\r\\nFROM gecob.prior_master_consolidado mc\\r\\nJOIN gecob.prior_features_ml fm \\r\\n    ON mc.inscricao_estadual = fm.inscricao_estadual \\r\\n    AND mc.tipo_debito = fm.tipo_debito\\r\\nWHERE mc.flag_tem_parcelamento = 1\\r\\nORDER BY \\r\\n    CASE mc.status_parcelamento_desc \\r\\n        WHEN 'INADIMPLENTE' THEN 1\\r\\n        WHEN 'ATIVO' THEN 2\\r\\n        ELSE 3 \\r\\n    END,\\r\\n    mc.saldo_parcelado DESC;\\r\\n\\r\\n-- 4.5. IMPACTO ARRECADAT\\u00d3RIO POR SETOR\\r\\nSELECT \\r\\n    '4.5. IMPACTO POR SETOR' AS consulta,\\r\\n    mc.secao_cnae,\\r\\n    mc.descricao_secao,\\r\\n    COUNT(DISTINCT mc.inscricao_estadual) AS qtd_total,\\r\\n    SUM(mc.valor_total_devido) AS valor_total,\\r\\n    SUM(CASE \\r\\n        WHEN sp.classificacao_prioridade IN ('PRIORIDADE_MAXIMA', 'PRIORIDADE_ALTA')\\r\\n        AND fm.capacidade_pagamento_estimada >= 1.5\\r\\n        AND mc.flag_falencia = 0\\r\\n        THEN 1 ELSE 0\\r\\n    END) AS casos_alta_recuperabilidade,\\r\\n    SUM(CASE \\r\\n        WHEN sp.classificacao_prioridade IN ('PRIORIDADE_MAXIMA', 'PRIORIDADE_ALTA')\\r\\n        AND fm.capacidade_pagamento_estimada >= 1.5\\r\\n        AND mc.flag_falencia = 0\\r\\n        THEN mc.valor_total_devido ELSE 0\\r\\n    END) AS valor_recuperavel,\\r\\n    ROUND(AVG(sp.score_final_priorizacao), 2) AS score_medio\\r\\nFROM gecob.prior_master_consolidado mc\\r\\nJOIN gecob.prior_score_priorizacao sp \\r\\n    ON mc.inscricao_estadual = sp.inscricao_estadual \\r\\n    AND mc.tipo_debito = sp.tipo_debito\\r\\nJOIN gecob.prior_features_ml fm \\r\\n    ON mc.inscricao_estadual = fm.inscricao_estadual \\r\\n    AND mc.tipo_debito = fm.tipo_debito\\r\\nWHERE mc.secao_cnae IS NOT NULL\\r\\nGROUP BY mc.secao_cnae, mc.descricao_secao\\r\\nHAVING COUNT(DISTINCT mc.inscricao_estadual) >= 5\\r\\nORDER BY valor_recuperavel DESC\\r\\nLIMIT 30;\\r\\n\\r\\n-- =================================================================================================\\r\\n-- SE\\u00c7\\u00c3O 5: DASHBOARD EXECUTIVO\\r\\n-- =================================================================================================\\r\\n\\r\\n-- 5.1. KPIs PRINCIPAIS\\r\\nSELECT \\r\\n    'DASHBOARD EXECUTIVO' AS consulta,\\r\\n    COUNT(DISTINCT mc.inscricao_estadual) AS total_contribuintes,\\r\\n    SUM(mc.valor_total_devido) AS divida_total,\\r\\n    SUM(CASE WHEN sp.classificacao_prioridade = 'PRIORIDADE_MAXIMA' THEN 1 ELSE 0 END) AS qtd_prioridade_maxima,\\r\\n    SUM(CASE WHEN sp.classificacao_prioridade = 'PRIORIDADE_ALTA' THEN 1 ELSE 0 END) AS qtd_prioridade_alta,\\r\\n    SUM(CASE \\r\\n        WHEN sp.classificacao_prioridade IN ('PRIORIDADE_MAXIMA', 'PRIORIDADE_ALTA')\\r\\n        AND fm.capacidade_pagamento_estimada >= 1.5\\r\\n        AND mc.flag_falencia = 0\\r\\n        THEN 1 ELSE 0\\r\\n    END) AS casos_alta_recuperabilidade,\\r\\n    SUM(CASE \\r\\n        WHEN sp.classificacao_prioridade IN ('PRIORIDADE_MAXIMA', 'PRIORIDADE_ALTA')\\r\\n        AND fm.capacidade_pagamento_estimada >= 1.5\\r\\n        AND mc.flag_falencia = 0\\r\\n        THEN mc.valor_total_devido ELSE 0\\r\\n    END) AS valor_alta_recuperabilidade,\\r\\n    ROUND(AVG(mc.taxa_resposta_contatos) * 100, 2) AS taxa_resposta_pct,\\r\\n    SUM(CASE WHEN mc.flag_falencia = 1 THEN 1 ELSE 0 END) AS casos_falencia,\\r\\n    SUM(CASE WHEN sp.score_viabilidade_cobranca < 40 THEN 1 ELSE 0 END) AS casos_baixa_viabilidade,\\r\\n    FROM_UNIXTIME(UNIX_TIMESTAMP()) AS data_atualizacao\\r\\nFROM gecob.prior_master_consolidado mc\\r\\nJOIN gecob.prior_score_priorizacao sp \\r\\n    ON mc.inscricao_estadual = sp.inscricao_estadual \\r\\n    AND mc.tipo_debito = sp.tipo_debito\\r\\nJOIN gecob.prior_features_ml fm \\r\\n    ON mc.inscricao_estadual = fm.inscricao_estadual \\r\\n    AND mc.tipo_debito = fm.tipo_debito;\", \"statementsList\": [\"\\r\\n\\r\\n-- 2.3. TOP 20 MUNIC\\u00cdPIOS\\r\\nSELECT \\r\\n    '2.3. TOP MUNIC\\u00cdPIOS' AS consulta,\\r\\n    mc.codigo_municipio,\\r\\n    mc.nome_municipio,\\r\\n    COUNT(DISTINCT mc.inscricao_estadual) AS qtd_contribuintes,\\r\\n    SUM(mc.valor_total_devido) AS valor_total,\\r\\n    ROUND(AVG(sp.score_final_priorizacao), 2) AS score_medio,\\r\\n    SUM(CASE WHEN sp.classificacao_prioridade = 'PRIORIDADE_MAXIMA' THEN 1 ELSE 0 END) AS prioridade_maxima,\\r\\n    ROUND(AVG(mc.taxa_resposta_contatos) * 100, 2) AS taxa_resposta_pct\\r\\nFROM gecob.prior_master_consolidado mc\\r\\nJOIN gecob.prior_score_priorizacao sp \\r\\n    ON mc.inscricao_estadual = sp.inscricao_estadual \\r\\n    AND mc.tipo_debito = sp.tipo_debito\\r\\nWHERE mc.nome_municipio IS NOT NULL\\r\\nGROUP BY mc.codigo_municipio, mc.nome_municipio\\r\\nORDER BY SUM(mc.valor_total_devido) DESC\\r\\nLIMIT 20;\", \"\\r\\n\\r\\n-- 2.4. MELHOR RESPONSIVIDADE (ALTA PRIORIDADE)\\r\\nSELECT \\r\\n    '2.4. MELHOR RESPONSIVIDADE' AS consulta,\\r\\n    mc.inscricao_estadual,\\r\\n    mc.razao_social,\\r\\n    mc.valor_total_devido,\\r\\n    sp.classificacao_prioridade,\\r\\n    mc.qtd_total_contatos,\\r\\n    ROUND(mc.taxa_resposta_contatos * 100, 2) AS taxa_resposta_pct,\\r\\n    mc.qtd_promessas_pagamento,\\r\\n    fm.capacidade_pagamento_estimada,\\r\\n    fm.perfil_engajamento,\\r\\n    -- NOVAS M\\u00c9TRICAS V1.5\\r\\n    mc.qtd_contatos_ultimos_30_dias,\\r\\n    mc.qtd_contatos_ultimos_90_dias\\r\\nFROM gecob.prior_master_consolidado mc\\r\\nJOIN gecob.prior_score_priorizacao sp \\r\\n    ON mc.inscricao_estadual = sp.inscricao_estadual \\r\\n    AND mc.tipo_debito = sp.tipo_debito\\r\\nJOIN gecob.prior_features_ml fm \\r\\n    ON mc.inscricao_estadual = fm.inscricao_estadual \\r\\n    AND mc.tipo_debito = fm.tipo_debito\\r\\nWHERE sp.classificacao_prioridade IN ('PRIORIDADE_MAXIMA', 'PRIORIDADE_ALTA')\\r\\n  AND mc.qtd_total_contatos >= 3\\r\\nORDER BY mc.taxa_resposta_contatos DESC\\r\\nLIMIT 30;\", \"\\r\\n\\r\\n-- 2.5. EMPRESAS NOTEIRAS (ALTO RISCO FISCAL)\\r\\nSELECT \\r\\n    '2.5. EMPRESAS NOTEIRAS' AS consulta,\\r\\n    mc.inscricao_estadual,\\r\\n    mc.razao_social,\\r\\n    mc.cnpj,\\r\\n    mc.valor_total_devido,\\r\\n    mc.score_noteiras,\\r\\n    mc.qtd_indicios_noteiras,\\r\\n    mc.classificacao_risco_noteiras,\\r\\n    sp.score_final_priorizacao,\\r\\n    sp.classificacao_prioridade,\\r\\n    mc.situacao_cadastral_desc,\\r\\n    mc.porte_por_faturamento\\r\\nFROM gecob.prior_master_consolidado mc\\r\\nJOIN gecob.prior_score_priorizacao sp \\r\\n    ON mc.inscricao_estadual = sp.inscricao_estadual \\r\\n    AND mc.tipo_debito = sp.tipo_debito\\r\\nWHERE mc.score_noteiras > 0\\r\\nORDER BY mc.score_noteiras DESC, sp.score_final_priorizacao DESC\\r\\nLIMIT 30;\", \"\\r\\n\\r\\n-- =================================================================================================\\r\\n-- SE\\u00c7\\u00c3O 3: DOSSI\\u00ca DE CONTRIBUINTE (MODIFICAR INSCRI\\u00c7\\u00c3O ESTADUAL)\\r\\n-- =================================================================================================\\r\\n\\r\\n-- 3.1. DOSSI\\u00ca - VIS\\u00c3O GERAL\\r\\n-- MODIFICAR: Trocar '0000000000000' pela inscri\\u00e7\\u00e3o estadual desejada\\r\\nSELECT \\r\\n    '3.1. DOSSI\\u00ca GERAL' AS consulta,\\r\\n    mc.inscricao_estadual,\\r\\n    mc.cnpj,\\r\\n    mc.razao_social,\\r\\n    mc.nome_fantasia,\\r\\n    sp.score_final_priorizacao,\\r\\n    sp.classificacao_prioridade,\\r\\n    sp.score_valor_debito,\\r\\n    sp.score_capacidade_pagamento,\\r\\n    sp.score_historico_pagamento,\\r\\n    sp.score_responsividade,\\r\\n    sp.score_viabilidade_cobranca,\\r\\n    mc.valor_total_devido,\\r\\n    mc.saldo_imposto,\\r\\n    mc.saldo_multa,\\r\\n    mc.saldo_juros,\\r\\n    mc.situacao_cadastral_desc,\\r\\n    mc.cnae_classe,\\r\\n    mc.descricao_cnae,\\r\\n    mc.porte_por_faturamento,\\r\\n    mc.nome_municipio,\\r\\n    mc.qtd_socios_ativos\\r\\nFROM gecob.prior_master_consolidado mc\\r\\nJOIN gecob.prior_score_priorizacao sp \\r\\n    ON mc.inscricao_estadual = sp.inscricao_estadual \\r\\n    AND mc.tipo_debito = sp.tipo_debito\\r\\nWHERE mc.inscricao_estadual = '0000000000000';\", \" -- << MODIFIQUE AQUI\\r\\n\\r\\n-- 3.2. DOSSI\\u00ca - HIST\\u00d3RICO DE CONTATOS\\r\\nSELECT \\r\\n    '3.2. DOSSI\\u00ca CONTATOS' AS consulta,\\r\\n    mc.inscricao_estadual,\\r\\n    mc.razao_social,\\r\\n    mc.data_inclusao_cobranca,\\r\\n    fm.dias_desde_inclusao_cobranca,\\r\\n    fm.faixa_idade_debito,\\r\\n    mc.qtd_total_contatos,\\r\\n    mc.qtd_respostas_positivas,\\r\\n    mc.qtd_respostas_negativas,\\r\\n    ROUND(mc.taxa_resposta_contatos * 100, 2) AS taxa_resposta_pct,\\r\\n    mc.qtd_promessas_pagamento,\\r\\n    mc.data_ultimo_contato,\\r\\n    mc.dias_desde_ultimo_contato,\\r\\n    fm.perfil_engajamento,\\r\\n    -- NOVAS M\\u00c9TRICAS V1.5\\r\\n    mc.qtd_contatos_ultimos_30_dias,\\r\\n    mc.qtd_contatos_ultimos_90_dias\\r\\nFROM gecob.prior_master_consolidado mc\\r\\nJOIN gecob.prior_features_ml fm \\r\\n    ON mc.inscricao_estadual = fm.inscricao_estadual \\r\\n    AND mc.tipo_debito = fm.tipo_debito\\r\\nWHERE mc.inscricao_estadual = '0000000000000';\", \" -- << MODIFIQUE AQUI\\r\\n\\r\\n-- 3.3. DOSSI\\u00ca - AN\\u00c1LISE FINANCEIRA\\r\\nSELECT \\r\\n    '3.3. DOSSI\\u00ca FINANCEIRO' AS consulta,\\r\\n    mc.inscricao_estadual,\\r\\n    mc.razao_social,\\r\\n    mc.faturamento_total_6m,\\r\\n    mc.faturamento_medio_6m,\\r\\n    mc.icms_devido_total_6m,\\r\\n    mc.icms_recolher_total_6m,\\r\\n    mc.qtd_periodos_declarados_6m,\\r\\n    mc.qtd_periodos_omissos_6m,\\r\\n    mc.regularidade_declaracoes,\\r\\n    mc.qtd_pagamentos_6m,\\r\\n    mc.valor_total_pago_6m,\\r\\n    mc.regularidade_pagamentos,\\r\\n    ROUND(fm.capacidade_pagamento_estimada, 2) AS capacidade_pagamento,\\r\\n    ROUND(fm.taxa_pagamento_vs_devido_6m * 100, 2) AS taxa_compliance_pct,\\r\\n    ROUND(fm.score_compliance * 100, 2) AS score_compliance\\r\\nFROM gecob.prior_master_consolidado mc\\r\\nJOIN gecob.prior_features_ml fm \\r\\n    ON mc.inscricao_estadual = fm.inscricao_estadual \\r\\n    AND mc.tipo_debito = fm.tipo_debito\\r\\nWHERE mc.inscricao_estadual = '0000000000000';\", \" -- << MODIFIQUE AQUI\\r\\n\\r\\n-- 3.4. DOSSI\\u00ca - SITUA\\u00c7\\u00c3O DE RISCO\\r\\nSELECT \\r\\n    '3.4. DOSSI\\u00ca RISCO' AS consulta,\\r\\n    mc.inscricao_estadual,\\r\\n    mc.razao_social,\\r\\n    mc.flag_falencia,\\r\\n    mc.flag_recuperacao_judicial,\\r\\n    mc.flag_devedor_contumaz,\\r\\n    mc.flag_protesto,\\r\\n    fm.score_risco_situacao,\\r\\n    mc.score_noteiras,\\r\\n    mc.qtd_indicios_noteiras,\\r\\n    mc.classificacao_risco_noteiras,\\r\\n    mc.flag_tem_parcelamento,\\r\\n    mc.status_parcelamento_desc,\\r\\n    mc.saldo_parcelado,\\r\\n    mc.numero_parcelas,\\r\\n    sp.score_viabilidade_cobranca\\r\\nFROM gecob.prior_master_consolidado mc\\r\\nJOIN gecob.prior_features_ml fm \\r\\n    ON mc.inscricao_estadual = fm.inscricao_estadual \\r\\n    AND mc.tipo_debito = fm.tipo_debito\\r\\nJOIN gecob.prior_score_priorizacao sp \\r\\n    ON mc.inscricao_estadual = sp.inscricao_estadual \\r\\n    AND mc.tipo_debito = sp.tipo_debito\\r\\nWHERE mc.inscricao_estadual = '0000000000000';\", \" -- << MODIFIQUE AQUI\\r\\n\\r\\n-- =================================================================================================\\r\\n-- SE\\u00c7\\u00c3O 4: AN\\u00c1LISES ESPECIALIZADAS\\r\\n-- =================================================================================================\\r\\n\\r\\n-- 4.1. ALTA PRIORIDADE + BOA CAPACIDADE\\r\\nSELECT \\r\\n    '4.1. ALTA PRIORIDADE + CAPACIDADE' AS consulta,\\r\\n    mc.inscricao_estadual,\\r\\n    mc.razao_social,\\r\\n    mc.valor_total_devido,\\r\\n    sp.score_final_priorizacao,\\r\\n    sp.classificacao_prioridade,\\r\\n    fm.capacidade_pagamento_estimada,\\r\\n    mc.faturamento_medio_6m,\\r\\n    mc.regularidade_pagamentos,\\r\\n    ROUND(fm.taxa_pagamento_vs_devido_6m * 100, 2) AS taxa_compliance_pct,\\r\\n    mc.situacao_cadastral_desc,\\r\\n    mc.qtd_total_contatos,\\r\\n    fm.perfil_engajamento,\\r\\n    CASE \\r\\n        WHEN fm.taxa_efetividade_contatos >= 0.5 THEN 'CONTATO_IMEDIATO_NEGOCIACAO'\\r\\n        WHEN mc.qtd_total_contatos < 3 THEN 'INTENSIFICAR_CONTATOS'\\r\\n        WHEN mc.flag_tem_parcelamento = 0 THEN 'OFERECER_PARCELAMENTO'\\r\\n        ELSE 'NEGOCIACAO_DESCONTO'\\r\\n    END AS acao_recomendada\\r\\nFROM gecob.prior_master_consolidado mc\\r\\nJOIN gecob.prior_score_priorizacao sp \\r\\n    ON mc.inscricao_estadual = sp.inscricao_estadual \\r\\n    AND mc.tipo_debito = sp.tipo_debito\\r\\nJOIN gecob.prior_features_ml fm \\r\\n    ON mc.inscricao_estadual = fm.inscricao_estadual \\r\\n    AND mc.tipo_debito = fm.tipo_debito\\r\\nWHERE sp.classificacao_prioridade IN ('PRIORIDADE_MAXIMA', 'PRIORIDADE_ALTA')\\r\\n  AND fm.capacidade_pagamento_estimada >= 1.5\\r\\n  AND mc.flag_falencia = 0\\r\\n  AND mc.flag_recuperacao_judicial = 0\\r\\n  AND mc.situacao_cadastral_desc = 'ATIVO'\\r\\nORDER BY sp.score_final_priorizacao DESC\\r\\nLIMIT 100;\", \"\\r\\n\\r\\n-- 4.2. CASOS DE RECUPERA\\u00c7\\u00c3O P\\u00d3S-CONTATO\\r\\nSELECT \\r\\n    '4.2. RECUPERA\\u00c7\\u00c3O P\\u00d3S-CONTATO' AS consulta,\\r\\n    mc.inscricao_estadual,\\r\\n    mc.razao_social,\\r\\n    mc.valor_total_devido,\\r\\n    sp.score_final_priorizacao,\\r\\n    mc.qtd_total_contatos,\\r\\n    mc.qtd_respostas_positivas,\\r\\n    ROUND(mc.taxa_resposta_contatos * 100, 2) AS taxa_resposta_pct,\\r\\n    mc.qtd_periodos_pagamento_6m,\\r\\n    ROUND(fm.taxa_pagamento_vs_devido_6m * 100, 2) AS taxa_pagamento_pct,\\r\\n    mc.regularidade_pagamentos,\\r\\n    fm.perfil_engajamento,\\r\\n    mc.data_ultimo_contato\\r\\nFROM gecob.prior_master_consolidado mc\\r\\nJOIN gecob.prior_score_priorizacao sp \\r\\n    ON mc.inscricao_estadual = sp.inscricao_estadual \\r\\n    AND mc.tipo_debito = sp.tipo_debito\\r\\nJOIN gecob.prior_features_ml fm \\r\\n    ON mc.inscricao_estadual = fm.inscricao_estadual \\r\\n    AND mc.tipo_debito = fm.tipo_debito\\r\\nWHERE mc.qtd_respostas_positivas >= 2\\r\\n  AND mc.qtd_total_contatos >= 3\\r\\n  AND mc.taxa_resposta_contatos >= 0.4\\r\\n  AND mc.qtd_periodos_pagamento_6m >= 3\\r\\nORDER BY mc.taxa_resposta_contatos DESC\\r\\nLIMIT 50;\", \"\\r\\n\\r\\n-- 4.3. CASOS CR\\u00cdTICOS PARA D\\u00cdVIDA ATIVA\\r\\nSELECT \\r\\n    '4.3. CASOS CR\\u00cdTICOS D\\u00cdVIDA ATIVA' AS consulta,\\r\\n    mc.inscricao_estadual,\\r\\n    mc.razao_social,\\r\\n    mc.valor_total_devido,\\r\\n    fm.dias_desde_inclusao_cobranca,\\r\\n    sp.score_viabilidade_cobranca,\\r\\n    mc.flag_falencia,\\r\\n    mc.flag_recuperacao_judicial,\\r\\n    mc.situacao_cadastral_desc,\\r\\n    mc.qtd_total_contatos,\\r\\n    ROUND(mc.taxa_resposta_contatos * 100, 2) AS taxa_resposta_pct,\\r\\n    mc.classificacao_omissao,\\r\\n    CASE \\r\\n        WHEN mc.flag_falencia = 1 THEN 'FAL\\u00caNCIA'\\r\\n        WHEN mc.flag_recuperacao_judicial = 1 THEN 'RECUPERA\\u00c7\\u00c3O JUDICIAL'\\r\\n        WHEN fm.dias_desde_inclusao_cobranca > 730 AND mc.qtd_total_contatos >= 10 AND mc.taxa_resposta_contatos < 0.2 THEN 'N\\u00c3O RESPONSIVO'\\r\\n        ELSE 'OUTROS'\\r\\n    END AS motivo_principal\\r\\nFROM gecob.prior_master_consolidado mc\\r\\nJOIN gecob.prior_score_priorizacao sp \\r\\n    ON mc.inscricao_estadual = sp.inscricao_estadual \\r\\n    AND mc.tipo_debito = sp.tipo_debito\\r\\nJOIN gecob.prior_features_ml fm \\r\\n    ON mc.inscricao_estadual = fm.inscricao_estadual \\r\\n    AND mc.tipo_debito = fm.tipo_debito\\r\\nWHERE sp.score_viabilidade_cobranca < 40\\r\\n  OR mc.flag_falencia = 1\\r\\n  OR mc.flag_recuperacao_judicial = 1\\r\\nORDER BY sp.score_viabilidade_cobranca ASC\\r\\nLIMIT 100;\", \"\\r\\n\\r\\n-- 4.4. AN\\u00c1LISE DE PARCELAMENTOS\\r\\nSELECT \\r\\n    '4.4. PARCELAMENTOS' AS consulta,\\r\\n    mc.inscricao_estadual,\\r\\n    mc.razao_social,\\r\\n    mc.valor_total_devido,\\r\\n    mc.numero_parcelamento,\\r\\n    mc.status_parcelamento_desc,\\r\\n    mc.saldo_parcelado,\\r\\n    mc.numero_parcelas,\\r\\n    fm.capacidade_pagamento_estimada,\\r\\n    mc.regularidade_pagamentos,\\r\\n    CASE \\r\\n        WHEN mc.status_parcelamento_desc = 'INADIMPLENTE' THEN 'ALERTA: Inadimplente'\\r\\n        WHEN fm.capacidade_pagamento_estimada >= 3 THEN 'Oportunidade Quita\\u00e7\\u00e3o'\\r\\n        ELSE 'Normal'\\r\\n    END AS status_alerta\\r\\nFROM gecob.prior_master_consolidado mc\\r\\nJOIN gecob.prior_features_ml fm \\r\\n    ON mc.inscricao_estadual = fm.inscricao_estadual \\r\\n    AND mc.tipo_debito = fm.tipo_debito\\r\\nWHERE mc.flag_tem_parcelamento = 1\\r\\nORDER BY \\r\\n    CASE mc.status_parcelamento_desc \\r\\n        WHEN 'INADIMPLENTE' THEN 1\\r\\n        WHEN 'ATIVO' THEN 2\\r\\n        ELSE 3 \\r\\n    END,\\r\\n    mc.saldo_parcelado DESC;\", \"\\r\\n\\r\\n-- 4.5. IMPACTO ARRECADAT\\u00d3RIO POR SETOR\\r\\nSELECT \\r\\n    '4.5. IMPACTO POR SETOR' AS consulta,\\r\\n    mc.secao_cnae,\\r\\n    mc.descricao_secao,\\r\\n    COUNT(DISTINCT mc.inscricao_estadual) AS qtd_total,\\r\\n    SUM(mc.valor_total_devido) AS valor_total,\\r\\n    SUM(CASE \\r\\n        WHEN sp.classificacao_prioridade IN ('PRIORIDADE_MAXIMA', 'PRIORIDADE_ALTA')\\r\\n        AND fm.capacidade_pagamento_estimada >= 1.5\\r\\n        AND mc.flag_falencia = 0\\r\\n        THEN 1 ELSE 0\\r\\n    END) AS casos_alta_recuperabilidade,\\r\\n    SUM(CASE \\r\\n        WHEN sp.classificacao_prioridade IN ('PRIORIDADE_MAXIMA', 'PRIORIDADE_ALTA')\\r\\n        AND fm.capacidade_pagamento_estimada >= 1.5\\r\\n        AND mc.flag_falencia = 0\\r\\n        THEN mc.valor_total_devido ELSE 0\\r\\n    END) AS valor_recuperavel,\\r\\n    ROUND(AVG(sp.score_final_priorizacao), 2) AS score_medio\\r\\nFROM gecob.prior_master_consolidado mc\\r\\nJOIN gecob.prior_score_priorizacao sp \\r\\n    ON mc.inscricao_estadual = sp.inscricao_estadual \\r\\n    AND mc.tipo_debito = sp.tipo_debito\\r\\nJOIN gecob.prior_features_ml fm \\r\\n    ON mc.inscricao_estadual = fm.inscricao_estadual \\r\\n    AND mc.tipo_debito = fm.tipo_debito\\r\\nWHERE mc.secao_cnae IS NOT NULL\\r\\nGROUP BY mc.secao_cnae, mc.descricao_secao\\r\\nHAVING COUNT(DISTINCT mc.inscricao_estadual) >= 5\\r\\nORDER BY valor_recuperavel DESC\\r\\nLIMIT 30;\", \"\\r\\n\\r\\n-- =================================================================================================\\r\\n-- SE\\u00c7\\u00c3O 5: DASHBOARD EXECUTIVO\\r\\n-- =================================================================================================\\r\\n\\r\\n-- 5.1. KPIs PRINCIPAIS\\r\\nSELECT \\r\\n    'DASHBOARD EXECUTIVO' AS consulta,\\r\\n    COUNT(DISTINCT mc.inscricao_estadual) AS total_contribuintes,\\r\\n    SUM(mc.valor_total_devido) AS divida_total,\\r\\n    SUM(CASE WHEN sp.classificacao_prioridade = 'PRIORIDADE_MAXIMA' THEN 1 ELSE 0 END) AS qtd_prioridade_maxima,\\r\\n    SUM(CASE WHEN sp.classificacao_prioridade = 'PRIORIDADE_ALTA' THEN 1 ELSE 0 END) AS qtd_prioridade_alta,\\r\\n    SUM(CASE \\r\\n        WHEN sp.classificacao_prioridade IN ('PRIORIDADE_MAXIMA', 'PRIORIDADE_ALTA')\\r\\n        AND fm.capacidade_pagamento_estimada >= 1.5\\r\\n        AND mc.flag_falencia = 0\\r\\n        THEN 1 ELSE 0\\r\\n    END) AS casos_alta_recuperabilidade,\\r\\n    SUM(CASE \\r\\n        WHEN sp.classificacao_prioridade IN ('PRIORIDADE_MAXIMA', 'PRIORIDADE_ALTA')\\r\\n        AND fm.capacidade_pagamento_estimada >= 1.5\\r\\n        AND mc.flag_falencia = 0\\r\\n        THEN mc.valor_total_devido ELSE 0\\r\\n    END) AS valor_alta_recuperabilidade,\\r\\n    ROUND(AVG(mc.taxa_resposta_contatos) * 100, 2) AS taxa_resposta_pct,\\r\\n    SUM(CASE WHEN mc.flag_falencia = 1 THEN 1 ELSE 0 END) AS casos_falencia,\\r\\n    SUM(CASE WHEN sp.score_viabilidade_cobranca < 40 THEN 1 ELSE 0 END) AS casos_baixa_viabilidade,\\r\\n    FROM_UNIXTIME(UNIX_TIMESTAMP()) AS data_atualizacao\\r\\nFROM gecob.prior_master_consolidado mc\\r\\nJOIN gecob.prior_score_priorizacao sp \\r\\n    ON mc.inscricao_estadual = sp.inscricao_estadual \\r\\n    AND mc.tipo_debito = sp.tipo_debito\\r\\nJOIN gecob.prior_features_ml fm \\r\\n    ON mc.inscricao_estadual = fm.inscricao_estadual \\r\\n    AND mc.tipo_debito = fm.tipo_debito;\"], \"aceSize\": 100, \"status\": \"available\", \"statusForButtons\": \"executed\", \"properties\": {\"settings\": []}, \"viewSettings\": {\"placeHolder\": \"Exemplo: SELECT * FROM tablename ou pressione CTRL + espa\\u00e7o\", \"sqlDialect\": true}, \"variables\": [], \"hasCurlyBracketParameters\": true, \"variableNames\": [], \"variableValues\": {}, \"statement\": \"/***************************************************************************************************\\r\\n * SISTEMA DE PRIORIZA\\u00c7\\u00c3O DE COBRAN\\u00c7A - CONSULTAS ANAL\\u00cdTICAS V3 (COMPAT\\u00cdVEL COM V1.5)\\r\\n * Receita Estadual de Santa Catarina - GECOB\\r\\n * Data: 09 de Outubro de 2025\\r\\n * \\r\\n * CORRE\\u00c7\\u00d5ES V3:\\r\\n * - Compatibilizado com V1.5 do sistema (pr\\u00e9-agrega\\u00e7\\u00e3o de conta corrente)\\r\\n * - Adicionadas novas m\\u00e9tricas de contatos (30/90 dias)\\r\\n * - Otimizado para trabalhar com dados j\\u00e1 agregados\\r\\n * - Removidas duplica\\u00e7\\u00f5es usando agrega\\u00e7\\u00e3o por inscricao_estadual\\r\\n ***************************************************************************************************/\\r\\n\\r\\nSET REQUEST_POOL = 'medium';\\r\\nSET MEM_LIMIT = 8G;\\r\\n\\r\\n-- =================================================================================================\\r\\n-- SE\\u00c7\\u00c3O 1: ESTAT\\u00cdSTICAS GERAIS DO SISTEMA\\r\\n-- =================================================================================================\\r\\n\\r\\n-- 1.1. PANORAMA GERAL\\r\\nSELECT \\r\\n    '1.1. PANORAMA GERAL' AS consulta,\\r\\n    COUNT(DISTINCT mc.inscricao_estadual) AS total_contribuintes,\\r\\n    SUM(mc.valor_total_devido) AS divida_total,\\r\\n    ROUND(AVG(mc.valor_total_devido), 2) AS divida_media,\\r\\n    COUNT(DISTINCT CASE WHEN sp.classificacao_prioridade = 'PRIORIDADE_MAXIMA' THEN mc.inscricao_estadual END) AS prioridade_maxima,\\r\\n    COUNT(DISTINCT CASE WHEN sp.classificacao_prioridade = 'PRIORIDADE_ALTA' THEN mc.inscricao_estadual END) AS prioridade_alta,\\r\\n    ROUND(AVG(mc.taxa_resposta_contatos) * 100, 2) AS taxa_resposta_pct,\\r\\n    COUNT(DISTINCT CASE WHEN mc.flag_falencia = 1 THEN mc.inscricao_estadual END) AS casos_falencia,\\r\\n    FROM_UNIXTIME(UNIX_TIMESTAMP()) AS data_atualizacao\\r\\nFROM gecob.prior_master_consolidado mc\\r\\nLEFT JOIN gecob.prior_score_priorizacao sp \\r\\n    ON mc.inscricao_estadual = sp.inscricao_estadual \\r\\n    AND mc.tipo_debito = sp.tipo_debito;\\r\\n\\r\\n-- 1.2. DISTRIBUI\\u00c7\\u00c3O POR FAIXAS DE VALOR\\r\\nSELECT \\r\\n    '1.2. FAIXAS DE VALOR' AS consulta,\\r\\n    CASE \\r\\n        WHEN valor_total_devido >= 10000000 THEN '10M+'\\r\\n        WHEN valor_total_devido >= 1000000 THEN '1M-10M'\\r\\n        WHEN valor_total_devido >= 100000 THEN '100K-1M'\\r\\n        WHEN valor_total_devido >= 10000 THEN '10K-100K'\\r\\n        ELSE 'At\\u00e9 10K'\\r\\n    END AS faixa,\\r\\n    COUNT(DISTINCT inscricao_estadual) AS qtd,\\r\\n    SUM(valor_total_devido) AS valor_total,\\r\\n    ROUND(AVG(score_final_priorizacao), 2) AS score_medio\\r\\nFROM (\\r\\n    SELECT \\r\\n        mc.inscricao_estadual,\\r\\n        SUM(mc.valor_total_devido) AS valor_total_devido,\\r\\n        MAX(sp.score_final_priorizacao) AS score_final_priorizacao\\r\\n    FROM gecob.prior_master_consolidado mc\\r\\n    LEFT JOIN gecob.prior_score_priorizacao sp \\r\\n        ON mc.inscricao_estadual = sp.inscricao_estadual \\r\\n        AND mc.tipo_debito = sp.tipo_debito\\r\\n    GROUP BY mc.inscricao_estadual\\r\\n) dados\\r\\nGROUP BY \\r\\n    CASE \\r\\n        WHEN valor_total_devido >= 10000000 THEN '10M+'\\r\\n        WHEN valor_total_devido >= 1000000 THEN '1M-10M'\\r\\n        WHEN valor_total_devido >= 100000 THEN '100K-1M'\\r\\n        WHEN valor_total_devido >= 10000 THEN '10K-100K'\\r\\n        ELSE 'At\\u00e9 10K'\\r\\n    END\\r\\nORDER BY MIN(valor_total_devido) DESC;\\r\\n\\r\\n-- 1.3. DISTRIBUI\\u00c7\\u00c3O POR PRIORIDADE\\r\\nSELECT \\r\\n    '1.3. DISTRIBUI\\u00c7\\u00c3O PRIORIDADE' AS consulta,\\r\\n    sp.classificacao_prioridade,\\r\\n    COUNT(DISTINCT mc.inscricao_estadual) AS quantidade,\\r\\n    ROUND(COUNT(DISTINCT mc.inscricao_estadual) * 100.0 / \\r\\n          SUM(COUNT(DISTINCT mc.inscricao_estadual)) OVER(), 2) AS percentual,\\r\\n    SUM(mc.valor_total_devido) AS valor_total,\\r\\n    ROUND(AVG(sp.score_final_priorizacao), 2) AS score_medio\\r\\nFROM gecob.prior_master_consolidado mc\\r\\nJOIN gecob.prior_score_priorizacao sp \\r\\n    ON mc.inscricao_estadual = sp.inscricao_estadual \\r\\n    AND mc.tipo_debito = sp.tipo_debito\\r\\nGROUP BY sp.classificacao_prioridade\\r\\nORDER BY \\r\\n    CASE sp.classificacao_prioridade\\r\\n        WHEN 'PRIORIDADE_MAXIMA' THEN 1\\r\\n        WHEN 'PRIORIDADE_ALTA' THEN 2\\r\\n        WHEN 'PRIORIDADE_MEDIA' THEN 3\\r\\n        ELSE 4\\r\\n    END;\\r\\n\\r\\n-- =================================================================================================\\r\\n-- SE\\u00c7\\u00c3O 2: RANKINGS E AN\\u00c1LISES\\r\\n-- =================================================================================================\\r\\n\\r\\n-- 2.1. TOP 50 CONTRIBUINTES POR SCORE\\r\\nSELECT \\r\\n    '2.1. TOP 50 SCORES' AS consulta,\\r\\n    mc.inscricao_estadual,\\r\\n    mc.razao_social,\\r\\n    mc.nome_fantasia,\\r\\n    mc.cnpj,\\r\\n    sp.score_final_priorizacao,\\r\\n    sp.classificacao_prioridade,\\r\\n    mc.valor_total_devido,\\r\\n    mc.situacao_cadastral_desc,\\r\\n    mc.porte_por_faturamento,\\r\\n    mc.qtd_total_contatos,\\r\\n    mc.flag_falencia,\\r\\n    mc.nome_municipio\\r\\nFROM gecob.prior_master_consolidado mc\\r\\nJOIN gecob.prior_score_priorizacao sp \\r\\n    ON mc.inscricao_estadual = sp.inscricao_estadual \\r\\n    AND mc.tipo_debito = sp.tipo_debito\\r\\nORDER BY sp.score_final_priorizacao DESC\\r\\nLIMIT 50;\\r\\n\\r\\n-- 2.2. TOP 30 SETORES POR VALOR\\r\\nSELECT \\r\\n    '2.2. TOP SETORES' AS consulta,\\r\\n    mc.secao_cnae,\\r\\n    mc.descricao_secao,\\r\\n    COUNT(DISTINCT mc.inscricao_estadual) AS qtd_contribuintes,\\r\\n    SUM(mc.valor_total_devido) AS valor_total,\\r\\n    ROUND(AVG(sp.score_final_priorizacao), 2) AS score_medio,\\r\\n    SUM(CASE WHEN sp.classificacao_prioridade IN ('PRIORIDADE_MAXIMA', 'PRIORIDADE_ALTA') THEN 1 ELSE 0 END) AS alta_prioridade,\\r\\n    SUM(CASE WHEN mc.flag_falencia = 1 THEN 1 ELSE 0 END) AS casos_falencia\\r\\nFROM gecob.prior_master_consolidado mc\\r\\nJOIN gecob.prior_score_priorizacao sp \\r\\n    ON mc.inscricao_estadual = sp.inscricao_estadual \\r\\n    AND mc.tipo_debito = sp.tipo_debito\\r\\nWHERE mc.secao_cnae IS NOT NULL\\r\\nGROUP BY mc.secao_cnae, mc.descricao_secao\\r\\nHAVING COUNT(DISTINCT mc.inscricao_estadual) >= 5\\r\\nORDER BY SUM(mc.valor_total_devido) DESC\\r\\nLIMIT 30;\\r\\n\\r\\n-- 2.3. TOP 20 MUNIC\\u00cdPIOS\\r\\nSELECT \\r\\n    '2.3. TOP MUNIC\\u00cdPIOS' AS consulta,\\r\\n    mc.codigo_municipio,\\r\\n    mc.nome_municipio,\\r\\n    COUNT(DISTINCT mc.inscricao_estadual) AS qtd_contribuintes,\\r\\n    SUM(mc.valor_total_devido) AS valor_total,\\r\\n    ROUND(AVG(sp.score_final_priorizacao), 2) AS score_medio,\\r\\n    SUM(CASE WHEN sp.classificacao_prioridade = 'PRIORIDADE_MAXIMA' THEN 1 ELSE 0 END) AS prioridade_maxima,\\r\\n    ROUND(AVG(mc.taxa_resposta_contatos) * 100, 2) AS taxa_resposta_pct\\r\\nFROM gecob.prior_master_consolidado mc\\r\\nJOIN gecob.prior_score_priorizacao sp \\r\\n    ON mc.inscricao_estadual = sp.inscricao_estadual \\r\\n    AND mc.tipo_debito = sp.tipo_debito\\r\\nWHERE mc.nome_municipio IS NOT NULL\\r\\nGROUP BY mc.codigo_municipio, mc.nome_municipio\\r\\nORDER BY SUM(mc.valor_total_devido) DESC\\r\\nLIMIT 20;\\r\\n\\r\\n-- 2.4. MELHOR RESPONSIVIDADE (ALTA PRIORIDADE)\\r\\nSELECT \\r\\n    '2.4. MELHOR RESPONSIVIDADE' AS consulta,\\r\\n    mc.inscricao_estadual,\\r\\n    mc.razao_social,\\r\\n    mc.valor_total_devido,\\r\\n    sp.classificacao_prioridade,\\r\\n    mc.qtd_total_contatos,\\r\\n    ROUND(mc.taxa_resposta_contatos * 100, 2) AS taxa_resposta_pct,\\r\\n    mc.qtd_promessas_pagamento,\\r\\n    fm.capacidade_pagamento_estimada,\\r\\n    fm.perfil_engajamento,\\r\\n    -- NOVAS M\\u00c9TRICAS V1.5\\r\\n    mc.qtd_contatos_ultimos_30_dias,\\r\\n    mc.qtd_contatos_ultimos_90_dias\\r\\nFROM gecob.prior_master_consolidado mc\\r\\nJOIN gecob.prior_score_priorizacao sp \\r\\n    ON mc.inscricao_estadual = sp.inscricao_estadual \\r\\n    AND mc.tipo_debito = sp.tipo_debito\\r\\nJOIN gecob.prior_features_ml fm \\r\\n    ON mc.inscricao_estadual = fm.inscricao_estadual \\r\\n    AND mc.tipo_debito = fm.tipo_debito\\r\\nWHERE sp.classificacao_prioridade IN ('PRIORIDADE_MAXIMA', 'PRIORIDADE_ALTA')\\r\\n  AND mc.qtd_total_contatos >= 3\\r\\nORDER BY mc.taxa_resposta_contatos DESC\\r\\nLIMIT 30;\\r\\n\\r\\n-- 2.5. EMPRESAS NOTEIRAS (ALTO RISCO FISCAL)\\r\\nSELECT \\r\\n    '2.5. EMPRESAS NOTEIRAS' AS consulta,\\r\\n    mc.inscricao_estadual,\\r\\n    mc.razao_social,\\r\\n    mc.cnpj,\\r\\n    mc.valor_total_devido,\\r\\n    mc.score_noteiras,\\r\\n    mc.qtd_indicios_noteiras,\\r\\n    mc.classificacao_risco_noteiras,\\r\\n    sp.score_final_priorizacao,\\r\\n    sp.classificacao_prioridade,\\r\\n    mc.situacao_cadastral_desc,\\r\\n    mc.porte_por_faturamento\\r\\nFROM gecob.prior_master_consolidado mc\\r\\nJOIN gecob.prior_score_priorizacao sp \\r\\n    ON mc.inscricao_estadual = sp.inscricao_estadual \\r\\n    AND mc.tipo_debito = sp.tipo_debito\\r\\nWHERE mc.score_noteiras > 0\\r\\nORDER BY mc.score_noteiras DESC, sp.score_final_priorizacao DESC\\r\\nLIMIT 30;\\r\\n\\r\\n-- =================================================================================================\\r\\n-- SE\\u00c7\\u00c3O 3: DOSSI\\u00ca DE CONTRIBUINTE (MODIFICAR INSCRI\\u00c7\\u00c3O ESTADUAL)\\r\\n-- =================================================================================================\\r\\n\\r\\n-- 3.1. DOSSI\\u00ca - VIS\\u00c3O GERAL\\r\\n-- MODIFICAR: Trocar '0000000000000' pela inscri\\u00e7\\u00e3o estadual desejada\\r\\nSELECT \\r\\n    '3.1. DOSSI\\u00ca GERAL' AS consulta,\\r\\n    mc.inscricao_estadual,\\r\\n    mc.cnpj,\\r\\n    mc.razao_social,\\r\\n    mc.nome_fantasia,\\r\\n    sp.score_final_priorizacao,\\r\\n    sp.classificacao_prioridade,\\r\\n    sp.score_valor_debito,\\r\\n    sp.score_capacidade_pagamento,\\r\\n    sp.score_historico_pagamento,\\r\\n    sp.score_responsividade,\\r\\n    sp.score_viabilidade_cobranca,\\r\\n    mc.valor_total_devido,\\r\\n    mc.saldo_imposto,\\r\\n    mc.saldo_multa,\\r\\n    mc.saldo_juros,\\r\\n    mc.situacao_cadastral_desc,\\r\\n    mc.cnae_classe,\\r\\n    mc.descricao_cnae,\\r\\n    mc.porte_por_faturamento,\\r\\n    mc.nome_municipio,\\r\\n    mc.qtd_socios_ativos\\r\\nFROM gecob.prior_master_consolidado mc\\r\\nJOIN gecob.prior_score_priorizacao sp \\r\\n    ON mc.inscricao_estadual = sp.inscricao_estadual \\r\\n    AND mc.tipo_debito = sp.tipo_debito\\r\\nWHERE mc.inscricao_estadual = '0000000000000'; -- << MODIFIQUE AQUI\\r\\n\\r\\n-- 3.2. DOSSI\\u00ca - HIST\\u00d3RICO DE CONTATOS\\r\\nSELECT \\r\\n    '3.2. DOSSI\\u00ca CONTATOS' AS consulta,\\r\\n    mc.inscricao_estadual,\\r\\n    mc.razao_social,\\r\\n    mc.data_inclusao_cobranca,\\r\\n    fm.dias_desde_inclusao_cobranca,\\r\\n    fm.faixa_idade_debito,\\r\\n    mc.qtd_total_contatos,\\r\\n    mc.qtd_respostas_positivas,\\r\\n    mc.qtd_respostas_negativas,\\r\\n    ROUND(mc.taxa_resposta_contatos * 100, 2) AS taxa_resposta_pct,\\r\\n    mc.qtd_promessas_pagamento,\\r\\n    mc.data_ultimo_contato,\\r\\n    mc.dias_desde_ultimo_contato,\\r\\n    fm.perfil_engajamento,\\r\\n    -- NOVAS M\\u00c9TRICAS V1.5\\r\\n    mc.qtd_contatos_ultimos_30_dias,\\r\\n    mc.qtd_contatos_ultimos_90_dias\\r\\nFROM gecob.prior_master_consolidado mc\\r\\nJOIN gecob.prior_features_ml fm \\r\\n    ON mc.inscricao_estadual = fm.inscricao_estadual \\r\\n    AND mc.tipo_debito = fm.tipo_debito\\r\\nWHERE mc.inscricao_estadual = '0000000000000'; -- << MODIFIQUE AQUI\\r\\n\\r\\n-- 3.3. DOSSI\\u00ca - AN\\u00c1LISE FINANCEIRA\\r\\nSELECT \\r\\n    '3.3. DOSSI\\u00ca FINANCEIRO' AS consulta,\\r\\n    mc.inscricao_estadual,\\r\\n    mc.razao_social,\\r\\n    mc.faturamento_total_6m,\\r\\n    mc.faturamento_medio_6m,\\r\\n    mc.icms_devido_total_6m,\\r\\n    mc.icms_recolher_total_6m,\\r\\n    mc.qtd_periodos_declarados_6m,\\r\\n    mc.qtd_periodos_omissos_6m,\\r\\n    mc.regularidade_declaracoes,\\r\\n    mc.qtd_pagamentos_6m,\\r\\n    mc.valor_total_pago_6m,\\r\\n    mc.regularidade_pagamentos,\\r\\n    ROUND(fm.capacidade_pagamento_estimada, 2) AS capacidade_pagamento,\\r\\n    ROUND(fm.taxa_pagamento_vs_devido_6m * 100, 2) AS taxa_compliance_pct,\\r\\n    ROUND(fm.score_compliance * 100, 2) AS score_compliance\\r\\nFROM gecob.prior_master_consolidado mc\\r\\nJOIN gecob.prior_features_ml fm \\r\\n    ON mc.inscricao_estadual = fm.inscricao_estadual \\r\\n    AND mc.tipo_debito = fm.tipo_debito\\r\\nWHERE mc.inscricao_estadual = '0000000000000'; -- << MODIFIQUE AQUI\\r\\n\\r\\n-- 3.4. DOSSI\\u00ca - SITUA\\u00c7\\u00c3O DE RISCO\\r\\nSELECT \\r\\n    '3.4. DOSSI\\u00ca RISCO' AS consulta,\\r\\n    mc.inscricao_estadual,\\r\\n    mc.razao_social,\\r\\n    mc.flag_falencia,\\r\\n    mc.flag_recuperacao_judicial,\\r\\n    mc.flag_devedor_contumaz,\\r\\n    mc.flag_protesto,\\r\\n    fm.score_risco_situacao,\\r\\n    mc.score_noteiras,\\r\\n    mc.qtd_indicios_noteiras,\\r\\n    mc.classificacao_risco_noteiras,\\r\\n    mc.flag_tem_parcelamento,\\r\\n    mc.status_parcelamento_desc,\\r\\n    mc.saldo_parcelado,\\r\\n    mc.numero_parcelas,\\r\\n    sp.score_viabilidade_cobranca\\r\\nFROM gecob.prior_master_consolidado mc\\r\\nJOIN gecob.prior_features_ml fm \\r\\n    ON mc.inscricao_estadual = fm.inscricao_estadual \\r\\n    AND mc.tipo_debito = fm.tipo_debito\\r\\nJOIN gecob.prior_score_priorizacao sp \\r\\n    ON mc.inscricao_estadual = sp.inscricao_estadual \\r\\n    AND mc.tipo_debito = sp.tipo_debito\\r\\nWHERE mc.inscricao_estadual = '0000000000000'; -- << MODIFIQUE AQUI\\r\\n\\r\\n-- =================================================================================================\\r\\n-- SE\\u00c7\\u00c3O 4: AN\\u00c1LISES ESPECIALIZADAS\\r\\n-- =================================================================================================\\r\\n\\r\\n-- 4.1. ALTA PRIORIDADE + BOA CAPACIDADE\\r\\nSELECT \\r\\n    '4.1. ALTA PRIORIDADE + CAPACIDADE' AS consulta,\\r\\n    mc.inscricao_estadual,\\r\\n    mc.razao_social,\\r\\n    mc.valor_total_devido,\\r\\n    sp.score_final_priorizacao,\\r\\n    sp.classificacao_prioridade,\\r\\n    fm.capacidade_pagamento_estimada,\\r\\n    mc.faturamento_medio_6m,\\r\\n    mc.regularidade_pagamentos,\\r\\n    ROUND(fm.taxa_pagamento_vs_devido_6m * 100, 2) AS taxa_compliance_pct,\\r\\n    mc.situacao_cadastral_desc,\\r\\n    mc.qtd_total_contatos,\\r\\n    fm.perfil_engajamento,\\r\\n    CASE \\r\\n        WHEN fm.taxa_efetividade_contatos >= 0.5 THEN 'CONTATO_IMEDIATO_NEGOCIACAO'\\r\\n        WHEN mc.qtd_total_contatos < 3 THEN 'INTENSIFICAR_CONTATOS'\\r\\n        WHEN mc.flag_tem_parcelamento = 0 THEN 'OFERECER_PARCELAMENTO'\\r\\n        ELSE 'NEGOCIACAO_DESCONTO'\\r\\n    END AS acao_recomendada\\r\\nFROM gecob.prior_master_consolidado mc\\r\\nJOIN gecob.prior_score_priorizacao sp \\r\\n    ON mc.inscricao_estadual = sp.inscricao_estadual \\r\\n    AND mc.tipo_debito = sp.tipo_debito\\r\\nJOIN gecob.prior_features_ml fm \\r\\n    ON mc.inscricao_estadual = fm.inscricao_estadual \\r\\n    AND mc.tipo_debito = fm.tipo_debito\\r\\nWHERE sp.classificacao_prioridade IN ('PRIORIDADE_MAXIMA', 'PRIORIDADE_ALTA')\\r\\n  AND fm.capacidade_pagamento_estimada >= 1.5\\r\\n  AND mc.flag_falencia = 0\\r\\n  AND mc.flag_recuperacao_judicial = 0\\r\\n  AND mc.situacao_cadastral_desc = 'ATIVO'\\r\\nORDER BY sp.score_final_priorizacao DESC\\r\\nLIMIT 100;\\r\\n\\r\\n-- 4.2. CASOS DE RECUPERA\\u00c7\\u00c3O P\\u00d3S-CONTATO\\r\\nSELECT \\r\\n    '4.2. RECUPERA\\u00c7\\u00c3O P\\u00d3S-CONTATO' AS consulta,\\r\\n    mc.inscricao_estadual,\\r\\n    mc.razao_social,\\r\\n    mc.valor_total_devido,\\r\\n    sp.score_final_priorizacao,\\r\\n    mc.qtd_total_contatos,\\r\\n    mc.qtd_respostas_positivas,\\r\\n    ROUND(mc.taxa_resposta_contatos * 100, 2) AS taxa_resposta_pct,\\r\\n    mc.qtd_periodos_pagamento_6m,\\r\\n    ROUND(fm.taxa_pagamento_vs_devido_6m * 100, 2) AS taxa_pagamento_pct,\\r\\n    mc.regularidade_pagamentos,\\r\\n    fm.perfil_engajamento,\\r\\n    mc.data_ultimo_contato\\r\\nFROM gecob.prior_master_consolidado mc\\r\\nJOIN gecob.prior_score_priorizacao sp \\r\\n    ON mc.inscricao_estadual = sp.inscricao_estadual \\r\\n    AND mc.tipo_debito = sp.tipo_debito\\r\\nJOIN gecob.prior_features_ml fm \\r\\n    ON mc.inscricao_estadual = fm.inscricao_estadual \\r\\n    AND mc.tipo_debito = fm.tipo_debito\\r\\nWHERE mc.qtd_respostas_positivas >= 2\\r\\n  AND mc.qtd_total_contatos >= 3\\r\\n  AND mc.taxa_resposta_contatos >= 0.4\\r\\n  AND mc.qtd_periodos_pagamento_6m >= 3\\r\\nORDER BY mc.taxa_resposta_contatos DESC\\r\\nLIMIT 50;\\r\\n\\r\\n-- 4.3. CASOS CR\\u00cdTICOS PARA D\\u00cdVIDA ATIVA\\r\\nSELECT \\r\\n    '4.3. CASOS CR\\u00cdTICOS D\\u00cdVIDA ATIVA' AS consulta,\\r\\n    mc.inscricao_estadual,\\r\\n    mc.razao_social,\\r\\n    mc.valor_total_devido,\\r\\n    fm.dias_desde_inclusao_cobranca,\\r\\n    sp.score_viabilidade_cobranca,\\r\\n    mc.flag_falencia,\\r\\n    mc.flag_recuperacao_judicial,\\r\\n    mc.situacao_cadastral_desc,\\r\\n    mc.qtd_total_contatos,\\r\\n    ROUND(mc.taxa_resposta_contatos * 100, 2) AS taxa_resposta_pct,\\r\\n    mc.classificacao_omissao,\\r\\n    CASE \\r\\n        WHEN mc.flag_falencia = 1 THEN 'FAL\\u00caNCIA'\\r\\n        WHEN mc.flag_recuperacao_judicial = 1 THEN 'RECUPERA\\u00c7\\u00c3O JUDICIAL'\\r\\n        WHEN fm.dias_desde_inclusao_cobranca > 730 AND mc.qtd_total_contatos >= 10 AND mc.taxa_resposta_contatos < 0.2 THEN 'N\\u00c3O RESPONSIVO'\\r\\n        ELSE 'OUTROS'\\r\\n    END AS motivo_principal\\r\\nFROM gecob.prior_master_consolidado mc\\r\\nJOIN gecob.prior_score_priorizacao sp \\r\\n    ON mc.inscricao_estadual = sp.inscricao_estadual \\r\\n    AND mc.tipo_debito = sp.tipo_debito\\r\\nJOIN gecob.prior_features_ml fm \\r\\n    ON mc.inscricao_estadual = fm.inscricao_estadual \\r\\n    AND mc.tipo_debito = fm.tipo_debito\\r\\nWHERE sp.score_viabilidade_cobranca < 40\\r\\n  OR mc.flag_falencia = 1\\r\\n  OR mc.flag_recuperacao_judicial = 1\\r\\nORDER BY sp.score_viabilidade_cobranca ASC\\r\\nLIMIT 100;\\r\\n\\r\\n-- 4.4. AN\\u00c1LISE DE PARCELAMENTOS\\r\\nSELECT \\r\\n    '4.4. PARCELAMENTOS' AS consulta,\\r\\n    mc.inscricao_estadual,\\r\\n    mc.razao_social,\\r\\n    mc.valor_total_devido,\\r\\n    mc.numero_parcelamento,\\r\\n    mc.status_parcelamento_desc,\\r\\n    mc.saldo_parcelado,\\r\\n    mc.numero_parcelas,\\r\\n    fm.capacidade_pagamento_estimada,\\r\\n    mc.regularidade_pagamentos,\\r\\n    CASE \\r\\n        WHEN mc.status_parcelamento_desc = 'INADIMPLENTE' THEN 'ALERTA: Inadimplente'\\r\\n        WHEN fm.capacidade_pagamento_estimada >= 3 THEN 'Oportunidade Quita\\u00e7\\u00e3o'\\r\\n        ELSE 'Normal'\\r\\n    END AS status_alerta\\r\\nFROM gecob.prior_master_consolidado mc\\r\\nJOIN gecob.prior_features_ml fm \\r\\n    ON mc.inscricao_estadual = fm.inscricao_estadual \\r\\n    AND mc.tipo_debito = fm.tipo_debito\\r\\nWHERE mc.flag_tem_parcelamento = 1\\r\\nORDER BY \\r\\n    CASE mc.status_parcelamento_desc \\r\\n        WHEN 'INADIMPLENTE' THEN 1\\r\\n        WHEN 'ATIVO' THEN 2\\r\\n        ELSE 3 \\r\\n    END,\\r\\n    mc.saldo_parcelado DESC;\\r\\n\\r\\n-- 4.5. IMPACTO ARRECADAT\\u00d3RIO POR SETOR\\r\\nSELECT \\r\\n    '4.5. IMPACTO POR SETOR' AS consulta,\\r\\n    mc.secao_cnae,\\r\\n    mc.descricao_secao,\\r\\n    COUNT(DISTINCT mc.inscricao_estadual) AS qtd_total,\\r\\n    SUM(mc.valor_total_devido) AS valor_total,\\r\\n    SUM(CASE \\r\\n        WHEN sp.classificacao_prioridade IN ('PRIORIDADE_MAXIMA', 'PRIORIDADE_ALTA')\\r\\n        AND fm.capacidade_pagamento_estimada >= 1.5\\r\\n        AND mc.flag_falencia = 0\\r\\n        THEN 1 ELSE 0\\r\\n    END) AS casos_alta_recuperabilidade,\\r\\n    SUM(CASE \\r\\n        WHEN sp.classificacao_prioridade IN ('PRIORIDADE_MAXIMA', 'PRIORIDADE_ALTA')\\r\\n        AND fm.capacidade_pagamento_estimada >= 1.5\\r\\n        AND mc.flag_falencia = 0\\r\\n        THEN mc.valor_total_devido ELSE 0\\r\\n    END) AS valor_recuperavel,\\r\\n    ROUND(AVG(sp.score_final_priorizacao), 2) AS score_medio\\r\\nFROM gecob.prior_master_consolidado mc\\r\\nJOIN gecob.prior_score_priorizacao sp \\r\\n    ON mc.inscricao_estadual = sp.inscricao_estadual \\r\\n    AND mc.tipo_debito = sp.tipo_debito\\r\\nJOIN gecob.prior_features_ml fm \\r\\n    ON mc.inscricao_estadual = fm.inscricao_estadual \\r\\n    AND mc.tipo_debito = fm.tipo_debito\\r\\nWHERE mc.secao_cnae IS NOT NULL\\r\\nGROUP BY mc.secao_cnae, mc.descricao_secao\\r\\nHAVING COUNT(DISTINCT mc.inscricao_estadual) >= 5\\r\\nORDER BY valor_recuperavel DESC\\r\\nLIMIT 30;\\r\\n\\r\\n-- =================================================================================================\\r\\n-- SE\\u00c7\\u00c3O 5: DASHBOARD EXECUTIVO\\r\\n-- =================================================================================================\\r\\n\\r\\n-- 5.1. KPIs PRINCIPAIS\\r\\nSELECT \\r\\n    'DASHBOARD EXECUTIVO' AS consulta,\\r\\n    COUNT(DISTINCT mc.inscricao_estadual) AS total_contribuintes,\\r\\n    SUM(mc.valor_total_devido) AS divida_total,\\r\\n    SUM(CASE WHEN sp.classificacao_prioridade = 'PRIORIDADE_MAXIMA' THEN 1 ELSE 0 END) AS qtd_prioridade_maxima,\\r\\n    SUM(CASE WHEN sp.classificacao_prioridade = 'PRIORIDADE_ALTA' THEN 1 ELSE 0 END) AS qtd_prioridade_alta,\\r\\n    SUM(CASE \\r\\n        WHEN sp.classificacao_prioridade IN ('PRIORIDADE_MAXIMA', 'PRIORIDADE_ALTA')\\r\\n        AND fm.capacidade_pagamento_estimada >= 1.5\\r\\n        AND mc.flag_falencia = 0\\r\\n        THEN 1 ELSE 0\\r\\n    END) AS casos_alta_recuperabilidade,\\r\\n    SUM(CASE \\r\\n        WHEN sp.classificacao_prioridade IN ('PRIORIDADE_MAXIMA', 'PRIORIDADE_ALTA')\\r\\n        AND fm.capacidade_pagamento_estimada >= 1.5\\r\\n        AND mc.flag_falencia = 0\\r\\n        THEN mc.valor_total_devido ELSE 0\\r\\n    END) AS valor_alta_recuperabilidade,\\r\\n    ROUND(AVG(mc.taxa_resposta_contatos) * 100, 2) AS taxa_resposta_pct,\\r\\n    SUM(CASE WHEN mc.flag_falencia = 1 THEN 1 ELSE 0 END) AS casos_falencia,\\r\\n    SUM(CASE WHEN sp.score_viabilidade_cobranca < 40 THEN 1 ELSE 0 END) AS casos_baixa_viabilidade,\\r\\n    FROM_UNIXTIME(UNIX_TIMESTAMP()) AS data_atualizacao\\r\\nFROM gecob.prior_master_consolidado mc\\r\\nJOIN gecob.prior_score_priorizacao sp \\r\\n    ON mc.inscricao_estadual = sp.inscricao_estadual \\r\\n    AND mc.tipo_debito = sp.tipo_debito\\r\\nJOIN gecob.prior_features_ml fm \\r\\n    ON mc.inscricao_estadual = fm.inscricao_estadual \\r\\n    AND mc.tipo_debito = fm.tipo_debito;\", \"result\": {\"id\": \"be3f0f40-d8cd-e4a3-686c-c595c61eb8b1\", \"type\": \"table\", \"hasResultset\": true, \"handle\": {\"secret\": \"RIQ2SCkQT+q5D4pHZ14clg==\", \"guid\": \"JdjfT0wGRZUAAAAA4EkacA==\", \"operation_type\": 0, \"has_result_set\": true, \"modified_row_count\": null, \"log_context\": null, \"session_guid\": \"8c47a7f3a2b84388:165ae9418edb4bae\", \"session_id\": 21358, \"session_type\": \"impala\", \"statement_id\": 19, \"has_more_statements\": false, \"statements_count\": 20, \"previous_statement_hash\": \"ddaf9d17c150264be3120bc858d166dd2b11979c7025e7713b56fd98\", \"start\": {\"row\": 481, \"column\": 0}, \"end\": {\"row\": 514, \"column\": 39}, \"statement\": \"-- =================================================================================================\\n-- SE\\u00c7\\u00c3O 5: DASHBOARD EXECUTIVO\\n-- =================================================================================================\\n\\n-- 5.1. KPIs PRINCIPAIS\\nSELECT \\n    'DASHBOARD EXECUTIVO' AS consulta,\\n    COUNT(DISTINCT mc.inscricao_estadual) AS total_contribuintes,\\n    SUM(mc.valor_total_devido) AS divida_total,\\n    SUM(CASE WHEN sp.classificacao_prioridade = 'PRIORIDADE_MAXIMA' THEN 1 ELSE 0 END) AS qtd_prioridade_maxima,\\n    SUM(CASE WHEN sp.classificacao_prioridade = 'PRIORIDADE_ALTA' THEN 1 ELSE 0 END) AS qtd_prioridade_alta,\\n    SUM(CASE \\n        WHEN sp.classificacao_prioridade IN ('PRIORIDADE_MAXIMA', 'PRIORIDADE_ALTA')\\n        AND fm.capacidade_pagamento_estimada >= 1.5\\n        AND mc.flag_falencia = 0\\n        THEN 1 ELSE 0\\n    END) AS casos_alta_recuperabilidade,\\n    SUM(CASE \\n        WHEN sp.classificacao_prioridade IN ('PRIORIDADE_MAXIMA', 'PRIORIDADE_ALTA')\\n        AND fm.capacidade_pagamento_estimada >= 1.5\\n        AND mc.flag_falencia = 0\\n        THEN mc.valor_total_devido ELSE 0\\n    END) AS valor_alta_recuperabilidade,\\n    ROUND(AVG(mc.taxa_resposta_contatos) * 100, 2) AS taxa_resposta_pct,\\n    SUM(CASE WHEN mc.flag_falencia = 1 THEN 1 ELSE 0 END) AS casos_falencia,\\n    SUM(CASE WHEN sp.score_viabilidade_cobranca < 40 THEN 1 ELSE 0 END) AS casos_baixa_viabilidade,\\n    FROM_UNIXTIME(UNIX_TIMESTAMP()) AS data_atualizacao\\nFROM gecob.prior_master_consolidado mc\\nJOIN gecob.prior_score_priorizacao sp \\n    ON mc.inscricao_estadual = sp.inscricao_estadual \\n    AND mc.tipo_debito = sp.tipo_debito\\nJOIN gecob.prior_features_ml fm \\n    ON mc.inscricao_estadual = fm.inscricao_estadual \\n    AND mc.tipo_debito = fm.tipo_debito\"}, \"meta\": [], \"rows\": 1, \"hasMore\": false, \"statement_id\": 19, \"statement_range\": {\"start\": {\"row\": 481, \"column\": 0}, \"end\": {\"row\": 514, \"column\": 39}}, \"statements_count\": 20, \"metaFilter\": {\"query\": \"\", \"facets\": {}, \"text\": []}, \"isMetaFilterVisible\": false, \"filteredMetaChecked\": true, \"filteredColumnCount\": 11, \"filteredMeta\": [{\"type\": \"int\", \"name\": \"\", \"comment\": null, \"cssClass\": \"sort-string\", \"checked\": true, \"originalIndex\": 0}, {\"name\": \"consulta\", \"type\": \"string\", \"comment\": null, \"cssClass\": \"sort-string\", \"checked\": true, \"originalIndex\": 1}, {\"name\": \"total_contribuintes\", \"type\": \"bigint\", \"comment\": null, \"cssClass\": \"sort-string\", \"checked\": true, \"originalIndex\": 2}, {\"name\": \"divida_total\", \"type\": \"decimal\", \"comment\": null, \"cssClass\": \"sort-string\", \"checked\": true, \"originalIndex\": 3}, {\"name\": \"qtd_prioridade_maxima\", \"type\": \"bigint\", \"comment\": null, \"cssClass\": \"sort-string\", \"checked\": true, \"originalIndex\": 4}, {\"name\": \"qtd_prioridade_alta\", \"type\": \"bigint\", \"comment\": null, \"cssClass\": \"sort-string\", \"checked\": true, \"originalIndex\": 5}, {\"name\": \"casos_alta_recuperabilidade\", \"type\": \"bigint\", \"comment\": null, \"cssClass\": \"sort-string\", \"checked\": true, \"originalIndex\": 6}, {\"name\": \"valor_alta_recuperabilidade\", \"type\": \"decimal\", \"comment\": null, \"cssClass\": \"sort-string\", \"checked\": true, \"originalIndex\": 7}, {\"name\": \"taxa_resposta_pct\", \"type\": \"double\", \"comment\": null, \"cssClass\": \"sort-string\", \"checked\": true, \"originalIndex\": 8}, {\"name\": \"casos_falencia\", \"type\": \"bigint\", \"comment\": null, \"cssClass\": \"sort-string\", \"checked\": true, \"originalIndex\": 9}, {\"name\": \"casos_baixa_viabilidade\", \"type\": \"bigint\", \"comment\": null, \"cssClass\": \"sort-string\", \"checked\": true, \"originalIndex\": 10}, {\"name\": \"data_atualizacao\", \"type\": \"string\", \"comment\": null, \"cssClass\": \"sort-string\", \"checked\": true, \"originalIndex\": 11}], \"fetchedOnce\": false, \"startTime\": \"2025-10-09T17:22:42.740Z\", \"endTime\": \"2025-10-09T17:22:44.079Z\", \"executionTime\": 1339, \"data\": [], \"explanation\": \"\", \"logs\": \"\", \"logLines\": 4, \"hasSomeResults\": true}, \"showGrid\": true, \"showChart\": false, \"showLogs\": true, \"progress\": 0, \"jobs\": [], \"executeNextTimeout\": 3034, \"isLoading\": false, \"resultsKlass\": \"results impala\", \"errorsKlass\": \"results impala alert alert-error\", \"is_redacted\": false, \"chartType\": \"bars\", \"chartSorting\": \"none\", \"chartScatterGroup\": null, \"chartScatterSize\": null, \"chartScope\": \"world\", \"chartTimelineType\": \"bar\", \"chartLimits\": [5, 10, 25, 50, 100], \"chartLimit\": null, \"chartX\": \"consulta\", \"chartXPivot\": null, \"chartYSingle\": null, \"chartYMulti\": [\"divida_total\"], \"chartData\": [], \"chartMapType\": \"marker\", \"chartMapLabel\": null, \"chartMapHeat\": null, \"hideStacked\": true, \"hasDataForChart\": true, \"previousChartOptions\": {\"chartLimit\": null, \"chartX\": \"consulta\", \"chartXPivot\": null, \"chartYSingle\": null, \"chartMapType\": \"marker\", \"chartMapLabel\": null, \"chartMapHeat\": null, \"chartYMulti\": [\"valor_total\"], \"chartScope\": \"world\", \"chartTimelineType\": \"bar\", \"chartSorting\": \"none\", \"chartScatterGroup\": null, \"chartScatterSize\": null}, \"isResultSettingsVisible\": false, \"settingsVisible\": false, \"checkStatusTimeout\": 11448, \"getLogsTimeout\": 11558, \"topRisk\": null, \"suggestion\": \"\", \"hasSuggestion\": null, \"compatibilityCheckRunning\": false, \"compatibilitySourcePlatforms\": [{\"name\": \"Teradata\", \"value\": \"teradata\"}, {\"name\": \"Oracle\", \"value\": \"oracle\"}, {\"name\": \"Netezza\", \"value\": \"netezza\"}, {\"name\": \"Impala\", \"value\": \"impala\"}, {\"name\": \"Hive\", \"value\": \"hive\"}, {\"name\": \"DB2\", \"value\": \"db2\"}, {\"name\": \"Greenplum\", \"value\": \"greenplum\"}, {\"name\": \"MySQL\", \"value\": \"mysql\"}, {\"name\": \"PostgreSQL\", \"value\": \"postgresql\"}, {\"name\": \"Informix\", \"value\": \"informix\"}, {\"name\": \"SQL Server\", \"value\": \"sqlserver\"}, {\"name\": \"Sybase\", \"value\": \"sybase\"}, {\"name\": \"Access\", \"value\": \"access\"}, {\"name\": \"Firebird\", \"value\": \"firebird\"}, {\"name\": \"ANSISQL\", \"value\": \"ansisql\"}, {\"name\": \"Generic\", \"value\": \"generic\"}], \"compatibilitySourcePlatform\": {\"name\": \"Impala\", \"value\": \"impala\"}, \"compatibilityTargetPlatforms\": [{\"name\": \"Impala\", \"value\": \"impala\"}, {\"name\": \"Hive\", \"value\": \"hive\"}], \"compatibilityTargetPlatform\": {\"name\": \"Impala\", \"value\": \"impala\"}, \"showSqlAnalyzer\": false, \"wasBatchExecuted\": false, \"isReady\": true, \"lastExecuted\": 1760030562495, \"lastAceSelectionRowOffset\": 0, \"executingBlockingOperation\": null, \"showLongOperationWarning\": false, \"lastExecutedStatements\": \"/***************************************************************************************************\\r\\n * SISTEMA DE PRIORIZA\\u00c7\\u00c3O DE COBRAN\\u00c7A - CONSULTAS ANAL\\u00cdTICAS V3 (COMPAT\\u00cdVEL COM V1.5)\\r\\n * Receita Estadual de Santa Catarina - GECOB\\r\\n * Data: 09 de Outubro de 2025\\r\\n * \\r\\n * CORRE\\u00c7\\u00d5ES V3:\\r\\n * - Compatibilizado com V1.5 do sistema (pr\\u00e9-agrega\\u00e7\\u00e3o de conta corrente)\\r\\n * - Adicionadas novas m\\u00e9tricas de contatos (30/90 dias)\\r\\n * - Otimizado para trabalhar com dados j\\u00e1 agregados\\r\\n * - Removidas duplica\\u00e7\\u00f5es usando agrega\\u00e7\\u00e3o por inscricao_estadual\\r\\n ***************************************************************************************************/\\r\\n\\r\\nSET REQUEST_POOL = 'medium';\\r\\nSET MEM_LIMIT = 8G;\\r\\n\\r\\n-- =================================================================================================\\r\\n-- SE\\u00c7\\u00c3O 1: ESTAT\\u00cdSTICAS GERAIS DO SISTEMA\\r\\n-- =================================================================================================\\r\\n\\r\\n-- 1.1. PANORAMA GERAL\\r\\nSELECT \\r\\n    '1.1. PANORAMA GERAL' AS consulta,\\r\\n    COUNT(DISTINCT mc.inscricao_estadual) AS total_contribuintes,\\r\\n    SUM(mc.valor_total_devido) AS divida_total,\\r\\n    ROUND(AVG(mc.valor_total_devido), 2) AS divida_media,\\r\\n    COUNT(DISTINCT CASE WHEN sp.classificacao_prioridade = 'PRIORIDADE_MAXIMA' THEN mc.inscricao_estadual END) AS prioridade_maxima,\\r\\n    COUNT(DISTINCT CASE WHEN sp.classificacao_prioridade = 'PRIORIDADE_ALTA' THEN mc.inscricao_estadual END) AS prioridade_alta,\\r\\n    ROUND(AVG(mc.taxa_resposta_contatos) * 100, 2) AS taxa_resposta_pct,\\r\\n    COUNT(DISTINCT CASE WHEN mc.flag_falencia = 1 THEN mc.inscricao_estadual END) AS casos_falencia,\\r\\n    FROM_UNIXTIME(UNIX_TIMESTAMP()) AS data_atualizacao\\r\\nFROM gecob.prior_master_consolidado mc\\r\\nLEFT JOIN gecob.prior_score_priorizacao sp \\r\\n    ON mc.inscricao_estadual = sp.inscricao_estadual \\r\\n    AND mc.tipo_debito = sp.tipo_debito;\\r\\n\\r\\n-- 1.2. DISTRIBUI\\u00c7\\u00c3O POR FAIXAS DE VALOR\\r\\nSELECT \\r\\n    '1.2. FAIXAS DE VALOR' AS consulta,\\r\\n    CASE \\r\\n        WHEN valor_total_devido >= 10000000 THEN '10M+'\\r\\n        WHEN valor_total_devido >= 1000000 THEN '1M-10M'\\r\\n        WHEN valor_total_devido >= 100000 THEN '100K-1M'\\r\\n        WHEN valor_total_devido >= 10000 THEN '10K-100K'\\r\\n        ELSE 'At\\u00e9 10K'\\r\\n    END AS faixa,\\r\\n    COUNT(DISTINCT inscricao_estadual) AS qtd,\\r\\n    SUM(valor_total_devido) AS valor_total,\\r\\n    ROUND(AVG(score_final_priorizacao), 2) AS score_medio\\r\\nFROM (\\r\\n    SELECT \\r\\n        mc.inscricao_estadual,\\r\\n        SUM(mc.valor_total_devido) AS valor_total_devido,\\r\\n        MAX(sp.score_final_priorizacao) AS score_final_priorizacao\\r\\n    FROM gecob.prior_master_consolidado mc\\r\\n    LEFT JOIN gecob.prior_score_priorizacao sp \\r\\n        ON mc.inscricao_estadual = sp.inscricao_estadual \\r\\n        AND mc.tipo_debito = sp.tipo_debito\\r\\n    GROUP BY mc.inscricao_estadual\\r\\n) dados\\r\\nGROUP BY \\r\\n    CASE \\r\\n        WHEN valor_total_devido >= 10000000 THEN '10M+'\\r\\n        WHEN valor_total_devido >= 1000000 THEN '1M-10M'\\r\\n        WHEN valor_total_devido >= 100000 THEN '100K-1M'\\r\\n        WHEN valor_total_devido >= 10000 THEN '10K-100K'\\r\\n        ELSE 'At\\u00e9 10K'\\r\\n    END\\r\\nORDER BY MIN(valor_total_devido) DESC;\\r\\n\\r\\n-- 1.3. DISTRIBUI\\u00c7\\u00c3O POR PRIORIDADE\\r\\nSELECT \\r\\n    '1.3. DISTRIBUI\\u00c7\\u00c3O PRIORIDADE' AS consulta,\\r\\n    sp.classificacao_prioridade,\\r\\n    COUNT(DISTINCT mc.inscricao_estadual) AS quantidade,\\r\\n    ROUND(COUNT(DISTINCT mc.inscricao_estadual) * 100.0 / \\r\\n          SUM(COUNT(DISTINCT mc.inscricao_estadual)) OVER(), 2) AS percentual,\\r\\n    SUM(mc.valor_total_devido) AS valor_total,\\r\\n    ROUND(AVG(sp.score_final_priorizacao), 2) AS score_medio\\r\\nFROM gecob.prior_master_consolidado mc\\r\\nJOIN gecob.prior_score_priorizacao sp \\r\\n    ON mc.inscricao_estadual = sp.inscricao_estadual \\r\\n    AND mc.tipo_debito = sp.tipo_debito\\r\\nGROUP BY sp.classificacao_prioridade\\r\\nORDER BY \\r\\n    CASE sp.classificacao_prioridade\\r\\n        WHEN 'PRIORIDADE_MAXIMA' THEN 1\\r\\n        WHEN 'PRIORIDADE_ALTA' THEN 2\\r\\n        WHEN 'PRIORIDADE_MEDIA' THEN 3\\r\\n        ELSE 4\\r\\n    END;\\r\\n\\r\\n-- =================================================================================================\\r\\n-- SE\\u00c7\\u00c3O 2: RANKINGS E AN\\u00c1LISES\\r\\n-- =================================================================================================\\r\\n\\r\\n-- 2.1. TOP 50 CONTRIBUINTES POR SCORE\\r\\nSELECT \\r\\n    '2.1. TOP 50 SCORES' AS consulta,\\r\\n    mc.inscricao_estadual,\\r\\n    mc.razao_social,\\r\\n    mc.nome_fantasia,\\r\\n    mc.cnpj,\\r\\n    sp.score_final_priorizacao,\\r\\n    sp.classificacao_prioridade,\\r\\n    mc.valor_total_devido,\\r\\n    mc.situacao_cadastral_desc,\\r\\n    mc.porte_por_faturamento,\\r\\n    mc.qtd_total_contatos,\\r\\n    mc.flag_falencia,\\r\\n    mc.nome_municipio\\r\\nFROM gecob.prior_master_consolidado mc\\r\\nJOIN gecob.prior_score_priorizacao sp \\r\\n    ON mc.inscricao_estadual = sp.inscricao_estadual \\r\\n    AND mc.tipo_debito = sp.tipo_debito\\r\\nORDER BY sp.score_final_priorizacao DESC\\r\\nLIMIT 50;\\r\\n\\r\\n-- 2.2. TOP 30 SETORES POR VALOR\\r\\nSELECT \\r\\n    '2.2. TOP SETORES' AS consulta,\\r\\n    mc.secao_cnae,\\r\\n    mc.descricao_secao,\\r\\n    COUNT(DISTINCT mc.inscricao_estadual) AS qtd_contribuintes,\\r\\n    SUM(mc.valor_total_devido) AS valor_total,\\r\\n    ROUND(AVG(sp.score_final_priorizacao), 2) AS score_medio,\\r\\n    SUM(CASE WHEN sp.classificacao_prioridade IN ('PRIORIDADE_MAXIMA', 'PRIORIDADE_ALTA') THEN 1 ELSE 0 END) AS alta_prioridade,\\r\\n    SUM(CASE WHEN mc.flag_falencia = 1 THEN 1 ELSE 0 END) AS casos_falencia\\r\\nFROM gecob.prior_master_consolidado mc\\r\\nJOIN gecob.prior_score_priorizacao sp \\r\\n    ON mc.inscricao_estadual = sp.inscricao_estadual \\r\\n    AND mc.tipo_debito = sp.tipo_debito\\r\\nWHERE mc.secao_cnae IS NOT NULL\\r\\nGROUP BY mc.secao_cnae, mc.descricao_secao\\r\\nHAVING COUNT(DISTINCT mc.inscricao_estadual) >= 5\\r\\nORDER BY SUM(mc.valor_total_devido) DESC\\r\\nLIMIT 30;\\r\\n\\r\\n-- 2.3. TOP 20 MUNIC\\u00cdPIOS\\r\\nSELECT \\r\\n    '2.3. TOP MUNIC\\u00cdPIOS' AS consulta,\\r\\n    mc.codigo_municipio,\\r\\n    mc.nome_municipio,\\r\\n    COUNT(DISTINCT mc.inscricao_estadual) AS qtd_contribuintes,\\r\\n    SUM(mc.valor_total_devido) AS valor_total,\\r\\n    ROUND(AVG(sp.score_final_priorizacao), 2) AS score_medio,\\r\\n    SUM(CASE WHEN sp.classificacao_prioridade = 'PRIORIDADE_MAXIMA' THEN 1 ELSE 0 END) AS prioridade_maxima,\\r\\n    ROUND(AVG(mc.taxa_resposta_contatos) * 100, 2) AS taxa_resposta_pct\\r\\nFROM gecob.prior_master_consolidado mc\\r\\nJOIN gecob.prior_score_priorizacao sp \\r\\n    ON mc.inscricao_estadual = sp.inscricao_estadual \\r\\n    AND mc.tipo_debito = sp.tipo_debito\\r\\nWHERE mc.nome_municipio IS NOT NULL\\r\\nGROUP BY mc.codigo_municipio, mc.nome_municipio\\r\\nORDER BY SUM(mc.valor_total_devido) DESC\\r\\nLIMIT 20;\\r\\n\\r\\n-- 2.4. MELHOR RESPONSIVIDADE (ALTA PRIORIDADE)\\r\\nSELECT \\r\\n    '2.4. MELHOR RESPONSIVIDADE' AS consulta,\\r\\n    mc.inscricao_estadual,\\r\\n    mc.razao_social,\\r\\n    mc.valor_total_devido,\\r\\n    sp.classificacao_prioridade,\\r\\n    mc.qtd_total_contatos,\\r\\n    ROUND(mc.taxa_resposta_contatos * 100, 2) AS taxa_resposta_pct,\\r\\n    mc.qtd_promessas_pagamento,\\r\\n    fm.capacidade_pagamento_estimada,\\r\\n    fm.perfil_engajamento,\\r\\n    -- NOVAS M\\u00c9TRICAS V1.5\\r\\n    mc.qtd_contatos_ultimos_30_dias,\\r\\n    mc.qtd_contatos_ultimos_90_dias\\r\\nFROM gecob.prior_master_consolidado mc\\r\\nJOIN gecob.prior_score_priorizacao sp \\r\\n    ON mc.inscricao_estadual = sp.inscricao_estadual \\r\\n    AND mc.tipo_debito = sp.tipo_debito\\r\\nJOIN gecob.prior_features_ml fm \\r\\n    ON mc.inscricao_estadual = fm.inscricao_estadual \\r\\n    AND mc.tipo_debito = fm.tipo_debito\\r\\nWHERE sp.classificacao_prioridade IN ('PRIORIDADE_MAXIMA', 'PRIORIDADE_ALTA')\\r\\n  AND mc.qtd_total_contatos >= 3\\r\\nORDER BY mc.taxa_resposta_contatos DESC\\r\\nLIMIT 30;\\r\\n\\r\\n-- 2.5. EMPRESAS NOTEIRAS (ALTO RISCO FISCAL)\\r\\nSELECT \\r\\n    '2.5. EMPRESAS NOTEIRAS' AS consulta,\\r\\n    mc.inscricao_estadual,\\r\\n    mc.razao_social,\\r\\n    mc.cnpj,\\r\\n    mc.valor_total_devido,\\r\\n    mc.score_noteiras,\\r\\n    mc.qtd_indicios_noteiras,\\r\\n    mc.classificacao_risco_noteiras,\\r\\n    sp.score_final_priorizacao,\\r\\n    sp.classificacao_prioridade,\\r\\n    mc.situacao_cadastral_desc,\\r\\n    mc.porte_por_faturamento\\r\\nFROM gecob.prior_master_consolidado mc\\r\\nJOIN gecob.prior_score_priorizacao sp \\r\\n    ON mc.inscricao_estadual = sp.inscricao_estadual \\r\\n    AND mc.tipo_debito = sp.tipo_debito\\r\\nWHERE mc.score_noteiras > 0\\r\\nORDER BY mc.score_noteiras DESC, sp.score_final_priorizacao DESC\\r\\nLIMIT 30;\\r\\n\\r\\n-- =================================================================================================\\r\\n-- SE\\u00c7\\u00c3O 3: DOSSI\\u00ca DE CONTRIBUINTE (MODIFICAR INSCRI\\u00c7\\u00c3O ESTADUAL)\\r\\n-- =================================================================================================\\r\\n\\r\\n-- 3.1. DOSSI\\u00ca - VIS\\u00c3O GERAL\\r\\n-- MODIFICAR: Trocar '0000000000000' pela inscri\\u00e7\\u00e3o estadual desejada\\r\\nSELECT \\r\\n    '3.1. DOSSI\\u00ca GERAL' AS consulta,\\r\\n    mc.inscricao_estadual,\\r\\n    mc.cnpj,\\r\\n    mc.razao_social,\\r\\n    mc.nome_fantasia,\\r\\n    sp.score_final_priorizacao,\\r\\n    sp.classificacao_prioridade,\\r\\n    sp.score_valor_debito,\\r\\n    sp.score_capacidade_pagamento,\\r\\n    sp.score_historico_pagamento,\\r\\n    sp.score_responsividade,\\r\\n    sp.score_viabilidade_cobranca,\\r\\n    mc.valor_total_devido,\\r\\n    mc.saldo_imposto,\\r\\n    mc.saldo_multa,\\r\\n    mc.saldo_juros,\\r\\n    mc.situacao_cadastral_desc,\\r\\n    mc.cnae_classe,\\r\\n    mc.descricao_cnae,\\r\\n    mc.porte_por_faturamento,\\r\\n    mc.nome_municipio,\\r\\n    mc.qtd_socios_ativos\\r\\nFROM gecob.prior_master_consolidado mc\\r\\nJOIN gecob.prior_score_priorizacao sp \\r\\n    ON mc.inscricao_estadual = sp.inscricao_estadual \\r\\n    AND mc.tipo_debito = sp.tipo_debito\\r\\nWHERE mc.inscricao_estadual = '0000000000000'; -- << MODIFIQUE AQUI\\r\\n\\r\\n-- 3.2. DOSSI\\u00ca - HIST\\u00d3RICO DE CONTATOS\\r\\nSELECT \\r\\n    '3.2. DOSSI\\u00ca CONTATOS' AS consulta,\\r\\n    mc.inscricao_estadual,\\r\\n    mc.razao_social,\\r\\n    mc.data_inclusao_cobranca,\\r\\n    fm.dias_desde_inclusao_cobranca,\\r\\n    fm.faixa_idade_debito,\\r\\n    mc.qtd_total_contatos,\\r\\n    mc.qtd_respostas_positivas,\\r\\n    mc.qtd_respostas_negativas,\\r\\n    ROUND(mc.taxa_resposta_contatos * 100, 2) AS taxa_resposta_pct,\\r\\n    mc.qtd_promessas_pagamento,\\r\\n    mc.data_ultimo_contato,\\r\\n    mc.dias_desde_ultimo_contato,\\r\\n    fm.perfil_engajamento,\\r\\n    -- NOVAS M\\u00c9TRICAS V1.5\\r\\n    mc.qtd_contatos_ultimos_30_dias,\\r\\n    mc.qtd_contatos_ultimos_90_dias\\r\\nFROM gecob.prior_master_consolidado mc\\r\\nJOIN gecob.prior_features_ml fm \\r\\n    ON mc.inscricao_estadual = fm.inscricao_estadual \\r\\n    AND mc.tipo_debito = fm.tipo_debito\\r\\nWHERE mc.inscricao_estadual = '0000000000000'; -- << MODIFIQUE AQUI\\r\\n\\r\\n-- 3.3. DOSSI\\u00ca - AN\\u00c1LISE FINANCEIRA\\r\\nSELECT \\r\\n    '3.3. DOSSI\\u00ca FINANCEIRO' AS consulta,\\r\\n    mc.inscricao_estadual,\\r\\n    mc.razao_social,\\r\\n    mc.faturamento_total_6m,\\r\\n    mc.faturamento_medio_6m,\\r\\n    mc.icms_devido_total_6m,\\r\\n    mc.icms_recolher_total_6m,\\r\\n    mc.qtd_periodos_declarados_6m,\\r\\n    mc.qtd_periodos_omissos_6m,\\r\\n    mc.regularidade_declaracoes,\\r\\n    mc.qtd_pagamentos_6m,\\r\\n    mc.valor_total_pago_6m,\\r\\n    mc.regularidade_pagamentos,\\r\\n    ROUND(fm.capacidade_pagamento_estimada, 2) AS capacidade_pagamento,\\r\\n    ROUND(fm.taxa_pagamento_vs_devido_6m * 100, 2) AS taxa_compliance_pct,\\r\\n    ROUND(fm.score_compliance * 100, 2) AS score_compliance\\r\\nFROM gecob.prior_master_consolidado mc\\r\\nJOIN gecob.prior_features_ml fm \\r\\n    ON mc.inscricao_estadual = fm.inscricao_estadual \\r\\n    AND mc.tipo_debito = fm.tipo_debito\\r\\nWHERE mc.inscricao_estadual = '0000000000000'; -- << MODIFIQUE AQUI\\r\\n\\r\\n-- 3.4. DOSSI\\u00ca - SITUA\\u00c7\\u00c3O DE RISCO\\r\\nSELECT \\r\\n    '3.4. DOSSI\\u00ca RISCO' AS consulta,\\r\\n    mc.inscricao_estadual,\\r\\n    mc.razao_social,\\r\\n    mc.flag_falencia,\\r\\n    mc.flag_recuperacao_judicial,\\r\\n    mc.flag_devedor_contumaz,\\r\\n    mc.flag_protesto,\\r\\n    fm.score_risco_situacao,\\r\\n    mc.score_noteiras,\\r\\n    mc.qtd_indicios_noteiras,\\r\\n    mc.classificacao_risco_noteiras,\\r\\n    mc.flag_tem_parcelamento,\\r\\n    mc.status_parcelamento_desc,\\r\\n    mc.saldo_parcelado,\\r\\n    mc.numero_parcelas,\\r\\n    sp.score_viabilidade_cobranca\\r\\nFROM gecob.prior_master_consolidado mc\\r\\nJOIN gecob.prior_features_ml fm \\r\\n    ON mc.inscricao_estadual = fm.inscricao_estadual \\r\\n    AND mc.tipo_debito = fm.tipo_debito\\r\\nJOIN gecob.prior_score_priorizacao sp \\r\\n    ON mc.inscricao_estadual = sp.inscricao_estadual \\r\\n    AND mc.tipo_debito = sp.tipo_debito\\r\\nWHERE mc.inscricao_estadual = '0000000000000'; -- << MODIFIQUE AQUI\\r\\n\\r\\n-- =================================================================================================\\r\\n-- SE\\u00c7\\u00c3O 4: AN\\u00c1LISES ESPECIALIZADAS\\r\\n-- =================================================================================================\\r\\n\\r\\n-- 4.1. ALTA PRIORIDADE + BOA CAPACIDADE\\r\\nSELECT \\r\\n    '4.1. ALTA PRIORIDADE + CAPACIDADE' AS consulta,\\r\\n    mc.inscricao_estadual,\\r\\n    mc.razao_social,\\r\\n    mc.valor_total_devido,\\r\\n    sp.score_final_priorizacao,\\r\\n    sp.classificacao_prioridade,\\r\\n    fm.capacidade_pagamento_estimada,\\r\\n    mc.faturamento_medio_6m,\\r\\n    mc.regularidade_pagamentos,\\r\\n    ROUND(fm.taxa_pagamento_vs_devido_6m * 100, 2) AS taxa_compliance_pct,\\r\\n    mc.situacao_cadastral_desc,\\r\\n    mc.qtd_total_contatos,\\r\\n    fm.perfil_engajamento,\\r\\n    CASE \\r\\n        WHEN fm.taxa_efetividade_contatos >= 0.5 THEN 'CONTATO_IMEDIATO_NEGOCIACAO'\\r\\n        WHEN mc.qtd_total_contatos < 3 THEN 'INTENSIFICAR_CONTATOS'\\r\\n        WHEN mc.flag_tem_parcelamento = 0 THEN 'OFERECER_PARCELAMENTO'\\r\\n        ELSE 'NEGOCIACAO_DESCONTO'\\r\\n    END AS acao_recomendada\\r\\nFROM gecob.prior_master_consolidado mc\\r\\nJOIN gecob.prior_score_priorizacao sp \\r\\n    ON mc.inscricao_estadual = sp.inscricao_estadual \\r\\n    AND mc.tipo_debito = sp.tipo_debito\\r\\nJOIN gecob.prior_features_ml fm \\r\\n    ON mc.inscricao_estadual = fm.inscricao_estadual \\r\\n    AND mc.tipo_debito = fm.tipo_debito\\r\\nWHERE sp.classificacao_prioridade IN ('PRIORIDADE_MAXIMA', 'PRIORIDADE_ALTA')\\r\\n  AND fm.capacidade_pagamento_estimada >= 1.5\\r\\n  AND mc.flag_falencia = 0\\r\\n  AND mc.flag_recuperacao_judicial = 0\\r\\n  AND mc.situacao_cadastral_desc = 'ATIVO'\\r\\nORDER BY sp.score_final_priorizacao DESC\\r\\nLIMIT 100;\\r\\n\\r\\n-- 4.2. CASOS DE RECUPERA\\u00c7\\u00c3O P\\u00d3S-CONTATO\\r\\nSELECT \\r\\n    '4.2. RECUPERA\\u00c7\\u00c3O P\\u00d3S-CONTATO' AS consulta,\\r\\n    mc.inscricao_estadual,\\r\\n    mc.razao_social,\\r\\n    mc.valor_total_devido,\\r\\n    sp.score_final_priorizacao,\\r\\n    mc.qtd_total_contatos,\\r\\n    mc.qtd_respostas_positivas,\\r\\n    ROUND(mc.taxa_resposta_contatos * 100, 2) AS taxa_resposta_pct,\\r\\n    mc.qtd_periodos_pagamento_6m,\\r\\n    ROUND(fm.taxa_pagamento_vs_devido_6m * 100, 2) AS taxa_pagamento_pct,\\r\\n    mc.regularidade_pagamentos,\\r\\n    fm.perfil_engajamento,\\r\\n    mc.data_ultimo_contato\\r\\nFROM gecob.prior_master_consolidado mc\\r\\nJOIN gecob.prior_score_priorizacao sp \\r\\n    ON mc.inscricao_estadual = sp.inscricao_estadual \\r\\n    AND mc.tipo_debito = sp.tipo_debito\\r\\nJOIN gecob.prior_features_ml fm \\r\\n    ON mc.inscricao_estadual = fm.inscricao_estadual \\r\\n    AND mc.tipo_debito = fm.tipo_debito\\r\\nWHERE mc.qtd_respostas_positivas >= 2\\r\\n  AND mc.qtd_total_contatos >= 3\\r\\n  AND mc.taxa_resposta_contatos >= 0.4\\r\\n  AND mc.qtd_periodos_pagamento_6m >= 3\\r\\nORDER BY mc.taxa_resposta_contatos DESC\\r\\nLIMIT 50;\\r\\n\\r\\n-- 4.3. CASOS CR\\u00cdTICOS PARA D\\u00cdVIDA ATIVA\\r\\nSELECT \\r\\n    '4.3. CASOS CR\\u00cdTICOS D\\u00cdVIDA ATIVA' AS consulta,\\r\\n    mc.inscricao_estadual,\\r\\n    mc.razao_social,\\r\\n    mc.valor_total_devido,\\r\\n    fm.dias_desde_inclusao_cobranca,\\r\\n    sp.score_viabilidade_cobranca,\\r\\n    mc.flag_falencia,\\r\\n    mc.flag_recuperacao_judicial,\\r\\n    mc.situacao_cadastral_desc,\\r\\n    mc.qtd_total_contatos,\\r\\n    ROUND(mc.taxa_resposta_contatos * 100, 2) AS taxa_resposta_pct,\\r\\n    mc.classificacao_omissao,\\r\\n    CASE \\r\\n        WHEN mc.flag_falencia = 1 THEN 'FAL\\u00caNCIA'\\r\\n        WHEN mc.flag_recuperacao_judicial = 1 THEN 'RECUPERA\\u00c7\\u00c3O JUDICIAL'\\r\\n        WHEN fm.dias_desde_inclusao_cobranca > 730 AND mc.qtd_total_contatos >= 10 AND mc.taxa_resposta_contatos < 0.2 THEN 'N\\u00c3O RESPONSIVO'\\r\\n        ELSE 'OUTROS'\\r\\n    END AS motivo_principal\\r\\nFROM gecob.prior_master_consolidado mc\\r\\nJOIN gecob.prior_score_priorizacao sp \\r\\n    ON mc.inscricao_estadual = sp.inscricao_estadual \\r\\n    AND mc.tipo_debito = sp.tipo_debito\\r\\nJOIN gecob.prior_features_ml fm \\r\\n    ON mc.inscricao_estadual = fm.inscricao_estadual \\r\\n    AND mc.tipo_debito = fm.tipo_debito\\r\\nWHERE sp.score_viabilidade_cobranca < 40\\r\\n  OR mc.flag_falencia = 1\\r\\n  OR mc.flag_recuperacao_judicial = 1\\r\\nORDER BY sp.score_viabilidade_cobranca ASC\\r\\nLIMIT 100;\\r\\n\\r\\n-- 4.4. AN\\u00c1LISE DE PARCELAMENTOS\\r\\nSELECT \\r\\n    '4.4. PARCELAMENTOS' AS consulta,\\r\\n    mc.inscricao_estadual,\\r\\n    mc.razao_social,\\r\\n    mc.valor_total_devido,\\r\\n    mc.numero_parcelamento,\\r\\n    mc.status_parcelamento_desc,\\r\\n    mc.saldo_parcelado,\\r\\n    mc.numero_parcelas,\\r\\n    fm.capacidade_pagamento_estimada,\\r\\n    mc.regularidade_pagamentos,\\r\\n    CASE \\r\\n        WHEN mc.status_parcelamento_desc = 'INADIMPLENTE' THEN 'ALERTA: Inadimplente'\\r\\n        WHEN fm.capacidade_pagamento_estimada >= 3 THEN 'Oportunidade Quita\\u00e7\\u00e3o'\\r\\n        ELSE 'Normal'\\r\\n    END AS status_alerta\\r\\nFROM gecob.prior_master_consolidado mc\\r\\nJOIN gecob.prior_features_ml fm \\r\\n    ON mc.inscricao_estadual = fm.inscricao_estadual \\r\\n    AND mc.tipo_debito = fm.tipo_debito\\r\\nWHERE mc.flag_tem_parcelamento = 1\\r\\nORDER BY \\r\\n    CASE mc.status_parcelamento_desc \\r\\n        WHEN 'INADIMPLENTE' THEN 1\\r\\n        WHEN 'ATIVO' THEN 2\\r\\n        ELSE 3 \\r\\n    END,\\r\\n    mc.saldo_parcelado DESC;\\r\\n\\r\\n-- 4.5. IMPACTO ARRECADAT\\u00d3RIO POR SETOR\\r\\nSELECT \\r\\n    '4.5. IMPACTO POR SETOR' AS consulta,\\r\\n    mc.secao_cnae,\\r\\n    mc.descricao_secao,\\r\\n    COUNT(DISTINCT mc.inscricao_estadual) AS qtd_total,\\r\\n    SUM(mc.valor_total_devido) AS valor_total,\\r\\n    SUM(CASE \\r\\n        WHEN sp.classificacao_prioridade IN ('PRIORIDADE_MAXIMA', 'PRIORIDADE_ALTA')\\r\\n        AND fm.capacidade_pagamento_estimada >= 1.5\\r\\n        AND mc.flag_falencia = 0\\r\\n        THEN 1 ELSE 0\\r\\n    END) AS casos_alta_recuperabilidade,\\r\\n    SUM(CASE \\r\\n        WHEN sp.classificacao_prioridade IN ('PRIORIDADE_MAXIMA', 'PRIORIDADE_ALTA')\\r\\n        AND fm.capacidade_pagamento_estimada >= 1.5\\r\\n        AND mc.flag_falencia = 0\\r\\n        THEN mc.valor_total_devido ELSE 0\\r\\n    END) AS valor_recuperavel,\\r\\n    ROUND(AVG(sp.score_final_priorizacao), 2) AS score_medio\\r\\nFROM gecob.prior_master_consolidado mc\\r\\nJOIN gecob.prior_score_priorizacao sp \\r\\n    ON mc.inscricao_estadual = sp.inscricao_estadual \\r\\n    AND mc.tipo_debito = sp.tipo_debito\\r\\nJOIN gecob.prior_features_ml fm \\r\\n    ON mc.inscricao_estadual = fm.inscricao_estadual \\r\\n    AND mc.tipo_debito = fm.tipo_debito\\r\\nWHERE mc.secao_cnae IS NOT NULL\\r\\nGROUP BY mc.secao_cnae, mc.descricao_secao\\r\\nHAVING COUNT(DISTINCT mc.inscricao_estadual) >= 5\\r\\nORDER BY valor_recuperavel DESC\\r\\nLIMIT 30;\\r\\n\\r\\n-- =================================================================================================\\r\\n-- SE\\u00c7\\u00c3O 5: DASHBOARD EXECUTIVO\\r\\n-- =================================================================================================\\r\\n\\r\\n-- 5.1. KPIs PRINCIPAIS\\r\\nSELECT \\r\\n    'DASHBOARD EXECUTIVO' AS consulta,\\r\\n    COUNT(DISTINCT mc.inscricao_estadual) AS total_contribuintes,\\r\\n    SUM(mc.valor_total_devido) AS divida_total,\\r\\n    SUM(CASE WHEN sp.classificacao_prioridade = 'PRIORIDADE_MAXIMA' THEN 1 ELSE 0 END) AS qtd_prioridade_maxima,\\r\\n    SUM(CASE WHEN sp.classificacao_prioridade = 'PRIORIDADE_ALTA' THEN 1 ELSE 0 END) AS qtd_prioridade_alta,\\r\\n    SUM(CASE \\r\\n        WHEN sp.classificacao_prioridade IN ('PRIORIDADE_MAXIMA', 'PRIORIDADE_ALTA')\\r\\n        AND fm.capacidade_pagamento_estimada >= 1.5\\r\\n        AND mc.flag_falencia = 0\\r\\n        THEN 1 ELSE 0\\r\\n    END) AS casos_alta_recuperabilidade,\\r\\n    SUM(CASE \\r\\n        WHEN sp.classificacao_prioridade IN ('PRIORIDADE_MAXIMA', 'PRIORIDADE_ALTA')\\r\\n        AND fm.capacidade_pagamento_estimada >= 1.5\\r\\n        AND mc.flag_falencia = 0\\r\\n        THEN mc.valor_total_devido ELSE 0\\r\\n    END) AS valor_alta_recuperabilidade,\\r\\n    ROUND(AVG(mc.taxa_resposta_contatos) * 100, 2) AS taxa_resposta_pct,\\r\\n    SUM(CASE WHEN mc.flag_falencia = 1 THEN 1 ELSE 0 END) AS casos_falencia,\\r\\n    SUM(CASE WHEN sp.score_viabilidade_cobranca < 40 THEN 1 ELSE 0 END) AS casos_baixa_viabilidade,\\r\\n    FROM_UNIXTIME(UNIX_TIMESTAMP()) AS data_atualizacao\\r\\nFROM gecob.prior_master_consolidado mc\\r\\nJOIN gecob.prior_score_priorizacao sp \\r\\n    ON mc.inscricao_estadual = sp.inscricao_estadual \\r\\n    AND mc.tipo_debito = sp.tipo_debito\\r\\nJOIN gecob.prior_features_ml fm \\r\\n    ON mc.inscricao_estadual = fm.inscricao_estadual \\r\\n    AND mc.tipo_debito = fm.tipo_debito;\", \"lastExecutedSelectionRange\": {\"start\": {\"row\": 0, \"column\": 0}, \"end\": {\"row\": 514, \"column\": 40}}, \"formatEnabled\": true, \"isFetchingData\": false, \"isCanceling\": false, \"aceAutoExpand\": false, \"lastCheckStatusRequest\": {\"readyState\": 4, \"responseText\": \"{\\\"status\\\": 0, \\\"query_status\\\": {\\\"status\\\": \\\"available\\\"}}\", \"responseJSON\": {\"status\": 0, \"query_status\": {\"status\": \"available\"}}, \"status\": 200, \"statusText\": \"OK\"}, \"lastGetLogsRequest\": {\"readyState\": 4, \"responseText\": \"{\\\"status\\\": 0, \\\"logs\\\": \\\"Query 9545064c4fdfd825:701a49e000000000 100% Complete (20 out of 20)\\\", \\\"progress\\\": 100, \\\"jobs\\\": [{\\\"name\\\": \\\"9545064c4fdfd825:701a49e000000000\\\", \\\"url\\\": \\\"/hue/jobbrowser#!id=9545064c4fdfd825:701a49e000000000\\\", \\\"started\\\": true, \\\"finished\\\": false, \\\"percentJob\\\": 100}], \\\"isFullLogs\\\": false}\", \"responseJSON\": {\"status\": 0, \"logs\": \"Query 9545064c4fdfd825:701a49e000000000 100% Complete (20 out of 20)\", \"progress\": 100, \"jobs\": [{\"name\": \"9545064c4fdfd825:701a49e000000000\", \"url\": \"/hue/jobbrowser#!id=9545064c4fdfd825:701a49e000000000\", \"started\": true, \"finished\": false, \"percentJob\": 100}], \"isFullLogs\": false}, \"status\": 200, \"statusText\": \"OK\"}}], \"selectedSnippet\": \"impala\", \"creatingSessionLocks\": [], \"sessions\": [], \"directoryUuid\": \"\", \"dependentsCoordinator\": [], \"historyFilter\": \"\", \"historyFilterVisible\": false, \"loadingHistory\": false, \"historyInitialHeight\": 12980, \"forceHistoryInitialHeight\": false, \"historyCurrentPage\": 1, \"historyTotalPages\": 112, \"schedulerViewModel\": null, \"schedulerViewModelIsLoaded\": false, \"isBatchable\": true, \"isExecutingAll\": false, \"executingAllIndex\": 0, \"retryModalConfirm\": null, \"retryModalCancel\": null, \"canSave\": true, \"unloaded\": false, \"updateHistoryFailed\": false, \"viewSchedulerId\": \"\", \"loadingScheduler\": false}",
    "extra": "",
    "search": "/***************************************************************************************************\r\n * SISTEMA DE PRIORIZAÃ‡ÃƒO DE COBRANÃ‡A - CONSULTAS ANALÃTICAS V3 (COMPATÃVEL COM V1.5)\r\n * Receita Estadual de Santa Catarina - GECOB\r\n * Data: 09 de Outubro de 2025\r\n * \r\n * CORREÃ‡Ã•ES V3:\r\n * - Compatibilizado com V1.5 do sistema (prÃ©-agregaÃ§Ã£o de conta corrente)\r\n * - Adicionadas novas mÃ©tricas de contatos (30/90 dias)\r\n * - Otimizado para trabalhar com dados jÃ¡ agregados\r\n * - Removidas duplicaÃ§Ãµes usando agregaÃ§Ã£o por inscricao_estadual\r\n ***************************************************************************************************/\r\n\r\nSET REQUEST_POOL = 'medium';\r\nSET MEM_LIMIT = 8G;\r\n\r\n-- =================================================================================================\r\n-- SEÃ‡ÃƒO 1: ESTATÃSTICAS GERAIS DO SISTEMA\r\n-- =================================================================================================\r\n\r\n-- 1.1. PANORAMA GERAL\r\nSELECT \r\n    '1.1. PANORAMA GERAL' AS consulta,\r\n    COUNT(DISTINCT mc.inscricao_estadual) AS total_contribuintes,\r\n    SUM(mc.valor_total_devido) AS divida_total,\r\n    ROUND(AVG(mc.valor_total_devido), 2) AS divida_media,\r\n    COUNT(DISTINCT CASE WHEN sp.classificacao_prioridade = 'PRIORIDADE_MAXIMA' THEN mc.inscricao_estadual END) AS prioridade_maxima,\r\n    COUNT(DISTINCT CASE WHEN sp.classificacao_prioridade = 'PRIORIDADE_ALTA' THEN mc.inscricao_estadual END) AS prioridade_alta,\r\n    ROUND(AVG(mc.taxa_resposta_contatos) * 100, 2) AS taxa_resposta_pct,\r\n    COUNT(DISTINCT CASE WHEN mc.flag_falencia = 1 THEN mc.inscricao_estadual END) AS casos_falencia,\r\n    FROM_UNIXTIME(UNIX_TIMESTAMP()) AS data_atualizacao\r\nFROM gecob.prior_master_consolidado mc\r\nLEFT JOIN gecob.prior_score_priorizacao sp \r\n    ON mc.inscricao_estadual = sp.inscricao_estadual \r\n    AND mc.tipo_debito = sp.tipo_debito;\r\n\r\n-- 1.2. DISTRIBUIÃ‡ÃƒO POR FAIXAS DE VALOR\r\nSELECT \r\n    '1.2. FAIXAS DE VALOR' AS consulta,\r\n    CASE \r\n        WHEN ",
    "last_modified": "2025-10-09T14:22:48.684",
    "version": 1,
    "is_history": false,
    "is_managed": false,
    "is_trashed": false,
    "parent_directory": [
      "13addfc5-7ea3-4f33-bd07-f3b8ce8c58f9",
      1,
      false
    ],
    "dependencies": []
  }
}
]
